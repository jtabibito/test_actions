{"version":3,"file":"RequestHook-17580c86.js","sources":["../../../../node_modules/.pnpm/@swc+helpers@0.5.7/node_modules/@swc/helpers/esm/_create_class.js","../../src/hooks/RequestHook.ts"],"sourcesContent":["function _defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n        var descriptor = props[i];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n\n        if (\"value\" in descriptor) descriptor.writable = true;\n\n        Object.defineProperty(target, descriptor.key, descriptor);\n    }\n}\nexport function _create_class(Constructor, protoProps, staticProps) {\n    if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) _defineProperties(Constructor, staticProps);\n\n    return Constructor;\n}\nexport { _create_class as _ };\n","\nlet requestSize = 0;\n\nexport function hookRequest() {\n\n  let originalSend = XMLHttpRequest.prototype.send;\n  \n  const cacheMap = new Map<string, number>();\n  function addRequestSize(url: string, size: number) {\n    if (cacheMap.get(url) == undefined) {\n      cacheMap.set(url, size);\n      requestSize += size;\n    }\n  }\n  \n  XMLHttpRequest.prototype.send = function (body) {\n    this.addEventListener(\n      \"load\",\n      function () {\n        let size = 0;\n        if (this.responseType === \"\" || this.responseType === \"text\") {\n          size = new Blob([JSON.stringify(this.responseText)]).size;\n        } else if (this.response instanceof Blob) {\n          size = this.response.size;\n        } else if (this.response instanceof ArrayBuffer) {\n          size = this.response.byteLength;\n        } else if (this.responseType === \"json\") {\n          size = new Blob([JSON.stringify(this.response)]).size;\n        }\n  \n        addRequestSize((this as XMLHttpRequest).responseURL, size);\n      },\n      false\n    );\n  \n    originalSend.call(this, body);\n  \n    var originalImageSrc = Object.getOwnPropertyDescriptor(\n      Image.prototype,\n      \"src\"\n    ).set;\n  \n    this.originalImageSrc = originalImageSrc;\n  \n    Object.defineProperty(Image.prototype, \"src\", {\n      set: function (value) {\n        fetch(value).then((response) => {\n          if (response.ok) {\n            response.blob().then((blob) => {\n              addRequestSize((this as XMLHttpRequest).responseURL, blob.size);\n            });\n          }\n        });\n        originalImageSrc.call(this, value);\n      },\n    });\n  };\n}\n\n\nexport class RequestHook {\n  private _originalSend;\n  private _hooked = false;\n\n  get size() {\n    return formatNumber(requestSize / 1024 / 1024);\n  }\n\n  constructor() {\n    this._hooked = true;\n  }\n\n  public reset(): void {\n    requestSize = 0;\n  }\n\n  public release(): void {\n    if (this._hooked) {\n      XMLHttpRequest.prototype.send = this._originalSend;\n      Object.defineProperty(Image.prototype, \"src\", {\n        set: function (value) {\n          this.src.call(this, value);\n        },\n      });\n    }\n    this._hooked = false;\n  }\n}\n\nfunction formatNumber(num: number): string {\n  return Number(num).toFixed(\n    Math.max(6 - num.toString().split(\".\")[0].length, 0)\n  );\n}\n"],"names":["requestSize","hookRequest","originalSend","XMLHttpRequest","prototype","send","cacheMap","Map","addRequestSize","url","size","get","undefined","set","body","addEventListener","responseType","Blob","JSON","stringify","responseText","response","ArrayBuffer","byteLength","responseURL","call","originalImageSrc","Object","getOwnPropertyDescriptor","Image","defineProperty","value","fetch","then","ok","blob","RequestHook","_hooked","reset","release","_originalSend","src","formatNumber","num","Number","toFixed","Math","max","toString","split","length"],"mappings":"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","x_google_ignoreList":[0]}