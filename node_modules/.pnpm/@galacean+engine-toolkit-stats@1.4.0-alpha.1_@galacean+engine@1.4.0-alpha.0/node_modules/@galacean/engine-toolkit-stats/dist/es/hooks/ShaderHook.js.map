{"version":3,"file":"ShaderHook.js","sources":["../../../src/hooks/ShaderHook.ts"],"sourcesContent":["import { log } from \"../log\";\n\n/**\n * @class ShaderHook\n */\nexport default class ShaderHook {\n  public shaders: number = 0;\n  private readonly realAttachShader: any;\n  private readonly realDetachShader: any;\n  private readonly gl: WebGLRenderingContext | WebGL2RenderingContext;\n  private hooked: boolean;\n\n  constructor(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.realAttachShader = gl.attachShader;\n    this.realDetachShader = gl.detachShader;\n\n    gl.attachShader = this.hookedAttachShader.bind(this);\n    gl.detachShader = this.hookedDetachShader.bind(this);\n\n    this.hooked = true;\n    this.gl = gl;\n\n    log(`Shader is hooked.`);\n  }\n\n  private hookedAttachShader(program: any, shader: any): void {\n    this.realAttachShader.call(this.gl, program, shader);\n\n    this.shaders++;\n\n    log(`AttachShader:`, shader, `shaders: ${this.shaders}`);\n  }\n\n  private hookedDetachShader(program: any, shader: any): void {\n    this.realDetachShader.call(this.gl, program, shader);\n\n    this.shaders--;\n\n    log(`DetachShader. shaders: ${this.shaders}`);\n  }\n\n  public reset(): void {\n    this.shaders = 0;\n  }\n\n  public release(): void {\n    if (this.hooked) {\n      this.gl.attachShader = this.realAttachShader;\n      this.gl.detachShader = this.realDetachShader;\n    }\n\n    this.hooked = false;\n  }\n}\n"],"names":["ShaderHook","gl","shaders","realAttachShader","attachShader","realDetachShader","detachShader","hookedAttachShader","bind","hookedDetachShader","hooked","log","program","shader","call","reset","release"],"mappings":";;;AAKe,IAAMA,2BAAD,WAAL;AAAMA,IAAAA,SAAAA,UAAAA,CAOPC,EAAkD,EAAA;aANvDC,OAAkB,GAAA,CAAA,CAAA;AAOvB,QAAA,IAAI,CAACC,gBAAgB,GAAGF,EAAAA,CAAGG,YAAY,CAAA;AACvC,QAAA,IAAI,CAACC,gBAAgB,GAAGJ,EAAAA,CAAGK,YAAY,CAAA;QAEvCL,EAAGG,CAAAA,YAAY,GAAG,IAAI,CAACG,kBAAkB,CAACC,IAAI,CAAC,IAAI,CAAA,CAAA;QACnDP,EAAGK,CAAAA,YAAY,GAAG,IAAI,CAACG,kBAAkB,CAACD,IAAI,CAAC,IAAI,CAAA,CAAA;QAEnD,IAAI,CAACE,MAAM,GAAG,IAAA,CAAA;QACd,IAAI,CAACT,EAAE,GAAGA,EAAAA,CAAAA;QAEVU,GAAK,CAAA,mBAAA,CAAA,CAAA;;AAjBYX,IAAAA,IAAAA,MAAAA,GAAAA,UAAAA,CAAAA,SAAAA,CAAAA;AAoBnB,IAAA,MAAA,CAAQO,kBAMP,GAND,SAAQA,kBAAmBK,CAAAA,OAAY,EAAEC,MAAW,EAAA;QAClD,IAAI,CAACV,gBAAgB,CAACW,IAAI,CAAC,IAAI,CAACb,EAAE,EAAEW,OAASC,EAAAA,MAAAA,CAAAA,CAAAA;AAE7C,QAAA,IAAI,CAACX,OAAO,EAAA,CAAA;AAEZS,QAAAA,GAAAA,CAAK,iBAAgBE,MAAQ,EAAC,WAAW,GAAA,IAAI,CAACX,OAAO,CAAA,CAAA;AACvD,KAAA,CAAA;AAEA,IAAA,MAAA,CAAQO,kBAMP,GAND,SAAQA,kBAAmBG,CAAAA,OAAY,EAAEC,MAAW,EAAA;QAClD,IAAI,CAACR,gBAAgB,CAACS,IAAI,CAAC,IAAI,CAACb,EAAE,EAAEW,OAASC,EAAAA,MAAAA,CAAAA,CAAAA;AAE7C,QAAA,IAAI,CAACX,OAAO,EAAA,CAAA;AAEZS,QAAAA,GAAAA,CAAI,yBAAC,GAAyB,IAAI,CAACT,OAAO,CAAA,CAAA;AAC5C,KAAA,CAAA;IAEA,MAAOa,CAAAA,KAEN,GAFD,SAAOA,KAAAA,GAAAA;QACL,IAAI,CAACb,OAAO,GAAG,CAAA,CAAA;AACjB,KAAA,CAAA;IAEA,MAAOc,CAAAA,OAON,GAPD,SAAOA,OAAAA,GAAAA;QACL,IAAI,IAAI,CAACN,MAAM,EAAE;AACf,YAAA,IAAI,CAACT,EAAE,CAACG,YAAY,GAAG,IAAI,CAACD,gBAAgB,CAAA;AAC5C,YAAA,IAAI,CAACF,EAAE,CAACK,YAAY,GAAG,IAAI,CAACD,gBAAgB,CAAA;AAC9C,SAAA;QAEA,IAAI,CAACK,MAAM,GAAG,KAAA,CAAA;AAChB,KAAA,CAAA;AA/CmBV,IAAAA,OAAAA,UAAAA,CAAAA;;;;;"}