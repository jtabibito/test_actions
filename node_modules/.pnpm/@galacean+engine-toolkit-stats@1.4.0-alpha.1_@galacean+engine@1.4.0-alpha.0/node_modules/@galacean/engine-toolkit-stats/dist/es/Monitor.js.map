{"version":3,"file":"Monitor.js","sources":["../../src/Monitor.ts"],"sourcesContent":["import { Core } from \"./Core\";\n\nlet tpl = `\n  <dl>\n    <dt>FPS</dt>\n    <dd>0</dd>\n    <dt>Memory <span class=\"unit\">(MB)</span></dt>\n    <dd>0</dd>\n    <dt>DrawCall</dt>\n    <dd>0</dd>\n    <dt>Triangles</dt>\n    <dd>0</dd>\n    <dt>Textures</dt>\n    <dd>0</dd>\n    <dt>Shaders</dt>\n    <dd>0</dd>\n    <dt>Network Size <span class=\"unit\">(MB)</span></dt>\n    <dd>0</dd>\n    <dt>WebGL</dt>\n    <dd></dd>\n  </dl>\n`;\nlet css = `\n  .gl-perf {\n    pointer-events: none;\n    user-select: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    padding: ${10 / 7.5}vh ${10 / 7.5}vh 0 ${10 / 7.5}vh;\n    background: rgba(0, 0, 0, 0.3);\n    color: #fff;\n    font: ${10 / 7.5}vh arial;\n  }\n\n  .gl-perf dl,\n  .gl-perf dt,\n  .gl-perf dd {\n    padding: 0;\n    margin: 0;\n  }\n\n  .gl-perf dt {\n    color: #fff;\n    text-shadow: #000 0 0 1px;\n  }\n\n  .gl-perf dt .unit{\n    font-size: ${10 / 7.5}vh;\n  }\n\n  .gl-perf dd {\n    font-size: ${20 / 7.5}vh;\n    padding: ${10 / 7.5}vh 0 ${10 / 7.5}vh;\n  }\n`;\n\nexport default class Monitor {\n  private core: Core;\n  private doms: HTMLElement[];\n  private container: HTMLElement;\n  private readonly items: string[];\n\n  constructor(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.core = new Core(gl);\n    this.items = [];\n    this.items = [\n      \"fps\",\n      \"memory\",\n      \"drawCall\",\n      \"triangles\",\n      \"textures\",\n      \"shaders\",\n      \"size\",\n      \"webglContext\",\n    ];\n    this.createContainer();\n    this.update = this.update.bind(this);\n  }\n\n  private createContainer(): void {\n    let container = document.createElement(\"div\");\n    container.classList.add(\"gl-perf\");\n    container.innerHTML = tpl;\n\n    container.appendChild(this.createStyle());\n\n    document.body.appendChild(container);\n\n    this.doms = Array.prototype.slice.apply(container.querySelectorAll(\"dd\"));\n    this.container = container;\n  }\n\n  private createStyle(): HTMLStyleElement {\n    let style: HTMLStyleElement = document.createElement(\"style\");\n\n    style.type = \"text/css\";\n\n    style.appendChild(document.createTextNode(css));\n\n    return style;\n  }\n\n  /**\n   * Update per frame\n   */\n  public update(): void {\n    let data = this.core.update();\n\n    if (data) {\n      for (let i = 0, l = this.items.length; i < l; i++) {\n        let dom = this.doms[i];\n        let item = this.items[i];\n        let value = data[item] || 0;\n\n        // see: http://wilsonpage.co.uk/preventing-layout-thrashing/\n        requestAnimationFrame(() => {\n          dom.innerText = value;\n        });\n      }\n    }\n  }\n\n  /**\n   * reset all hooks\n   */\n  public reset(): void {\n    this.core.reset();\n  }\n\n  /**\n   * release all hooks\n   */\n  public release(): void {\n    this.core.release();\n  }\n\n  /**\n   * destroy the instance\n   */\n  public destroy(): void {\n    this.release();\n    document.body.removeChild(this.container);\n  }\n}\n"],"names":["tpl","css","Monitor","gl","core","Core","items","createContainer","update","bind","container","document","createElement","classList","add","innerHTML","appendChild","createStyle","body","doms","Array","prototype","slice","apply","querySelectorAll","style","type","createTextNode","data","dom","i","item","value","requestAnimationFrame","innerText","l","length","reset","release","destroy","removeChild"],"mappings":"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"}