!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("@galacean/engine")):"function"==typeof define&&define.amd?define(["exports","@galacean/engine"],i):i(((t="undefined"!=typeof globalThis?globalThis:t||self).Galacean=t.Galacean||{},t.Galacean.PhysicsLite={}),t.Galacean)}(this,function(t,i){"use strict";function e(t,i){return(e=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function s(t,i){if("function"!=typeof i&&null!==i)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&e(t,i)}function n(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function o(t,i,e){return i&&n(t.prototype,i),e&&n(t,e),t}function r(t,i){return null!=i&&"undefined"!=typeof Symbol&&i[Symbol.hasInstance]?!!i[Symbol.hasInstance](t):t instanceof i}var a=/*#__PURE__*/function(){function t(t){void 0===t&&(t=[]),this._flags=t,this.flag=!0,this._flags.push(this)}return t.prototype.destroy=function(){i.Utils.removeFromArray(this._flags,this),this._flags=null},t}(),h=/*#__PURE__*/function(){function t(){this._updateFlags=[]}var i=t.prototype;return i.register=function(){return new a(this._updateFlags)},i.distribute=function(){for(var t=this._updateFlags,i=t.length-1;i>=0;i--)t[i].flag=!0},t}(),l=/*#__PURE__*/function(){function t(){this._position=new i.Vector3,this._worldScale=new i.Vector3(1,1,1),this._transform=new c,this._invModelMatrix=new i.Matrix,this._transform.owner=this,this._inverseWorldMatFlag=this._transform.registerWorldChangeFlag()}var e=t.prototype;return e.setRotation=function(t){console.log("Physics-lite don't support setRotation. Use Physics-PhysX instead!")},e.setPosition=function(t){t!==this._position&&this._position.copyFrom(t),this._setLocalPose()},e.setWorldScale=function(t){this._worldScale.copyFrom(t),this._setLocalPose()},e.setContactOffset=function(t){console.log("Physics-lite don't support setContactOffset. Use Physics-PhysX instead!")},e.setMaterial=function(t){console.log("Physics-lite don't support setMaterial. Use Physics-PhysX instead!")},e.setUniqueID=function(t){this._id=t},e.setIsTrigger=function(t){console.log("Physics-lite don't support setIsTrigger. Use Physics-PhysX instead!")},e.destroy=function(){},e._updateHitResult=function(e,s,n,o,r){void 0===r&&(r=!1);var a=t._tempPoint;e.getPoint(s,a),r||i.Vector3.transformCoordinate(a,this._transform.worldMatrix,a);var h=i.Vector3.distance(o,a);h<n.distance&&(n.point.copyFrom(a),n.distance=h,n.shapeID=this._id)},e._getLocalRay=function(e){var s=this._getInvModelMatrix(),n=t._ray;return i.Vector3.transformCoordinate(e.origin,s,n.origin),i.Vector3.transformNormal(e.direction,s,n.direction),n.direction.normalize(),n},e._getInvModelMatrix=function(){return this._inverseWorldMatFlag.flag&&(i.Matrix.invert(this._transform.worldMatrix,this._invModelMatrix),this._inverseWorldMatFlag.flag=!1),this._invModelMatrix},e._setLocalPose=function(){var e=t._tempPoint;i.Vector3.multiply(this._position,this._worldScale,e),this._transform.position=e},t}();l._ray=new i.Ray,l._tempPoint=new i.Vector3;var c=/*#__PURE__*/function(){function t(){this._position=new i.Vector3,this._rotation=new i.Vector3,this._rotationQuaternion=new i.Quaternion,this._scale=new i.Vector3(1,1,1),this._worldRotationQuaternion=new i.Quaternion,this._localMatrix=new i.Matrix,this._worldMatrix=new i.Matrix,this._updateFlagManager=new h,this._isParentDirty=!0,this._parentTransformCache=null,this._dirtyFlag=188}var e=t.prototype;return e.setPosition=function(t,i,e){this._position.set(t,i,e),this.position=this._position},e.setRotationQuaternion=function(t,i,e,s){this._rotationQuaternion.set(t,i,e,s),this.rotationQuaternion=this._rotationQuaternion},e.setScale=function(t,i,e){this._scale.set(t,i,e),this.scale=this._scale},e.registerWorldChangeFlag=function(){return this._updateFlagManager.register()},e._updateWorldPositionFlag=function(){if(!this._isContainDirtyFlags(132)&&(this._worldAssociatedChange(132),r(this._owner,u)))for(var t=this._owner._shapes,i=0,e=t.length;i<e;i++)t[i]._transform._updateWorldPositionFlag()},e._updateWorldRotationFlag=function(){if(!this._isContainDirtyFlags(152)&&(this._worldAssociatedChange(152),r(this._owner,u)))for(var t=this._owner._shapes,i=0,e=t.length;i<e;i++)t[i]._transform._updateWorldRotationFlag()},e._updateWorldScaleFlag=function(){if(!this._isContainDirtyFlags(160)&&(this._worldAssociatedChange(160),r(this._owner,u)))for(var t=this._owner._shapes,i=0,e=t.length;i<e;i++)t[i]._transform._updateWorldScaleFlag()},e._updateAllWorldFlag=function(){if(!this._isContainDirtyFlags(188)&&(this._worldAssociatedChange(188),r(this._owner,u)))for(var t=this._owner._shapes,i=0,e=t.length;i<e;i++)t[i]._transform._updateAllWorldFlag()},e._getParentTransform=function(){if(!this._isParentDirty)return this._parentTransformCache;var t=null;return r(this._owner,l)&&(t=this._owner._collider._transform),this._parentTransformCache=t,this._isParentDirty=!1,t},e._isContainDirtyFlags=function(t){return(this._dirtyFlag&t)===t},e._isContainDirtyFlag=function(t){return(this._dirtyFlag&t)!=0},e._setDirtyFlagTrue=function(t){this._dirtyFlag|=t},e._setDirtyFlagFalse=function(t){this._dirtyFlag&=~t},e._worldAssociatedChange=function(t){this._dirtyFlag|=t,this._updateFlagManager.distribute()},o(t,[{key:"owner",set:function(t){this._owner=t}},{key:"position",get:function(){return this._position},set:function(t){this._position!==t&&this._position.copyFrom(t),this._setDirtyFlagTrue(64),this._updateWorldPositionFlag()}},{key:"rotationQuaternion",get:function(){return this._isContainDirtyFlag(2)&&(i.Quaternion.rotationEuler(i.MathUtil.degreeToRadian(this._rotation.x),i.MathUtil.degreeToRadian(this._rotation.y),i.MathUtil.degreeToRadian(this._rotation.z),this._rotationQuaternion),this._setDirtyFlagFalse(2)),this._rotationQuaternion},set:function(t){this._rotationQuaternion!==t&&this._rotationQuaternion.copyFrom(t),this._setDirtyFlagTrue(65),this._setDirtyFlagFalse(2),this._updateWorldRotationFlag()}},{key:"worldRotationQuaternion",get:function(){if(this._isContainDirtyFlag(16)){var t=this._getParentTransform();null!=t?i.Quaternion.multiply(t.worldRotationQuaternion,this.rotationQuaternion,this._worldRotationQuaternion):this._worldRotationQuaternion.copyFrom(this.rotationQuaternion),this._setDirtyFlagFalse(16)}return this._worldRotationQuaternion},set:function(e){this._worldRotationQuaternion!==e&&this._worldRotationQuaternion.copyFrom(e);var s=this._getParentTransform();s?(i.Quaternion.invert(s.worldRotationQuaternion,t._tempQuat0),i.Quaternion.multiply(e,t._tempQuat0,this._rotationQuaternion)):this._rotationQuaternion.copyFrom(e),this.rotationQuaternion=this._rotationQuaternion,this._setDirtyFlagFalse(16)}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale!==t&&this._scale.copyFrom(t),this._setDirtyFlagTrue(64),this._updateWorldScaleFlag()}},{key:"localMatrix",get:function(){return this._isContainDirtyFlag(64)&&(i.Matrix.affineTransformation(this._scale,this.rotationQuaternion,this._position,this._localMatrix),this._setDirtyFlagFalse(64)),this._localMatrix},set:function(t){this._localMatrix!==t&&this._localMatrix.copyFrom(t),this._localMatrix.decompose(this._position,this._rotationQuaternion,this._scale),this._setDirtyFlagTrue(1),this._setDirtyFlagFalse(64),this._updateAllWorldFlag()}},{key:"worldMatrix",get:function(){if(this._isContainDirtyFlag(128)){var t=this._getParentTransform();t?i.Matrix.multiply(t.worldMatrix,this.localMatrix,this._worldMatrix):this._worldMatrix.copyFrom(this.localMatrix),this._setDirtyFlagFalse(128)}return this._worldMatrix},set:function(e){this._worldMatrix!==e&&this._worldMatrix.copyFrom(e);var s=this._getParentTransform();s?(i.Matrix.invert(s.worldMatrix,t._tempMat42),i.Matrix.multiply(t._tempMat42,e,this._localMatrix)):this._localMatrix.copyFrom(e),this.localMatrix=this._localMatrix,this._setDirtyFlagFalse(128)}}]),t}();c._tempQuat0=new i.Quaternion,c._tempMat42=new i.Matrix;var u=/*#__PURE__*/function(){function t(){this._shapes=[],this._transform=new c,this._transform.owner=this}var i=t.prototype;return i.addShape=function(t){var i=t._collider;i!==this&&(i&&i.removeShape(t),this._shapes.push(t),t._collider=this)},i.removeShape=function(t){var i=this._shapes.indexOf(t);-1!==i&&(this._shapes.splice(i,1),t._collider=null)},i.setWorldTransform=function(t,i){this._transform.setPosition(t.x,t.y,t.z),this._transform.setRotationQuaternion(i.x,i.y,i.z,i.w)},i.getWorldTransform=function(t,i){var e=this._transform,s=e.position,n=e.rotationQuaternion;t.set(s.x,s.y,s.z),i.set(n.x,n.y,n.z,n.w)},i.destroy=function(){},i._raycast=function(t,i,e){e.distance=Number.MAX_VALUE;for(var s=this._shapes,n=0,o=s.length;n<o;n++){var r=s[n];i(r._id)&&r._raycast(t,e)}return e.distance!=Number.MAX_VALUE},t}(),d=/*#__PURE__*/function(t){function i(i,e){var s;return(s=t.call(this)||this)._isStaticCollider=!1,s._transform.setPosition(i.x,i.y,i.z),s._transform.setRotationQuaternion(e.x,e.y,e.z,e.w),s}s(i,t);var e=i.prototype;return e.addForce=function(t){throw"Physics-lite don't support addForce. Use Physics-PhysX instead!"},e.addTorque=function(t){throw"Physics-lite don't support addTorque. Use Physics-PhysX instead!"},e.move=function(t,i){throw"Physics-lite don't support move. Use Physics-PhysX instead!"},e.sleep=function(){throw"Physics-lite don't support putToSleep. Use Physics-PhysX instead!"},e.setAngularDamping=function(t){throw"Physics-lite don't support setAngularDamping. Use Physics-PhysX instead!"},e.setAngularVelocity=function(t){throw"Physics-lite don't support setAngularVelocity. Use Physics-PhysX instead!"},e.setCenterOfMass=function(t){throw"Physics-lite don't support setCenterOfMass. Use Physics-PhysX instead!"},e.setCollisionDetectionMode=function(t){throw"Physics-lite don't support setCollisionDetectionMode. Use Physics-PhysX instead!"},e.setConstraints=function(t){throw"Physics-lite don't support setConstraints. Use Physics-PhysX instead!"},e.setInertiaTensor=function(t){throw"Physics-lite don't support setInertiaTensor. Use Physics-PhysX instead!"},e.setIsKinematic=function(t){throw"Physics-lite don't support setIsKinematic. Use Physics-PhysX instead!"},e.setLinearDamping=function(t){throw"Physics-lite don't support setLinearDamping. Use Physics-PhysX instead!"},e.setLinearVelocity=function(t){throw"Physics-lite don't support setLinearVelocity. Use Physics-PhysX instead!"},e.setMass=function(t){throw"Physics-lite don't support setMass. Use Physics-PhysX instead!"},e.setMaxAngularVelocity=function(t){throw"Physics-lite don't support setMaxAngularVelocity. Use Physics-PhysX instead!"},e.setMaxDepenetrationVelocity=function(t){throw"Physics-lite don't support setMaxDepenetrationVelocity. Use Physics-PhysX instead!"},e.setSleepThreshold=function(t){throw"Physics-lite don't support setSleepThreshold. Use Physics-PhysX instead!"},e.setSolverIterations=function(t){throw"Physics-lite don't support setSolverIterations. Use Physics-PhysX instead!"},e.wakeUp=function(){throw"Physics-lite don't support wakeUp. Use Physics-PhysX instead!"},i}(u),_=/*#__PURE__*/function(){function t(t,i,e,s,n){}var i=t.prototype;return i.setBounciness=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.setDynamicFriction=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.setStaticFriction=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.setBounceCombine=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.setFrictionCombine=function(t){throw"Physics-lite don't support physics material. Use Physics-PhysX instead!"},i.destroy=function(){},t}(),p=function(){this.shapeID=-1,this.distance=0,this.point=new i.Vector3,this.normal=new i.Vector3},y=/*#__PURE__*/function(t){function e(e,s,n){var o;return(o=t.call(this)||this)._halfSize=new i.Vector3,o._sizeScale=new i.Vector3(1,1,1),o._boxMin=new i.Vector3(-.5,-.5,-.5),o._boxMax=new i.Vector3(.5,.5,.5),o._id=e,o._halfSize.set(.5*s.x,.5*s.y,.5*s.z),o._setBondingBox(),o}s(e,t);var n=e.prototype;return n.setPosition=function(i){t.prototype.setPosition.call(this,i),this._setBondingBox()},n.setWorldScale=function(i){t.prototype.setWorldScale.call(this,i),this._sizeScale.set(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z)),this._setBondingBox()},n.setSize=function(t){this._halfSize.set(.5*t.x,.5*t.y,.5*t.z),this._setBondingBox()},n._raycast=function(t,i){var s=this._getLocalRay(t),n=this._sizeScale,o=this._halfSize,r=e._tempBox;r.min.set(-o.x*n.x,-o.y*n.y,-o.z*n.z),r.max.set(o.x*n.x,o.y*n.y,o.z*n.z);var a=s.intersectBox(r);return -1!==a&&(this._updateHitResult(s,a,i,t.origin),!0)},n._setBondingBox=function(){var t=this._transform.position,i=this._sizeScale,e=this._halfSize;this._boxMin.set(-e.x*i.x+t.x,-e.y*i.y+t.y,-e.z*i.z+t.z),this._boxMax.set(e.x*i.x+t.x,e.y*i.y+t.y,e.z*i.z+t.z)},e}(l);y._tempBox=new i.BoundingBox;var f=/*#__PURE__*/function(t){function e(i,e,s){var n;return(n=t.call(this)||this)._radius=1,n._maxScale=1,n._radius=e,n._id=i,n}s(e,t);var n=e.prototype;return n.setRadius=function(t){this._radius=t},n.setWorldScale=function(i){t.prototype.setWorldScale.call(this,i),this._maxScale=Math.max(Math.abs(i.x),Math.abs(i.y),Math.abs(i.z))},n._raycast=function(t,s){var n=e._tempSphere;i.Vector3.transformCoordinate(this._transform.position,this._collider._transform.worldMatrix,n.center),n.radius=this.worldRadius;var o=t.intersectSphere(n);return -1!==o&&(this._updateHitResult(t,o,s,t.origin,!0),!0)},o(e,[{key:"worldRadius",get:function(){return this._radius*this._maxScale}}]),e}(l);f._tempSphere=new i.BoundingSphere;var g=/*#__PURE__*/function(){function t(t,e,s,n,o,r){this._staticColliders=[],this._dynamicColliders=[],this._sphere=new i.BoundingSphere,this._box=new i.BoundingBox,this._currentEvents=new i.DisorderedArray,this._eventMap={},this._eventPool=[],this._onContactEnter=t,this._onContactExit=e,this._onContactStay=s,this._onTriggerEnter=n,this._onTriggerExit=o,this._onTriggerStay=r}var e=t.prototype;return e.setGravity=function(t){console.log("Physics-lite don't support gravity. Use Physics-PhysX instead!")},e.addColliderShape=function(t){this._eventMap[t._id]={}},e.removeColliderShape=function(t){var i=this._eventPool,e=this._currentEvents,s=this._eventMap,n=t._id;e.forEach(function(t,o){t.index1==n?(e.deleteByIndex(o),i.push(t)):t.index2==n&&(e.deleteByIndex(o),i.push(t),s[t.index1][n]=void 0)}),delete s[n]},e.addCollider=function(t){(t._isStaticCollider?this._staticColliders:this._dynamicColliders).push(t)},e.removeCollider=function(t){var i=t._isStaticCollider?this._staticColliders:this._dynamicColliders,e=i.indexOf(t);-1!==e&&i.splice(e,1)},e.update=function(t){for(var i=this._dynamicColliders,e=0,s=i.length;e<s;e++){var n=i[e];this._collisionDetection(n,this._staticColliders),this._collisionDetection(n,i)}this._fireEvent()},e.raycast=function(i,e,s,n){if(!n)return this._raycast(i,e,s,this._staticColliders,n)||this._raycast(i,e,s,this._dynamicColliders,n);var o=this._raycast(i,e,s,this._staticColliders,n);o&&(e=t._currentHit.distance);var r=this._raycast(i,e,s,this._dynamicColliders,n),a=o||r,h=t._hitResult;return a?n(h.shapeID,h.distance,h.point,h.normal):(h.shapeID=-1,h.distance=0,h.point.set(0,0,0),h.normal.set(0,0,0)),a},e.addCharacterController=function(t){throw"Physics-lite don't support addCharacterController. Use Physics-PhysX instead!"},e.removeCharacterController=function(t){throw"Physics-lite don't support removeCharacterController. Use Physics-PhysX instead!"},e._getTrigger=function(t,i){var e;return this._eventPool.length?((e=this._eventPool.pop()).index1=t,e.index2=i):e=new P(t,i),this._eventMap[t][i]=e,e},e._collisionDetection=function(i,e){for(var s=i._shapes,n=0,o=s.length;n<o;n++){var a=s[n];if(r(a,y)){t._updateWorldBox(a,this._box);for(var h=0,l=e.length;h<l;h++)for(var c=e[h]._shapes,u=0,d=c.length;u<d;u++){var _=c[u],p=_._id,g=a._id,P=p<g?this._eventMap[p][g]:this._eventMap[g][p];if((void 0===P||P.alreadyInvoked)&&_!=a&&this._boxCollision(_)){if(void 0===P){var m=p<g?this._getTrigger(p,g):this._getTrigger(g,p);m.state=0,m.alreadyInvoked=!1,this._currentEvents.add(m)}else 0===P.state?(P.state=1,P.alreadyInvoked=!1):1===P.state&&(P.alreadyInvoked=!1)}}}else if(r(a,f)){t._upWorldSphere(a,this._sphere);for(var v=0,x=e.length;v<x;v++)for(var w=e[v]._shapes,M=0,C=w.length;M<C;M++){var F=w[M],S=F._id,U=a._id,D=S<U?this._eventMap[S][U]:this._eventMap[U][S];if((void 0===D||D.alreadyInvoked)&&F!=a&&this._sphereCollision(F)){if(void 0===D){var T=S<U?this._getTrigger(S,U):this._getTrigger(U,S);T.state=0,T.alreadyInvoked=!1,this._currentEvents.add(T)}else 0===D.state?(D.state=1,D.alreadyInvoked=!1):1===D.state&&(D.alreadyInvoked=!1)}}}}},e._fireEvent=function(){var t=this,i=this._eventPool,e=this._currentEvents;e.forEach(function(s,n){s.alreadyInvoked?(s.state=2,t._eventMap[s.index1][s.index2]=void 0,e.deleteByIndex(n),t._onTriggerExit(s.index1,s.index2),i.push(s)):0==s.state?(t._onTriggerEnter(s.index1,s.index2),s.alreadyInvoked=!0):1==s.state&&(t._onTriggerStay(s.index1,s.index2),s.alreadyInvoked=!0)})},e._boxCollision=function(e){if(r(e,y)){var s=t._tempBox;return t._updateWorldBox(e,s),i.CollisionUtil.intersectsBoxAndBox(s,this._box)}if(r(e,f)){var n=t._tempSphere;return t._upWorldSphere(e,n),i.CollisionUtil.intersectsSphereAndBox(n,this._box)}return!1},e._sphereCollision=function(e){if(r(e,y)){var s=t._tempBox;return t._updateWorldBox(e,s),i.CollisionUtil.intersectsSphereAndBox(this._sphere,s)}if(r(e,f)){var n=t._tempSphere;return t._upWorldSphere(e,n),i.CollisionUtil.intersectsSphereAndSphere(n,this._sphere)}return!1},e._raycast=function(i,e,s,n,o){for(var r=!1,a=t._currentHit,h=0,l=n.length;h<l;h++)if(n[h]._raycast(i,s,a)&&a.distance<e){if(!o)return!0;r=!0;var c=t._hitResult;c.normal.copyFrom(a.normal),c.point.copyFrom(a.point),c.distance=e=a.distance,c.shapeID=a.shapeID}return r},t._updateWorldBox=function(t,e){var s=t._transform.worldMatrix;e.min.copyFrom(t._boxMin),e.max.copyFrom(t._boxMax),i.BoundingBox.transform(e,s,e)},t._upWorldSphere=function(t,e){i.Vector3.transformCoordinate(t._transform.position,t._transform.worldMatrix,e.center),e.radius=t.worldRadius},t}();g._tempSphere=new i.BoundingSphere,g._tempBox=new i.BoundingBox,g._currentHit=new p,g._hitResult=new p;var P=function(t,i){this.alreadyInvoked=!1,this.index1=t,this.index2=i},m=/*#__PURE__*/function(t){function i(i,e){var s;return(s=t.call(this)||this)._isStaticCollider=!0,s._transform.setPosition(i.x,i.y,i.z),s._transform.setRotationQuaternion(e.x,e.y,e.z,e.w),s}return s(i,t),i}(u),v=/*#__PURE__*/function(){function t(){}var i=t.prototype;return i.initialize=function(){return Promise.resolve()},i.createPhysicsManager=function(){return null},i.createPhysicsScene=function(t,i,e,s,n,o,r){return new g(i,e,s,n,o,r)},i.createStaticCollider=function(t,i){return new m(t,i)},i.createDynamicCollider=function(t,i){return new d(t,i)},i.createCharacterController=function(){throw"Physics-lite don't support createCharacterController. Use Physics-PhysX instead!"},i.createPhysicsMaterial=function(t,i,e,s,n){return new _(t,i,e,s,n)},i.createBoxColliderShape=function(t,i,e){return new y(t,i,e)},i.createSphereColliderShape=function(t,i,e){return new f(t,i,e)},i.createPlaneColliderShape=function(t,i){throw"Physics-lite don't support PlaneColliderShape. Use Physics-PhysX instead!"},i.createCapsuleColliderShape=function(t,i,e,s){throw"Physics-lite don't support CapsuleColliderShape. Use Physics-PhysX instead!"},i.createFixedJoint=function(t){throw"Physics-lite don't support CapsuleColliderShape. Use Physics-PhysX instead!"},i.createHingeJoint=function(t){throw"Physics-lite don't support CapsuleColliderShape. Use Physics-PhysX instead!"},i.createSpringJoint=function(t){throw"Physics-lite don't support CapsuleColliderShape. Use Physics-PhysX instead!"},t}(),x="1.4.0-alpha.0";console.log("Galacean PhysicsLite version: "+x),t.LitePhysics=v,t.version=x,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=browser.min.js.map
