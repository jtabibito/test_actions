!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@galacean/engine")):"function"==typeof define&&define.amd?define(["exports","@galacean/engine"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).Galacean=e.Galacean||{},e.Galacean.ShaderLab={}),e.Galacean)}(this,function(e,t){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,void 0)}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}"function"==typeof SuppressedError&&SuppressedError;var a,s,c,l,u,p,h,d,f,_,y,g,S,v,m,E,x,C,T,A,b,O,P,I,L,R,M,k,N,G,V,D,F,w,B,j,U,W,H,q,z,X,Q,K,Y,J,Z,$,ee,et,er,en,ei,eo,ea,es,ec,el,eu,ep,eh,ed,ef,e_,ey,eg,eS,ev,em,eE,ex,eC,eT,eA,eb,eO,eP,eI,eL,eR,eM,ek,eN,eG,eV,eD,eF,ew=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.set=function(e,t){this.start=e,this.end=t},t.dispose=function(){this.start.dispose(),this.end.dispose()},e}(),eB=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.set=function(e,t,r){this.index=e,this.line=t,this.column=r},t.dispose=function(){this.index=0,this.line=0,this.column=0},e}(),ej=((a={})[a.ATTRIBUTE=0]="ATTRIBUTE",a[a.CONST=1]="CONST",a[a.BOOL=2]="BOOL",a[a.FLOAT=3]="FLOAT",a[a.DOUBLE=4]="DOUBLE",a[a.INT=5]="INT",a[a.UINT=6]="UINT",a[a.BREAK=7]="BREAK",a[a.CONTINUE=8]="CONTINUE",a[a.DO=9]="DO",a[a.ELSE=10]="ELSE",a[a.FOR=11]="FOR",a[a.IF=12]="IF",a[a.WHILE=13]="WHILE",a[a.DISCARD=14]="DISCARD",a[a.RETURN=15]="RETURN",a[a.BVEC2=16]="BVEC2",a[a.BVEC3=17]="BVEC3",a[a.BVEC4=18]="BVEC4",a[a.IVEC2=19]="IVEC2",a[a.IVEC3=20]="IVEC3",a[a.IVEC4=21]="IVEC4",a[a.UVEC2=22]="UVEC2",a[a.UVEC3=23]="UVEC3",a[a.UVEC4=24]="UVEC4",a[a.VEC2=25]="VEC2",a[a.VEC3=26]="VEC3",a[a.VEC4=27]="VEC4",a[a.MAT2=28]="MAT2",a[a.MAT3=29]="MAT3",a[a.MAT4=30]="MAT4",a[a.MAT2X3=31]="MAT2X3",a[a.MAT2X4=32]="MAT2X4",a[a.MAT3X2=33]="MAT3X2",a[a.MAT3X4=34]="MAT3X4",a[a.MAT4X2=35]="MAT4X2",a[a.MAT4X3=36]="MAT4X3",a[a.IN=37]="IN",a[a.OUT=38]="OUT",a[a.INOUT=39]="INOUT",a[a.CENTROID=40]="CENTROID",a[a.SAMPLER2D=41]="SAMPLER2D",a[a.SAMPLER3D=42]="SAMPLER3D",a[a.SAMPLER_CUBE=43]="SAMPLER_CUBE",a[a.SAMPLER2D_SHADOW=44]="SAMPLER2D_SHADOW",a[a.SAMPLER_CUBE_SHADOW=45]="SAMPLER_CUBE_SHADOW",a[a.SAMPLER2D_ARRAY=46]="SAMPLER2D_ARRAY",a[a.SAMPLER2D_ARRAY_SHADOW=47]="SAMPLER2D_ARRAY_SHADOW",a[a.I_SAMPLER2D=48]="I_SAMPLER2D",a[a.I_SAMPLER3D=49]="I_SAMPLER3D",a[a.I_SAMPLER_CUBE=50]="I_SAMPLER_CUBE",a[a.I_SAMPLER2D_ARRAY=51]="I_SAMPLER2D_ARRAY",a[a.U_SAMPLER2D=52]="U_SAMPLER2D",a[a.U_SAMPLER3D=53]="U_SAMPLER3D",a[a.U_SAMPLER_CUBE=54]="U_SAMPLER_CUBE",a[a.U_SAMPLER2D_ARRAY=55]="U_SAMPLER2D_ARRAY",a[a.STRUCT=56]="STRUCT",a[a.VOID=57]="VOID",a[a.TRUE=58]="TRUE",a[a.FALSE=59]="FALSE",a[a.PRECISION=60]="PRECISION",a[a.PRECISE=61]="PRECISE",a[a.HIGHP=62]="HIGHP",a[a.MEDIUMP=63]="MEDIUMP",a[a.LOWP=64]="LOWP",a[a.INVARIANT=65]="INVARIANT",a[a.SMOOTH=66]="SMOOTH",a[a.FLAT=67]="FLAT",a[a.NOPERSPECTIVE=68]="NOPERSPECTIVE",a[a.GS_RenderQueueType=69]="GS_RenderQueueType",a[a.GS_BlendState=70]="GS_BlendState",a[a.GS_DepthState=71]="GS_DepthState",a[a.GS_StencilState=72]="GS_StencilState",a[a.GS_RasterState=73]="GS_RasterState",a[a.GS_EditorProperties=74]="GS_EditorProperties",a[a.GS_EditorMacros=75]="GS_EditorMacros",a[a.GS_Editor=76]="GS_Editor",a[a.GS_Tags=77]="GS_Tags",a[a.GS_ReplacementTag=78]="GS_ReplacementTag",a[a.GS_LightMode=79]="GS_LightMode",a[a.GS_PipelineStage=80]="GS_PipelineStage",a[a.GS_VertexShader=81]="GS_VertexShader",a[a.GS_FragmentShader=82]="GS_FragmentShader",a[a.GS_SubShader=83]="GS_SubShader",a[a.GS_Pass=84]="GS_Pass",a[a.GS_BlendFactor=85]="GS_BlendFactor",a[a.GS_BlendOperation=86]="GS_BlendOperation",a[a.GS_Bool=87]="GS_Bool",a[a.GS_Number=88]="GS_Number",a[a.GS_Color=89]="GS_Color",a[a.GS_CompareFunction=90]="GS_CompareFunction",a[a.GS_StencilOperation=91]="GS_StencilOperation",a[a.GS_CullMode=92]="GS_CullMode",a[a.GS_UsePass=93]="GS_UsePass",a),eU=new Map([["attribute",ej.ATTRIBUTE],["const",ej.CONST],["bool",ej.BOOL],["float",ej.FLOAT],["double",ej.DOUBLE],["int",ej.INT],["uint",ej.UINT],["break",ej.BREAK],["continue",ej.CONTINUE],["do",ej.DO],["else",ej.ELSE],["for",ej.FOR],["if",ej.IF],["while",ej.WHILE],["discard",ej.DISCARD],["return",ej.RETURN],["bvec2",ej.BVEC2],["bvec3",ej.BVEC3],["bvec4",ej.BVEC4],["ivec2",ej.IVEC2],["ivec3",ej.IVEC3],["ivec4",ej.IVEC4],["uvec2",ej.UVEC2],["uvec3",ej.UVEC3],["uvec4",ej.UVEC4],["vec2",ej.VEC2],["vec3",ej.VEC3],["vec4",ej.VEC4],["mat2",ej.MAT2],["mat3",ej.MAT3],["mat4",ej.MAT4],["in",ej.IN],["out",ej.OUT],["inout",ej.INOUT],["sampler2D",ej.SAMPLER2D],["samplerCube",ej.SAMPLER_CUBE],["sampler3D",ej.SAMPLER3D],["sampler2DShadow",ej.SAMPLER2D_SHADOW],["samplerCubeShadow",ej.SAMPLER_CUBE_SHADOW],["sampler2DArray",ej.SAMPLER2D_ARRAY],["sampler2DArrayShadow",ej.SAMPLER2D_ARRAY_SHADOW],["isampler2D",ej.I_SAMPLER2D],["isampler3D",ej.I_SAMPLER3D],["isamplerCube",ej.I_SAMPLER_CUBE],["isampler2DArray",ej.I_SAMPLER2D_ARRAY],["usampler2D",ej.U_SAMPLER2D],["usampler3D",ej.U_SAMPLER3D],["usamplerCube",ej.U_SAMPLER_CUBE],["usampler2DArray",ej.U_SAMPLER2D_ARRAY],["struct",ej.STRUCT],["void",ej.VOID],["true",ej.TRUE],["false",ej.FALSE],["precision",ej.PRECISION],["precise",ej.PRECISE],["highp",ej.HIGHP],["mediump",ej.MEDIUMP],["lowp",ej.LOWP],["invariant",ej.INVARIANT],["flat",ej.FLAT],["smooth",ej.SMOOTH],["noperspective",ej.NOPERSPECTIVE],["centroid",ej.CENTROID]]),eW=((s={})[s.ID=1e3]="ID",s[s.FLOAT_CONSTANT=1001]="FLOAT_CONSTANT",s[s.INT_CONSTANT=1002]="INT_CONSTANT",s[s.STRING_CONST=1003]="STRING_CONST",s[s.LEFT_OP=1004]="LEFT_OP",s[s.RIGHT_OP=1005]="RIGHT_OP",s[s.INC_OP=1006]="INC_OP",s[s.DEC_OP=1007]="DEC_OP",s[s.LE_OP=1008]="LE_OP",s[s.GE_OP=1009]="GE_OP",s[s.EQ_OP=1010]="EQ_OP",s[s.NE_OP=1011]="NE_OP",s[s.AND_OP=1012]="AND_OP",s[s.OR_OP=1013]="OR_OP",s[s.XOR_OP=1014]="XOR_OP",s[s.MUL_ASSIGN=1015]="MUL_ASSIGN",s[s.DIV_ASSIGN=1016]="DIV_ASSIGN",s[s.ADD_ASSIGN=1017]="ADD_ASSIGN",s[s.SUB_ASSIGN=1018]="SUB_ASSIGN",s[s.MOD_ASSIGN=1019]="MOD_ASSIGN",s[s.LEFT_ASSIGN=1020]="LEFT_ASSIGN",s[s.RIGHT_ASSIGN=1021]="RIGHT_ASSIGN",s[s.AND_ASSIGN=1022]="AND_ASSIGN",s[s.XOR_ASSIGN=1023]="XOR_ASSIGN",s[s.OR_ASSIGN=1024]="OR_ASSIGN",s[s.LEFT_PAREN=1025]="LEFT_PAREN",s[s.RIGHT_PAREN=1026]="RIGHT_PAREN",s[s.LEFT_BRACKET=1027]="LEFT_BRACKET",s[s.RIGHT_BRACKET=1028]="RIGHT_BRACKET",s[s.LEFT_BRACE=1029]="LEFT_BRACE",s[s.RIGHT_BRACE=1030]="RIGHT_BRACE",s[s.DOT=1031]="DOT",s[s.COMMA=1032]="COMMA",s[s.COLON=1033]="COLON",s[s.EQUAL=1034]="EQUAL",s[s.SEMICOLON=1035]="SEMICOLON",s[s.BANG=1036]="BANG",s[s.DASH=1037]="DASH",s[s.TILDE=1038]="TILDE",s[s.PLUS=1039]="PLUS",s[s.STAR=1040]="STAR",s[s.SLASH=1041]="SLASH",s[s.PERCENT=1042]="PERCENT",s[s.LEFT_ANGLE=1043]="LEFT_ANGLE",s[s.RIGHT_ANGLE=1044]="RIGHT_ANGLE",s[s.VERTICAL_BAR=1045]="VERTICAL_BAR",s[s.CARET=1046]="CARET",s[s.AMPERSAND=1047]="AMPERSAND",s[s.QUESTION=1048]="QUESTION",s[s.NOT_WORD=1049]="NOT_WORD",s[s.EPSILON=1998]="EPSILON",s[s.EOF=1999]="EOF",s);function eH(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function eq(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(eq=function(){return!!e})()}function ez(e,t,r){return(ez=eq()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&i(o,r.prototype),o}).apply(null,arguments)}function eX(e){return(eX=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function eQ(e){var t="function"==typeof Map?new Map:void 0;return(eQ=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return ez(e,arguments,eX(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),i(r,e)})(e)}var eK=/*#__PURE__*/function(e){function t(t,r,n,i,o){var a;return(a=e.call(this,r)||this).location=n,a.source=i,a.file=o,a.name=t,a}return o(t,e),t.prototype.toString=function(){var e,r,n=this.message,i=this.location,o=this.source;if(!o)return n;eH(i,eB)?e=r=i:(e=i.start,r=i.end);for(var a=o.split("\n"),s=this.name+": "+n+"\n\n",c="|\xb7\xb7\xb7",l=t.wrappingLineCount,u=e.line-l,p=r.line+l;u<=p;u++){var h=a[u];if(s+=c+""+h+"\n",!(u<e.line)&&!(u>r.line)){var d=0,f=h.length,_=c.length;u===e.line?(d=e.column,_+=e.column):u===r.line&&(f=r.column);var y=Math.max(f-d,1);s+=" ".repeat(_)+"^".repeat(y)+"\n"}}return s},t}(eQ(Error));eK.wrappingLineCount=2;var eY=((c={}).PreprocessorError="PreprocessorError",c.CompilationError="CompilationError",c.ScannerError="ScannerError",c),eJ=/*#__PURE__*/function(){function e(){}return e.createObjectPool=function(r){var n=new t.ClearableObjectPool(r);return e._shaderLabObjectPoolSet.push(n),n},e.clearAllShaderLabObjectPool=function(){for(var t=0,r=e._shaderLabObjectPoolSet.length;t<r;t++)e._shaderLabObjectPoolSet[t].clear()},e.createGSError=function(e,t,r,n,i){return new eK(t,e,n,r,i)},e}();eJ._shaderLabObjectPoolSet=[];var eZ=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.set=function(e,t,r){if(this.type=e,this.lexeme=t,r){if(eH(r,ew))this.location=r;else{var n=tJ.createPosition(r.index+t.length,r.line,r.column+t.length);this.location=tJ.createRange(r,n)}}},t.dispose=function(){},e}();eZ.pool=eJ.createObjectPool(eZ);var e$=new eZ;e$.set(eW.EOF,"/EOF");var e0=/*#__PURE__*/function(){function e(){}return e.isNum=function(e){return this.numRegex.test(e)},e.isLetter=function(e){return this.letterRegex.test(e)},e.isAlpha=function(e){return this.alphaRegex.test(e)},e.isNumOrLetter=function(e){return this.numOrLetterRegex.test(e)},e.isKeyword=function(e){return e<eW.ID},e}();function e2(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e1(e,t,r){return t&&e2(e.prototype,t),r&&e2(e,r),e}e0.numRegex=/\d/,e0.letterRegex=/\w/,e0.alphaRegex=/[a-zA-Z_]/,e0.numOrLetterRegex=/(\d|\w)/;var e3=/*#__PURE__*/function(){function e(e,t){void 0===t&&(t=new Map),this._currentIndex=0,this._column=0,this._line=0,this._source=e,this._keywordsMap=t}var t=e.prototype;return t.getCurPosition=function(){return tJ.createPosition(this._currentIndex,this._line,this._column)},t.isEnd=function(){return this._currentIndex>=this._source.length},t.getCurChar=function(){return this._source[this._currentIndex]},t.advance=function(e){void 0===e&&(e=1);for(var t=0;t<e;t++)this._advance()},t._advance=function(){!this.isEnd()&&("\n"===this.getCurChar()?(this._line+=1,this._column=0):this._column+=1,this._currentIndex++)},t.skipSpace=function(t){for(var r=t?e._spaceCharsWithBreak:e._spaceChars,n=this.getCurChar();e._checkIsIn(n,r);)this._advance(),n=this.getCurChar()},t.skipCommentsAndSpace=function(){if(this.skipSpace(!0),"//"===this.peek(2)){var e=this.getCurPosition();for(this.advance(2);"\n"!==this.getCurChar();)this._advance();return this.skipCommentsAndSpace(),tJ.createRange(e,this.getCurPosition())}if("/*"===this.peek(2)){var t=this.getCurPosition();for(this.advance(2);"*/"!==this.peek(2)&&!this.isEnd();)this._advance();return this.advance(2),this.skipCommentsAndSpace(),tJ.createRange(t,this.getCurPosition())}},t.peek=function(e){var t=this._currentIndex;return this._source.substring(t,t+e)},t.scanText=function(e){this.skipCommentsAndSpace();var t=this.peek(e.length);t!==e&&this.throwError(this.getCurPosition(),'Expect text "'+e+'", but got "'+t+'"'),this.advance(e.length)},t.throwError=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw eJ.createGSError(r.join(" "),eY.ScannerError,this._source,e)},t.scanPairedText=function(e,t,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1),n||this.scanText(e);for(var i=this._currentIndex,o=r?1:0;this.peek(t.length)!==t||0!==o;){if(this.isEnd())return;if(r){if(this.peek(e.length)===e){o+=1,this.advance(e.length);continue}if(this.peek(t.length)===t){if(0==(o-=1))break;this.advance(t.length);continue}}this.advance(t.length)}return this.advance(t.length),this._source.substring(i,this._currentIndex-t.length)},t.scanToken=function(e,t){void 0===t&&(t=/\w/),this.skipCommentsAndSpace();var r,n=this.getCurPosition();if(!this.isEnd()){for(;t.test(this.getCurChar())&&!this.isEnd();)this._advance();var i=this.getCurPosition();if(n.index===i.index){this._advance();var o=eZ.pool.get();return o.set(eW.NOT_WORD,this._source[n.index],n),null==e||e(o,this),o}var a=this._source.substring(n.index,i.index),s=null!=(r=this._keywordsMap.get(a))?r:eW.ID,c=tJ.createRange(n,i),l=eZ.pool.get();return l.set(s,a,c),null==e||e(l,this),l}},e._checkIsIn=function(e,t){for(var r=0;r<t.length;r++)if(e===t[r])return!0;return!1},e1(e,[{key:"current",get:function(){return this._currentIndex}},{key:"source",get:function(){return this._source}},{key:"line",get:function(){return this._line}},{key:"column",get:function(){return this._column}}]),e}();e3._spaceCharsWithBreak=[" ","	","\n"],e3._spaceChars=[" ","	"];var e4=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.reset=function(e){this._source=e,this._currentIndex=0,this._line=this._column=0},r.tokenize=function(){return function(e,t){var r,n,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(r)throw TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,function(e){switch(e.label){case 0:if(this.isEnd())return[3,2];return[4,this.scanToken()];case 1:return e.sent(),[3,0];case 2:return[2,e$]}})},r.skipSpace=function(){for(;/\s/.test(this.getCurChar());)this.advance()},r.scanToken=function(){if(this.skipCommentsAndSpace(),this.isEnd())return e$;if(e0.isAlpha(this.getCurChar()))return this._scanWord();if(e0.isNum(this.getCurChar()))return this._scanNum();var e=this._getPosition(),t=eZ.pool.get();switch(this.getCurChar()){case"<":if(this.advance(),"<"===this.getCurChar()){if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(eW.LEFT_ASSIGN,"<<=",e);break}t.set(eW.LEFT_OP,"<<",e);break}if("="===this.getCurChar()){this.advance(),t.set(eW.LE_OP,"<=",e);break}t.set(eW.LEFT_ANGLE,"<",e);break;case">":if(this.advance(),">"===this.getCurChar()){if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(eW.RIGHT_ASSIGN,">>=",e);break}t.set(eW.RIGHT_OP,">>",e);break}if("="===this.getCurChar()){this.advance(),t.set(eW.GE_OP,">=",e);break}t.set(eW.RIGHT_ANGLE,">",e);break;case"+":if(this.advance(),"+"===this.getCurChar()){this.advance(),t.set(eW.INC_OP,"++",e);break}if("="===this.getCurChar()){this.advance(),t.set(eW.ADD_ASSIGN,"+=",e);break}t.set(eW.PLUS,"+",e);break;case"-":if(this.advance(),"-"===this.getCurChar()){this.advance(),t.set(eW.DEC_OP,"--",e);break}if("="===this.getCurChar()){this.advance(),t.set(eW.SUB_ASSIGN,"-=",e);break}t.set(eW.DASH,"-",e);break;case"=":if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(eW.EQ_OP,"==",e);break}t.set(eW.EQUAL,"=",e);break;case"!":if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(eW.NE_OP,"!=",e);break}t.set(eW.BANG,"!",e);break;case"&":if(this.advance(),"&"===this.getCurChar()){this.advance(),t.set(eW.AND_OP,"&&",e);break}if("="===this.getCurChar()){this.advance(),t.set(eW.ADD_ASSIGN,"&=",e);break}t.set(eW.AMPERSAND,"&",e);break;case"|":if(this.advance(),"|"===this.getCurChar()){this.advance(),t.set(eW.OR_OP,"||",e);break}if("="===this.getCurChar()){this.advance(),t.set(eW.OR_ASSIGN,"|=",e);break}t.set(eW.VERTICAL_BAR,"|",e);break;case"^":if(this.advance(),"^"===this.getCurChar()){this.advance(),t.set(eW.XOR_OP,"^^",e);break}if("="===this.getCurChar()){this.advance(),t.set(eW.XOR_ASSIGN,"^=",e);break}t.set(eW.CARET,"^",e);break;case"*":if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(eW.MUL_ASSIGN,"*=",e);break}t.set(eW.STAR,"*",e);break;case"/":if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(eW.DIV_ASSIGN,"/=",e);break}t.set(eW.SLASH,"/",e);break;case"%":if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(eW.MOD_ASSIGN,"%=",e);break}t.set(eW.PERCENT,"%",e);break;case"(":this.advance(),t.set(eW.LEFT_PAREN,"(",e);break;case")":this.advance(),t.set(eW.RIGHT_PAREN,")",e);break;case"{":this.advance(),t.set(eW.LEFT_BRACE,"{",e);break;case"}":this.advance(),t.set(eW.RIGHT_BRACE,"}",e);break;case"[":this.advance(),t.set(eW.LEFT_BRACKET,"[",e);break;case"]":this.advance(),t.set(eW.RIGHT_BRACKET,"]",e);break;case".":if(this.advance(),e0.isNum(this.getCurChar()))return this._scanNumAfterDot();t.set(eW.DOT,".",e);break;case",":this.advance(),t.set(eW.COMMA,",",e);break;case":":this.advance(),t.set(eW.COLON,":",e);break;case";":this.advance(),t.set(eW.SEMICOLON,";",e);break;case"~":this.advance(),t.set(eW.TILDE,"~",e);break;case"?":this.advance(),t.set(eW.QUESTION,"?",e);break;case'"':return this.advance(),this._scanStringConst();default:this.throwError(this.getCurPosition(),"Unexpected character "+this.getCurChar())}return t},r._scanStringConst=function(){for(var e=this._getPosition(),t=[];'"'!==this.getCurChar();)t.push(this.getCurChar()),this.advance();this.advance();var r=tJ.createRange(e,this._getPosition()),n=eZ.pool.get();return n.set(eW.STRING_CONST,t.join(""),r),n},r._scanNumAfterDot=function(){for(var e=["."];e0.isNum(this.getCurChar());)e.push(this.getCurChar()),this.advance();var t=eZ.pool.get();return t.set(eW.FLOAT_CONSTANT,e.join(""),this._getPosition(1)),t},r._getPosition=function(e){return void 0===e&&(e=0),tJ.createPosition(this.current-e,this._line,this._column-e)},r._scanWord=function(){var e=[this.getCurChar()],t=this._getPosition();for(this.advance();e0.isLetter(this.getCurChar());)e.push(this.getCurChar()),this.advance();var r=e.join(""),n=eU.get(r);if(n){var i=eZ.pool.get();return i.set(n,r,t),i}var o=eZ.pool.get();return o.set(eW.ID,r,t),o},r._scanNum=function(){for(var e=[];e0.isNum(this.getCurChar());)e.push(this.getCurChar()),this.advance();if("."===this.getCurChar()){for(e.push(this.getCurChar()),this.advance();e0.isNum(this.getCurChar());)e.push(this.getCurChar()),this.advance();this._scanFloatSuffix(e);var t=eZ.pool.get();return t.set(eW.FLOAT_CONSTANT,e.join(""),this._getPosition(e.length)),t}if("e"===this.getCurChar()||"E"===this.getCurChar()){this._scanFloatSuffix(e);var r=eZ.pool.get();return r.set(eW.FLOAT_CONSTANT,e.join(""),this._getPosition(e.length)),r}this._scanIntegerSuffix(e);var n=eZ.pool.get();return n.set(eW.INT_CONSTANT,e.join(""),this._getPosition(e.length)),n},r._scanFloatSuffix=function(e){if("e"===this.getCurChar()||"E"===this.getCurChar())for(e.push(this.getCurChar()),this.advance(),("+"===this.getCurChar()||"-"===this.getCurChar())&&(e.push(this.getCurChar()),this.advance()),e0.isNum(this.getCurChar())||this.throwError(this.getCurPosition(),"lexing error, invalid exponent suffix.");e0.isNum(this.getCurChar());)e.push(this.getCurChar()),this.advance();("f"===this.getCurChar()||"F"===this.getCurChar())&&(e.push(this.getCurChar()),this.advance())},r._scanIntegerSuffix=function(e){("u"===this.getCurChar()||"U"===this.getCurChar())&&(e.push(this.getCurChar()),this.advance())},t}(e3),e9=((l={})[l.Shift=0]="Shift",l[l.Reduce=1]="Reduce",l[l.Accept=2]="Accept",l),e5=function(){this.globalPrecisions=[]},e6=function(e,t,r){this.type=e,this.typeLexeme=t,this.arraySpecifier=r},e7=((u={})[u.VAR=0]="VAR",u[u.FN=1]="FN",u[u.STRUCT=2]="STRUCT",u),e8=function(e,t,r,n){this.ident=e,this.symbolType=t,this.astNode=r,this.dataType=n},te=/*#__PURE__*/function(e){function t(t,r){var n=new e6(r.protoType.returnType.type,r.protoType.returnType.typeSpecifier.lexeme);return e.call(this,t,e7.FN,r,n)||this}return o(t,e),t}(e8),tt=/*#__PURE__*/function(e){function t(t,r){return e.call(this,t,e7.STRUCT,r)||this}return o(t,e),t}(e8),tr=/*#__PURE__*/function(){function e(){this._table=new Map}var r=e.prototype;return r.insert=function(e){for(var r,n=null!=(r=this._table.get(e.ident))?r:[],i=0;i<n.length;i++)if(this.symbolEqualCheck(n[i],e)){t.Logger.warn("replace symbol:",e.ident),n[i]=e;return}n.push(e),this._table.set(e.ident,n)},r.lookup=function(e){for(var t,r,i=null!=(t=this._table.get(e.ident))?t:[],o=n(i);!(r=o()).done;){var a=r.value;if(this.symbolEqualCheck(a,e))return a}},e}(),tn=/*#__PURE__*/function(){function e(){this._stack=[]}var t=e.prototype;return t.newScope=function(e){this._stack.push(e)},t.clear=function(){this._stack.length=0},t.dropScope=function(){this._stack.pop()},t.insert=function(e){this._scope.insert(e)},t.lookup=function(e){for(var t=this._stack.length-1;t>=0;t--){var r=this._stack[t].lookup(e);if(r)return r}},e1(e,[{key:"_scope",get:function(){return this._stack[this._stack.length-1]}}]),e}(),ti=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.symbolEqualCheck=function(e,t){if(e.symbolType!==t.symbolType)return!1;if(t.symbolType===e7.FN){if(!t.astNode&&!t.signature)return!0;var r,n=e.astNode.protoType.paramSig,i=null!=(r=t.signature)?r:t.astNode.protoType.paramSig;if(n.length!==i.length)return!1;for(var o=0;o<n.length;o++)if(3e3!==n[o]&&3e3!==i[o]&&n[o]!==i[o])return!1}return!0},r.getAllFnSymbols=function(e){var t;return(null!=(t=this._table.get(e))?t:[]).filter(function(e){return e.symbolType===e7.FN})},t}(tr),to=/*#__PURE__*/function(e){function t(t,r,n,i){var o;return(o=e.call(this,t,e7.VAR,i,r)||this).isGlobalVariable=n,o}return o(t,e),t}(e8),ta=/*#__PURE__*/function(){function e(){this.semanticStack=[],this.acceptRule=void 0,this.symbolTable=new tn,this._shaderData=new e5,this.errors=[],this._translationRuleTable=new Map,this.newScope()}var t=e.prototype;return t.reset=function(){this.semanticStack.length=0,this._shaderData=new e5,this.symbolTable.clear(),this.newScope(),this.errors.length=0},t.newScope=function(){var e=new ti;this.symbolTable.newScope(e)},t.dropScope=function(){return this.symbolTable.dropScope()},t.addTranslationRule=function(e,t){this._translationRuleTable.set(e,t)},t.getTranslationRule=function(e){return this._translationRuleTable.get(e)},t.error=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=new eK(eY.CompilationError,r.join(""),e,tJ._processingPassText);return this.errors.push(i),i},e1(e,[{key:"shaderData",get:function(){return this._shaderData}}]),e}(),ts=((p={})[p.START=2e3]="START",p[p.gs_shader_program=2001]="gs_shader_program",p[p.global_declaration=2002]="global_declaration",p[p.variable_declaration=2003]="variable_declaration",p[p.array_specifier_list=2004]="array_specifier_list",p[p.array_specifier=2005]="array_specifier",p[p.ext_builtin_type_specifier_nonarray=2006]="ext_builtin_type_specifier_nonarray",p[p.precision_specifier=2007]="precision_specifier",p[p.variable_identifier=2008]="variable_identifier",p[p.variable_identifier_node=2009]="variable_identifier_node",p[p.primary_expression=2010]="primary_expression",p[p.postfix_expression=2011]="postfix_expression",p[p.integer_expression=2012]="integer_expression",p[p.function_call=2013]="function_call",p[p.function_call_generic=2014]="function_call_generic",p[p.function_call_header_no_parameters=2015]="function_call_header_no_parameters",p[p.function_call_header_with_parameters=2016]="function_call_header_with_parameters",p[p.function_call_parameter_list=2017]="function_call_parameter_list",p[p.function_call_header=2018]="function_call_header",p[p.function_identifier=2019]="function_identifier",p[p.constructor_identifier=2020]="constructor_identifier",p[p.unary_expression=2021]="unary_expression",p[p.unary_operator=2022]="unary_operator",p[p.multiplicative_expression=2023]="multiplicative_expression",p[p.additive_expression=2024]="additive_expression",p[p.shift_expression=2025]="shift_expression",p[p.relational_expression=2026]="relational_expression",p[p.equality_expression=2027]="equality_expression",p[p.and_expression=2028]="and_expression",p[p.inclusive_or_expression=2029]="inclusive_or_expression",p[p.exclusive_or_expression=2030]="exclusive_or_expression",p[p.logical_and_expression=2031]="logical_and_expression",p[p.logical_xor_expression=2032]="logical_xor_expression",p[p.logical_or_expression=2033]="logical_or_expression",p[p.conditional_expression=2034]="conditional_expression",p[p.assignment_expression=2035]="assignment_expression",p[p.assignment_operator=2036]="assignment_operator",p[p.expression=2037]="expression",p[p.integer_constant_expression=2038]="integer_constant_expression",p[p.integer_constant_expression_operator=2039]="integer_constant_expression_operator",p[p.declaration=2040]="declaration",p[p.function_prototype=2041]="function_prototype",p[p.function_declarator=2042]="function_declarator",p[p.function_header_with_parameters=2043]="function_header_with_parameters",p[p.function_header=2044]="function_header",p[p.function_parameter_list=2045]="function_parameter_list",p[p.parameter_declarator=2046]="parameter_declarator",p[p.parameter_declaration=2047]="parameter_declaration",p[p.parameter_qualifier=2048]="parameter_qualifier",p[p.parameter_type_specifier=2049]="parameter_type_specifier",p[p.init_declarator_list=2050]="init_declarator_list",p[p.single_declaration=2051]="single_declaration",p[p.fully_specified_type=2052]="fully_specified_type",p[p.type_qualifier=2053]="type_qualifier",p[p.single_type_qualifier=2054]="single_type_qualifier",p[p.storage_qualifier=2055]="storage_qualifier",p[p.precision_qualifier=2056]="precision_qualifier",p[p.interpolation_qualifier=2057]="interpolation_qualifier",p[p.invariant_qualifier=2058]="invariant_qualifier",p[p.type_specifier=2059]="type_specifier",p[p.type_specifier_nonarray=2060]="type_specifier_nonarray",p[p.type_specifier_no_prec=2061]="type_specifier_no_prec",p[p.basic_type=2062]="basic_type",p[p.struct_specifier=2063]="struct_specifier",p[p.struct_declaration_list=2064]="struct_declaration_list",p[p.struct_declaration=2065]="struct_declaration",p[p.struct_declarator_list=2066]="struct_declarator_list",p[p.struct_declarator=2067]="struct_declarator",p[p.identifier_list=2068]="identifier_list",p[p.decl_identifier=2069]="decl_identifier",p[p.initializer=2070]="initializer",p[p.initializer_list=2071]="initializer_list",p[p.declaration_statement=2072]="declaration_statement",p[p.simple_statement=2073]="simple_statement",p[p.compound_statement_no_scope=2074]="compound_statement_no_scope",p[p.statement_with_scope=2075]="statement_with_scope",p[p.compound_statement=2076]="compound_statement",p[p.statement=2077]="statement",p[p.statement_list=2078]="statement_list",p[p.iteration_statement_no_new_scope=2079]="iteration_statement_no_new_scope",p[p.expression_statement=2080]="expression_statement",p[p.selection_statement=2081]="selection_statement",p[p.selection_rest_statement=2082]="selection_rest_statement",p[p.condition=2083]="condition",p[p.conditionopt=2084]="conditionopt",p[p.iteration_statement=2085]="iteration_statement",p[p.for_init_statement=2086]="for_init_statement",p[p.for_rest_statement=2087]="for_rest_statement",p[p.jump_statement=2088]="jump_statement",p[p.external_declaration=2089]="external_declaration",p[p.function_definition=2090]="function_definition",p[p.field_selection=2091]="field_selection",p[p.bool_constant=2092]="bool_constant",p[p.function_identifier_node=2093]="function_identifier_node",p[p.typename_identifier_node=2094]="typename_identifier_node",p[p.scope_brace=2095]="scope_brace",p[p.scope_end_brace=2096]="scope_end_brace",p[p._ignore=2097]="_ignore",p),tc=function e(t,r){this.goal=t,this.derivation=r,this.id=e._id++,e.pool.set(this.id,this)};tc._id=0,tc.pool=new Map;var tl=/*#__PURE__*/function(){function e(e,t){this.startSymbol=e,t.unshift(new tc(ts.START,[e])),this.productions=t}var t=e.prototype;return t.getProductionList=function(e){return this.productions.filter(function(t){return t.goal===e})},t.isNullableNT=function(e){return this.productions.find(function(t){return t.goal===e&&t.derivation[0]===eW.EPSILON})},t.getProductionByID=function(e){return tc.pool.get(e)},e.create=function(t,r){return new e(t,r.map(function(e){return new tc(e[0],e.slice(1))}))},e}(),tu=((h={})[h.VERTEX=0]="VERTEX",h[h.FRAGMENT=1]="FRAGMENT",h[h.ALL=2]="ALL",h);function tp(e){return e>=200&&e<=213}var th=new Map,td=/*#__PURE__*/function(){function e(e,t,r){for(var n=arguments.length,i=Array(n>3?n-3:0),o=3;o<n;o++)i[o-3]=arguments[o];this.ident=e,this._returnType=t,this.args=i,this.scope=r}return e.getReturnType=function(e,t){return tp(e._returnType)?t:e._returnType},e._create=function(t,r){for(var n,i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];var s=ez(e,[].concat([t,r,tu.ALL],o)),c=null!=(n=th.get(t))?n:[];c.push(s),th.set(t,c)},e._createWithScop=function(t,r,n){for(var i,o=arguments.length,a=Array(o>3?o-3:0),s=3;s<o;s++)a[s-3]=arguments[s];var c=ez(e,[].concat([t,r,n],a)),l=null!=(i=th.get(t))?i:[];l.push(c),th.set(t,l)},e.getFn=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i=th.get(e),o=3e3;if(null==i?void 0:i.length){var a=i.find(function(e){if(e.args.length!==r.length)return!1;for(var t=0,n=0;n<r.length;n++)if(3e3!==r[n]){if(o=r[n],tp(e.args[n])){if(0===t){t=r[n];continue}o=t}if(3e3!==r[n]&&r[n]!==o)return!1}return!0});if(a)return{fun:a,genType:o}}},e}();td._create("radians",200,200),td._create("degrees",200,200),td._create("sin",200,200),td._create("cos",200,200),td._create("tan",200,200),td._create("asin",200,200),td._create("acos",200,200),td._create("atan",200,200,200),td._create("atan",200,200),td._create("sinh",200,200),td._create("cosh",200,200),td._create("tanh",200,200),td._create("asinh",200,200),td._create("acosh",200,200),td._create("atanh",200,200),td._create("pow",200,200,200),td._create("exp",200,200),td._create("log",200,200),td._create("exp2",200,200),td._create("log2",200,200),td._create("sqrt",200,200),td._create("inversesqrt",200,200),td._create("abs",200,200),td._create("abs",201,201),td._create("sign",200,200),td._create("sign",201,201),td._create("floor",200,200),td._create("trunc",200,200),td._create("round",200,200),td._create("roundEven",200,200),td._create("ceil",200,200),td._create("fract",200,200),td._create("mod",200,200,ej.FLOAT),td._create("mod",200,200,200),td._create("min",200,200,200),td._create("min",200,200,ej.FLOAT),td._create("min",201,201,201),td._create("min",201,201,ej.INT),td._create("min",202,202,202),td._create("min",202,202,ej.UINT),td._create("max",200,200,200),td._create("max",200,200,ej.FLOAT),td._create("max",201,201,201),td._create("max",201,201,ej.INT),td._create("clamp",200,200,200,200),td._create("clamp",200,200,ej.FLOAT,ej.FLOAT),td._create("clamp",201,201,201,201),td._create("clamp",201,201,ej.INT,ej.INT),td._create("clamp",202,202,202,202),td._create("clamp",202,202,ej.UINT,ej.UINT),td._create("mix",200,200,200,200),td._create("mix",200,200,200,ej.FLOAT),td._create("mix",200,200,200,203),td._create("step",200,200,200),td._create("step",200,ej.FLOAT,200),td._create("smoothstep",200,200,200,200),td._create("smoothstep",200,ej.FLOAT,ej.FLOAT,200),td._create("isnan",203,200),td._create("isinf",203,200),td._create("floatBitsToInt",200,200),td._create("floatBitsToUint",202,200),td._create("intBitsToFloat",200,201),td._create("uintBitsToFloat",200,202),td._create("packSnorm2x16",ej.UINT,ej.VEC2),td._create("unpackSnorm2x16",ej.VEC2,ej.UINT),td._create("packUnorm2x16",ej.UINT,ej.VEC2),td._create("unpackUnorm2x16",ej.VEC2,ej.UINT),td._create("packHalf2x16",ej.UINT,ej.VEC2),td._create("unpackHalf2x16",ej.VEC2,ej.UINT),td._create("length",ej.FLOAT,200),td._create("distance",ej.FLOAT,200,200),td._create("dot",ej.FLOAT,200,200),td._create("cross",ej.VEC3,ej.VEC3,ej.VEC3),td._create("normalize",200,200),td._create("faceforward",200,200,200,200),td._create("reflect",200,200,200),td._create("refract",200,200,200,ej.FLOAT),td._create("matrixCompMult",204,204,204),td._create("outerProduct",ej.MAT2,ej.VEC2,ej.VEC2),td._create("outerProduct",ej.MAT3,ej.VEC3,ej.VEC3),td._create("outerProduct",ej.MAT4,ej.VEC4,ej.VEC4),td._create("outerProduct",ej.MAT2X3,ej.VEC3,ej.VEC2),td._create("outerProduct",ej.MAT3X2,ej.VEC2,ej.VEC3),td._create("outerProduct",ej.MAT2X4,ej.VEC4,ej.VEC2),td._create("outerProduct",ej.MAT4X2,ej.VEC2,ej.VEC4),td._create("outerProduct",ej.MAT3X4,ej.VEC4,ej.VEC3),td._create("outerProduct",ej.MAT4X3,ej.VEC3,ej.VEC4),td._create("transpose",ej.MAT2,ej.MAT2),td._create("transpose",ej.MAT3,ej.MAT3),td._create("transpose",ej.MAT4,ej.MAT4),td._create("transpose",ej.MAT2X3,ej.MAT3X2),td._create("transpose",ej.MAT3X2,ej.MAT2X3),td._create("transpose",ej.MAT4X2,ej.MAT2X4),td._create("transpose",ej.MAT2X4,ej.MAT4X2),td._create("transpose",ej.MAT3X4,ej.MAT4X3),td._create("transpose",ej.MAT4X3,ej.MAT3X4),td._create("determinant",ej.FLOAT,ej.MAT2),td._create("determinant",ej.FLOAT,ej.MAT3),td._create("determinant",ej.FLOAT,ej.MAT4),td._create("inverse",ej.MAT2,ej.MAT2),td._create("inverse",ej.MAT3,ej.MAT3),td._create("inverse",ej.MAT4,ej.MAT4),td._create("lessThan",205,208,208),td._create("lessThan",205,206,206),td._create("lessThan",205,207,207),td._create("lessThanEqual",205,208,208),td._create("lessThanEqual",205,206,206),td._create("lessThanEqual",205,207,207),td._create("greaterThan",205,208,208),td._create("greaterThan",205,206,206),td._create("greaterThan",205,207,207),td._create("greaterThanEqual",205,208,208),td._create("greaterThanEqual",205,206,206),td._create("greaterThanEqual",205,207,207),td._create("equal",205,208,208),td._create("equal",205,206,206),td._create("equal",205,207,207),td._create("equal",205,205,205),td._create("notEqual",205,208,208),td._create("notEqual",205,206,206),td._create("notEqual",205,207,207),td._create("notEqual",205,205,205),td._create("any",ej.BOOL,205),td._create("all",ej.BOOL,205),td._create("not",205,205),td._create("textureSize",ej.IVEC2,210,ej.INT),td._create("textureSize",ej.IVEC3,211,ej.INT),td._create("textureSize",ej.IVEC2,212,ej.INT),td._create("textureSize",ej.IVEC2,ej.SAMPLER2D_SHADOW,ej.INT),td._create("textureSize",ej.IVEC2,ej.SAMPLER_CUBE_SHADOW,ej.INT),td._create("textureSize",ej.IVEC3,213,ej.INT),td._create("textureSize",ej.IVEC3,ej.SAMPLER2D_ARRAY_SHADOW,ej.INT),td._create("texture2D",ej.SAMPLER2D,ej.VEC2),td._create("texture2D",ej.SAMPLER2D,ej.VEC2,ej.FLOAT),td._create("texture",209,210,ej.VEC2,ej.FLOAT),td._create("texture",209,210,ej.VEC2),td._create("texture",209,211,ej.VEC3,ej.FLOAT),td._create("texture",209,211,ej.VEC3),td._create("texture",209,212,ej.VEC3,ej.FLOAT),td._create("texture",209,212,ej.VEC3),td._create("texture",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC3,ej.FLOAT),td._create("texture",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC3),td._create("texture",ej.FLOAT,ej.SAMPLER_CUBE_SHADOW,ej.VEC4,ej.FLOAT),td._create("texture",ej.FLOAT,ej.SAMPLER_CUBE_SHADOW,ej.VEC4),td._create("texture",209,ej.SAMPLER2D_ARRAY,ej.VEC3,ej.FLOAT),td._create("texture",209,ej.SAMPLER2D_ARRAY,ej.VEC3),td._create("texture",ej.FLOAT,ej.SAMPLER2D_ARRAY_SHADOW,ej.VEC4),td._create("textureProj",209,210,ej.VEC3,ej.FLOAT),td._create("textureProj",209,210,ej.VEC3),td._create("textureProj",209,210,ej.VEC4,ej.FLOAT),td._create("textureProj",209,210,ej.VEC4),td._create("textureProj",209,211,ej.VEC4,ej.FLOAT),td._create("textureProj",209,211,ej.VEC4),td._create("textureProj",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC4,ej.FLOAT),td._create("textureProj",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC4),td._create("textureLod",209,210,ej.VEC2,ej.FLOAT),td._create("textureLod",209,211,ej.VEC3,ej.FLOAT),td._create("textureLod",209,212,ej.VEC3,ej.FLOAT),td._create("textureLod",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC3,ej.FLOAT),td._create("textureLod",209,213,ej.VEC3,ej.FLOAT),td._create("textureCube",ej.SAMPLER_CUBE,ej.VEC3),td._create("textureCube",ej.SAMPLER_CUBE,ej.VEC3,ej.FLOAT),td._create("textureCubeLod",ej.SAMPLER_CUBE,ej.VEC3,ej.FLOAT),td._create("textureOffset",209,210,ej.VEC2,ej.IVEC2,ej.FLOAT),td._create("textureOffset",209,210,ej.VEC2,ej.IVEC2),td._create("textureOffset",209,211,ej.VEC3,ej.IVEC3,ej.FLOAT),td._create("textureOffset",209,211,ej.VEC3,ej.IVEC3),td._create("textureOffset",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC3,ej.IVEC2,ej.FLOAT),td._create("textureOffset",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC3,ej.IVEC2),td._create("textureOffset",209,213,ej.VEC3,ej.IVEC2,ej.FLOAT),td._create("textureOffset",209,213,ej.VEC3,ej.IVEC2),td._create("texelFetch",209,210,ej.IVEC2,ej.INT),td._create("texelFetch",209,211,ej.IVEC3,ej.INT),td._create("texelFetch",209,213,ej.IVEC3,ej.INT),td._create("texelFetchOffset",209,210,ej.IVEC2,ej.INT,ej.IVEC2),td._create("texelFetchOffset",209,211,ej.IVEC3,ej.INT,ej.IVEC3),td._create("texelFetchOffset",209,213,ej.IVEC3,ej.INT,ej.IVEC2),td._create("textureProjOffset",209,210,ej.VEC3,ej.IVEC2,ej.FLOAT),td._create("textureProjOffset",209,210,ej.VEC3,ej.IVEC2),td._create("textureProjOffset",209,210,ej.VEC4,ej.IVEC2,ej.FLOAT),td._create("textureProjOffset",209,210,ej.VEC4,ej.IVEC2),td._create("textureProjOffset",209,211,ej.VEC4,ej.IVEC3,ej.FLOAT),td._create("textureProjOffset",209,211,ej.VEC4,ej.IVEC3),td._create("textureProjOffset",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC4,ej.IVEC2,ej.FLOAT),td._create("textureProjOffset",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC4,ej.IVEC2),td._create("textureLodOffset",209,210,ej.VEC2,ej.FLOAT,ej.IVEC2),td._create("textureLodOffset",209,211,ej.VEC3,ej.FLOAT,ej.IVEC3),td._create("textureLodOffset",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC3,ej.FLOAT,ej.IVEC2),td._create("textureLodOffset",209,213,ej.VEC3,ej.FLOAT,ej.IVEC2),td._create("textureProjLod",209,210,ej.VEC3,ej.FLOAT),td._create("textureProjLod",209,210,ej.VEC4,ej.FLOAT),td._create("textureProjLod",209,211,ej.VEC4,ej.FLOAT),td._create("textureProjLod",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC4,ej.FLOAT),td._create("textureProjLodOffset",209,210,ej.VEC3,ej.FLOAT,ej.IVEC2),td._create("textureProjLodOffset",209,210,ej.VEC4,ej.FLOAT,ej.IVEC2),td._create("textureProjLodOffset",209,211,ej.VEC4,ej.FLOAT,ej.IVEC3),td._create("textureProjLodOffset",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC4,ej.FLOAT,ej.IVEC2),td._create("textureGrad",209,210,ej.VEC2,ej.VEC2,ej.VEC2),td._create("textureGrad",209,211,ej.VEC3,ej.VEC3,ej.VEC3),td._create("textureGrad",209,212,ej.VEC3,ej.VEC3,ej.VEC3),td._create("textureGrad",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC3,ej.VEC2,ej.VEC2),td._create("textureGrad",ej.FLOAT,ej.SAMPLER_CUBE_SHADOW,ej.VEC4,ej.VEC3,ej.VEC3),td._create("textureGrad",209,213,ej.VEC3,ej.VEC2,ej.VEC2),td._create("textureGrad",ej.FLOAT,ej.SAMPLER2D_ARRAY_SHADOW,ej.VEC4,ej.VEC2,ej.VEC2),td._create("textureGradOffset",209,210,ej.VEC2,ej.VEC2,ej.VEC2,ej.IVEC2),td._create("textureGradOffset",209,211,ej.VEC3,ej.VEC3,ej.VEC3,ej.IVEC3),td._create("textureGradOffset",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC3,ej.VEC2,ej.VEC2,ej.IVEC2),td._create("textureGradOffset",209,213,ej.VEC3,ej.VEC2,ej.VEC2,ej.IVEC2),td._create("textureGradOffset",ej.FLOAT,ej.SAMPLER2D_ARRAY_SHADOW,ej.VEC3,ej.VEC2,ej.VEC2,ej.IVEC2),td._create("textureProjGrad",209,210,ej.VEC3,ej.VEC2,ej.VEC2),td._create("textureProjGrad",209,210,ej.VEC4,ej.VEC2,ej.VEC2),td._create("textureProjGrad",209,211,ej.VEC4,ej.VEC3,ej.VEC3),td._create("textureProjGrad",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC4,ej.VEC2,ej.VEC2),td._create("textureProjGradOffset",209,210,ej.VEC3,ej.VEC2,ej.VEC2,ej.IVEC2),td._create("textureProjGradOffset",209,210,ej.VEC4,ej.VEC2,ej.VEC2,ej.IVEC2),td._create("textureProjGradOffset",209,211,ej.VEC4,ej.VEC3,ej.VEC3,ej.IVEC3),td._create("textureProjGradOffset",ej.FLOAT,ej.SAMPLER2D_SHADOW,ej.VEC4,ej.VEC2,ej.VEC2,ej.IVEC2),td._createWithScop("dFdx",200,tu.FRAGMENT,200),td._createWithScop("dFdy",200,tu.FRAGMENT,200),td._createWithScop("fwidth",200,tu.FRAGMENT,200);var tf=new Map,t_=/*#__PURE__*/function(){function e(e,t,r){this.type=e,this.lexeme=t,this.scope=r}return e.createVariable=function(t,r,n){void 0===n&&(n=tu.ALL);var i=new e(r,t,n);tf.set(t,i)},e.getVar=function(e){return tf.get(e)},e}();t_.createVariable("gl_VertexID",ej.INT,tu.VERTEX),t_.createVariable("gl_InstanceID",ej.INT,tu.VERTEX),t_.createVariable("gl_Position",ej.VEC4,tu.VERTEX),t_.createVariable("gl_PointSize",ej.FLOAT,tu.VERTEX),t_.createVariable("gl_FragCoord",ej.VEC4,tu.FRAGMENT),t_.createVariable("gl_FrontFacing",ej.BOOL,tu.FRAGMENT),t_.createVariable("gl_FragDepth",ej.FLOAT,tu.FRAGMENT),t_.createVariable("gl_PointCoord",ej.VEC2,tu.FRAGMENT),t_.createVariable("gl_FragColor",ej.VEC4,tu.FRAGMENT),t_.createVariable("gl_MaxVertexAttribs",ej.INT),t_.createVariable("gl_MaxVertexUniformVectors",ej.INT),t_.createVariable("gl_MaxVertexOutputVectors",ej.INT),t_.createVariable("gl_MaxFragmentInputVectors",ej.INT),t_.createVariable("gl_MaxVertexTextureImageUnits",ej.INT),t_.createVariable("gl_MaxCombinedTextureImageUnits",ej.INT),t_.createVariable("gl_MaxTextureImageUnits",ej.INT),t_.createVariable("gl_MaxFragmentUniformVectors",ej.INT),t_.createVariable("gl_MaxDrawBuffers",ej.INT),t_.createVariable("gl_MinProgramTexelOffset",ej.INT),t_.createVariable("gl_MaxProgramTexelOffset",ej.INT);var ty=/*#__PURE__*/function(){function e(t,r,i){this._needReInfer=!0,this.production=t,this.position=r,this.lookaheadSet=new Set;for(var o,a=n(i);!(o=a()).done;){var s=o.value;this.lookaheadSet.add(s)}this.id=e._id++}var t=e.prototype;return t.addLookahead=function(e){for(var t,r=n(e);!(t=r()).done;){var i=t.value;this.lookaheadSet.has(i)||(this.lookaheadSet.add(i),this.needReInfer=!0)}},t.symbolByOffset=function(e){return this.production.derivation[this.position+e]},t.canReduce=function(){if(this.position>this.production.derivation.length-1)return!0;for(var e=this.position;e<this.production.derivation.length;e++)if(this.production.derivation[e]!==eW.EPSILON)return!1;return!0},t.advance=function(){if(this.canReduce())throw"Error: advance reduce-able parsing state item";return new e(this.production,this.position+1,this.lookaheadSet)},t.toString=function(){var e,t=this.production.derivation.map(function(e){return tx.toString(e)});return t[this.position]="."+(null!=(e=t[this.position])?e:""),ts[this.production.goal]+" :=> "+t.join("|")+" ;"+Array.from(this.lookaheadSet).map(function(e){return tx.toString(e)}).join("/")},e1(e,[{key:"needReInfer",get:function(){return this._needReInfer},set:function(e){this._needReInfer=e}},{key:"curSymbol",get:function(){return this.production.derivation[this.position]}},{key:"nextSymbol",get:function(){return this.production.derivation[this.position+1]}}]),e}();ty._id=0;var tg=/*#__PURE__*/function(){function e(t){this.closured=!1,this._stateItemPool=new Map,this.id=e._id++,this._items=new Set([].concat(t)),this.cores=new Set([].concat(t));for(var r,i=n(t);!(r=i()).done;){var o=r.value,a=this.getStateItemMapKey(o.production,o.position);this._stateItemPool.set(a,o)}e.pool.set(this.id,this)}var t=e.prototype;return t.getStateItemMapKey=function(e,t){return e.id+","+t},t.createStateItem=function(e,t,r){void 0===r&&(r=new Set);var i=this.getStateItemMapKey(e,t),o=this._stateItemPool.get(i);if(o){for(var a,s=n(r);!(a=s()).done;){var c=a.value;o.lookaheadSet.has(c)||(o.lookaheadSet.add(c),o.needReInfer=!0)}return o}var l=new ty(e,t,r);return this._stateItemPool.set(i,l),l},e.create=function(t){var r=this.getMapKey(t),i=this.closureMap.get(r);if(i){for(var o,a=n(t);!(o=a()).done;){var s=o.value;i.createStateItem(s.production,s.position,s.lookaheadSet)}return i}var c=new e(t);return this.closureMap.set(r,c),c},e.getMapKey=function(e){return e.map(function(e){return e.production.id+","+e.position}).join(";")},e1(e,[{key:"items",get:function(){return this._items}},{key:"needReInfer",get:function(){for(var e,t=n(this.cores);!(e=t()).done;)if(e.value.needReInfer)return!0;return!1}}]),e}();tg.closureMap=new Map,tg.pool=new Map,tg._id=0;var tS=/*#__PURE__*/function(){function e(){}return e.unwrapNodeByType=function(t,r){var n=t.children[0];if(!eH(n,eZ))return n.nt===r?n:e.unwrapNodeByType(n,r)},e.typeCompatible=function(e,t){return void 0==t||(e===ej.INT?e===t||t===ej.UINT:e===t)},e.toString=function(e){if(this.isTerminal(e)){var t;return null!=(t=eW[e])?t:ej[e]}return ts[e]},e.isTerminal=function(e){return e<ts.START},e.printStatePool=function(e){var t="";console.log("========== Parser Pool ==========");for(var r,i=0,o=n(tg.pool.values());!(r=o()).done;){var a=r.value;i++;var s="";s+=(""+a.id+": \n").padEnd(4);for(var c,l=n(a.items);!(c=l()).done;)s+="     "+c.value.toString()+"\n";t+=s}console.log("state count:",i),console.log(t)},e}(),tv=function(e,t,r){this.type=e,this.arraySpecifier=r,this.typeLexeme=t},tm=function(e,t){this.typeInfo=e,this.ident=t},tE=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.set=function(e,t,r){this.nt=r,this._location=e,this._children=t},t.dispose=function(){},t.codeGen=function(e){return e.defaultCodeGen(this.children)},t.semanticAnalyze=function(e){},e1(e,[{key:"children",get:function(){return this._children}},{key:"location",get:function(){return this._location}}]),e}();(d=eF||(eF={}))._unwrapToken=function(e){if(eH(e,eZ))return e;throw"not token"},d.get=function(e,t,r,n){var i=e.get();i.set(r,n),i.semanticAnalyze(t),t.semanticStack.push(i)},(f=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts._ignore)},t}(tE)).pool=eJ.createObjectPool(f),d.TrivialNode=f,(_=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.scope_brace)},r.semanticAnalyze=function(e){e.newScope()},t}(tE)).pool=eJ.createObjectPool(_),d.ScopeBrace=_,(y=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.scope_end_brace)},r.semanticAnalyze=function(e){e.dropScope()},t}(tE)).pool=eJ.createObjectPool(y),d.ScopeEndBrace=y,(g=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.jump_statement)},r.semanticAnalyze=function(e){d._unwrapToken(this.children[0]).type,ej.RETURN},r.codeGen=function(e){return e.visitJumpStatement(this)},t}(tE)).pool=eJ.createObjectPool(g),d.JumpStatement=g,(S=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.conditionopt)},t}(tE)).pool=eJ.createObjectPool(S),d.ConditionOpt=S,(v=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.for_rest_statement)},t}(tE)).pool=eJ.createObjectPool(v),d.ForRestStatement=v,(m=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.condition)},t}(tE)).pool=eJ.createObjectPool(m),d.Condition=m,(E=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.for_init_statement)},t}(tE)).pool=eJ.createObjectPool(E),d.ForInitStatement=E,(x=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.iteration_statement)},t}(tE)).pool=eJ.createObjectPool(x),d.IterationStatement=x,(C=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.selection_statement)},t}(tE)).pool=eJ.createObjectPool(C),d.SelectionStatement=C,(T=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.expression_statement)},t}(tE)).pool=eJ.createObjectPool(T),d.ExpressionStatement=T,A=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r,n){e.prototype.set.call(this,t,r,n),this._type=void 0},e1(t,[{key:"type",get:function(){var e;return null!=(e=this._type)?e:3e3},set:function(e){this._type=e}}]),t}(tE),d.ExpressionAstNode=A,(b=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.initializer_list)},r.semanticAnalyze=function(e){var t=this.children[0];this.type=t.type},t}(A)).pool=eJ.createObjectPool(b),d.InitializerList=b,(O=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.initializer)},r.semanticAnalyze=function(e){1===this.children.length?this.type=this.children[0].type:this.type=this.children[1].type},t}(A)).pool=eJ.createObjectPool(O),d.Initializer=O,(P=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.single_declaration),this.typeSpecifier=void 0,this.arraySpecifier=void 0},r.semanticAnalyze=function(e){var t,r=this.children[0],n=this.children[1];if(this.typeSpecifier=r.typeSpecifier,2===this.children.length||4===this.children.length){var i=new tv(r.type,r.typeSpecifier.lexeme),o=this.children[3];t=new to(n.lexeme,i,!1,o)}else{var a=this.children[2];this.arraySpecifier=a;var s=new tv(r.type,r.typeSpecifier.lexeme,a),c=this.children[4];t=new to(n.lexeme,s,!1,c)}e.symbolTable.insert(t)},r.codeGen=function(e){return e.visitSingleDeclaration(this)},t}(tE)).pool=eJ.createObjectPool(P),d.SingleDeclaration=P,(I=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.fully_specified_type)},e1(t,[{key:"qualifierList",get:function(){if(this.children.length>1)return this.children[0].qualifierList}},{key:"typeSpecifier",get:function(){return 1===this.children.length?this.children[0]:this.children[1]}},{key:"type",get:function(){return this.typeSpecifier.type}}]),t}(tE)).pool=eJ.createObjectPool(I),d.FullySpecifiedType=I,(L=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.type_qualifier)},r.semanticAnalyze=function(e){this.children.length>1?this.qualifierList=[].concat(this.children[0].qualifierList,[this.children[1].qualifier]):this.qualifierList=[this.children[0].qualifier]},t}(tE)).pool=eJ.createObjectPool(L),d.TypeQualifier=L,(R=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.single_type_qualifier)},r.semanticAnalyze=function(e){var t=this.children[0];eH(t,eZ)?this.qualifier=t.type:this.qualifier=t.qualifier,this.lexeme=t.lexeme},t}(tE)).pool=eJ.createObjectPool(R),d.SingleTypeQualifier=R,(k=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.storage_qualifier)},t}(M=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r,n){e.prototype.set.call(this,t,r,n)},e1(t,[{key:"qualifier",get:function(){return this.children[0].type}},{key:"lexeme",get:function(){return this.children[0].lexeme}}]),t}(tE))).pool=eJ.createObjectPool(k),d.StorageQualifier=k,(N=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.precision_qualifier)},t}(M)).pool=eJ.createObjectPool(N),d.PrecisionQualifier=N,(G=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.interpolation_qualifier)},t}(M)).pool=eJ.createObjectPool(G),d.InterpolationQualifier=G,(V=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.invariant_qualifier)},t}(M)).pool=eJ.createObjectPool(V),d.InvariantQualifier=V,(D=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.type_specifier)},e1(t,[{key:"type",get:function(){return this.children[0].type}},{key:"lexeme",get:function(){return this.children[0].lexeme}},{key:"arraySize",get:function(){var e,t;return null==(t=this.children)?void 0:null==(e=t[1])?void 0:e.size}},{key:"isCustom",get:function(){return"string"==typeof this.type}}]),t}(tE)).pool=eJ.createObjectPool(D),d.TypeSpecifier=D,(F=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.array_specifier)},e1(t,[{key:"size",get:function(){return this.children[1].value}}]),t}(tE)).pool=eJ.createObjectPool(F),d.ArraySpecifier=F,(w=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.integer_constant_expression_operator)},r.semanticAnalyze=function(e){var t=this.children[0];switch(t.type){case eW.PLUS:this.compute=function(e,t){return e+t};break;case eW.DASH:this.compute=function(e,t){return e-t};break;case eW.STAR:this.compute=function(e,t){return e*t};break;case eW.SLASH:this.compute=function(e,t){return e/t};break;case eW.PERCENT:this.compute=function(e,t){return e%t};break;default:e.error(t.location,"not implemented operator "+t.lexeme)}},e1(t,[{key:"lexeme",get:function(){return this.children[0].lexeme}}]),t}(tE)).pool=eJ.createObjectPool(w),d.IntegerConstantExpressionOperator=w,(B=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.integer_constant_expression),this.value=void 0},r.semanticAnalyze=function(e){if(1===this.children.length){var t=this.children[0];if(eH(t,eZ))this.value=Number(t.lexeme);else if(t.symbolInfo||e.error(t.location,"Undeclared symbol:",t.lexeme),!tS.typeCompatible(ej.INT,t.typeInfo)){e.error(t.location,"Invalid integer.");return}}},t}(tE)).pool=eJ.createObjectPool(B),d.IntegerConstantExpression=B,(j=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.type_specifier_nonarray);var n=r[0];eH(n,eZ)?this.type=n.lexeme:this.type=n.type,this.lexeme=n.lexeme},t}(tE)).pool=eJ.createObjectPool(j),d.TypeSpecifierNonArray=j,(U=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.ext_builtin_type_specifier_nonarray);var n=this.children[0];this.type=n.type,this.lexeme=n.lexeme},t}(tE)).pool=eJ.createObjectPool(U),d.ExtBuiltinTypeSpecifierNonArray=U,(W=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.init_declarator_list)},r.semanticAnalyze=function(e){var t;if(3===this.children.length||5===this.children.length)t=new to(this.children[2].lexeme,this.typeInfo,!1,this),e.symbolTable.insert(t);else if(4===this.children.length||6===this.children.length){var r=this.typeInfo,n=this.children[3];r.arraySpecifier&&n&&e.error(n.location,"Array of array is not supported."),r.arraySpecifier=n,t=new to(this.children[2].lexeme,r,!1,this),e.symbolTable.insert(t)}},e1(t,[{key:"typeInfo",get:function(){if(1===this.children.length){var e=this.children[0];return new tv(e.typeSpecifier.type,e.typeSpecifier.lexeme,e.arraySpecifier)}return this.children[0].typeInfo}}]),t}(tE)).pool=eJ.createObjectPool(W),d.InitDeclaratorList=W,(H=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.identifier_list)},e1(t,[{key:"idList",get:function(){return 2===this.children.length?[this.children[1]]:[].concat(this.children[0].idList,[this.children[2]])}}]),t}(tE)).pool=eJ.createObjectPool(H),d.IdentifierList=H,(q=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.declaration)},r.codeGen=function(e){return e.visitDeclaration(this)},t}(tE)).pool=eJ.createObjectPool(q),d.Declaration=q,(z=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.function_prototype)},r.codeGen=function(e){return e.visitFunctionProtoType(this)},e1(t,[{key:"declarator",get:function(){return this.children[0]}},{key:"ident",get:function(){return this.declarator.ident}},{key:"returnType",get:function(){return this.declarator.returnType}},{key:"parameterList",get:function(){return this.declarator.parameterInfoList}},{key:"paramSig",get:function(){return this.declarator.paramSig}}]),t}(tE)).pool=eJ.createObjectPool(z),d.FunctionProtoType=z,(X=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.function_declarator)},e1(t,[{key:"header",get:function(){return this.children[0]}},{key:"parameterList",get:function(){return this.children[1]}},{key:"ident",get:function(){return this.header.ident}},{key:"returnType",get:function(){return this.header.returnType}},{key:"parameterInfoList",get:function(){var e;return null==(e=this.parameterList)?void 0:e.parameterInfoList}},{key:"paramSig",get:function(){var e;return null==(e=this.parameterList)?void 0:e.paramSig}}]),t}(tE)).pool=eJ.createObjectPool(X),d.FunctionDeclarator=X,(Q=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.function_header)},r.semanticAnalyze=function(e){e.newScope()},r.codeGen=function(e){return e.visitFunctionHeader(this)},e1(t,[{key:"ident",get:function(){return this.children[1]}},{key:"returnType",get:function(){return this.children[0]}}]),t}(tE)).pool=eJ.createObjectPool(Q),d.FunctionHeader=Q,(K=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.function_parameter_list)},r.codeGen=function(e){return e.visitFunctionParameterList(this)},e1(t,[{key:"parameterInfoList",get:function(){if(1===this.children.length){var e=this.children[0];return[{ident:e.ident,typeInfo:e.typeInfo,astNode:e}]}var t=this.children[0],r=this.children[2];return[].concat(t.parameterInfoList,[{ident:r.ident,typeInfo:r.typeInfo,astNode:r}])}},{key:"paramSig",get:function(){if(1===this.children.length)return[this.children[0].typeInfo.type];var e=this.children[0],t=this.children[2];return e.paramSig.concat([t.typeInfo.type])}}]),t}(tE)).pool=eJ.createObjectPool(K),d.FunctionParameterList=K,(Y=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.parameter_declaration)},r.semanticAnalyze=function(e){var t,r=new to((t=1===this.children.length?this.children[0]:this.children[1]).ident.lexeme,t.typeInfo,!1,this);e.symbolTable.insert(r)},e1(t,[{key:"typeQualifier",get:function(){if(2===this.children.length)return this.children[0]}},{key:"parameterDeclarator",get:function(){return 1===this.children.length?this.children[0]:this.children[1]}},{key:"typeInfo",get:function(){return this.parameterDeclarator.typeInfo}},{key:"ident",get:function(){return this.parameterDeclarator.ident}}]),t}(tE)).pool=eJ.createObjectPool(Y),d.ParameterDeclaration=Y,(J=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.parameter_declarator)},e1(t,[{key:"ident",get:function(){return this.children[1]}},{key:"typeInfo",get:function(){var e=this.children[0],t=this.children[2];return new tv(e.type,e.lexeme,t)}}]),t}(tE)).pool=eJ.createObjectPool(J),d.ParameterDeclarator=J,(Z=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.simple_statement)},t}(tE)).pool=eJ.createObjectPool(Z),d.SimpleStatement=Z,($=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.compound_statement)},t}(tE)).pool=eJ.createObjectPool($),d.CompoundStatement=$,(ee=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.compound_statement_no_scope)},t}(tE)).pool=eJ.createObjectPool(ee),d.CompoundStatementNoScope=ee,(et=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.statement)},t}(tE)).pool=eJ.createObjectPool(et),d.Statement=et,(er=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.statement_list)},r.codeGen=function(e){return e.visitStatementList(this)},t}(tE)).pool=eJ.createObjectPool(er),d.StatementList=er,(en=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.function_definition)},r.semanticAnalyze=function(e){e.dropScope();var t=new te(this.protoType.ident.lexeme,this);e.symbolTable.insert(t)},r.codeGen=function(e){return e.visitFunctionDefinition(this)},e1(t,[{key:"protoType",get:function(){return this.children[0]}},{key:"statements",get:function(){return this.children[1]}}]),t}(tE)).pool=eJ.createObjectPool(en),d.FunctionDefinition=en,(ei=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.function_call)},r.semanticAnalyze=function(e){this.type=this.children[0].type},r.codeGen=function(e){return e.visitFunctionCall(this)},t}(A)).pool=eJ.createObjectPool(ei),d.FunctionCall=ei,(eo=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.function_call_generic),this.fnSymbol=void 0},r.semanticAnalyze=function(e){var t=this.children[0];if(t.isBuiltin)this.type=t.ident;else{var r,n,i=t.ident;if(4===this.children.length){var o=this.children[2];eH(o,ea)&&(n=o.paramSig)}var a=td.getFn.apply(td,[].concat([i],null!=n?n:[]));if(a){this.type=td.getReturnType(a.fun,a.genType);return}var s=e.symbolTable.lookup({ident:i,symbolType:e7.FN,signature:n});if(!s){e.error(this.location,"No overload function type found: ",t.ident);return}this.type=null==s?void 0:null==(r=s.dataType)?void 0:r.type,this.fnSymbol=s}},t}(A)).pool=eJ.createObjectPool(eo),d.FunctionCallGeneric=eo,(ea=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.function_call_parameter_list)},e1(t,[{key:"paramSig",get:function(){if(1===this.children.length){var e=this.children[0];return void 0==e.type?[3e3]:[e.type]}var t=this.children[0],r=this.children[2];return void 0==t.paramSig||void 0==r.type?[3e3]:t.paramSig.concat([r.type])}},{key:"paramNodes",get:function(){if(1===this.children.length)return[this.children[0]];var e=this.children[0],t=this.children[2];return e.paramNodes.concat([t])}}]),t}(tE)).pool=eJ.createObjectPool(ea),d.FunctionCallParameterList=ea,(es=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.precision_specifier)},r.semanticAnalyze=function(e){e.shaderData.globalPrecisions.push(this)},t}(tE)).pool=eJ.createObjectPool(es),d.PrecisionSpecifier=es,(ec=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.function_identifier)},r.semanticAnalyze=function(e){},r.codeGen=function(e){return e.visitFunctionIdentifier(this)},e1(t,[{key:"ident",get:function(){return this.children[0].type}},{key:"lexeme",get:function(){return this.children[0].lexeme}},{key:"isBuiltin",get:function(){return"string"!=typeof this.ident}}]),t}(tE)).pool=eJ.createObjectPool(ec),d.FunctionIdentifier=ec,(el=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.assignment_expression)},r.semanticAnalyze=function(e){if(1===this.children.length){var t,r=this.children[0];this.type=null!=(t=r.type)?t:3e3}else{var n,i=this.children[2];this.type=null!=(n=i.type)?n:3e3}},t}(A)).pool=eJ.createObjectPool(el),d.AssignmentExpression=el,(eu=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.assignment_operator)},t}(tE)).pool=eJ.createObjectPool(eu),d.AssignmentOperator=eu,(ep=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.expression)},r.semanticAnalyze=function(e){if(1===this.children.length){var t=this.children[0];this.type=t.type}else{var r=this.children[2];this.type=r.type}},t}(A)).pool=eJ.createObjectPool(ep),d.Expression=ep,(eh=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.primary_expression)},r.semanticAnalyze=function(e){if(1===this.children.length){var t,r=this.children[0];if(eH(r,eN))this.type=null!=(t=r.typeInfo)?t:3e3;else switch(r.type){case eW.INT_CONSTANT:this._type=ej.INT;break;case eW.FLOAT_CONSTANT:this.type=ej.FLOAT;break;case ej.TRUE:case ej.FALSE:this.type=ej.BOOL}}else{var n=this.children[1];this.type=n.type}},t}(A)).pool=eJ.createObjectPool(eh),d.PrimaryExpression=eh,(ed=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){if(e.prototype.set.call(this,t,r,ts.postfix_expression),1===this.children.length){var n=this.children[0];this.type=n.type}},r.codeGen=function(e){return e.visitPostfixExpression(this)},t}(A)).pool=eJ.createObjectPool(ed),d.PostfixExpression=ed,(ef=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.unary_operator)},t}(tE)).pool=eJ.createObjectPool(ef),d.UnaryOperator=ef,(e_=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.unary_expression),this.type=this.children[0].type},t}(A)).pool=eJ.createObjectPool(e_),d.UnaryExpression=e_,(ey=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){if(e.prototype.set.call(this,t,r,ts.multiplicative_expression),1===this.children.length)this.type=this.children[0].type;else{var n=this.children[0],i=this.children[2];n.type===i.type&&(this.type=n.type)}},t}(A)).pool=eJ.createObjectPool(ey),d.MultiplicativeExpression=ey,(eg=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){if(e.prototype.set.call(this,t,r,ts.additive_expression),1===this.children.length)this.type=this.children[0].type;else{var n=this.children[0],i=this.children[2];n.type===i.type&&(this.type=n.type)}},t}(A)).pool=eJ.createObjectPool(eg),d.AdditiveExpression=eg,(eS=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.shift_expression)},r.semanticAnalyze=function(e){var t=this.children[0];this.type=t.type},t}(A)).pool=eJ.createObjectPool(eS),d.ShiftExpression=eS,(ev=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.relational_expression)},r.semanticAnalyze=function(e){1===this.children.length?this.type=this.children[0].type:this.type=ej.BOOL},t}(A)).pool=eJ.createObjectPool(ev),d.RelationalExpression=ev,(em=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.equality_expression)},r.semanticAnalyze=function(e){1===this.children.length?this.type=this.children[0].type:this.type=ej.BOOL},t}(A)).pool=eJ.createObjectPool(em),d.EqualityExpression=em,(eE=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.and_expression)},r.semanticAnalyze=function(e){1===this.children.length?this.type=this.children[0].type:this.type=ej.UINT},t}(A)).pool=eJ.createObjectPool(eE),d.AndExpression=eE,(ex=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.exclusive_or_expression)},r.semanticAnalyze=function(e){1===this.children.length?this.type=this.children[0].type:this.type=ej.UINT},t}(A)).pool=eJ.createObjectPool(ex),d.ExclusiveOrExpression=ex,(eC=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.inclusive_or_expression)},r.semanticAnalyze=function(e){1===this.children.length?this.type=this.children[0].type:this.type=ej.UINT},t}(A)).pool=eJ.createObjectPool(eC),d.InclusiveOrExpression=eC,(eT=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.logical_and_expression)},r.semanticAnalyze=function(e){1===this.children.length?this.type=this.children[0].type:this.type=ej.BOOL},t}(A)).pool=eJ.createObjectPool(eT),d.LogicalAndExpression=eT,(eA=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.logical_xor_expression)},r.semanticAnalyze=function(e){1===this.children.length?this.type=this.children[0].type:this.type=ej.BOOL},t}(A)).pool=eJ.createObjectPool(eA),d.LogicalXorExpression=eA,(eb=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.logical_or_expression)},r.semanticAnalyze=function(e){1===this.children.length?this.type=this.children[0].type:this.type=ej.BOOL},t}(A)).pool=eJ.createObjectPool(eb),d.LogicalOrExpression=eb,(eO=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.conditional_expression)},r.semanticAnalyze=function(e){1===this.children.length&&(this.type=this.children[0].type)},t}(A)).pool=eJ.createObjectPool(eO),d.ConditionalExpression=eO,(eP=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.struct_specifier)},r.semanticAnalyze=function(e){6===this.children.length&&(this.ident=this.children[1],e.symbolTable.insert(new tt(this.ident.lexeme,this)))},e1(t,[{key:"propList",get:function(){return(6===this.children.length?this.children[3]:this.children[2]).propList}}]),t}(tE)).pool=eJ.createObjectPool(eP),d.StructSpecifier=eP,(eI=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.struct_declaration_list)},e1(t,[{key:"propList",get:function(){if(1===this.children.length)return this.children[0].propList;var e=this.children[0],t=this.children[1];return[e.propList,t.propList].flat()}}]),t}(tE)).pool=eJ.createObjectPool(eI),d.StructDeclarationList=eI,(eL=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.struct_declaration)},e1(t,[{key:"typeSpecifier",get:function(){return 3===this.children.length?this.children[0]:this.children[1]}},{key:"declaratorList",get:function(){return 3===this.children.length?this.children[1]:this.children[2]}},{key:"propList",get:function(){for(var e=[],t=0;t<this.declaratorList.declaratorList.length;t++){var r=this.declaratorList.declaratorList[t],n=new tm(new tv(this.typeSpecifier.type,this.typeSpecifier.lexeme,r.arraySpecifier),r.ident);e.push(n)}return e}}]),t}(tE)).pool=eJ.createObjectPool(eL),d.StructDeclaration=eL,(eR=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.struct_declarator_list)},e1(t,[{key:"declaratorList",get:function(){return 1===this.children.length?[this.children[0]]:[].concat(this.children[0].declaratorList,[this.children[1]])}}]),t}(tE)).pool=eJ.createObjectPool(eR),d.StructDeclaratorList=eR,(eM=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.set=function(t,r){e.prototype.set.call(this,t,r,ts.struct_declarator)},e1(t,[{key:"ident",get:function(){return this.children[0]}},{key:"arraySpecifier",get:function(){return this.children[1]}}]),t}(tE)).pool=eJ.createObjectPool(eM),d.StructDeclarator=eM,(ek=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.variable_declaration)},r.semanticAnalyze=function(e){var t,r=this.children[0];t=new to(this.children[1].lexeme,new tv(r.type,r.typeSpecifier.lexeme),!0,this),e.symbolTable.insert(t)},r.codeGen=function(e){return e.visitGlobalVariableDeclaration(this)},t}(tE)).pool=eJ.createObjectPool(ek),d.VariableDeclaration=ek,(eN=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.variable_identifier)},r.semanticAnalyze=function(e){var t=this.children[0],r=t_.getVar(t.lexeme);if(r){this.symbolInfo=r;return}this.symbolInfo=e.symbolTable.lookup({ident:t.lexeme,symbolType:e7.VAR}),this.symbolInfo||e.error(this.location,"undeclared identifier:",t.lexeme)},r.codeGen=function(e){return e.visitVariableIdentifier(this)},e1(t,[{key:"lexeme",get:function(){return this.children[0].lexeme}},{key:"typeInfo",get:function(){var e;return eH(this.symbolInfo,to)?this.symbolInfo.dataType.type:null==(e=this.symbolInfo)?void 0:e.type}}]),t}(tE)).pool=eJ.createObjectPool(eN),d.VariableIdentifier=eN,(eG=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var r=t.prototype;return r.set=function(t,r){e.prototype.set.call(this,t,r,ts.gs_shader_program)},r.semanticAnalyze=function(e){this.shaderData=e.shaderData,this.shaderData.symbolTable=e.symbolTable._scope},t}(tE)).pool=eJ.createObjectPool(eG),d.GLShaderProgram=eG;var tx=/*#__PURE__*/function(){function e(){}return e.isTerminal=function(e){return e<ts.START},e.toString=function(e){if(this.isTerminal(e)){var t;return null!=(t=eW[e])?t:ej[e]}return ts[e]},e.createProductionWithOptions=function(e,t,r){for(var i,o=[],a=n(t);!(i=a()).done;){var s=i.value;o.push([[].concat([e],s),function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(n[0]){var o=n[0].location.start,a=n[n.length-1].location.end,s=tJ.createRange(o,a);eF.get(null!=r?r:eF.TrivialNode.pool,e,s,n)}}])}return o},e.createProductionOptions=function(e,t,r){for(var i,o=[],a=n(r);!(i=a()).done;){var s=i.value,c=e.slice(0,t);c.push.apply(c,[].concat(s)),c.push.apply(c,[].concat(e.slice(t))),o.push(c)}return o},e.addMapSetItem=function(e,t,r){var n,i=null!=(n=e.get(t))?n:new Set;i.add(r),e.set(t,i)},e.isSubSet=function(e,t){for(var r,i=n(e);!(r=i()).done;){var o=r.value;if(!t.has(o))return!1}return!0},e.isActionEqual=function(e,t){return e.action===t.action&&e.target===t.target},e.printAction=function(e){return"<Action: "+e9[e.action]+" -> "+(e.action===e9.Reduce?tc.pool.get(e.target):"State "+e.target)+">"},e.printProduction=function(t){var r=t.derivation.map(function(t){return e.toString(t)}).join("|");return ts[t.goal]+" :=> "+r},e}(),tC=[].concat(tx.createProductionWithOptions(ts.gs_shader_program,[[ts.global_declaration],[ts.gs_shader_program,ts.global_declaration]],eF.GLShaderProgram.pool),tx.createProductionWithOptions(ts.global_declaration,[[ts.precision_specifier],[ts.variable_declaration],[ts.struct_specifier],[ts.function_definition]]),tx.createProductionWithOptions(ts.variable_declaration,[[ej.GS_RenderQueueType,eW.ID,eW.SEMICOLON],[ts.fully_specified_type,eW.ID,eW.SEMICOLON],[ts.fully_specified_type,eW.ID,ts.array_specifier,eW.SEMICOLON]],eF.VariableDeclaration.pool),tx.createProductionWithOptions(ts.ext_builtin_type_specifier_nonarray,[[ej.VOID],[ej.FLOAT],[ej.BOOL],[ej.INT],[ej.UINT],[ej.VEC2],[ej.VEC3],[ej.VEC4],[ej.BVEC2],[ej.BVEC3],[ej.BVEC4],[ej.IVEC2],[ej.IVEC3],[ej.IVEC4],[ej.UVEC2],[ej.UVEC3],[ej.UVEC4],[ej.MAT2],[ej.MAT3],[ej.MAT4],[ej.MAT2X3],[ej.MAT2X4],[ej.MAT3X2],[ej.MAT3X4],[ej.MAT4X2],[ej.MAT4X3],[ej.SAMPLER2D],[ej.SAMPLER3D],[ej.SAMPLER_CUBE],[ej.SAMPLER2D_SHADOW],[ej.SAMPLER_CUBE_SHADOW],[ej.SAMPLER2D_ARRAY],[ej.SAMPLER2D_ARRAY_SHADOW],[ej.I_SAMPLER2D],[ej.I_SAMPLER3D],[ej.I_SAMPLER_CUBE],[ej.I_SAMPLER2D_ARRAY],[ej.U_SAMPLER2D],[ej.U_SAMPLER3D],[ej.U_SAMPLER_CUBE],[ej.U_SAMPLER2D_ARRAY]],eF.ExtBuiltinTypeSpecifierNonArray.pool),tx.createProductionWithOptions(ts.type_specifier_nonarray,[[eW.ID],[ts.ext_builtin_type_specifier_nonarray]],eF.TypeSpecifierNonArray.pool),tx.createProductionWithOptions(ts.fully_specified_type,[[ts.type_specifier],[ts.type_qualifier,ts.type_specifier]],eF.FullySpecifiedType.pool),tx.createProductionWithOptions(ts.type_specifier,[[ts.type_specifier_nonarray],[ts.ext_builtin_type_specifier_nonarray,ts.array_specifier]],eF.TypeSpecifier.pool),tx.createProductionWithOptions(ts.type_qualifier,[[ts.single_type_qualifier],[ts.type_qualifier,ts.single_type_qualifier]],eF.TypeQualifier.pool),tx.createProductionWithOptions(ts.single_type_qualifier,[[ts.storage_qualifier],[ts.precision_qualifier],[ts.interpolation_qualifier],[ts.invariant_qualifier],[ej.PRECISE]],eF.SingleTypeQualifier.pool),tx.createProductionWithOptions(ts.storage_qualifier,[[ej.CONST],[ej.IN],[ej.INOUT],[ej.OUT],[ej.CENTROID]],eF.StorageQualifier.pool),tx.createProductionWithOptions(ts.interpolation_qualifier,[[ej.SMOOTH],[ej.FLAT]],eF.InterpolationQualifier.pool),tx.createProductionWithOptions(ts.invariant_qualifier,[[ej.INVARIANT]],eF.InvariantQualifier.pool),tx.createProductionWithOptions(ts.precision_qualifier,[[ej.HIGHP],[ej.MEDIUMP],[ej.LOWP]],eF.PrecisionQualifier.pool),tx.createProductionWithOptions(ts.struct_specifier,[[ej.STRUCT,eW.ID,eW.LEFT_BRACE,ts.struct_declaration_list,eW.RIGHT_BRACE,eW.SEMICOLON],[ej.STRUCT,eW.LEFT_BRACE,ts.struct_declaration_list,eW.RIGHT_BRACE,eW.SEMICOLON]],eF.StructSpecifier.pool),tx.createProductionWithOptions(ts.struct_declaration_list,[[ts.struct_declaration],[ts.struct_declaration_list,ts.struct_declaration]],eF.StructDeclarationList.pool),tx.createProductionWithOptions(ts.struct_declaration,[[ts.type_specifier,ts.struct_declarator_list,eW.SEMICOLON],[ts.type_qualifier,ts.type_specifier,ts.struct_declarator_list,eW.SEMICOLON]],eF.StructDeclaration.pool),tx.createProductionWithOptions(ts.struct_declarator_list,[[ts.struct_declarator],[ts.struct_declarator_list,eW.COMMA,ts.struct_declarator]],eF.StructDeclaratorList.pool),tx.createProductionWithOptions(ts.struct_declarator,[[eW.ID],[eW.ID,ts.array_specifier]],eF.StructDeclarator.pool),tx.createProductionWithOptions(ts.array_specifier,[[eW.LEFT_BRACKET,eW.RIGHT_BRACKET],[eW.LEFT_BRACKET,ts.integer_constant_expression,eW.RIGHT_BRACKET]],eF.ArraySpecifier.pool),tx.createProductionWithOptions(ts.integer_constant_expression_operator,[[eW.PLUS],[eW.DASH],[eW.STAR],[eW.SLASH],[eW.PERCENT]],eF.IntegerConstantExpressionOperator.pool),tx.createProductionWithOptions(ts.integer_constant_expression,[[ts.variable_identifier],[eW.INT_CONSTANT],[ts.integer_constant_expression,ts.integer_constant_expression_operator,eW.INT_CONSTANT],[ts.integer_constant_expression,ts.integer_constant_expression_operator,ts.variable_identifier]],eF.IntegerConstantExpression.pool),tx.createProductionWithOptions(ts.conditional_expression,[[ts.logical_or_expression],[ts.logical_or_expression,eW.QUESTION,ts.expression,eW.COLON,ts.assignment_expression]],eF.ConditionalExpression.pool),tx.createProductionWithOptions(ts.logical_or_expression,[[ts.logical_xor_expression],[ts.logical_or_expression,eW.OR_OP,ts.logical_xor_expression]],eF.LogicalOrExpression.pool),tx.createProductionWithOptions(ts.logical_xor_expression,[[ts.logical_and_expression],[ts.logical_xor_expression,eW.XOR_OP,ts.logical_and_expression]],eF.LogicalXorExpression.pool),tx.createProductionWithOptions(ts.logical_and_expression,[[ts.inclusive_or_expression],[ts.logical_and_expression,eW.AND_OP,ts.inclusive_or_expression]],eF.LogicalAndExpression.pool),tx.createProductionWithOptions(ts.inclusive_or_expression,[[ts.exclusive_or_expression],[ts.inclusive_or_expression,eW.VERTICAL_BAR,ts.exclusive_or_expression]],eF.InclusiveOrExpression.pool),tx.createProductionWithOptions(ts.exclusive_or_expression,[[ts.and_expression],[ts.exclusive_or_expression,eW.CARET,ts.and_expression]],eF.ExclusiveOrExpression.pool),tx.createProductionWithOptions(ts.and_expression,[[ts.equality_expression],[ts.and_expression,eW.AMPERSAND,ts.equality_expression]],eF.AndExpression.pool),tx.createProductionWithOptions(ts.equality_expression,[[ts.relational_expression],[ts.equality_expression,eW.EQ_OP,ts.relational_expression],[ts.equality_expression,eW.NE_OP,ts.relational_expression]],eF.EqualityExpression.pool),tx.createProductionWithOptions(ts.relational_expression,[[ts.shift_expression],[ts.relational_expression,eW.LEFT_ANGLE,ts.shift_expression],[ts.relational_expression,eW.RIGHT_ANGLE,ts.shift_expression],[ts.relational_expression,eW.LE_OP,ts.shift_expression],[ts.relational_expression,eW.GE_OP,ts.shift_expression]],eF.RelationalExpression.pool),tx.createProductionWithOptions(ts.shift_expression,[[ts.additive_expression],[ts.shift_expression,eW.LEFT_OP,ts.additive_expression],[ts.shift_expression,eW.RIGHT_OP,ts.additive_expression]],eF.ShiftExpression.pool),tx.createProductionWithOptions(ts.additive_expression,[[ts.multiplicative_expression],[ts.additive_expression,eW.PLUS,ts.multiplicative_expression],[ts.additive_expression,eW.DASH,ts.multiplicative_expression]],eF.AdditiveExpression.pool),tx.createProductionWithOptions(ts.multiplicative_expression,[[ts.unary_expression],[ts.multiplicative_expression,eW.STAR,ts.unary_expression],[ts.multiplicative_expression,eW.SLASH,ts.unary_expression],[ts.multiplicative_expression,eW.PERCENT,ts.unary_expression]],eF.MultiplicativeExpression.pool),tx.createProductionWithOptions(ts.unary_expression,[[ts.postfix_expression],[eW.INC_OP,ts.unary_expression],[eW.DEC_OP,ts.unary_expression],[ts.unary_operator,ts.unary_expression]],eF.UnaryExpression.pool),tx.createProductionWithOptions(ts.unary_operator,[[eW.PLUS],[eW.DASH],[eW.BANG],[eW.TILDE]],eF.UnaryOperator.pool),tx.createProductionWithOptions(ts.postfix_expression,[[ts.primary_expression],[ts.postfix_expression,eW.LEFT_BRACKET,ts.expression,eW.RIGHT_BRACKET],[ts.function_call],[ts.postfix_expression,eW.DOT,eW.ID],[ts.postfix_expression,eW.DOT,ts.function_call],[ts.postfix_expression,eW.INC_OP],[ts.postfix_expression,eW.DEC_OP]],eF.PostfixExpression.pool),tx.createProductionWithOptions(ts.primary_expression,[[ts.variable_identifier],[eW.INT_CONSTANT],[eW.FLOAT_CONSTANT],[ej.TRUE],[ej.FALSE],[eW.LEFT_PAREN,ts.expression,eW.RIGHT_PAREN]],eF.PrimaryExpression.pool),tx.createProductionWithOptions(ts.expression,[[ts.assignment_expression],[ts.expression,eW.COMMA,ts.assignment_expression]],eF.Expression.pool),tx.createProductionWithOptions(ts.assignment_expression,[[ts.conditional_expression],[ts.unary_expression,ts.assignment_operator,ts.assignment_expression]],eF.AssignmentExpression.pool),tx.createProductionWithOptions(ts.assignment_operator,[[eW.EQUAL],[eW.MUL_ASSIGN],[eW.DIV_ASSIGN],[eW.MOD_ASSIGN],[eW.ADD_ASSIGN],[eW.SUB_ASSIGN],[eW.LEFT_ASSIGN],[eW.RIGHT_ASSIGN],[eW.AND_ASSIGN],[eW.XOR_ASSIGN],[eW.OR_ASSIGN]],eF.AssignmentOperator.pool),tx.createProductionWithOptions(ts.function_call,[[ts.function_call_generic]],eF.FunctionCall.pool),tx.createProductionWithOptions(ts.function_call_generic,[[ts.function_identifier,eW.LEFT_PAREN,ts.function_call_parameter_list,eW.RIGHT_PAREN],[ts.function_identifier,eW.LEFT_PAREN,eW.RIGHT_PAREN],[ts.function_identifier,ej.VOID,eW.RIGHT_PAREN]],eF.FunctionCallGeneric.pool),tx.createProductionWithOptions(ts.function_call_parameter_list,[[ts.assignment_expression],[ts.function_call_parameter_list,eW.COMMA,ts.assignment_expression]],eF.FunctionCallParameterList.pool),tx.createProductionWithOptions(ts.function_identifier,[[ts.type_specifier]],eF.FunctionIdentifier.pool),tx.createProductionWithOptions(ts.function_definition,[[ts.function_prototype,ts.compound_statement_no_scope]],eF.FunctionDefinition.pool),tx.createProductionWithOptions(ts.function_prototype,[[ts.function_declarator,eW.RIGHT_PAREN]],eF.FunctionProtoType.pool),tx.createProductionWithOptions(ts.function_declarator,[[ts.function_header],[ts.function_header,ts.function_parameter_list]],eF.FunctionDeclarator.pool),tx.createProductionWithOptions(ts.function_header,[[ts.fully_specified_type,eW.ID,eW.LEFT_PAREN]],eF.FunctionHeader.pool),tx.createProductionWithOptions(ts.function_parameter_list,[[ts.parameter_declaration],[ts.function_parameter_list,eW.COMMA,ts.parameter_declaration]],eF.FunctionParameterList.pool),tx.createProductionWithOptions(ts.parameter_declaration,[[ts.type_qualifier,ts.parameter_declarator],[ts.parameter_declarator]],eF.ParameterDeclaration.pool),tx.createProductionWithOptions(ts.parameter_declarator,[[ts.type_specifier,eW.ID],[ts.type_specifier,eW.ID,ts.array_specifier]],eF.ParameterDeclarator.pool),tx.createProductionWithOptions(ts.statement_list,[[ts.statement],[ts.statement_list,ts.statement]],eF.StatementList.pool),tx.createProductionWithOptions(ts.statement,[[ts.compound_statement],[ts.simple_statement]],eF.Statement.pool),tx.createProductionWithOptions(ts.compound_statement_no_scope,[[eW.LEFT_BRACE,eW.RIGHT_BRACE],[eW.LEFT_BRACE,ts.statement_list,eW.RIGHT_BRACE]],eF.CompoundStatementNoScope.pool),tx.createProductionWithOptions(ts.compound_statement,[[eW.LEFT_BRACE,eW.RIGHT_BRACE],[ts.scope_brace,ts.statement_list,ts.scope_end_brace]],eF.CompoundStatement.pool),tx.createProductionWithOptions(ts.simple_statement,[[ts.declaration],[ts.expression_statement],[ts.selection_statement],[ts.iteration_statement],[ts.jump_statement]],eF.SimpleStatement.pool),tx.createProductionWithOptions(ts.declaration,[[ts.function_prototype,eW.SEMICOLON],[ts.init_declarator_list,eW.SEMICOLON],[ej.PRECISION,ts.precision_qualifier,ts.ext_builtin_type_specifier_nonarray,eW.SEMICOLON],[ts.type_qualifier,eW.ID,eW.SEMICOLON],[ts.type_qualifier,eW.ID,ts.identifier_list,eW.SEMICOLON]],eF.Declaration.pool),tx.createProductionWithOptions(ts.identifier_list,[[eW.COMMA,eW.ID],[ts.identifier_list,eW.COMMA,eW.ID]],eF.IdentifierList.pool),tx.createProductionWithOptions(ts.init_declarator_list,[[ts.single_declaration],[ts.init_declarator_list,eW.COMMA,eW.ID],[ts.init_declarator_list,eW.COMMA,eW.ID,ts.array_specifier],[ts.init_declarator_list,eW.COMMA,eW.ID,ts.array_specifier,eW.EQUAL,ts.initializer],[ts.init_declarator_list,eW.COMMA,eW.ID,eW.EQUAL,ts.initializer]],eF.InitDeclaratorList.pool),tx.createProductionWithOptions(ts.single_declaration,[[ts.fully_specified_type,eW.ID],[ts.fully_specified_type,eW.ID,ts.array_specifier],[ts.fully_specified_type,eW.ID,ts.array_specifier,eW.EQUAL,ts.initializer],[ts.fully_specified_type,eW.ID,eW.EQUAL,ts.initializer]],eF.SingleDeclaration.pool),tx.createProductionWithOptions(ts.initializer,[[ts.assignment_expression],[eW.LEFT_BRACE,ts.initializer_list,eW.RIGHT_BRACE]],eF.Initializer.pool),tx.createProductionWithOptions(ts.initializer_list,[[ts.initializer],[ts.initializer_list,eW.COMMA,ts.initializer]],eF.InitializerList.pool),tx.createProductionWithOptions(ts.expression_statement,[[eW.SEMICOLON],[ts.expression,eW.SEMICOLON]],eF.ExpressionStatement.pool),tx.createProductionWithOptions(ts.selection_statement,[[ej.IF,eW.LEFT_PAREN,ts.expression,eW.RIGHT_PAREN,ts.statement],[ej.IF,eW.LEFT_PAREN,ts.expression,eW.RIGHT_PAREN,ts.statement,ej.ELSE,ts.statement]],eF.SelectionStatement.pool),tx.createProductionWithOptions(ts.iteration_statement,[[ej.WHILE,eW.LEFT_PAREN,ts.condition,eW.RIGHT_PAREN,ts.statement],[ej.FOR,eW.LEFT_PAREN,ts.for_init_statement,ts.for_rest_statement,eW.RIGHT_PAREN,ts.statement]],eF.IterationStatement.pool),tx.createProductionWithOptions(ts.precision_specifier,[[ej.PRECISION,ts.precision_qualifier,ts.ext_builtin_type_specifier_nonarray,eW.SEMICOLON]],eF.PrecisionSpecifier.pool),tx.createProductionWithOptions(ts.for_init_statement,[[ts.expression_statement],[ts.declaration]],eF.ForInitStatement.pool),tx.createProductionWithOptions(ts.condition,[[ts.expression],[ts.fully_specified_type,eW.ID,eW.EQUAL,ts.initializer]],eF.Condition.pool),tx.createProductionWithOptions(ts.for_rest_statement,[[ts.conditionopt,eW.SEMICOLON],[ts.conditionopt,eW.SEMICOLON,ts.expression]],eF.ForRestStatement.pool),tx.createProductionWithOptions(ts.conditionopt,[[eW.EPSILON],[ts.condition]],eF.ConditionOpt.pool),tx.createProductionWithOptions(ts.jump_statement,[[ej.CONTINUE,eW.SEMICOLON],[ej.BREAK,eW.SEMICOLON],[ej.RETURN,eW.SEMICOLON],[ej.RETURN,ts.expression,eW.SEMICOLON],[ej.DISCARD,eW.SEMICOLON]],eF.JumpStatement.pool),tx.createProductionWithOptions(ts.scope_brace,[[eW.LEFT_BRACE]],eF.ScopeBrace.pool),tx.createProductionWithOptions(ts.scope_end_brace,[[eW.RIGHT_BRACE]],eF.ScopeEndBrace.pool),tx.createProductionWithOptions(ts.variable_identifier,[[eW.ID]],eF.VariableIdentifier.pool)),tT=function(e){for(var t=0;t<tC.length;t++){var r=tC[t][1];r&&e.addTranslationRule(t,r)}},tA=/*#__PURE__*/function(){function e(e){this.firstSetMap=new Map,this.followSetMap=new Map,this.actionTable=new Map,this.gotoTable=new Map,this._firstSetNTStack=[],this.grammar=e}var t=e.prototype;return t.generate=function(){this.computeFirstSet(),this.buildStateTable()},t.buildStateTable=function(){var e=[new ty(this.grammar.productions[0],0,[eW.EOF])],t=tg.create(e);this._extendState(t)},t._extendState=function(e){if(e.needReInfer){this._closure(e);for(var t,r=this._inferNextState(e),i=n(r);!(t=i()).done;){var o=t.value;this._extendState(o)}}},t._closure=function(e){for(var t,r=n(e.cores);!(t=r()).done;){var i=t.value;i.canReduce()||this._extendStateItem(e,i)}return e.closured=!0,e},t._extendStateItem=function(e,t){if(!tx.isTerminal(t.curSymbol)){var r=this.grammar.getProductionList(t.curSymbol);if(t.nextSymbol){for(var i=new Set,o=!1,a=1,s=t.symbolByOffset(1);s;s=t.symbolByOffset(++a)){if(tx.isTerminal(s)){i.add(s),o=!0;break}c=this.firstSetMap.get(s);for(var c,l,u=n(c);!(l=u()).done;){var p=l.value;i.add(p)}if(!c.has(eW.EPSILON))break}if(!o&&(null==c?void 0:c.has(eW.EPSILON)))for(var h,d=n(t.lookaheadSet);!(h=d()).done;){var f=h.value;i.add(f)}for(var _,y=n(r);!(_=y()).done;){var g=_.value,S=e.createStateItem(g,0);e.items.has(S)&&tx.isSubSet(i,S.lookaheadSet)||(e.items.add(S),S.addLookahead(i),this._extendStateItem(e,S))}}else for(var v,m=n(r);!(v=m()).done;){var E=v.value,x=e.createStateItem(E,0);e.items.has(x)&&tx.isSubSet(t.lookaheadSet,x.lookaheadSet)||(e.items.add(x),x.addLookahead(t.lookaheadSet),this._extendStateItem(e,x))}}},t._inferNextState=function(e){var t=new Map,r=null!=(o=this.actionTable.get(e.id))?o:new Map,i=null!=(a=this.gotoTable.get(e.id))?a:new Map;this.actionTable.set(e.id,r),this.gotoTable.set(e.id,i);for(var o,a,s,c=n(e.items);!(s=c()).done;){var l=s.value;if(l.canReduce()){var u=void 0;u=l.production.goal!==ts.START?{action:e9.Reduce,target:l.production.id}:{action:e9.Accept};for(var p,h=n(l.lookaheadSet);!(p=h()).done;){var d=p.value;this._addAction(r,d,u)}}else{var f=l.advance();tx.addMapSetItem(t,l.curSymbol,f)}l.needReInfer=!1}for(var _,y=new Set,g=n(t.entries());!(_=g()).done;){var S=_.value,v=S[0],m=S[1],E=tg.create(Array.from(m));tx.isTerminal(v)?this._addAction(r,v,{action:e9.Shift,target:E.id}):i.set(v,E.id),y.add(E)}return y},t._addAction=function(e,t,r){var n=e.get(t);if(n&&!tx.isActionEqual(n,r)){if(t===ej.ELSE&&n.action===e9.Shift&&r.action===e9.Reduce)return;console.warn("conflict detect: <Terminal "+tx.toString(t)+">",tx.printAction(n)," -> ",tx.printAction(r))}e.set(t,r)},t.computeFirstSet=function(){for(var e,t=n(this.grammar.productions.slice(1));!(e=t()).done;){var r=e.value;this._computeFirstSetForNT(r.goal)}},t._computeFirstSetForNT=function(e){var t=this._firstSetNTStack.findIndex(function(t){return t===e});if(-1!==t){for(var r=this.firstSetMap.get(e),i=this._firstSetNTStack.length,o=i-1;o>t;o--){var a=this._firstSetNTStack[o];this.firstSetMap.set(a,r)}return r}this._firstSetNTStack.push(e);var s=this.grammar.getProductionList(e),c=new Set;this.firstSetMap.set(e,c),this.grammar.isNullableNT(e)&&c.add(eW.EPSILON);for(var l,u=n(s);!(l=u()).done;){for(var p=l.value,h=0;h<p.derivation.length;h++){var d=p.derivation[h];if(tx.isTerminal(d)){c.add(d);break}for(var f,_=this._computeFirstSetForNT(d),y=n(_);!(f=y()).done;){var g=f.value;g!==eW.EPSILON&&c.add(g)}if(!this.grammar.isNullableNT(d))break}h===p.derivation.length&&c.add(eW.EPSILON)}return this._firstSetNTStack.pop(),c},e}(),tb=/*#__PURE__*/function(){function e(e,t,r){this._traceBackStack=[],this.actionTable=e,this.gotoTable=t,this.grammar=r,this.sematicAnalyzer=new ta}var r=e.prototype;return r.parse=function(e){this.sematicAnalyzer.reset();var r=performance.now(),n=this._traceBackStack,i=this.sematicAnalyzer;n.push(0);for(var o=e.next(),a=0;;){a+=1;var s=o.value,c=this.stateActionTable.get(s.type);if((null==c?void 0:c.action)===e9.Shift)n.push(s,c.target),o=e.next();else if((null==c?void 0:c.action)===e9.Accept)return t.Logger.info("[pass compilation - parser] Accept! State automata run "+a+" times! cost time "+(performance.now()-r)+"ms"),null==i.acceptRule||i.acceptRule.call(i,i),i.semanticStack.pop();else if((null==c?void 0:c.action)===e9.Reduce){for(var l=c.target,u=this.grammar.getProductionByID(l),p=i.getTranslationRule(u.id),h=[],d=u.derivation.length-1;d>=0;d--)if(u.derivation[d]!==eW.EPSILON){n.pop();var f=n.pop();if(eH(f,eZ))h.unshift(f);else{var _=i.semanticStack.pop();h.unshift(_)}}null==p||p.apply(void 0,[].concat([i],h));var y=this.stateGotoTable;n.push(u.goal);var g=null==y?void 0:y.get(u.goal);n.push(g);continue}else{var S=eJ.createGSError("Unexpected token "+s.lexeme,eY.CompilationError,tJ._processingPassText,s.location);return this.sematicAnalyzer.errors.push(S),null}}},r._printStack=function(e){for(var r="",n=0;n<this._traceBackStack.length-1;n++){var i,o=this._traceBackStack[n++],a=this._traceBackStack[n];r+="State"+o+" - "+(null!=(i=a.lexeme)?i:tS.toString(a))+"; "}r+="State"+this._traceBackStack[this._traceBackStack.length-1]+" --- "+e.lexeme,t.Logger.info(r)},e.create=function(){if(!this._singleton){var t=tl.create(ts.gs_shader_program,tC.map(function(e){return e[0]})),r=new tA(t);r.generate(),this._singleton=new e(r.actionTable,r.gotoTable,t),tT(this._singleton.sematicAnalyzer)}return this._singleton},e1(e,[{key:"curState",get:function(){return this._traceBackStack[this._traceBackStack.length-1]}},{key:"stateActionTable",get:function(){return this.actionTable.get(this.curState)}},{key:"stateGotoTable",get:function(){return this.gotoTable.get(this.curState)}},{key:"errors",get:function(){return this.sematicAnalyzer.errors}}]),e}();function tO(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}var tP=/*#__PURE__*/function(){function e(e,t,r,n){this.macro=e,this.body=t,this.location=r,this.args=n,n&&(this._argsLexemes=this.args.map(function(e){return e.lexeme}),this._replaceRegex=RegExp("\\b("+this._argsLexemes.join("|")+")\\b","g"))}return e.prototype.expandFunctionBody=function(e){var t,r=this;if(e.length!==(null==(t=this.args)?void 0:t.length))throw eJ.createGSError("mismatched function macro",eY.PreprocessorError,"",this.location);return this.body.lexeme.replace(this._replaceRegex,function(t){return e[r._argsLexemes.indexOf(t)]})},e1(e,[{key:"isFunction",get:function(){var e;return!!(null==(e=this.args)?void 0:e.length)}}]),e}(),tI=((eV={})[eV.id=0]="id",eV[eV.line_remain=1]="line_remain",eV[eV.chunk=2]="chunk",eV[eV.int_constant=3]="int_constant",eV[eV.string_const=4]="string_const",eV[eV.right_op=5]="right_op",eV[eV.left_op=6]="left_op",eV[eV.left_paren=7]="left_paren",eV[eV.right_paren=8]="right_paren",eV[eV.ge=9]="ge",eV[eV.le=10]="le",eV[eV.eq=11]="eq",eV[eV.neq=12]="neq",eV[eV.and=13]="and",eV[eV.or=14]="or",eV[eV.left_angle=15]="left_angle",eV[eV.right_angle=16]="right_angle",eV[eV.star=17]="star",eV[eV.plus=18]="plus",eV[eV.dash=19]="dash",eV[eV.bang=20]="bang",eV[eV.slash=21]="slash",eV[eV.percent=22]="percent",eV[eV.EOF=100]="EOF",eV),tL=((eD={})[eD.define=101]="define",eD[eD.undef=102]="undef",eD[eD.if=103]="if",eD[eD.ifdef=104]="ifdef",eD[eD.ifndef=105]="ifndef",eD[eD.else=106]="else",eD[eD.elif=107]="elif",eD[eD.endif=108]="endif",eD[eD.include=109]="include",eD[eD.defined=110]="defined",eD),tR=new Map([["#define",101],["#undef",102],["#if",103],["#ifdef",104],["#ifndef",105],["#else",106],["#elif",107],["#endif",108],["#include",109],["defined",110]]),tM=function(e,t,r){this.sourceFile=null!=e?e:"__main__",this.rangeInFile=t,this.sourceMap=r},tk=/*#__PURE__*/function(){function e(e,t,r){this.sourceLoc={block:e,rangeInBlock:t},this.generatedLoc=r}return e.prototype.getSourceIndex=function(e){var t,r,n,i,o=this.sourceLoc,a=o.block,s=o.rangeInBlock;if(a.sourceMap){if("__main__"!==a.sourceFile)return a.sourceMap.map(e-this.generatedLoc.start);if(s)return{sourceFile:a.sourceFile,index:(null!=(n=null==(r=a.rangeInFile)?void 0:r.start.index)?n:0)+s.start.index}}return{index:e-this.generatedLoc.start+s.start.index+(null!=(i=null==(t=a.rangeInFile)?void 0:t.start.index)?i:0),sourceFile:this.sourceLoc.block.sourceFile}},e}(),tN=/*#__PURE__*/function(){function e(){this.mapRanges=[]}var t=e.prototype;return t.addMapRange=function(e){this.mapRanges.push(e)},t.map=function(t){for(var r,i,o=n(this.mapRanges);!(i=o()).done;){var a=i.value,s=a.generatedLoc;if(e.rangeContains(s,t))return a.getSourceIndex(t);if(a.generatedLoc.start<t){r=a;continue}break}return r?{index:t-r.generatedLoc.end+r.sourceLoc.rangeInBlock.end.index,sourceFile:r.sourceLoc.block.sourceFile}:{sourceFile:"__main__",index:t}},e.rangeContains=function(e,t){return e.start<=t&&e.end>t},e}(),tG=/*#__PURE__*/function(){function e(){}return e.expand=function(e,t,r){for(var i,o=[],a=0,s=0,c=n(e);!(i=c()).done;){var l=i.value,u=t.slice(a,l.rangeInBlock.start.index);o.push(u,l.replace);var p=s+u.length+l.replace.length,h=new tk(l.block,l.rangeInBlock,{start:s+u.length,end:p});null==r||r.addMapRange(h),a=l.rangeInBlock.end.index,s=p}return o.push(t.slice(a)),o.join("")},e.assembleSegments=function(e,t){for(var r,i=[],o=0,a=n(e);!(r=a()).done;){var s=r.value,c=t.slice(o,s.range.start.index);i.push(c,s.replace),o=s.range.end.index}return i.push(t.slice(o)),i.join("")},e}(),tV=/*#__PURE__*/function(e){function t(t,r,n){var i;return void 0===r&&(r="__main__"),(i=e.call(this,t)||this).macroLvl=0,i.sourceMap=new tN,i.file=r,i.blockRange=n,i}o(t,e);var r=t.prototype;return r.scanDirective=function(e){var t=this._advanceToDirective(e);return[tL.if,tL.ifdef,tL.ifndef].includes(null==t?void 0:t.type)?this.macroLvl+=1:(null==t?void 0:t.type)===tL.endif&&(this.macroLvl-=1),t},r.scanWordsUntilChar=function(e){for(var t=[];;)if(this.skipSpace(!0),e0.isLetter(this.getCurChar()))t.push(this.scanWord());else{if(this.getCurChar()===e)return this.advance(),t;this.advance()}},r.scanWord=function(e){if(void 0===e&&(e=!1),e)for(;!e0.isLetter(this.getCurChar())&&!this.isEnd();)this.advance();else this.skipSpace(!0);if(this.isEnd())return e$;for(var t=this._currentIndex;e0.isLetter(this.getCurChar())&&!this.isEnd();)this.advance();var r=this._currentIndex,n=this._source.slice(t,r);r===t&&this.throwError(this.getShaderPosition(),"no word found.");var i=tR.get(n);if(i){var o=eZ.pool.get();return o.set(i,n,this.getShaderPosition()),o}var a=eZ.pool.get();return a.set(tI.id,n,this.getShaderPosition(n.length)),a},r.getShaderPosition=function(e){return void 0===e&&(e=0),tJ.createPosition(this._currentIndex-e,this.line,this.column-e)},r.scanToken=function(e){if(this.skipSpace(!0),this._skipComments(),!this.isEnd()){for(var r=this._currentIndex;t._splitCharacters.test(this.getCurChar())&&!this.isEnd();)this._advance();if(r===this._currentIndex)return this._advance(),this.scanToken(e);var n=this._source.slice(r,this._currentIndex),i=eZ.pool.get();return i.set(tR.has(n)?tR.get(n):tI.id,n,this.getShaderPosition(this._currentIndex-r)),null==e||e(i,this),i}},r.scanQuotedString=function(){this.skipSpace(!0),'"'!==this.getCurChar()&&this.throwError(this.getShaderPosition(),"unexpected char, expected '\"'");var e=this.getShaderPosition();this._advance();for(var t=this._currentIndex;'"'!==this.getCurChar()&&!this.isEnd();)this._advance();this.isEnd()&&this.throwError(this.getShaderPosition(),"unexpected char, expected '\"'");var r=this._source.slice(t,this._currentIndex),n=eZ.pool.get();return n.set(tI.string_const,r,e),n},r.scanToChar=function(e){for(var t=this._source;t[this._currentIndex]!==e&&!this.isEnd();)this.advance()},r.scanMacroBranchChunk=function(){for(var e=this._currentIndex,t=this.getShaderPosition(),r=this.macroLvl,n=this.scanDirective();(n.type!==tL.endif||r-1!==this.macroLvl)&&(![tL.elif,tL.else].includes(n.type)||r!==this.macroLvl);)n=this.scanDirective();var i=this._source.slice(e,this._currentIndex-n.lexeme.length-1),o=eZ.pool.get();return o.set(tI.chunk,i,t),{token:o,nextDirective:n}},r.scanPairedBlock=function(e,t){this.scanToChar(e);var r=0,n=this._source;do{var i=n[this._currentIndex];i===e?r++:i===t&&r--,this._advance()}while(r>0)},r.scanRemainMacro=function(){for(var e=this.macroLvl,t=this.scanDirective();!this.isEnd()&&(t.type!==tL.endif||e-1!==this.macroLvl);)t=this.scanDirective();return this.getShaderPosition()},r.peekNonSpace=function(){for(var e=this._currentIndex;/\s/.test(this._source[e]);)e+=1;return this._source[e]},r.scanInteger=function(){for(var e=this._currentIndex;e0.isNum(this.getCurChar());)this.advance();this._currentIndex===e&&this.throwError(this.getShaderPosition(),"no integer found");var t=this._source.slice(e,this._currentIndex),r=eZ.pool.get();return r.set(tI.int_constant,t,this.getShaderPosition()),r},r.scanLineRemain=function(){this.skipSpace(!1);for(var e=this._currentIndex,t=[];"\n"!==this.getCurChar();){if(this.isEnd()){var r=this._source.slice(e,this._currentIndex),n=eZ.pool.get();return n.set(tI.line_remain,r,this.getShaderPosition(r.length)),n}this.advance();var i=this._skipComments();i&&(i.start.index-=e,i.end.index-=e,t.push(i))}var o=this._source.slice(e,this._currentIndex);t.length&&(o=tG.assembleSegments(t.map(function(e){return{range:e,replace:""}}),o));var a=eZ.pool.get();return a.set(tI.line_remain,o,this.getShaderPosition(o.length)),a},r._advanceToDirective=function(e){for(;;){var t=this.scanToken(e);if(null==t?void 0:t.lexeme.startsWith("#"))return t;if(this.isEnd())return}},r._skipComments=function(){if("//"===this.peek(2)){for(var e=this.getShaderPosition();"\n"!==this.getCurChar()&&!this.isEnd();)this._advance();return tJ.createRange(e,this.getCurPosition())}if("/*"===this.peek(2)){var t=this.getShaderPosition();for(this.advance(2);"*/"!==this.peek(2)&&!this.isEnd();)this._advance();return this.advance(2),tJ.createRange(t,this.getShaderPosition())}},t}(e3);tV._splitCharacters=/[\w#.]/;var tD=/*#__PURE__*/function(){function e(){}return e.reset=function(e,t){this._definedMacros.clear(),this._expandSegmentsStack.length=0,this._expandSegmentsStack.push([]),this._branchMacros.clear(),this.addPredefinedMacro("GL_ES"),this._includeMap=e,this._basePathForIncludeKey=t,this._errors.length=0},e.addPredefinedMacro=function(e,t){var r,n=eZ.pool.get();n.set(tI.id,e),t&&(r=eZ.pool.get()).set(tI.id,t),this._definedMacros.set(e,new tP(n,r))},e.parse=function(e){for(;!e.isEnd();){var t=e.scanDirective(this._onToken.bind(this));if(e.isEnd())break;switch(t.type){case tL.define:this._parseDefine(e);break;case tL.undef:this._parseUndef(e);break;case tL.if:this._parseIf(e);break;case tL.ifndef:this._parseIfNdef(e);break;case tL.ifdef:this._parseIfDef(e);break;case tL.include:this._parseInclude(e)}}return this._errors.length>0?null:tG.expand(this.expandSegments,e.source,e.sourceMap)},e.reportError=function(e,t,r,n){var i=eJ.createGSError(t,eY.PreprocessorError,r,e,n);this._errors.push(i)},e._parseInclude=function(e){var r,n=e.getShaderPosition(8);e.skipSpace(!0);var i=e.scanQuotedString();r="."!==i.lexeme[0]?i.lexeme:new URL(i.lexeme,this._basePathForIncludeKey).href.substring(t.ShaderPass._shaderRootPath.length),e.scanToChar("\n");var o=e.getShaderPosition(),a=this._includeMap[r];if(!a){this.reportError(i.location,'Shader slice "'+r+'" not founded.',e.source,e.file);return}var s=tJ.createRange(n,o),c=this._expandMacroChunk(a,s,i.lexeme),l=new tM(i.lexeme,void 0,c.sourceMap);this.expandSegments.push({block:l,rangeInBlock:s,replace:c.content})},e._parseIfDef=function(e){var t=e.current-6,r=e.scanWord();this._addEmptyReplace(e,t),this._branchMacros.add(r.lexeme);var n=this._definedMacros.get(r.lexeme);e.skipSpace(!0);var i=e.scanMacroBranchChunk(),o=i.token,a=i.nextDirective;if(n){var s=a.type===tL.endif?e.getShaderPosition():e.scanRemainMacro(),c=this._expandMacroChunk(o.lexeme,o.location,e),l=new tM(e.file,e.blockRange,c.sourceMap),u=tJ.createRange(o.location.start,s);this.expandSegments.push({block:l,rangeInBlock:u,replace:c.content});return}this.expandSegments.pop(),this._addEmptyReplace(e,t),this._parseMacroBranch(a.type,e)},e._parseMacroBranch=function(e,t){if(e!==tL.endif){var r=t.current;if(e===tL.else){var n=t.scanMacroBranchChunk().token,i=this._expandMacroChunk(n.lexeme,n.location,t),o=new tM(t.file,t.blockRange,i.sourceMap),a=tJ.createPosition(r),s=tJ.createRange(a,t.getShaderPosition());this.expandSegments.push({block:o,rangeInBlock:s,replace:i.content})}else if(e===tL.elif){var c=this._parseConstantExpression(t),l=t.scanMacroBranchChunk(),u=l.token,p=l.nextDirective;if(c){var h=p.type===tL.endif?t.current:t.scanRemainMacro().index,d=this._expandMacroChunk(u.lexeme,u.location,t),f=new tM(t.file,t.blockRange,d.sourceMap),_=tJ.createPosition(r),y=tJ.createPosition(h),g=tJ.createRange(_,y);this.expandSegments.push({block:f,rangeInBlock:g,replace:d.content})}else{var S=new tM(t.file,t.blockRange),v=tJ.createPosition(r),m=tJ.createPosition(t.current),E=tJ.createRange(v,m);this.expandSegments.push({block:S,rangeInBlock:E,replace:""}),this._parseMacroBranch(p.type,t)}}}},e._parseConstantExpression=function(e){return e.skipSpace(!0),this._parseLogicalOrExpression(e)},e._parseLogicalOrExpression=function(e){var t=this._parseLogicalAndExpression(e),r=e.peek(2);if(r&&"||"===r){e.advance(2),e.skipSpace(!1);var n=this._parseLogicalOrExpression(e);return t||n}return t},e._parseLogicalAndExpression=function(e){var t=this._parseEqualityExpression(e),r=e.peek(2);if(r&&"&&"===r){e.advance(2),e.skipSpace(!1);var n=this._parseLogicalAndExpression(e);return t&&n}return t},e._parseEqualityExpression=function(e){var t=this._parseRelationalExpression(e),r=e.peek(2);if(r&&["==","!="].includes(r)){e.advance(2),e.skipSpace(!1);var n=this._parseEqualityExpression(e);switch(r){case"==":return t===n;case"!=":return t!==n}}return t},e._parseRelationalExpression=function(e){var t=this._parseShiftExpression(e),r=e.peek(2);if("="!==r[1]&&(r=r[0]),r&&[">","<",">=","<="].includes(r)){var n=e.getShaderPosition();e.advance(r.length),e.skipSpace(!1);var i=this._parseRelationalExpression(e);if((void 0===t?"undefined":tO(t))!==(void 0===i?"undefined":tO(i))&&"number"!=typeof t){this.reportError(n,"invalid operator in relation expression.",e.source,e.file);return}switch(r){case">":return t>i;case"<":return t<i;case">=":return t>=i;case"<=":return t<=i}}return t},e._parseShiftExpression=function(e){var t=this._parseAdditiveExpression(e),r=e.peek(2);if(r&&[">>","<<"].includes(r)){var n=e.getShaderPosition();e.advance(2),e.skipSpace(!1);var i=this._parseShiftExpression(e);if((void 0===t?"undefined":tO(t))!==(void 0===i?"undefined":tO(i))&&"number"!=typeof t){this.reportError(n,"invalid operator in shift expression.",e.source,e.file);return}switch(r){case">>":return t>>i;case"<<":return t<<i}}return t},e._parseAdditiveExpression=function(e){var t=this._parseMulticativeExpression(e);if([">","<"].includes(e.getCurChar())){var r=e.getShaderPosition();e.advance();var n=e.getCurChar();e.skipSpace(!1);var i=this._parseAdditiveExpression(e);if((void 0===t?"undefined":tO(t))!==(void 0===i?"undefined":tO(i))&&"number"!=typeof t)return this.reportError(r,"invalid operator.",e.source,e.file),!1;switch(n){case"+":return t+i;case"-":return t-i}}return t},e._parseMulticativeExpression=function(e){var t=this._parseUnaryExpression(e);if(e.skipSpace(!1),["*","/","%"].includes(e.getCurChar())){var r=e.getShaderPosition(),n=e.getCurChar();e.skipSpace(!1);var i=this._parseMulticativeExpression(e);if((void 0===t?"undefined":tO(t))!==(void 0===i?"undefined":tO(i))&&"number"!=typeof t){this.reportError(r,"invalid operator.",e.source,e.file);return}switch(n){case"*":return t*i;case"/":return t/i;case"%":return t%i}}return t},e._parseUnaryExpression=function(e){var t=e.getCurChar();if(["+","-","!"].includes(t)){e.advance();var r=e.getShaderPosition(),n=this._parseParenthesisExpression(e);switch(("!"===t&&"boolean"!=typeof n||"!"!==t&&"number"!=typeof n)&&this.reportError(r,"invalid operator.",e.source,e.file),t){case"+":return n;case"-":return-n;case"!":return!n}}return this._parseParenthesisExpression(e)},e._parseParenthesisExpression=function(e){if("("===e.getCurChar()){e.advance(),e.skipSpace(!1);var t=this._parseConstantExpression(e);return e.scanToChar(")"),e.advance(),t}return this._parseConstant(e)},e._parseConstant=function(e){if(e0.isAlpha(e.getCurChar())){var t=e.scanWord();if(t.type===tL.defined){var r="("===e.peekNonSpace(),n=e.scanWord(!0);return r&&(e.scanToChar(")"),e.advance()),this._branchMacros.add(n.lexeme),!!this._definedMacros.get(n.lexeme)}var i=this._definedMacros.get(t.lexeme);if(!i)return!1;i.isFunction&&this.reportError(t.location,"invalid function macro usage",e.source,e.file);var o=Number(i.body.lexeme);return Number.isInteger(o)||this.reportError(t.location,"invalid const macro: "+t.lexeme,e.source,e.file),this._branchMacros.add(t.lexeme),o}if(e0.isNum(e.getCurChar()))return Number(e.scanInteger().lexeme);this.reportError(e.getShaderPosition(),"invalid token: "+e.getCurChar(),e.source,e.file)},e._expandMacroChunk=function(e,t,r){this._expandSegmentsStack.push([]),n="string"==typeof r?new tV(e,r):new tV(e,r.file,t);var n,i=this.parse(n);return this._expandSegmentsStack.pop(),{content:i,sourceMap:n.sourceMap}},e._parseIfNdef=function(e){var t=e.current-7,r=e.scanWord();this._addEmptyReplace(e,t),this._branchMacros.add(r.lexeme);var n=this._definedMacros.get(r.lexeme),i=e.scanMacroBranchChunk(),o=i.token,a=i.nextDirective;if(!n){var s=a.type===tL.endif?e.getShaderPosition():e.scanRemainMacro(),c=this._expandMacroChunk(o.lexeme,o.location,e),l=new tM(e.file,e.blockRange,c.sourceMap),u=tJ.createRange(o.location.start,s);this.expandSegments.push({block:l,rangeInBlock:u,replace:c.content});return}this.expandSegments.pop(),this._addEmptyReplace(e,t),this._parseMacroBranch(a.type,e)},e._addEmptyReplace=function(e,t){var r=new tM(e.file,e.blockRange),n=tJ.createPosition(t),i=e.getCurPosition(),o=tJ.createRange(n,i);this.expandSegments.push({block:r,rangeInBlock:o,replace:""})},e._parseIf=function(e){var t=e.current-3,r=this._parseConstantExpression(e);this._addEmptyReplace(e,t);var n=e.scanMacroBranchChunk(),i=n.token,o=n.nextDirective;if(r){var a=o.type===tL.endif?e.getShaderPosition():e.scanRemainMacro(),s=this._expandMacroChunk(i.lexeme,i.location,e),c=new tM(e.file,e.blockRange,s.sourceMap),l=tJ.createRange(i.location.start,a);this.expandSegments.push({block:c,rangeInBlock:l,replace:s.content});return}this.expandSegments.pop(),this._addEmptyReplace(e,t),this._parseMacroBranch(o.type,e)},e._parseDefine=function(e){var t,r=e.getShaderPosition(7),n=e.scanWord(),i=n.location.end;this._definedMacros.get(n.lexeme)&&n.lexeme.startsWith("GL_")&&this.reportError(n.location,"redefined macro: "+n.lexeme,e.source,e.file),"("===e.getCurChar()&&(t=e.scanWordsUntilChar(")"),i=e.getShaderPosition());var o=new tP(n,e.scanLineRemain(),tJ.createRange(r,i),t);this._definedMacros.set(n.lexeme,o);var a=new tM(e.file,e.blockRange);this.expandSegments.push({block:a,rangeInBlock:tJ.createRange(r,e.getCurPosition()),replace:""})},e._parseUndef=function(e){var t=e.current-6,r=e.scanWord(),n=new tM(e.file,e.blockRange),i=tJ.createPosition(t),o=tJ.createRange(i,e.getCurPosition());this.expandSegments.push({block:n,rangeInBlock:o,replace:""}),this._definedMacros.delete(r.lexeme)},e._onToken=function(e,t){var r=this._definedMacros.get(e.lexeme);if(r){var n=r.body.lexeme;if(r.isFunction){t.scanToChar("("),t.advance();for(var i=[],o=1,a=t.current;;){if("("===t.getCurChar())o+=1;else if(")"===t.getCurChar()){if(0==(o-=1))break}else","===t.getCurChar()&&1===o&&(i.push(t.source.slice(a,t.current)),a=t.current+1);t.advance()}i.push(t.source.slice(a,t.current)),t.advance();var s=tJ.createRange(e.location.start,t.getCurPosition());n=r.expandFunctionBody(i);var c=this._expandMacroChunk(n,s,t),l=new tM(t.file,t.blockRange,c.sourceMap),u=tJ.createRange(e.location.start,t.getCurPosition());this.expandSegments.push({block:l,rangeInBlock:u,replace:c.content})}else{var p=this._expandMacroChunk(n,e.location,t),h=new tM(t.file,t.blockRange,p.sourceMap),d=tJ.createRange(e.location.start,e.location.end);this.expandSegments.push({block:h,rangeInBlock:d,replace:p.content})}}},e1(e,null,[{key:"expandSegments",get:function(){return this._expandSegmentsStack[this._expandSegmentsStack.length-1]}}]),e}();tD._definedMacros=new Map,tD._expandSegmentsStack=[[]],tD._branchMacros=new Set,tD._errors=[];var tF=/*#__PURE__*/function(){function e(){}return e.reset=function(e,t){tD.reset(e,t)},e.process=function(e){return this.baseScanner=new tV(e),tD.parse(this.baseScanner)},e.addPredefinedMacro=function(e,t){tD.addPredefinedMacro(e,t)},e.convertSourceIndex=function(e){return this.baseScanner.sourceMap.map(e)},e}(),tw=/*#__PURE__*/function(){function e(){this.attributeList=[],this.attributeStructs=[],this._referencedAttributeList=Object.create(null),this._referencedGlobals=Object.create(null),this._referencedVaryingList=Object.create(null)}var t=e.prototype;return t.reset=function(){this.attributeList.length=0,this.attributeStructs.length=0,this._referencedAttributeList=Object.create(null),this._referencedGlobals=Object.create(null),this._referencedVaryingList=Object.create(null)},t.isAttributeStruct=function(e){return -1!==this.attributeStructs.findIndex(function(t){return t.ident.lexeme===e})},t.isVaryingStruct=function(e){var t,r;return(null==(r=this.varyingStruct)?void 0:null==(t=r.ident)?void 0:t.lexeme)===e},t.referenceAttribute=function(e){if(!this._referencedAttributeList[e.lexeme]){var t=this.attributeList.find(function(t){return t.ident.lexeme===e.lexeme});if(!t)return eJ.createGSError("referenced attribute not found: "+e.lexeme,eY.CompilationError,tJ._processingPassText,e.location);this._referencedAttributeList[e.lexeme]=t}},t.referenceVarying=function(e){if(!this._referencedVaryingList[e.lexeme]){var t,r=null==(t=this.varyingStruct)?void 0:t.propList.find(function(t){return t.ident.lexeme===e.lexeme});if(!r)return eJ.createGSError("referenced varying not found: "+e.lexeme,eY.CompilationError,tJ._processingPassText,e.location);this._referencedVaryingList[e.lexeme]=r}},t.referenceGlobal=function(e,t){if(!this._referencedGlobals[e]){if(t===e7.FN){for(var r=this._passSymbolTable.getAllFnSymbols(e),n=0;n<r.length;n++){var i=0===n?e:e+n;this._referencedGlobals[i]=r[n]}return}var o=this.passSymbolTable.lookup({ident:e,symbolType:t});o&&(this._referencedGlobals[e]=o)}},e.reset=function(){this._singleton||(this._singleton=new e),this._singleton.reset()},e1(e,[{key:"passSymbolTable",get:function(){return this._passSymbolTable}}],[{key:"context",get:function(){return this._singleton}}]),e}(),tB=/*#__PURE__*/function(e){function t(){var t;return t=e.apply(this,arguments)||this,t._versionText="",t._extensions="",t}o(t,e);var r=t.prototype;return r.visitShaderProgram=function(e,t,r){return this.errors.length=0,tw.reset(),tw.context._passSymbolTable=e.shaderData.symbolTable,{vertex:this.vertexMain(t,e.shaderData),fragment:this._fragmentMain(r,e.shaderData)}},r.vertexMain=function(e,t){var r=t.symbolTable,i=r.lookup({ident:e,symbolType:e7.FN});if(!(null==i?void 0:i.astNode))throw"no entry function found: "+e;var o=i.astNode;tw.context.stage=tu.VERTEX;var a=o.protoType.returnType;if("string"==typeof a.type){var s=r.lookup({ident:a.type,symbolType:e7.STRUCT});s?tw.context.varyingStruct=s.astNode:this._reportError(a.location,"invalid varying struct: "+a.type)}else a.type!==ej.VOID&&this._reportError(a.location,"main entry can only return struct.");var c=o.protoType.parameterList;if(null==c?void 0:c.length)for(var l,u=n(c);!(l=u()).done;){var p=l.value;if("string"==typeof p.typeInfo.type){var h=r.lookup({ident:p.typeInfo.type,symbolType:e7.STRUCT});if(!h){this._reportError(p.astNode.location,'Not found attribute struct "'+p.typeInfo.type+'".');continue}tw.context.attributeStructs.push(h.astNode);for(var d,f=n(h.astNode.propList);!(d=f()).done;){var _=d.value;tw.context.attributeList.push(_)}}else tw.context.attributeList.push(p)}var y=o.statements.codeGen(this),g=[].concat(this._getGlobalText(t),this.getAttributeDeclare(),this.getVaryingDeclare()).sort(function(e,t){return e.index-t.index}).map(function(e){return e.text}).join("\n");return tw.context.reset(),this._versionText+"\n"+g+"\n\nvoid main() "+y},r._fragmentMain=function(e,t){var r=t.symbolTable.lookup({ident:e,symbolType:e7.FN});if(!(null==r?void 0:r.astNode))throw"no entry function found: "+e;var n=r.astNode;tw.context.stage=tu.FRAGMENT;var i=n.statements.codeGen(this),o=[].concat(this._getGlobalText(t),this.getVaryingDeclare()).sort(function(e,t){return e.index-t.index}).map(function(e){return e.text}).join("\n");return tw.context.reset(),this._versionText+"\n"+this._extensions+"\n\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n#else\n  precision mediump float;\n  precision mediump int;\n#endif\n\n"+o+"\n\nvoid main() "+i},r._getGlobalText=function(e,t,r,i){void 0===t&&(t=[]),void 0===r&&(r=0),void 0===i&&(i=new Set);var o=tw.context._referencedGlobals;if(r===Object.keys(o).length){for(var a,s=n(e.globalPrecisions);!(a=s()).done;){var c=a.value;t.push({text:c.codeGen(this),index:c.location.start.index})}return t}for(var l in r=Object.keys(o).length,o){var u=o[l];i.has(l)||(i.add(l),eH(u,e8)?u.symbolType===e7.VAR?t.push({text:"uniform "+u.astNode.codeGen(this),index:u.astNode.location.start.index}):t.push({text:u.astNode.codeGen(this),index:u.astNode.location.start.index}):t.push({text:u.codeGen(this),index:u.location.start.index}))}return this._getGlobalText(e,t,r,i)},t}(/*#__PURE__*/function(){function e(){this.errors=[]}var t=e.prototype;return t.defaultCodeGen=function(e){for(var t,r=[],i=n(e);!(t=i()).done;){var o=t.value;eH(o,eZ)?r.push(o.lexeme):r.push(o.codeGen(this))}return r.join(" ")},t.visitPostfixExpression=function(e){if(3===e.children.length){var t=tw.context,r=e.children[0],n=e.children[2];if(!eH(n,eZ))return r.codeGen(this)+"."+n.codeGen(this);if(t.isAttributeStruct(r.type)){var i=t.referenceAttribute(n);return i&&this.errors.push(i),n.lexeme}if(t.isVaryingStruct(r.type)){var o=t.referenceVarying(n);return o&&this.errors.push(o),n.lexeme}return r.codeGen(this)+"."+n.lexeme}return this.defaultCodeGen(e.children)},t.visitVariableIdentifier=function(e){return eH(e.symbolInfo,to)&&e.symbolInfo.isGlobalVariable&&tw.context.referenceGlobal(e.lexeme,e7.VAR),e.lexeme},t.visitFunctionCall=function(e){var t=e.children[0];if(eH(t.fnSymbol,te)){tw.context.referenceGlobal(t.fnSymbol.ident,e7.FN);var r=t.children[2],n=t.fnSymbol.astNode.protoType.parameterList;if(eH(r,eF.FunctionCallParameterList)){for(var i=[],o=r.paramNodes,a=0;a<o.length;a++)tw.context.isAttributeStruct(n[a].typeInfo.typeLexeme)||tw.context.isVaryingStruct(n[a].typeInfo.typeLexeme)||i.push(o[a].codeGen(this));return t.fnSymbol.ident+"("+i.join(", ")+")"}}return this.defaultCodeGen(e.children)},t.visitStatementList=function(e){var t=e.children;return 1===e.children.length?t[0].codeGen(this):t[0].codeGen(this)+"\n"+t[1].codeGen(this)},t.visitSingleDeclaration=function(e){var t=e.typeSpecifier.type;return"string"==typeof t&&tw.context.referenceGlobal(t,e7.STRUCT),this.defaultCodeGen(e.children)},t.visitGlobalVariableDeclaration=function(e){var t=e.children[0];return eH(t,eF.FullySpecifiedType)&&t.typeSpecifier.isCustom&&tw.context.referenceGlobal(t.type,e7.STRUCT),this.defaultCodeGen(e.children)},t.visitDeclaration=function(e){var t,r,n=e.children[0];return eH(n,eF.InitDeclaratorList)&&n.typeInfo.typeLexeme===(null==(r=tw.context.varyingStruct)?void 0:null==(t=r.ident)?void 0:t.lexeme)?"":this.defaultCodeGen(e.children)},t.visitFunctionProtoType=function(e){return tw.context._curFn=e,this.defaultCodeGen(e.children)},t.visitFunctionDefinition=function(e){return tw.context._curFn=void 0,this.defaultCodeGen(e.children)},t.visitFunctionParameterList=function(e){var t=this;return e.parameterInfoList.filter(function(e){return!tw.context.isAttributeStruct(e.typeInfo.typeLexeme)&&!tw.context.isVaryingStruct(e.typeInfo.typeLexeme)}).map(function(e){return e.astNode.codeGen(t)}).join(", ")},t.visitFunctionHeader=function(e){var t=e.returnType.typeSpecifier.lexeme;return tw.context.isAttributeStruct(t)||tw.context.isVaryingStruct(t)?"void "+e.ident.lexeme+"(":this.defaultCodeGen(e.children)},t.visitJumpStatement=function(e){if(e.children[0].type===ej.RETURN){var t=e.children[1];if(eH(t,eF.Expression)){var r,n,i,o,a=tS.unwrapNodeByType(t,ts.variable_identifier);if((null==a?void 0:a.typeInfo)===(null==(n=tw.context.varyingStruct)?void 0:null==(r=n.ident)?void 0:r.lexeme))return"";var s=tS.unwrapNodeByType(t,ts.function_call);if((null==s?void 0:s.type)===(null==(o=tw.context.varyingStruct)?void 0:null==(i=o.ident)?void 0:i.lexeme))return""+t.codeGen(this)+";"}}return this.defaultCodeGen(e.children)},t.visitFunctionIdentifier=function(e){return this.defaultCodeGen(e.children)},t._reportError=function(e,t){this.errors.push(new eK(eY.CompilationError,t,e,tJ._processingPassText))},e}()),tj=/*#__PURE__*/function(e){function t(){var t;return t=e.apply(this,arguments)||this,t._versionText="#version 100",t._extensions=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives","GL_EXT_draw_buffers","GL_EXT_frag_depth"].map(function(e){return"#extension "+e+" : enable\n"}).join(""),t}o(t,e);var r=t.prototype;return r.getAttributeDeclare=function(){for(var e,t=[],r=n(Object.values(tw.context._referencedAttributeList));!(e=r()).done;){var i=e.value;t.push({text:"attribute "+i.typeInfo.typeLexeme+" "+i.ident.lexeme+";",index:i.ident.location.start.index})}return t},r.getVaryingDeclare=function(){for(var e,t=[],r=n(Object.values(tw.context._referencedVaryingList));!(e=r()).done;){var i=e.value;t.push({text:"varying "+i.typeInfo.typeLexeme+" "+i.ident.lexeme+";",index:i.ident.location.start.index})}return t},t.getVisitor=function(){return this._singleton||(this._singleton=new t),this._singleton},t}(tB),tU="GS_glFragColor",tW=/*#__PURE__*/function(e){function t(){var t;return t=e.apply(this,arguments)||this,t._versionText="#version 300 es",t}o(t,e);var r=t.prototype;return r.getAttributeDeclare=function(){for(var e,t=[],r=n(Object.values(tw.context._referencedAttributeList));!(e=r()).done;){var i=e.value;t.push({text:"in "+i.typeInfo.typeLexeme+" "+i.ident.lexeme+";",index:i.ident.location.start.index})}return t},r.getVaryingDeclare=function(){for(var e=[],t=tw.context.stage===tu.FRAGMENT?"in":"out",r=Object.values(tw.context._referencedVaryingList),n=0;n<r.length;n++){var i,o=r[n];e.push({text:(null!=(i=o.qualifier)?i:t)+" "+o.typeInfo.typeLexeme+" "+o.ident.lexeme+";",index:o.ident.location.start.index})}return e},r.visitFunctionIdentifier=function(e){if(1!==e.children[0].children.length)return this.defaultCodeGen(e.children);var t=e.lexeme;if("texture2D"===e.ident||"textureCube"===e.ident)t="texture";else if("texture2DProj"===e.ident)t="textureProj";else if(tw.context.stage===tu.FRAGMENT)switch(e.ident){case"texture2DLodEXT":case"textureCubeLodEXT":t="textureLod";break;case"texture2DGradEXT":case"textureCubeGradEXT":t="textureGrad";break;case"texture2DProjLodEXT":t="textureProjLod";break;case"texture2DProjGradEXT":t="textureProjGrad";break;case"gl_FragDepthEXT":t="gl_FragDepth"}return t},r.visitVariableIdentifier=function(t){if(tw.context.stage===tu.FRAGMENT&&"gl_FragColor"===t.lexeme){if(!tw.context._referencedVaryingList[tU]){var r=eZ.pool.get();r.set(eW.ID,tU,tJ.createPosition(0,0,0)),tw.context._referencedVaryingList[tU]={ident:r,typeInfo:new tv(ej.VEC4,"vec4"),qualifier:"out",astNode:t}}return tU}return e.prototype.visitVariableIdentifier.call(this,t)},t.getVisitor=function(){return this._singleton||(this._singleton=new t),this._singleton},t}(tB);function tH(){return(tH=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var tq=new Map([["RenderQueueType",ej.GS_RenderQueueType],["BlendState",ej.GS_BlendState],["DepthState",ej.GS_DepthState],["StencilState",ej.GS_StencilState],["RasterState",ej.GS_RasterState],["EditorProperties",ej.GS_EditorProperties],["EditorMacros",ej.GS_EditorMacros],["Editor",ej.GS_Editor],["Tags",ej.GS_Tags],["VertexShader",ej.GS_VertexShader],["FragmentShader",ej.GS_FragmentShader],["SubShader",ej.GS_SubShader],["Pass",ej.GS_Pass],["BlendFactor",ej.GS_BlendFactor],["BlendOperation",ej.GS_BlendOperation],["Bool",ej.GS_Bool],["Number",ej.GS_Number],["CompareFunction",ej.GS_CompareFunction],["StencilOperation",ej.GS_StencilOperation],["CullMode",ej.GS_CullMode],["true",ej.TRUE],["false",ej.FALSE],["UsePass",ej.GS_UsePass],["Color",ej.GS_Color]]),tz=/*#__PURE__*/function(e){function t(t,r){return void 0===r&&(r=new Map),e.call(this,t,r)||this}o(t,e);var r=t.prototype;return r.scanWord=function(){this.skipCommentsAndSpace();for(var e=this._currentIndex;/\S/.test(this.getCurChar())&&!this.isEnd();)this._advance();return this._source.substring(e,this._currentIndex)},r.scanNumber=function(){this.skipCommentsAndSpace();for(var e=this._currentIndex;/[0-9]/.test(this.getCurChar());)this._advance();if("."===this.getCurChar())for(this._advance();/[0-9]/.test(this.getCurChar());)this._advance();return Number(this._source.substring(e,this._currentIndex))},r.scanToCharacter=function(e){for(;this.getCurChar()!==e&&!this.isEnd();)this._advance();this._advance()},t}(e3),tX=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.symbolEqualCheck=function(e,t){return e.type===t.type},t}(tr),tQ=[ej.GS_RenderQueueType,ej.GS_BlendFactor,ej.GS_BlendOperation,ej.GS_Bool,ej.GS_Number,ej.GS_Color,ej.GS_CompareFunction,ej.GS_StencilOperation,ej.GS_CullMode],tK=[ej.GS_BlendState,ej.GS_DepthState,ej.GS_RasterState,ej.GS_StencilState],tY=/*#__PURE__*/function(){function e(){}return e._isRenderStateDeclarator=function(e){return tK.includes(e.type)},e._isEngineType=function(e){return tQ.includes(e.type)},e.reset=function(){this._errors.length=0,this._symbolTable.clear(),this._newScope()},e.parse=function(e){var r=performance.now(),n=new tz(e,tq),i={subShaders:[],globalContents:[],renderStates:{constantMap:{},variableMap:{}}};n.scanText("Shader"),i.name=n.scanPairedText('"','"'),n.scanText("{"),n.skipCommentsAndSpace(),this._parseShaderStatements(i,n);for(var o=i.globalContents,a=i.renderStates,s=0;s<i.subShaders.length;s++)for(var c=i.subShaders[s],l=o.concat(c.globalContents),u=tH({},a.constantMap,c.renderStates.constantMap),p=tH({},a.variableMap,c.renderStates.variableMap),h=0;h<c.passes.length;h++){var d=c.passes[h];if(Object.assign(d.renderStates.constantMap,u),Object.assign(d.renderStates.variableMap,p),!d.isUsePass){var f=l.concat(d.globalContents);d.contents=f.map(function(e){return e.content}).join("\n")}}return t.Logger.info("[content compilation] cost time "+(performance.now()-r)+"ms"),i},e._parseShaderStatements=function(t,r){for(var n=1,i=r.getCurPosition();;){var o=r.scanToken();switch(o.type){case ej.GS_SubShader:this._addGlobalStatement(t,r,i,o.lexeme.length);var a=this._parseSubShader(r);t.subShaders.push(a),i=r.getCurPosition();break;case ej.GS_EditorProperties:case ej.GS_EditorMacros:case ej.GS_Editor:this._addGlobalStatement(t,r,i,o.lexeme.length),r.scanPairedText("{","}",!0),i=r.getCurPosition();break;case ej.GS_RenderQueueType:this._addGlobalStatement(t,r,i,o.lexeme.length),this._parseRenderQueueAssignment(t,r),i=r.getCurPosition();break;case eW.NOT_WORD:if("{"===o.lexeme)n+=1;else if("}"===o.lexeme&&0==(n-=1)){this._addGlobalStatement(t,r,i,o.lexeme.length),this._symbolTable.dropScope();return}default:if(e._isRenderStateDeclarator(o)){this._addGlobalStatement(t,r,i,o.lexeme.length),this._parseRenderStateDeclarationOrAssignment(t,o,r),i=r.getCurPosition();break}e._isEngineType(o)&&(this._addGlobalStatement(t,r,i,o.lexeme.length),this._parseVariableDeclaration(o.type,r),i=r.getCurPosition())}}},e._parseRenderStateDeclarationOrAssignment=function(e,t,r){var n,i=r.scanToken();if(i.type===eW.ID)n=!0,r.scanText("{");else if("{"===i.lexeme)n=!1;else if("="===i.lexeme){var o=r.scanToken();r.scanText(";");var a=this._symbolTable.lookup({type:t.type,ident:o.lexeme});if(!(null==a?void 0:a.value)){var s=eJ.createGSError('Invalid "'+t.lexeme+'" variable: '+o.lexeme,eY.CompilationError,r.source,o.location);this._errors.push(s);return}var c=a.value;Object.assign(e.renderStates.constantMap,c.constantMap),Object.assign(e.renderStates.variableMap,c.variableMap);return}var l=this._parseRenderStatePropList(t.lexeme,r);n?this._symbolTable.insert({ident:i.lexeme,type:t.type,value:l}):(Object.assign(e.renderStates.constantMap,l.constantMap),Object.assign(e.renderStates.variableMap,l.variableMap))},e._parseVariableDeclaration=function(e,t){var r=t.scanToken();t.scanText(";"),this._symbolTable.insert({type:r.type,ident:r.lexeme})},e._newScope=function(){var e=new tX;this._symbolTable.newScope(e)},e._parseRenderStatePropList=function(e,t){for(var r={constantMap:{},variableMap:{}};"}"!==t.getCurChar();)this._parseRenderStatePropItem(r,e,t),t.skipCommentsAndSpace();return t._advance(),r},e._parseRenderStatePropItem=function(r,n,i){var o=i.scanToken().lexeme,a=i.scanToken();if("BlendState"===n&&"BlendColor"!==o&&"AlphaToCoverage"!==o){var s=0;if("["===a.lexeme)s=i.scanNumber(),i.scanText("]"),i.scanText("=");else if("="!==a.lexeme){var c=eJ.createGSError("Invalid syntax, expect character '=', but got "+a.lexeme,eY.CompilationError,i.source,i.getCurPosition());this._errors.push(c),i.scanToCharacter(";");return}o+=s}o=n+o;var l=t.RenderStateDataKey[o];if(void 0==l){var u=eJ.createGSError("Invalid render state element "+o,eY.CompilationError,i.source,i.getCurPosition());this._errors.push(u),i.scanToCharacter(";");return}if(i.skipCommentsAndSpace(),/[0-9.]/.test(i.getCurChar()))d=i.scanNumber();else{var p=i.scanToken();if(p.type===ej.TRUE)d=!0;else if(p.type===ej.FALSE)d=!1;else if(p.type===ej.GS_Color){i.scanText("(");for(var h=[];;){if(h.push(i.scanNumber()),i.skipCommentsAndSpace(),")"===i.peek(1)){i._advance();break}i.scanText(",")}d=ez(t.Color,[].concat(h))}else if("."===i.getCurChar()){i._advance();var d,f,_=i.scanToken();if(void 0==(d=null==(f=e._engineType[p.lexeme])?void 0:f[_.lexeme])){var y=eJ.createGSError("Invalid engine constant: "+p.lexeme+"."+_.lexeme,eY.CompilationError,i.source,_.location);this._errors.push(y),i.scanToCharacter(";");return}}else d=p.lexeme}i.scanText(";"),"string"==typeof d?r.variableMap[l]=d:r.constantMap[l]=d},e._parseRenderQueueAssignment=function(r,n){n.scanText("=");var i=n.scanToken();n.scanText(";");var o=e._engineType.RenderQueueType[i.lexeme],a=t.RenderStateDataKey.RenderQueueType;void 0==o?r.renderStates.variableMap[a]=i.lexeme:r.renderStates.constantMap[a]=o},e._addGlobalStatement=function(e,t,r,n){t.current>r.index+n&&e.globalContents.push({range:{start:r,end:tH({},t.getCurPosition(),{index:t.current-n-1})},content:t.source.substring(r.index,t.current-n-1)})},e._parseSubShader=function(t){this._newScope();var r={passes:[],globalContents:[],renderStates:{constantMap:{},variableMap:{}},tags:{}},n=1;r.name=t.scanPairedText('"','"'),t.scanText("{"),t.skipCommentsAndSpace();for(var i=t.getCurPosition();;){var o=t.scanToken();switch(o.type){case ej.GS_Pass:this._addGlobalStatement(r,t,i,o.lexeme.length);var a=this._parsePass(t);r.passes.push(a),i=t.getCurPosition();break;case ej.GS_RenderQueueType:this._addGlobalStatement(r,t,i,o.lexeme.length),this._parseRenderQueueAssignment(r,t),i=t.getCurPosition();break;case ej.GS_UsePass:this._addGlobalStatement(r,t,i,o.lexeme.length);var s=t.scanPairedText('"','"');r.passes.push({name:s,isUsePass:!0,renderStates:{constantMap:{},variableMap:{}},tags:{}}),i=t.getCurPosition();break;case ej.GS_Tags:this._addGlobalStatement(r,t,i,o.lexeme.length),this._parseTags(r,t),i=t.getCurPosition();break;case eW.NOT_WORD:if("{"===o.lexeme)n+=1;else if("}"===o.lexeme&&0==(n-=1))return this._addGlobalStatement(r,t,i,o.lexeme.length),this._symbolTable.dropScope(),r;default:if(e._isRenderStateDeclarator(o)){this._addGlobalStatement(r,t,i,o.lexeme.length),this._parseRenderStateDeclarationOrAssignment(r,o,t),i=t.getCurPosition();break}e._isEngineType(o)&&(this._addGlobalStatement(r,t,i,o.lexeme.length),this._parseVariableDeclaration(o.type,t),i=t.getCurPosition())}}},e._parseTags=function(e,t){for(t.scanText("{");;){var r=t.scanToken();t.scanText("=");var n=t.scanPairedText('"','"');if(t.skipCommentsAndSpace(),e.tags[r.lexeme]=n,"}"===t.peek(1)){t._advance();return}t.scanText(",")}},e._parsePass=function(r){this._newScope();var n={globalContents:[],renderStates:{constantMap:{},variableMap:{}},tags:{}};n.name=r.scanPairedText('"','"'),r.scanText("{");var i=1;r.skipCommentsAndSpace();for(var o=r.getCurPosition();;){var a=r.scanToken();switch(a.type){case ej.GS_RenderQueueType:this._addGlobalStatement(n,r,o,a.lexeme.length),this._parseRenderQueueAssignment(n,r),o=r.getCurPosition();break;case ej.GS_Tags:this._addGlobalStatement(n,r,o,a.lexeme.length),this._parseTags(n,r),o=r.getCurPosition();break;case ej.GS_VertexShader:case ej.GS_FragmentShader:this._addGlobalStatement(n,r,o,a.lexeme.length),r.scanText("=");var s=r.scanToken();if(n[a.lexeme]){var c=eJ.createGSError("reassign main entry",eY.CompilationError,r.source,r.getCurPosition());throw t.Logger.error(c.toString()),c}n[a.type===ej.GS_VertexShader?"vertexEntry":"fragmentEntry"]=s.lexeme,r.scanText(";"),o=r.getCurPosition();break;case eW.NOT_WORD:if("{"===a.lexeme)i+=1;else if("}"===a.lexeme&&0==(i-=1))return this._addGlobalStatement(n,r,o,a.lexeme.length),this._symbolTable.dropScope(),n;default:if(e._isRenderStateDeclarator(a)){this._addGlobalStatement(n,r,o,a.lexeme.length),this._parseRenderStateDeclarationOrAssignment(n,a,r),o=r.getCurPosition();break}e._isEngineType(a)&&(this._addGlobalStatement(n,r,o,a.lexeme.length),this._parseVariableDeclaration(a.type,r),o=r.getCurPosition())}}},e}();tY._engineType={RenderQueueType:t.RenderQueueType,CompareFunction:t.CompareFunction,StencilOperation:t.StencilOperation,BlendOperation:t.BlendOperation,BlendFactor:t.BlendFactor,CullMode:t.CullMode},tY._errors=[],tY._symbolTable=new tn;var tJ=/*#__PURE__*/function(){function e(){this.errors=[]}var r=e.prototype;return r._parseShaderPass=function(r,i,o,a,s,c,l){tF.reset(t.ShaderLib,l);for(var u,p=n(a);!(u=p()).done;){var h=u.value;tF.addPredefinedMacro(h.name,h.value)}for(var d=0;d<c.length;d++)tF.addPredefinedMacro(c[d]);var f=performance.now(),_=tF.process(r);if(tD._errors.length>0){for(var y,g=n(tD._errors);!(y=g()).done;){var S=y.value;this.errors.push(S)}this._logErrors();return}t.Logger.info("[pass compilation - preprocessor]  cost time "+(performance.now()-f)+"ms");var v=new e4(_).tokenize(),m=e._parser;e._processingPassText=_;for(var E,x=m.parse(v),C=n(m.errors);!(E=C()).done;){var T=E.value;this.errors.push(T)}if(!x){this._logErrors();return}var A=s===t.ShaderPlatformTarget.GLES100?tj.getVisitor():tW.getVisitor(),b=performance.now(),O=A.visitShaderProgram(x,i,o);t.Logger.info("[CodeGen] cost time: "+(performance.now()-b)+"ms"),e._processingPassText=void 0;for(var P,I=n(A.errors);!(P=I()).done;){var L=P.value;this.errors.push(L)}return this._logErrors(),O},r._parseShaderContent=function(e){eJ.clearAllShaderLabObjectPool(),tY.reset();var t=tY.parse(e);this.errors.length=0;for(var r,i=n(tY._errors);!(r=i()).done;){var o=r.value;this.errors.push(o)}return t},r._logErrors=function(){var e=this.errors;if(0!==e.length&&t.Logger.isEnabled){t.Logger.error(""+e.length+" errors occur!");for(var r,i=n(e);!(r=i()).done;){var o=r.value;t.Logger.error(o.toString())}}},e.createPosition=function(e,t,r){var n=this._shaderPositionPool.get();return n.set(e,t,r),n},e.createRange=function(e,t){var r=this._shaderRangePool.get();return r.set(e,t),r},e}();tJ._parser=tb.create(),tJ._shaderPositionPool=eJ.createObjectPool(eB),tJ._shaderRangePool=eJ.createObjectPool(ew);var tZ="1.4.0-alpha.0";console.log("Galacean ShaderLab version: "+tZ+". mode: Verbose"),e.GSError=eK,e.GSErrorName=eY,e.Preprocessor=tF,e.ShaderLab=tJ,e.version=tZ,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=browser.verbose.min.js.map
