!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@galacean/engine")):"function"==typeof define&&define.amd?define(["exports","@galacean/engine"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).Galacean=e.Galacean||{},e.Galacean.ShaderLab={}),e.Galacean)}(this,function(e,t){"use strict";function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function r(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,void 0)}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0;return function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}"function"==typeof SuppressedError&&SuppressedError;var o,s,c,l,u,p,h,d,f,_,S,g,y,v,m,x,E,C,b,T,P,A,O,I,R,L,k,N,G,M,D,F,w,B,U,V,W,j,H,q,z,Q,X,K,Y,J,Z,$,ee,et,en,er,ei,ea,eo,es=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.set=function(e,t){this.start=e,this.end=t},t.dispose=function(){this.start.dispose(),this.end.dispose()},e}(),ec=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.set=function(e){this.index=e},t.dispose=function(){this.index=0},e}(),el=((o={})[o.ATTRIBUTE=0]="ATTRIBUTE",o[o.CONST=1]="CONST",o[o.BOOL=2]="BOOL",o[o.FLOAT=3]="FLOAT",o[o.DOUBLE=4]="DOUBLE",o[o.INT=5]="INT",o[o.UINT=6]="UINT",o[o.BREAK=7]="BREAK",o[o.CONTINUE=8]="CONTINUE",o[o.DO=9]="DO",o[o.ELSE=10]="ELSE",o[o.FOR=11]="FOR",o[o.IF=12]="IF",o[o.WHILE=13]="WHILE",o[o.DISCARD=14]="DISCARD",o[o.RETURN=15]="RETURN",o[o.BVEC2=16]="BVEC2",o[o.BVEC3=17]="BVEC3",o[o.BVEC4=18]="BVEC4",o[o.IVEC2=19]="IVEC2",o[o.IVEC3=20]="IVEC3",o[o.IVEC4=21]="IVEC4",o[o.UVEC2=22]="UVEC2",o[o.UVEC3=23]="UVEC3",o[o.UVEC4=24]="UVEC4",o[o.VEC2=25]="VEC2",o[o.VEC3=26]="VEC3",o[o.VEC4=27]="VEC4",o[o.MAT2=28]="MAT2",o[o.MAT3=29]="MAT3",o[o.MAT4=30]="MAT4",o[o.MAT2X3=31]="MAT2X3",o[o.MAT2X4=32]="MAT2X4",o[o.MAT3X2=33]="MAT3X2",o[o.MAT3X4=34]="MAT3X4",o[o.MAT4X2=35]="MAT4X2",o[o.MAT4X3=36]="MAT4X3",o[o.IN=37]="IN",o[o.OUT=38]="OUT",o[o.INOUT=39]="INOUT",o[o.CENTROID=40]="CENTROID",o[o.SAMPLER2D=41]="SAMPLER2D",o[o.SAMPLER3D=42]="SAMPLER3D",o[o.SAMPLER_CUBE=43]="SAMPLER_CUBE",o[o.SAMPLER2D_SHADOW=44]="SAMPLER2D_SHADOW",o[o.SAMPLER_CUBE_SHADOW=45]="SAMPLER_CUBE_SHADOW",o[o.SAMPLER2D_ARRAY=46]="SAMPLER2D_ARRAY",o[o.SAMPLER2D_ARRAY_SHADOW=47]="SAMPLER2D_ARRAY_SHADOW",o[o.I_SAMPLER2D=48]="I_SAMPLER2D",o[o.I_SAMPLER3D=49]="I_SAMPLER3D",o[o.I_SAMPLER_CUBE=50]="I_SAMPLER_CUBE",o[o.I_SAMPLER2D_ARRAY=51]="I_SAMPLER2D_ARRAY",o[o.U_SAMPLER2D=52]="U_SAMPLER2D",o[o.U_SAMPLER3D=53]="U_SAMPLER3D",o[o.U_SAMPLER_CUBE=54]="U_SAMPLER_CUBE",o[o.U_SAMPLER2D_ARRAY=55]="U_SAMPLER2D_ARRAY",o[o.STRUCT=56]="STRUCT",o[o.VOID=57]="VOID",o[o.TRUE=58]="TRUE",o[o.FALSE=59]="FALSE",o[o.PRECISION=60]="PRECISION",o[o.PRECISE=61]="PRECISE",o[o.HIGHP=62]="HIGHP",o[o.MEDIUMP=63]="MEDIUMP",o[o.LOWP=64]="LOWP",o[o.INVARIANT=65]="INVARIANT",o[o.SMOOTH=66]="SMOOTH",o[o.FLAT=67]="FLAT",o[o.NOPERSPECTIVE=68]="NOPERSPECTIVE",o[o.GS_RenderQueueType=69]="GS_RenderQueueType",o[o.GS_BlendState=70]="GS_BlendState",o[o.GS_DepthState=71]="GS_DepthState",o[o.GS_StencilState=72]="GS_StencilState",o[o.GS_RasterState=73]="GS_RasterState",o[o.GS_EditorProperties=74]="GS_EditorProperties",o[o.GS_EditorMacros=75]="GS_EditorMacros",o[o.GS_Editor=76]="GS_Editor",o[o.GS_Tags=77]="GS_Tags",o[o.GS_ReplacementTag=78]="GS_ReplacementTag",o[o.GS_LightMode=79]="GS_LightMode",o[o.GS_PipelineStage=80]="GS_PipelineStage",o[o.GS_VertexShader=81]="GS_VertexShader",o[o.GS_FragmentShader=82]="GS_FragmentShader",o[o.GS_SubShader=83]="GS_SubShader",o[o.GS_Pass=84]="GS_Pass",o[o.GS_BlendFactor=85]="GS_BlendFactor",o[o.GS_BlendOperation=86]="GS_BlendOperation",o[o.GS_Bool=87]="GS_Bool",o[o.GS_Number=88]="GS_Number",o[o.GS_Color=89]="GS_Color",o[o.GS_CompareFunction=90]="GS_CompareFunction",o[o.GS_StencilOperation=91]="GS_StencilOperation",o[o.GS_CullMode=92]="GS_CullMode",o[o.GS_UsePass=93]="GS_UsePass",o),eu=new Map([["attribute",el.ATTRIBUTE],["const",el.CONST],["bool",el.BOOL],["float",el.FLOAT],["double",el.DOUBLE],["int",el.INT],["uint",el.UINT],["break",el.BREAK],["continue",el.CONTINUE],["do",el.DO],["else",el.ELSE],["for",el.FOR],["if",el.IF],["while",el.WHILE],["discard",el.DISCARD],["return",el.RETURN],["bvec2",el.BVEC2],["bvec3",el.BVEC3],["bvec4",el.BVEC4],["ivec2",el.IVEC2],["ivec3",el.IVEC3],["ivec4",el.IVEC4],["uvec2",el.UVEC2],["uvec3",el.UVEC3],["uvec4",el.UVEC4],["vec2",el.VEC2],["vec3",el.VEC3],["vec4",el.VEC4],["mat2",el.MAT2],["mat3",el.MAT3],["mat4",el.MAT4],["in",el.IN],["out",el.OUT],["inout",el.INOUT],["sampler2D",el.SAMPLER2D],["samplerCube",el.SAMPLER_CUBE],["sampler3D",el.SAMPLER3D],["sampler2DShadow",el.SAMPLER2D_SHADOW],["samplerCubeShadow",el.SAMPLER_CUBE_SHADOW],["sampler2DArray",el.SAMPLER2D_ARRAY],["sampler2DArrayShadow",el.SAMPLER2D_ARRAY_SHADOW],["isampler2D",el.I_SAMPLER2D],["isampler3D",el.I_SAMPLER3D],["isamplerCube",el.I_SAMPLER_CUBE],["isampler2DArray",el.I_SAMPLER2D_ARRAY],["usampler2D",el.U_SAMPLER2D],["usampler3D",el.U_SAMPLER3D],["usamplerCube",el.U_SAMPLER_CUBE],["usampler2DArray",el.U_SAMPLER2D_ARRAY],["struct",el.STRUCT],["void",el.VOID],["true",el.TRUE],["false",el.FALSE],["precision",el.PRECISION],["precise",el.PRECISE],["highp",el.HIGHP],["mediump",el.MEDIUMP],["lowp",el.LOWP],["invariant",el.INVARIANT],["flat",el.FLAT],["smooth",el.SMOOTH],["noperspective",el.NOPERSPECTIVE],["centroid",el.CENTROID]]),ep=((s={})[s.ID=1e3]="ID",s[s.FLOAT_CONSTANT=1001]="FLOAT_CONSTANT",s[s.INT_CONSTANT=1002]="INT_CONSTANT",s[s.STRING_CONST=1003]="STRING_CONST",s[s.LEFT_OP=1004]="LEFT_OP",s[s.RIGHT_OP=1005]="RIGHT_OP",s[s.INC_OP=1006]="INC_OP",s[s.DEC_OP=1007]="DEC_OP",s[s.LE_OP=1008]="LE_OP",s[s.GE_OP=1009]="GE_OP",s[s.EQ_OP=1010]="EQ_OP",s[s.NE_OP=1011]="NE_OP",s[s.AND_OP=1012]="AND_OP",s[s.OR_OP=1013]="OR_OP",s[s.XOR_OP=1014]="XOR_OP",s[s.MUL_ASSIGN=1015]="MUL_ASSIGN",s[s.DIV_ASSIGN=1016]="DIV_ASSIGN",s[s.ADD_ASSIGN=1017]="ADD_ASSIGN",s[s.SUB_ASSIGN=1018]="SUB_ASSIGN",s[s.MOD_ASSIGN=1019]="MOD_ASSIGN",s[s.LEFT_ASSIGN=1020]="LEFT_ASSIGN",s[s.RIGHT_ASSIGN=1021]="RIGHT_ASSIGN",s[s.AND_ASSIGN=1022]="AND_ASSIGN",s[s.XOR_ASSIGN=1023]="XOR_ASSIGN",s[s.OR_ASSIGN=1024]="OR_ASSIGN",s[s.LEFT_PAREN=1025]="LEFT_PAREN",s[s.RIGHT_PAREN=1026]="RIGHT_PAREN",s[s.LEFT_BRACKET=1027]="LEFT_BRACKET",s[s.RIGHT_BRACKET=1028]="RIGHT_BRACKET",s[s.LEFT_BRACE=1029]="LEFT_BRACE",s[s.RIGHT_BRACE=1030]="RIGHT_BRACE",s[s.DOT=1031]="DOT",s[s.COMMA=1032]="COMMA",s[s.COLON=1033]="COLON",s[s.EQUAL=1034]="EQUAL",s[s.SEMICOLON=1035]="SEMICOLON",s[s.BANG=1036]="BANG",s[s.DASH=1037]="DASH",s[s.TILDE=1038]="TILDE",s[s.PLUS=1039]="PLUS",s[s.STAR=1040]="STAR",s[s.SLASH=1041]="SLASH",s[s.PERCENT=1042]="PERCENT",s[s.LEFT_ANGLE=1043]="LEFT_ANGLE",s[s.RIGHT_ANGLE=1044]="RIGHT_ANGLE",s[s.VERTICAL_BAR=1045]="VERTICAL_BAR",s[s.CARET=1046]="CARET",s[s.AMPERSAND=1047]="AMPERSAND",s[s.QUESTION=1048]="QUESTION",s[s.NOT_WORD=1049]="NOT_WORD",s[s.EPSILON=1998]="EPSILON",s[s.EOF=1999]="EOF",s);function eh(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}var ed=/*#__PURE__*/function(){function e(){}return e.createObjectPool=function(n){var r=new t.ClearableObjectPool(n);return e._shaderLabObjectPoolSet.push(r),r},e.clearAllShaderLabObjectPool=function(){for(var t=0,n=e._shaderLabObjectPoolSet.length;t<n;t++)e._shaderLabObjectPoolSet[t].clear()},e.createGSError=function(e,t,n,r,i){return Error("["+t+"]: "+e)},e}();ed._shaderLabObjectPoolSet=[];var ef=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.set=function(e,t,n){if(this.type=e,this.lexeme=t,n){if(eh(n,es))this.location=n;else{var r=tl.createPosition(n.index+t.length);this.location=tl.createRange(n,r)}}},t.dispose=function(){},e}();ef.pool=ed.createObjectPool(ef);var e_=new ef;e_.set(ep.EOF,"/EOF");var eS=/*#__PURE__*/function(){function e(){}return e.isNum=function(e){return this.numRegex.test(e)},e.isLetter=function(e){return this.letterRegex.test(e)},e.isAlpha=function(e){return this.alphaRegex.test(e)},e.isNumOrLetter=function(e){return this.numOrLetterRegex.test(e)},e.isKeyword=function(e){return e<ep.ID},e}();function eg(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ey(e,t,n){return t&&eg(e.prototype,t),n&&eg(e,n),e}eS.numRegex=/\d/,eS.letterRegex=/\w/,eS.alphaRegex=/[a-zA-Z_]/,eS.numOrLetterRegex=/(\d|\w)/;var ev=((c={}).PreprocessorError="PreprocessorError",c.CompilationError="CompilationError",c.ScannerError="ScannerError",c),em=/*#__PURE__*/function(){function e(e,t){void 0===t&&(t=new Map),this._currentIndex=0,this._source=e,this._keywordsMap=t}var t=e.prototype;return t.getCurPosition=function(){return tl.createPosition(this._currentIndex)},t.isEnd=function(){return this._currentIndex>=this._source.length},t.getCurChar=function(){return this._source[this._currentIndex]},t.advance=function(e){void 0===e&&(e=1);for(var t=0;t<e;t++)this._advance()},t._advance=function(){!this.isEnd()&&this._currentIndex++},t.skipSpace=function(t){for(var n=t?e._spaceCharsWithBreak:e._spaceChars,r=this.getCurChar();e._checkIsIn(r,n);)this._advance(),r=this.getCurChar()},t.skipCommentsAndSpace=function(){if(this.skipSpace(!0),"//"===this.peek(2)){var e=this.getCurPosition();for(this.advance(2);"\n"!==this.getCurChar();)this._advance();return this.skipCommentsAndSpace(),tl.createRange(e,this.getCurPosition())}if("/*"===this.peek(2)){var t=this.getCurPosition();for(this.advance(2);"*/"!==this.peek(2)&&!this.isEnd();)this._advance();return this.advance(2),this.skipCommentsAndSpace(),tl.createRange(t,this.getCurPosition())}},t.peek=function(e){var t=this._currentIndex;return this._source.substring(t,t+e)},t.scanText=function(e){this.skipCommentsAndSpace();var t=this.peek(e.length);t!==e&&this.throwError(this.getCurPosition(),'Expect text "'+e+'", but got "'+t+'"'),this.advance(e.length)},t.throwError=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw ed.createGSError(n.join(" "),ev.ScannerError,this._source,e)},t.scanPairedText=function(e,t,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1),r||this.scanText(e);for(var i=this._currentIndex,a=n?1:0;this.peek(t.length)!==t||0!==a;){if(this.isEnd())return;if(n){if(this.peek(e.length)===e){a+=1,this.advance(e.length);continue}if(this.peek(t.length)===t){if(0==(a-=1))break;this.advance(t.length);continue}}this.advance(t.length)}return this.advance(t.length),this._source.substring(i,this._currentIndex-t.length)},t.scanToken=function(e,t){void 0===t&&(t=/\w/),this.skipCommentsAndSpace();var n,r=this.getCurPosition();if(!this.isEnd()){for(;t.test(this.getCurChar())&&!this.isEnd();)this._advance();var i=this.getCurPosition();if(r.index===i.index){this._advance();var a=ef.pool.get();return a.set(ep.NOT_WORD,this._source[r.index],r),null==e||e(a,this),a}var o=this._source.substring(r.index,i.index),s=null!=(n=this._keywordsMap.get(o))?n:ep.ID,c=tl.createRange(r,i),l=ef.pool.get();return l.set(s,o,c),null==e||e(l,this),l}},e._checkIsIn=function(e,t){for(var n=0;n<t.length;n++)if(e===t[n])return!0;return!1},ey(e,[{key:"current",get:function(){return this._currentIndex}},{key:"source",get:function(){return this._source}}]),e}();em._spaceCharsWithBreak=[" ","	","\n"],em._spaceChars=[" ","	"];var ex=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.reset=function(e){this._source=e,this._currentIndex=0},n.tokenize=function(){return function(e,t){var n,r,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(c){return function(s){if(n)throw TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,function(e){switch(e.label){case 0:if(this.isEnd())return[3,2];return[4,this.scanToken()];case 1:return e.sent(),[3,0];case 2:return[2,e_]}})},n.skipSpace=function(){for(;/\s/.test(this.getCurChar());)this.advance()},n.scanToken=function(){if(this.skipCommentsAndSpace(),this.isEnd())return e_;if(eS.isAlpha(this.getCurChar()))return this._scanWord();if(eS.isNum(this.getCurChar()))return this._scanNum();var e=this._getPosition(),t=ef.pool.get();switch(this.getCurChar()){case"<":if(this.advance(),"<"===this.getCurChar()){if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(ep.LEFT_ASSIGN,"<<=",e);break}t.set(ep.LEFT_OP,"<<",e);break}if("="===this.getCurChar()){this.advance(),t.set(ep.LE_OP,"<=",e);break}t.set(ep.LEFT_ANGLE,"<",e);break;case">":if(this.advance(),">"===this.getCurChar()){if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(ep.RIGHT_ASSIGN,">>=",e);break}t.set(ep.RIGHT_OP,">>",e);break}if("="===this.getCurChar()){this.advance(),t.set(ep.GE_OP,">=",e);break}t.set(ep.RIGHT_ANGLE,">",e);break;case"+":if(this.advance(),"+"===this.getCurChar()){this.advance(),t.set(ep.INC_OP,"++",e);break}if("="===this.getCurChar()){this.advance(),t.set(ep.ADD_ASSIGN,"+=",e);break}t.set(ep.PLUS,"+",e);break;case"-":if(this.advance(),"-"===this.getCurChar()){this.advance(),t.set(ep.DEC_OP,"--",e);break}if("="===this.getCurChar()){this.advance(),t.set(ep.SUB_ASSIGN,"-=",e);break}t.set(ep.DASH,"-",e);break;case"=":if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(ep.EQ_OP,"==",e);break}t.set(ep.EQUAL,"=",e);break;case"!":if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(ep.NE_OP,"!=",e);break}t.set(ep.BANG,"!",e);break;case"&":if(this.advance(),"&"===this.getCurChar()){this.advance(),t.set(ep.AND_OP,"&&",e);break}if("="===this.getCurChar()){this.advance(),t.set(ep.ADD_ASSIGN,"&=",e);break}t.set(ep.AMPERSAND,"&",e);break;case"|":if(this.advance(),"|"===this.getCurChar()){this.advance(),t.set(ep.OR_OP,"||",e);break}if("="===this.getCurChar()){this.advance(),t.set(ep.OR_ASSIGN,"|=",e);break}t.set(ep.VERTICAL_BAR,"|",e);break;case"^":if(this.advance(),"^"===this.getCurChar()){this.advance(),t.set(ep.XOR_OP,"^^",e);break}if("="===this.getCurChar()){this.advance(),t.set(ep.XOR_ASSIGN,"^=",e);break}t.set(ep.CARET,"^",e);break;case"*":if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(ep.MUL_ASSIGN,"*=",e);break}t.set(ep.STAR,"*",e);break;case"/":if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(ep.DIV_ASSIGN,"/=",e);break}t.set(ep.SLASH,"/",e);break;case"%":if(this.advance(),"="===this.getCurChar()){this.advance(),t.set(ep.MOD_ASSIGN,"%=",e);break}t.set(ep.PERCENT,"%",e);break;case"(":this.advance(),t.set(ep.LEFT_PAREN,"(",e);break;case")":this.advance(),t.set(ep.RIGHT_PAREN,")",e);break;case"{":this.advance(),t.set(ep.LEFT_BRACE,"{",e);break;case"}":this.advance(),t.set(ep.RIGHT_BRACE,"}",e);break;case"[":this.advance(),t.set(ep.LEFT_BRACKET,"[",e);break;case"]":this.advance(),t.set(ep.RIGHT_BRACKET,"]",e);break;case".":if(this.advance(),eS.isNum(this.getCurChar()))return this._scanNumAfterDot();t.set(ep.DOT,".",e);break;case",":this.advance(),t.set(ep.COMMA,",",e);break;case":":this.advance(),t.set(ep.COLON,":",e);break;case";":this.advance(),t.set(ep.SEMICOLON,";",e);break;case"~":this.advance(),t.set(ep.TILDE,"~",e);break;case"?":this.advance(),t.set(ep.QUESTION,"?",e);break;case'"':return this.advance(),this._scanStringConst();default:this.throwError(this.getCurPosition(),"Unexpected character "+this.getCurChar())}return t},n._scanStringConst=function(){for(var e=this._getPosition(),t=[];'"'!==this.getCurChar();)t.push(this.getCurChar()),this.advance();this.advance();var n=tl.createRange(e,this._getPosition()),r=ef.pool.get();return r.set(ep.STRING_CONST,t.join(""),n),r},n._scanNumAfterDot=function(){for(var e=["."];eS.isNum(this.getCurChar());)e.push(this.getCurChar()),this.advance();var t=ef.pool.get();return t.set(ep.FLOAT_CONSTANT,e.join(""),this._getPosition(1)),t},n._getPosition=function(e){return void 0===e&&(e=0),tl.createPosition(this.current-e)},n._scanWord=function(){var e=[this.getCurChar()],t=this._getPosition();for(this.advance();eS.isLetter(this.getCurChar());)e.push(this.getCurChar()),this.advance();var n=e.join(""),r=eu.get(n);if(r){var i=ef.pool.get();return i.set(r,n,t),i}var a=ef.pool.get();return a.set(ep.ID,n,t),a},n._scanNum=function(){for(var e=[];eS.isNum(this.getCurChar());)e.push(this.getCurChar()),this.advance();if("."===this.getCurChar()){for(e.push(this.getCurChar()),this.advance();eS.isNum(this.getCurChar());)e.push(this.getCurChar()),this.advance();this._scanFloatSuffix(e);var t=ef.pool.get();return t.set(ep.FLOAT_CONSTANT,e.join(""),this._getPosition(e.length)),t}if("e"===this.getCurChar()||"E"===this.getCurChar()){this._scanFloatSuffix(e);var n=ef.pool.get();return n.set(ep.FLOAT_CONSTANT,e.join(""),this._getPosition(e.length)),n}this._scanIntegerSuffix(e);var r=ef.pool.get();return r.set(ep.INT_CONSTANT,e.join(""),this._getPosition(e.length)),r},n._scanFloatSuffix=function(e){if("e"===this.getCurChar()||"E"===this.getCurChar())for(e.push(this.getCurChar()),this.advance(),("+"===this.getCurChar()||"-"===this.getCurChar())&&(e.push(this.getCurChar()),this.advance()),eS.isNum(this.getCurChar())||this.throwError(this.getCurPosition(),"lexing error, invalid exponent suffix.");eS.isNum(this.getCurChar());)e.push(this.getCurChar()),this.advance();("f"===this.getCurChar()||"F"===this.getCurChar())&&(e.push(this.getCurChar()),this.advance())},n._scanIntegerSuffix=function(e){("u"===this.getCurChar()||"U"===this.getCurChar())&&(e.push(this.getCurChar()),this.advance())},t}(em),eE=((l={})[l.Shift=0]="Shift",l[l.Reduce=1]="Reduce",l[l.Accept=2]="Accept",l),eC=function(){this.globalPrecisions=[]},eb=function(e,t,n){this.type=e,this.typeLexeme=t,this.arraySpecifier=n},eT=((u={})[u.VAR=0]="VAR",u[u.FN=1]="FN",u[u.STRUCT=2]="STRUCT",u),eP=function(e,t,n,r){this.ident=e,this.symbolType=t,this.astNode=n,this.dataType=r},eA=/*#__PURE__*/function(e){function t(t,n){var r=new eb(n.protoType.returnType.type,n.protoType.returnType.typeSpecifier.lexeme);return e.call(this,t,eT.FN,n,r)||this}return a(t,e),t}(eP),eO=/*#__PURE__*/function(e){function t(t,n){return e.call(this,t,eT.STRUCT,n)||this}return a(t,e),t}(eP),eI=/*#__PURE__*/function(){function e(){this._table=new Map}var n=e.prototype;return n.insert=function(e){for(var n,r=null!=(n=this._table.get(e.ident))?n:[],i=0;i<r.length;i++)if(this.symbolEqualCheck(r[i],e)){t.Logger.warn("replace symbol:",e.ident),r[i]=e;return}r.push(e),this._table.set(e.ident,r)},n.lookup=function(e){for(var t,n,i=null!=(t=this._table.get(e.ident))?t:[],a=r(i);!(n=a()).done;){var o=n.value;if(this.symbolEqualCheck(o,e))return o}},e}(),eR=/*#__PURE__*/function(){function e(){this._stack=[]}var t=e.prototype;return t.newScope=function(e){this._stack.push(e)},t.clear=function(){this._stack.length=0},t.dropScope=function(){this._stack.pop()},t.insert=function(e){this._scope.insert(e)},t.lookup=function(e){for(var t=this._stack.length-1;t>=0;t--){var n=this._stack[t].lookup(e);if(n)return n}},ey(e,[{key:"_scope",get:function(){return this._stack[this._stack.length-1]}}]),e}(),eL=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.symbolEqualCheck=function(e,t){if(e.symbolType!==t.symbolType)return!1;if(t.symbolType===eT.FN){if(!t.astNode&&!t.signature)return!0;var n,r=e.astNode.protoType.paramSig,i=null!=(n=t.signature)?n:t.astNode.protoType.paramSig;if(r.length!==i.length)return!1;for(var a=0;a<r.length;a++)if(3e3!==r[a]&&3e3!==i[a]&&r[a]!==i[a])return!1}return!0},n.getAllFnSymbols=function(e){var t;return(null!=(t=this._table.get(e))?t:[]).filter(function(e){return e.symbolType===eT.FN})},t}(eI),ek=/*#__PURE__*/function(e){function t(t,n,r,i){var a;return(a=e.call(this,t,eT.VAR,i,n)||this).isGlobalVariable=r,a}return a(t,e),t}(eP),eN=/*#__PURE__*/function(){function e(){this.semanticStack=[],this.acceptRule=void 0,this.symbolTable=new eR,this._shaderData=new eC,this._translationRuleTable=new Map,this.newScope()}var t=e.prototype;return t.reset=function(){this.semanticStack.length=0,this._shaderData=new eC,this.symbolTable.clear(),this.newScope()},t.newScope=function(){var e=new eL;this.symbolTable.newScope(e)},t.dropScope=function(){return this.symbolTable.dropScope()},t.addTranslationRule=function(e,t){this._translationRuleTable.set(e,t)},t.getTranslationRule=function(e){return this._translationRuleTable.get(e)},t.error=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Error(n.join(""))},ey(e,[{key:"shaderData",get:function(){return this._shaderData}}]),e}(),eG=((p={})[p.START=2e3]="START",p[p.gs_shader_program=2001]="gs_shader_program",p[p.global_declaration=2002]="global_declaration",p[p.variable_declaration=2003]="variable_declaration",p[p.array_specifier_list=2004]="array_specifier_list",p[p.array_specifier=2005]="array_specifier",p[p.ext_builtin_type_specifier_nonarray=2006]="ext_builtin_type_specifier_nonarray",p[p.precision_specifier=2007]="precision_specifier",p[p.variable_identifier=2008]="variable_identifier",p[p.variable_identifier_node=2009]="variable_identifier_node",p[p.primary_expression=2010]="primary_expression",p[p.postfix_expression=2011]="postfix_expression",p[p.integer_expression=2012]="integer_expression",p[p.function_call=2013]="function_call",p[p.function_call_generic=2014]="function_call_generic",p[p.function_call_header_no_parameters=2015]="function_call_header_no_parameters",p[p.function_call_header_with_parameters=2016]="function_call_header_with_parameters",p[p.function_call_parameter_list=2017]="function_call_parameter_list",p[p.function_call_header=2018]="function_call_header",p[p.function_identifier=2019]="function_identifier",p[p.constructor_identifier=2020]="constructor_identifier",p[p.unary_expression=2021]="unary_expression",p[p.unary_operator=2022]="unary_operator",p[p.multiplicative_expression=2023]="multiplicative_expression",p[p.additive_expression=2024]="additive_expression",p[p.shift_expression=2025]="shift_expression",p[p.relational_expression=2026]="relational_expression",p[p.equality_expression=2027]="equality_expression",p[p.and_expression=2028]="and_expression",p[p.inclusive_or_expression=2029]="inclusive_or_expression",p[p.exclusive_or_expression=2030]="exclusive_or_expression",p[p.logical_and_expression=2031]="logical_and_expression",p[p.logical_xor_expression=2032]="logical_xor_expression",p[p.logical_or_expression=2033]="logical_or_expression",p[p.conditional_expression=2034]="conditional_expression",p[p.assignment_expression=2035]="assignment_expression",p[p.assignment_operator=2036]="assignment_operator",p[p.expression=2037]="expression",p[p.integer_constant_expression=2038]="integer_constant_expression",p[p.integer_constant_expression_operator=2039]="integer_constant_expression_operator",p[p.declaration=2040]="declaration",p[p.function_prototype=2041]="function_prototype",p[p.function_declarator=2042]="function_declarator",p[p.function_header_with_parameters=2043]="function_header_with_parameters",p[p.function_header=2044]="function_header",p[p.function_parameter_list=2045]="function_parameter_list",p[p.parameter_declarator=2046]="parameter_declarator",p[p.parameter_declaration=2047]="parameter_declaration",p[p.parameter_qualifier=2048]="parameter_qualifier",p[p.parameter_type_specifier=2049]="parameter_type_specifier",p[p.init_declarator_list=2050]="init_declarator_list",p[p.single_declaration=2051]="single_declaration",p[p.fully_specified_type=2052]="fully_specified_type",p[p.type_qualifier=2053]="type_qualifier",p[p.single_type_qualifier=2054]="single_type_qualifier",p[p.storage_qualifier=2055]="storage_qualifier",p[p.precision_qualifier=2056]="precision_qualifier",p[p.interpolation_qualifier=2057]="interpolation_qualifier",p[p.invariant_qualifier=2058]="invariant_qualifier",p[p.type_specifier=2059]="type_specifier",p[p.type_specifier_nonarray=2060]="type_specifier_nonarray",p[p.type_specifier_no_prec=2061]="type_specifier_no_prec",p[p.basic_type=2062]="basic_type",p[p.struct_specifier=2063]="struct_specifier",p[p.struct_declaration_list=2064]="struct_declaration_list",p[p.struct_declaration=2065]="struct_declaration",p[p.struct_declarator_list=2066]="struct_declarator_list",p[p.struct_declarator=2067]="struct_declarator",p[p.identifier_list=2068]="identifier_list",p[p.decl_identifier=2069]="decl_identifier",p[p.initializer=2070]="initializer",p[p.initializer_list=2071]="initializer_list",p[p.declaration_statement=2072]="declaration_statement",p[p.simple_statement=2073]="simple_statement",p[p.compound_statement_no_scope=2074]="compound_statement_no_scope",p[p.statement_with_scope=2075]="statement_with_scope",p[p.compound_statement=2076]="compound_statement",p[p.statement=2077]="statement",p[p.statement_list=2078]="statement_list",p[p.iteration_statement_no_new_scope=2079]="iteration_statement_no_new_scope",p[p.expression_statement=2080]="expression_statement",p[p.selection_statement=2081]="selection_statement",p[p.selection_rest_statement=2082]="selection_rest_statement",p[p.condition=2083]="condition",p[p.conditionopt=2084]="conditionopt",p[p.iteration_statement=2085]="iteration_statement",p[p.for_init_statement=2086]="for_init_statement",p[p.for_rest_statement=2087]="for_rest_statement",p[p.jump_statement=2088]="jump_statement",p[p.external_declaration=2089]="external_declaration",p[p.function_definition=2090]="function_definition",p[p.field_selection=2091]="field_selection",p[p.bool_constant=2092]="bool_constant",p[p.function_identifier_node=2093]="function_identifier_node",p[p.typename_identifier_node=2094]="typename_identifier_node",p[p.scope_brace=2095]="scope_brace",p[p.scope_end_brace=2096]="scope_end_brace",p[p._ignore=2097]="_ignore",p),eM=function e(t,n){this.goal=t,this.derivation=n,this.id=e._id++,e.pool.set(this.id,this)};eM._id=0,eM.pool=new Map;var eD=/*#__PURE__*/function(){function e(e,t){this.startSymbol=e,t.unshift(new eM(eG.START,[e])),this.productions=t}var t=e.prototype;return t.getProductionList=function(e){return this.productions.filter(function(t){return t.goal===e})},t.isNullableNT=function(e){return this.productions.find(function(t){return t.goal===e&&t.derivation[0]===ep.EPSILON})},t.getProductionByID=function(e){return eM.pool.get(e)},e.create=function(t,n){return new e(t,n.map(function(e){return new eM(e[0],e.slice(1))}))},e}(),eF=function(e,t,n){this.type=e,this.arraySpecifier=n,this.typeLexeme=t},ew=function(e,t){this.typeInfo=e,this.ident=t},eB=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.set=function(e,t,n){this.nt=n,this._location=e,this._children=t},t.dispose=function(){},t.codeGen=function(e){return e.defaultCodeGen(this.children)},t.semanticAnalyze=function(e){},ey(e,[{key:"children",get:function(){return this._children}},{key:"location",get:function(){return this._location}}]),e}();(h=eo||(eo={}))._unwrapToken=function(e){if(eh(e,ef))return e;throw"not token"},h.get=function(e,t,n,r){var i=e.get();i.set(n,r),i.semanticAnalyze(t),t.semanticStack.push(i)},(d=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG._ignore)},t}(eB)).pool=ed.createObjectPool(d),h.TrivialNode=d,(f=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.scope_brace)},n.semanticAnalyze=function(e){e.newScope()},t}(eB)).pool=ed.createObjectPool(f),h.ScopeBrace=f,(_=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.scope_end_brace)},n.semanticAnalyze=function(e){e.dropScope()},t}(eB)).pool=ed.createObjectPool(_),h.ScopeEndBrace=_,(S=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.jump_statement)},n.codeGen=function(e){return e.visitJumpStatement(this)},t}(eB)).pool=ed.createObjectPool(S),h.JumpStatement=S,g=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n,r){e.prototype.set.call(this,t,n,r),this._type=void 0},ey(t,[{key:"type",get:function(){var e;return null!=(e=this._type)?e:3e3},set:function(e){this._type=e}}]),t}(eB),h.ExpressionAstNode=g,(y=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.single_declaration),this.typeSpecifier=void 0,this.arraySpecifier=void 0},n.semanticAnalyze=function(e){var t,n=this.children[0],r=this.children[1];if(this.typeSpecifier=n.typeSpecifier,2===this.children.length||4===this.children.length){var i=new eF(n.type,n.typeSpecifier.lexeme),a=this.children[3];t=new ek(r.lexeme,i,!1,a)}else{var o=this.children[2];this.arraySpecifier=o;var s=new eF(n.type,n.typeSpecifier.lexeme,o),c=this.children[4];t=new ek(r.lexeme,s,!1,c)}e.symbolTable.insert(t)},n.codeGen=function(e){return e.visitSingleDeclaration(this)},t}(eB)).pool=ed.createObjectPool(y),h.SingleDeclaration=y,(v=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.fully_specified_type)},ey(t,[{key:"qualifierList",get:function(){if(this.children.length>1)return this.children[0].qualifierList}},{key:"typeSpecifier",get:function(){return 1===this.children.length?this.children[0]:this.children[1]}},{key:"type",get:function(){return this.typeSpecifier.type}}]),t}(eB)).pool=ed.createObjectPool(v),h.FullySpecifiedType=v,(m=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.type_qualifier)},n.semanticAnalyze=function(e){this.children.length>1?this.qualifierList=[].concat(this.children[0].qualifierList,[this.children[1].qualifier]):this.qualifierList=[this.children[0].qualifier]},t}(eB)).pool=ed.createObjectPool(m),h.TypeQualifier=m,(x=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.single_type_qualifier)},n.semanticAnalyze=function(e){var t=this.children[0];eh(t,ef)?this.qualifier=t.type:this.qualifier=t.qualifier,this.lexeme=t.lexeme},t}(eB)).pool=ed.createObjectPool(x),h.SingleTypeQualifier=x,(E=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.type_specifier)},ey(t,[{key:"type",get:function(){return this.children[0].type}},{key:"lexeme",get:function(){return this.children[0].lexeme}},{key:"arraySize",get:function(){var e,t;return null==(t=this.children)?void 0:null==(e=t[1])?void 0:e.size}},{key:"isCustom",get:function(){return"string"==typeof this.type}}]),t}(eB)).pool=ed.createObjectPool(E),h.TypeSpecifier=E,(C=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.array_specifier)},ey(t,[{key:"size",get:function(){return this.children[1].value}}]),t}(eB)).pool=ed.createObjectPool(C),h.ArraySpecifier=C,(b=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.integer_constant_expression_operator)},n.semanticAnalyze=function(e){var t=this.children[0];switch(t.type){case ep.PLUS:this.compute=function(e,t){return e+t};break;case ep.DASH:this.compute=function(e,t){return e-t};break;case ep.STAR:this.compute=function(e,t){return e*t};break;case ep.SLASH:this.compute=function(e,t){return e/t};break;case ep.PERCENT:this.compute=function(e,t){return e%t};break;default:e.error(t.location,"not implemented operator "+t.lexeme)}},ey(t,[{key:"lexeme",get:function(){return this.children[0].lexeme}}]),t}(eB)).pool=ed.createObjectPool(b),h.IntegerConstantExpressionOperator=b,(T=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.integer_constant_expression),this.value=void 0},n.semanticAnalyze=function(e){if(1===this.children.length){var t=this.children[0];eh(t,ef)&&(this.value=Number(t.lexeme))}},t}(eB)).pool=ed.createObjectPool(T),h.IntegerConstantExpression=T,(P=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.type_specifier_nonarray);var r=n[0];eh(r,ef)?this.type=r.lexeme:this.type=r.type,this.lexeme=r.lexeme},t}(eB)).pool=ed.createObjectPool(P),h.TypeSpecifierNonArray=P,(A=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.ext_builtin_type_specifier_nonarray);var r=this.children[0];this.type=r.type,this.lexeme=r.lexeme},t}(eB)).pool=ed.createObjectPool(A),h.ExtBuiltinTypeSpecifierNonArray=A,(O=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.init_declarator_list)},n.semanticAnalyze=function(e){var t;if(3===this.children.length||5===this.children.length)t=new ek(this.children[2].lexeme,this.typeInfo,!1,this),e.symbolTable.insert(t);else if(4===this.children.length||6===this.children.length){var n=this.typeInfo,r=this.children[3];n.arraySpecifier=r,t=new ek(this.children[2].lexeme,n,!1,this),e.symbolTable.insert(t)}},ey(t,[{key:"typeInfo",get:function(){if(1===this.children.length){var e=this.children[0];return new eF(e.typeSpecifier.type,e.typeSpecifier.lexeme,e.arraySpecifier)}return this.children[0].typeInfo}}]),t}(eB)).pool=ed.createObjectPool(O),h.InitDeclaratorList=O,(I=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.identifier_list)},ey(t,[{key:"idList",get:function(){return 2===this.children.length?[this.children[1]]:[].concat(this.children[0].idList,[this.children[2]])}}]),t}(eB)).pool=ed.createObjectPool(I),h.IdentifierList=I,(R=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.declaration)},n.codeGen=function(e){return e.visitDeclaration(this)},t}(eB)).pool=ed.createObjectPool(R),h.Declaration=R,(L=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.function_prototype)},n.codeGen=function(e){return e.visitFunctionProtoType(this)},ey(t,[{key:"declarator",get:function(){return this.children[0]}},{key:"ident",get:function(){return this.declarator.ident}},{key:"returnType",get:function(){return this.declarator.returnType}},{key:"parameterList",get:function(){return this.declarator.parameterInfoList}},{key:"paramSig",get:function(){return this.declarator.paramSig}}]),t}(eB)).pool=ed.createObjectPool(L),h.FunctionProtoType=L,(k=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.function_declarator)},ey(t,[{key:"header",get:function(){return this.children[0]}},{key:"parameterList",get:function(){return this.children[1]}},{key:"ident",get:function(){return this.header.ident}},{key:"returnType",get:function(){return this.header.returnType}},{key:"parameterInfoList",get:function(){var e;return null==(e=this.parameterList)?void 0:e.parameterInfoList}},{key:"paramSig",get:function(){var e;return null==(e=this.parameterList)?void 0:e.paramSig}}]),t}(eB)).pool=ed.createObjectPool(k),h.FunctionDeclarator=k,(N=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.function_header)},n.semanticAnalyze=function(e){e.newScope()},n.codeGen=function(e){return e.visitFunctionHeader(this)},ey(t,[{key:"ident",get:function(){return this.children[1]}},{key:"returnType",get:function(){return this.children[0]}}]),t}(eB)).pool=ed.createObjectPool(N),h.FunctionHeader=N,(G=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.function_parameter_list)},n.codeGen=function(e){return e.visitFunctionParameterList(this)},ey(t,[{key:"parameterInfoList",get:function(){if(1===this.children.length){var e=this.children[0];return[{ident:e.ident,typeInfo:e.typeInfo,astNode:e}]}var t=this.children[0],n=this.children[2];return[].concat(t.parameterInfoList,[{ident:n.ident,typeInfo:n.typeInfo,astNode:n}])}},{key:"paramSig",get:function(){if(1===this.children.length)return[this.children[0].typeInfo.type];var e=this.children[0],t=this.children[2];return e.paramSig.concat([t.typeInfo.type])}}]),t}(eB)).pool=ed.createObjectPool(G),h.FunctionParameterList=G,(M=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.parameter_declaration)},n.semanticAnalyze=function(e){var t,n=new ek((t=1===this.children.length?this.children[0]:this.children[1]).ident.lexeme,t.typeInfo,!1,this);e.symbolTable.insert(n)},ey(t,[{key:"typeQualifier",get:function(){if(2===this.children.length)return this.children[0]}},{key:"parameterDeclarator",get:function(){return 1===this.children.length?this.children[0]:this.children[1]}},{key:"typeInfo",get:function(){return this.parameterDeclarator.typeInfo}},{key:"ident",get:function(){return this.parameterDeclarator.ident}}]),t}(eB)).pool=ed.createObjectPool(M),h.ParameterDeclaration=M,(D=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.parameter_declarator)},ey(t,[{key:"ident",get:function(){return this.children[1]}},{key:"typeInfo",get:function(){var e=this.children[0],t=this.children[2];return new eF(e.type,e.lexeme,t)}}]),t}(eB)).pool=ed.createObjectPool(D),h.ParameterDeclarator=D,(F=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.compound_statement_no_scope)},t}(eB)).pool=ed.createObjectPool(F),h.CompoundStatementNoScope=F,(w=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.statement_list)},n.codeGen=function(e){return e.visitStatementList(this)},t}(eB)).pool=ed.createObjectPool(w),h.StatementList=w,(B=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.function_definition)},n.semanticAnalyze=function(e){e.dropScope();var t=new eA(this.protoType.ident.lexeme,this);e.symbolTable.insert(t)},n.codeGen=function(e){return e.visitFunctionDefinition(this)},ey(t,[{key:"protoType",get:function(){return this.children[0]}},{key:"statements",get:function(){return this.children[1]}}]),t}(eB)).pool=ed.createObjectPool(B),h.FunctionDefinition=B,(U=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.function_call)},n.semanticAnalyze=function(e){this.type=this.children[0].type},n.codeGen=function(e){return e.visitFunctionCall(this)},t}(g)).pool=ed.createObjectPool(U),h.FunctionCall=U,(V=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.function_call_generic),this.fnSymbol=void 0},n.semanticAnalyze=function(e){var t=this.children[0];if(t.isBuiltin)this.type=t.ident;else{var n,r,i=t.ident;if(4===this.children.length){var a=this.children[2];eh(a,W)&&(r=a.paramSig)}var o=e.symbolTable.lookup({ident:i,symbolType:eT.FN,signature:r});if(!o)return;this.type=null==o?void 0:null==(n=o.dataType)?void 0:n.type,this.fnSymbol=o}},t}(g)).pool=ed.createObjectPool(V),h.FunctionCallGeneric=V,(W=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.function_call_parameter_list)},ey(t,[{key:"paramSig",get:function(){if(1===this.children.length){var e=this.children[0];return void 0==e.type?[3e3]:[e.type]}var t=this.children[0],n=this.children[2];return void 0==t.paramSig||void 0==n.type?[3e3]:t.paramSig.concat([n.type])}},{key:"paramNodes",get:function(){if(1===this.children.length)return[this.children[0]];var e=this.children[0],t=this.children[2];return e.paramNodes.concat([t])}}]),t}(eB)).pool=ed.createObjectPool(W),h.FunctionCallParameterList=W,(j=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.precision_specifier)},n.semanticAnalyze=function(e){e.shaderData.globalPrecisions.push(this)},t}(eB)).pool=ed.createObjectPool(j),h.PrecisionSpecifier=j,(H=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.function_identifier)},n.semanticAnalyze=function(e){},n.codeGen=function(e){return e.visitFunctionIdentifier(this)},ey(t,[{key:"ident",get:function(){return this.children[0].type}},{key:"lexeme",get:function(){return this.children[0].lexeme}},{key:"isBuiltin",get:function(){return"string"!=typeof this.ident}}]),t}(eB)).pool=ed.createObjectPool(H),h.FunctionIdentifier=H,(q=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.assignment_expression)},t}(g)).pool=ed.createObjectPool(q),h.AssignmentExpression=q,(z=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.expression)},t}(g)).pool=ed.createObjectPool(z),h.Expression=z,(Q=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.primary_expression)},n.semanticAnalyze=function(e){if(1===this.children.length){var t,n=this.children[0];if(eh(n,et))this.type=null!=(t=n.typeInfo)?t:3e3;else switch(n.type){case ep.INT_CONSTANT:this._type=el.INT;break;case ep.FLOAT_CONSTANT:this.type=el.FLOAT;break;case el.TRUE:case el.FALSE:this.type=el.BOOL}}else{var r=this.children[1];this.type=r.type}},t}(g)).pool=ed.createObjectPool(Q),h.PrimaryExpression=Q,(X=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){if(e.prototype.set.call(this,t,n,eG.postfix_expression),1===this.children.length){var r=this.children[0];this.type=r.type}},n.codeGen=function(e){return e.visitPostfixExpression(this)},t}(g)).pool=ed.createObjectPool(X),h.PostfixExpression=X,(K=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.struct_specifier)},n.semanticAnalyze=function(e){6===this.children.length&&(this.ident=this.children[1],e.symbolTable.insert(new eO(this.ident.lexeme,this)))},ey(t,[{key:"propList",get:function(){return(6===this.children.length?this.children[3]:this.children[2]).propList}}]),t}(eB)).pool=ed.createObjectPool(K),h.StructSpecifier=K,(Y=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.struct_declaration_list)},ey(t,[{key:"propList",get:function(){if(1===this.children.length)return this.children[0].propList;var e=this.children[0],t=this.children[1];return[e.propList,t.propList].flat()}}]),t}(eB)).pool=ed.createObjectPool(Y),h.StructDeclarationList=Y,(J=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.struct_declaration)},ey(t,[{key:"typeSpecifier",get:function(){return 3===this.children.length?this.children[0]:this.children[1]}},{key:"declaratorList",get:function(){return 3===this.children.length?this.children[1]:this.children[2]}},{key:"propList",get:function(){for(var e=[],t=0;t<this.declaratorList.declaratorList.length;t++){var n=this.declaratorList.declaratorList[t],r=new ew(new eF(this.typeSpecifier.type,this.typeSpecifier.lexeme,n.arraySpecifier),n.ident);e.push(r)}return e}}]),t}(eB)).pool=ed.createObjectPool(J),h.StructDeclaration=J,(Z=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.struct_declarator_list)},ey(t,[{key:"declaratorList",get:function(){return 1===this.children.length?[this.children[0]]:[].concat(this.children[0].declaratorList,[this.children[1]])}}]),t}(eB)).pool=ed.createObjectPool(Z),h.StructDeclaratorList=Z,($=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.set=function(t,n){e.prototype.set.call(this,t,n,eG.struct_declarator)},ey(t,[{key:"ident",get:function(){return this.children[0]}},{key:"arraySpecifier",get:function(){return this.children[1]}}]),t}(eB)).pool=ed.createObjectPool($),h.StructDeclarator=$,(ee=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.variable_declaration)},n.semanticAnalyze=function(e){var t,n=this.children[0];t=new ek(this.children[1].lexeme,new eF(n.type,n.typeSpecifier.lexeme),!0,this),e.symbolTable.insert(t)},n.codeGen=function(e){return e.visitGlobalVariableDeclaration(this)},t}(eB)).pool=ed.createObjectPool(ee),h.VariableDeclaration=ee,(et=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.variable_identifier)},n.semanticAnalyze=function(e){var t=this.children[0];this.symbolInfo=e.symbolTable.lookup({ident:t.lexeme,symbolType:eT.VAR})},n.codeGen=function(e){return e.visitVariableIdentifier(this)},ey(t,[{key:"lexeme",get:function(){return this.children[0].lexeme}},{key:"typeInfo",get:function(){var e;return eh(this.symbolInfo,ek)?this.symbolInfo.dataType.type:null==(e=this.symbolInfo)?void 0:e.type}}]),t}(eB)).pool=ed.createObjectPool(et),h.VariableIdentifier=et,(en=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}a(t,e);var n=t.prototype;return n.set=function(t,n){e.prototype.set.call(this,t,n,eG.gs_shader_program)},n.semanticAnalyze=function(e){this.shaderData=e.shaderData,this.shaderData.symbolTable=e.symbolTable._scope},t}(eB)).pool=ed.createObjectPool(en),h.GLShaderProgram=en;var eU=/*#__PURE__*/function(){function e(){}return e.isTerminal=function(e){return e<eG.START},e.toString=function(e){if(this.isTerminal(e)){var t;return null!=(t=ep[e])?t:el[e]}return eG[e]},e.createProductionWithOptions=function(e,t,n){for(var i,a=[],o=r(t);!(i=o()).done;){var s=i.value;a.push([[].concat([e],s),function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(r[0]){var a=r[0].location.start,o=r[r.length-1].location.end,s=tl.createRange(a,o);eo.get(null!=n?n:eo.TrivialNode.pool,e,s,r)}}])}return a},e.createProductionOptions=function(e,t,n){for(var i,a=[],o=r(n);!(i=o()).done;){var s=i.value,c=e.slice(0,t);c.push.apply(c,[].concat(s)),c.push.apply(c,[].concat(e.slice(t))),a.push(c)}return a},e.addMapSetItem=function(e,t,n){var r,i=null!=(r=e.get(t))?r:new Set;i.add(n),e.set(t,i)},e.isSubSet=function(e,t){for(var n,i=r(e);!(n=i()).done;){var a=n.value;if(!t.has(a))return!1}return!0},e.isActionEqual=function(e,t){return e.action===t.action&&e.target===t.target},e}(),eV=[].concat(eU.createProductionWithOptions(eG.gs_shader_program,[[eG.global_declaration],[eG.gs_shader_program,eG.global_declaration]],eo.GLShaderProgram.pool),eU.createProductionWithOptions(eG.global_declaration,[[eG.precision_specifier],[eG.variable_declaration],[eG.struct_specifier],[eG.function_definition]]),eU.createProductionWithOptions(eG.variable_declaration,[[el.GS_RenderQueueType,ep.ID,ep.SEMICOLON],[eG.fully_specified_type,ep.ID,ep.SEMICOLON],[eG.fully_specified_type,ep.ID,eG.array_specifier,ep.SEMICOLON]],eo.VariableDeclaration.pool),eU.createProductionWithOptions(eG.ext_builtin_type_specifier_nonarray,[[el.VOID],[el.FLOAT],[el.BOOL],[el.INT],[el.UINT],[el.VEC2],[el.VEC3],[el.VEC4],[el.BVEC2],[el.BVEC3],[el.BVEC4],[el.IVEC2],[el.IVEC3],[el.IVEC4],[el.UVEC2],[el.UVEC3],[el.UVEC4],[el.MAT2],[el.MAT3],[el.MAT4],[el.MAT2X3],[el.MAT2X4],[el.MAT3X2],[el.MAT3X4],[el.MAT4X2],[el.MAT4X3],[el.SAMPLER2D],[el.SAMPLER3D],[el.SAMPLER_CUBE],[el.SAMPLER2D_SHADOW],[el.SAMPLER_CUBE_SHADOW],[el.SAMPLER2D_ARRAY],[el.SAMPLER2D_ARRAY_SHADOW],[el.I_SAMPLER2D],[el.I_SAMPLER3D],[el.I_SAMPLER_CUBE],[el.I_SAMPLER2D_ARRAY],[el.U_SAMPLER2D],[el.U_SAMPLER3D],[el.U_SAMPLER_CUBE],[el.U_SAMPLER2D_ARRAY]],eo.ExtBuiltinTypeSpecifierNonArray.pool),eU.createProductionWithOptions(eG.type_specifier_nonarray,[[ep.ID],[eG.ext_builtin_type_specifier_nonarray]],eo.TypeSpecifierNonArray.pool),eU.createProductionWithOptions(eG.fully_specified_type,[[eG.type_specifier],[eG.type_qualifier,eG.type_specifier]],eo.FullySpecifiedType.pool),eU.createProductionWithOptions(eG.type_specifier,[[eG.type_specifier_nonarray],[eG.ext_builtin_type_specifier_nonarray,eG.array_specifier]],eo.TypeSpecifier.pool),eU.createProductionWithOptions(eG.type_qualifier,[[eG.single_type_qualifier],[eG.type_qualifier,eG.single_type_qualifier]],eo.TypeQualifier.pool),eU.createProductionWithOptions(eG.single_type_qualifier,[[eG.storage_qualifier],[eG.precision_qualifier],[eG.interpolation_qualifier],[eG.invariant_qualifier],[el.PRECISE]],eo.SingleTypeQualifier.pool),eU.createProductionWithOptions(eG.storage_qualifier,[[el.CONST],[el.IN],[el.INOUT],[el.OUT],[el.CENTROID]]),eU.createProductionWithOptions(eG.interpolation_qualifier,[[el.SMOOTH],[el.FLAT]]),eU.createProductionWithOptions(eG.invariant_qualifier,[[el.INVARIANT]]),eU.createProductionWithOptions(eG.precision_qualifier,[[el.HIGHP],[el.MEDIUMP],[el.LOWP]]),eU.createProductionWithOptions(eG.struct_specifier,[[el.STRUCT,ep.ID,ep.LEFT_BRACE,eG.struct_declaration_list,ep.RIGHT_BRACE,ep.SEMICOLON],[el.STRUCT,ep.LEFT_BRACE,eG.struct_declaration_list,ep.RIGHT_BRACE,ep.SEMICOLON]],eo.StructSpecifier.pool),eU.createProductionWithOptions(eG.struct_declaration_list,[[eG.struct_declaration],[eG.struct_declaration_list,eG.struct_declaration]],eo.StructDeclarationList.pool),eU.createProductionWithOptions(eG.struct_declaration,[[eG.type_specifier,eG.struct_declarator_list,ep.SEMICOLON],[eG.type_qualifier,eG.type_specifier,eG.struct_declarator_list,ep.SEMICOLON]],eo.StructDeclaration.pool),eU.createProductionWithOptions(eG.struct_declarator_list,[[eG.struct_declarator],[eG.struct_declarator_list,ep.COMMA,eG.struct_declarator]],eo.StructDeclaratorList.pool),eU.createProductionWithOptions(eG.struct_declarator,[[ep.ID],[ep.ID,eG.array_specifier]],eo.StructDeclarator.pool),eU.createProductionWithOptions(eG.array_specifier,[[ep.LEFT_BRACKET,ep.RIGHT_BRACKET],[ep.LEFT_BRACKET,eG.integer_constant_expression,ep.RIGHT_BRACKET]],eo.ArraySpecifier.pool),eU.createProductionWithOptions(eG.integer_constant_expression_operator,[[ep.PLUS],[ep.DASH],[ep.STAR],[ep.SLASH],[ep.PERCENT]],eo.IntegerConstantExpressionOperator.pool),eU.createProductionWithOptions(eG.integer_constant_expression,[[eG.variable_identifier],[ep.INT_CONSTANT],[eG.integer_constant_expression,eG.integer_constant_expression_operator,ep.INT_CONSTANT],[eG.integer_constant_expression,eG.integer_constant_expression_operator,eG.variable_identifier]],eo.IntegerConstantExpression.pool),eU.createProductionWithOptions(eG.conditional_expression,[[eG.logical_or_expression],[eG.logical_or_expression,ep.QUESTION,eG.expression,ep.COLON,eG.assignment_expression]]),eU.createProductionWithOptions(eG.logical_or_expression,[[eG.logical_xor_expression],[eG.logical_or_expression,ep.OR_OP,eG.logical_xor_expression]]),eU.createProductionWithOptions(eG.logical_xor_expression,[[eG.logical_and_expression],[eG.logical_xor_expression,ep.XOR_OP,eG.logical_and_expression]]),eU.createProductionWithOptions(eG.logical_and_expression,[[eG.inclusive_or_expression],[eG.logical_and_expression,ep.AND_OP,eG.inclusive_or_expression]]),eU.createProductionWithOptions(eG.inclusive_or_expression,[[eG.exclusive_or_expression],[eG.inclusive_or_expression,ep.VERTICAL_BAR,eG.exclusive_or_expression]]),eU.createProductionWithOptions(eG.exclusive_or_expression,[[eG.and_expression],[eG.exclusive_or_expression,ep.CARET,eG.and_expression]]),eU.createProductionWithOptions(eG.and_expression,[[eG.equality_expression],[eG.and_expression,ep.AMPERSAND,eG.equality_expression]]),eU.createProductionWithOptions(eG.equality_expression,[[eG.relational_expression],[eG.equality_expression,ep.EQ_OP,eG.relational_expression],[eG.equality_expression,ep.NE_OP,eG.relational_expression]]),eU.createProductionWithOptions(eG.relational_expression,[[eG.shift_expression],[eG.relational_expression,ep.LEFT_ANGLE,eG.shift_expression],[eG.relational_expression,ep.RIGHT_ANGLE,eG.shift_expression],[eG.relational_expression,ep.LE_OP,eG.shift_expression],[eG.relational_expression,ep.GE_OP,eG.shift_expression]]),eU.createProductionWithOptions(eG.shift_expression,[[eG.additive_expression],[eG.shift_expression,ep.LEFT_OP,eG.additive_expression],[eG.shift_expression,ep.RIGHT_OP,eG.additive_expression]]),eU.createProductionWithOptions(eG.additive_expression,[[eG.multiplicative_expression],[eG.additive_expression,ep.PLUS,eG.multiplicative_expression],[eG.additive_expression,ep.DASH,eG.multiplicative_expression]]),eU.createProductionWithOptions(eG.multiplicative_expression,[[eG.unary_expression],[eG.multiplicative_expression,ep.STAR,eG.unary_expression],[eG.multiplicative_expression,ep.SLASH,eG.unary_expression],[eG.multiplicative_expression,ep.PERCENT,eG.unary_expression]]),eU.createProductionWithOptions(eG.unary_expression,[[eG.postfix_expression],[ep.INC_OP,eG.unary_expression],[ep.DEC_OP,eG.unary_expression],[eG.unary_operator,eG.unary_expression]]),eU.createProductionWithOptions(eG.unary_operator,[[ep.PLUS],[ep.DASH],[ep.BANG],[ep.TILDE]]),eU.createProductionWithOptions(eG.postfix_expression,[[eG.primary_expression],[eG.postfix_expression,ep.LEFT_BRACKET,eG.expression,ep.RIGHT_BRACKET],[eG.function_call],[eG.postfix_expression,ep.DOT,ep.ID],[eG.postfix_expression,ep.DOT,eG.function_call],[eG.postfix_expression,ep.INC_OP],[eG.postfix_expression,ep.DEC_OP]],eo.PostfixExpression.pool),eU.createProductionWithOptions(eG.primary_expression,[[eG.variable_identifier],[ep.INT_CONSTANT],[ep.FLOAT_CONSTANT],[el.TRUE],[el.FALSE],[ep.LEFT_PAREN,eG.expression,ep.RIGHT_PAREN]],eo.PrimaryExpression.pool),eU.createProductionWithOptions(eG.expression,[[eG.assignment_expression],[eG.expression,ep.COMMA,eG.assignment_expression]],eo.Expression.pool),eU.createProductionWithOptions(eG.assignment_expression,[[eG.conditional_expression],[eG.unary_expression,eG.assignment_operator,eG.assignment_expression]],eo.AssignmentExpression.pool),eU.createProductionWithOptions(eG.assignment_operator,[[ep.EQUAL],[ep.MUL_ASSIGN],[ep.DIV_ASSIGN],[ep.MOD_ASSIGN],[ep.ADD_ASSIGN],[ep.SUB_ASSIGN],[ep.LEFT_ASSIGN],[ep.RIGHT_ASSIGN],[ep.AND_ASSIGN],[ep.XOR_ASSIGN],[ep.OR_ASSIGN]]),eU.createProductionWithOptions(eG.function_call,[[eG.function_call_generic]],eo.FunctionCall.pool),eU.createProductionWithOptions(eG.function_call_generic,[[eG.function_identifier,ep.LEFT_PAREN,eG.function_call_parameter_list,ep.RIGHT_PAREN],[eG.function_identifier,ep.LEFT_PAREN,ep.RIGHT_PAREN],[eG.function_identifier,el.VOID,ep.RIGHT_PAREN]],eo.FunctionCallGeneric.pool),eU.createProductionWithOptions(eG.function_call_parameter_list,[[eG.assignment_expression],[eG.function_call_parameter_list,ep.COMMA,eG.assignment_expression]],eo.FunctionCallParameterList.pool),eU.createProductionWithOptions(eG.function_identifier,[[eG.type_specifier]],eo.FunctionIdentifier.pool),eU.createProductionWithOptions(eG.function_definition,[[eG.function_prototype,eG.compound_statement_no_scope]],eo.FunctionDefinition.pool),eU.createProductionWithOptions(eG.function_prototype,[[eG.function_declarator,ep.RIGHT_PAREN]],eo.FunctionProtoType.pool),eU.createProductionWithOptions(eG.function_declarator,[[eG.function_header],[eG.function_header,eG.function_parameter_list]],eo.FunctionDeclarator.pool),eU.createProductionWithOptions(eG.function_header,[[eG.fully_specified_type,ep.ID,ep.LEFT_PAREN]],eo.FunctionHeader.pool),eU.createProductionWithOptions(eG.function_parameter_list,[[eG.parameter_declaration],[eG.function_parameter_list,ep.COMMA,eG.parameter_declaration]],eo.FunctionParameterList.pool),eU.createProductionWithOptions(eG.parameter_declaration,[[eG.type_qualifier,eG.parameter_declarator],[eG.parameter_declarator]],eo.ParameterDeclaration.pool),eU.createProductionWithOptions(eG.parameter_declarator,[[eG.type_specifier,ep.ID],[eG.type_specifier,ep.ID,eG.array_specifier]],eo.ParameterDeclarator.pool),eU.createProductionWithOptions(eG.statement_list,[[eG.statement],[eG.statement_list,eG.statement]],eo.StatementList.pool),eU.createProductionWithOptions(eG.statement,[[eG.compound_statement],[eG.simple_statement]]),eU.createProductionWithOptions(eG.compound_statement_no_scope,[[ep.LEFT_BRACE,ep.RIGHT_BRACE],[ep.LEFT_BRACE,eG.statement_list,ep.RIGHT_BRACE]],eo.CompoundStatementNoScope.pool),eU.createProductionWithOptions(eG.compound_statement,[[ep.LEFT_BRACE,ep.RIGHT_BRACE],[eG.scope_brace,eG.statement_list,eG.scope_end_brace]]),eU.createProductionWithOptions(eG.simple_statement,[[eG.declaration],[eG.expression_statement],[eG.selection_statement],[eG.iteration_statement],[eG.jump_statement]]),eU.createProductionWithOptions(eG.declaration,[[eG.function_prototype,ep.SEMICOLON],[eG.init_declarator_list,ep.SEMICOLON],[el.PRECISION,eG.precision_qualifier,eG.ext_builtin_type_specifier_nonarray,ep.SEMICOLON],[eG.type_qualifier,ep.ID,ep.SEMICOLON],[eG.type_qualifier,ep.ID,eG.identifier_list,ep.SEMICOLON]],eo.Declaration.pool),eU.createProductionWithOptions(eG.identifier_list,[[ep.COMMA,ep.ID],[eG.identifier_list,ep.COMMA,ep.ID]],eo.IdentifierList.pool),eU.createProductionWithOptions(eG.init_declarator_list,[[eG.single_declaration],[eG.init_declarator_list,ep.COMMA,ep.ID],[eG.init_declarator_list,ep.COMMA,ep.ID,eG.array_specifier],[eG.init_declarator_list,ep.COMMA,ep.ID,eG.array_specifier,ep.EQUAL,eG.initializer],[eG.init_declarator_list,ep.COMMA,ep.ID,ep.EQUAL,eG.initializer]],eo.InitDeclaratorList.pool),eU.createProductionWithOptions(eG.single_declaration,[[eG.fully_specified_type,ep.ID],[eG.fully_specified_type,ep.ID,eG.array_specifier],[eG.fully_specified_type,ep.ID,eG.array_specifier,ep.EQUAL,eG.initializer],[eG.fully_specified_type,ep.ID,ep.EQUAL,eG.initializer]],eo.SingleDeclaration.pool),eU.createProductionWithOptions(eG.initializer,[[eG.assignment_expression],[ep.LEFT_BRACE,eG.initializer_list,ep.RIGHT_BRACE]]),eU.createProductionWithOptions(eG.initializer_list,[[eG.initializer],[eG.initializer_list,ep.COMMA,eG.initializer]]),eU.createProductionWithOptions(eG.expression_statement,[[ep.SEMICOLON],[eG.expression,ep.SEMICOLON]]),eU.createProductionWithOptions(eG.selection_statement,[[el.IF,ep.LEFT_PAREN,eG.expression,ep.RIGHT_PAREN,eG.statement],[el.IF,ep.LEFT_PAREN,eG.expression,ep.RIGHT_PAREN,eG.statement,el.ELSE,eG.statement]]),eU.createProductionWithOptions(eG.iteration_statement,[[el.WHILE,ep.LEFT_PAREN,eG.condition,ep.RIGHT_PAREN,eG.statement],[el.FOR,ep.LEFT_PAREN,eG.for_init_statement,eG.for_rest_statement,ep.RIGHT_PAREN,eG.statement]]),eU.createProductionWithOptions(eG.precision_specifier,[[el.PRECISION,eG.precision_qualifier,eG.ext_builtin_type_specifier_nonarray,ep.SEMICOLON]],eo.PrecisionSpecifier.pool),eU.createProductionWithOptions(eG.for_init_statement,[[eG.expression_statement],[eG.declaration]]),eU.createProductionWithOptions(eG.condition,[[eG.expression],[eG.fully_specified_type,ep.ID,ep.EQUAL,eG.initializer]]),eU.createProductionWithOptions(eG.for_rest_statement,[[eG.conditionopt,ep.SEMICOLON],[eG.conditionopt,ep.SEMICOLON,eG.expression]]),eU.createProductionWithOptions(eG.conditionopt,[[ep.EPSILON],[eG.condition]]),eU.createProductionWithOptions(eG.jump_statement,[[el.CONTINUE,ep.SEMICOLON],[el.BREAK,ep.SEMICOLON],[el.RETURN,ep.SEMICOLON],[el.RETURN,eG.expression,ep.SEMICOLON],[el.DISCARD,ep.SEMICOLON]],eo.JumpStatement.pool),eU.createProductionWithOptions(eG.scope_brace,[[ep.LEFT_BRACE]],eo.ScopeBrace.pool),eU.createProductionWithOptions(eG.scope_end_brace,[[ep.RIGHT_BRACE]],eo.ScopeEndBrace.pool),eU.createProductionWithOptions(eG.variable_identifier,[[ep.ID]],eo.VariableIdentifier.pool)),eW=function(e){for(var t=0;t<eV.length;t++){var n=eV[t][1];n&&e.addTranslationRule(t,n)}},ej=/*#__PURE__*/function(){function e(t,n,i){this._needReInfer=!0,this.production=t,this.position=n,this.lookaheadSet=new Set;for(var a,o=r(i);!(a=o()).done;){var s=a.value;this.lookaheadSet.add(s)}this.id=e._id++}var t=e.prototype;return t.addLookahead=function(e){for(var t,n=r(e);!(t=n()).done;){var i=t.value;this.lookaheadSet.has(i)||(this.lookaheadSet.add(i),this.needReInfer=!0)}},t.symbolByOffset=function(e){return this.production.derivation[this.position+e]},t.canReduce=function(){if(this.position>this.production.derivation.length-1)return!0;for(var e=this.position;e<this.production.derivation.length;e++)if(this.production.derivation[e]!==ep.EPSILON)return!1;return!0},t.advance=function(){return new e(this.production,this.position+1,this.lookaheadSet)},ey(e,[{key:"needReInfer",get:function(){return this._needReInfer},set:function(e){this._needReInfer=e}},{key:"curSymbol",get:function(){return this.production.derivation[this.position]}},{key:"nextSymbol",get:function(){return this.production.derivation[this.position+1]}}]),e}();ej._id=0;var eH=/*#__PURE__*/function(){function e(t){this.closured=!1,this._stateItemPool=new Map,this.id=e._id++,this._items=new Set([].concat(t)),this.cores=new Set([].concat(t));for(var n,i=r(t);!(n=i()).done;){var a=n.value,o=this.getStateItemMapKey(a.production,a.position);this._stateItemPool.set(o,a)}e.pool.set(this.id,this)}var t=e.prototype;return t.getStateItemMapKey=function(e,t){return e.id+","+t},t.createStateItem=function(e,t,n){void 0===n&&(n=new Set);var i=this.getStateItemMapKey(e,t),a=this._stateItemPool.get(i);if(a){for(var o,s=r(n);!(o=s()).done;){var c=o.value;a.lookaheadSet.has(c)||(a.lookaheadSet.add(c),a.needReInfer=!0)}return a}var l=new ej(e,t,n);return this._stateItemPool.set(i,l),l},e.create=function(t){var n=this.getMapKey(t),i=this.closureMap.get(n);if(i){for(var a,o=r(t);!(a=o()).done;){var s=a.value;i.createStateItem(s.production,s.position,s.lookaheadSet)}return i}var c=new e(t);return this.closureMap.set(n,c),c},e.getMapKey=function(e){return e.map(function(e){return e.production.id+","+e.position}).join(";")},ey(e,[{key:"items",get:function(){return this._items}},{key:"needReInfer",get:function(){for(var e,t=r(this.cores);!(e=t()).done;)if(e.value.needReInfer)return!0;return!1}}]),e}();eH.closureMap=new Map,eH.pool=new Map,eH._id=0;var eq=/*#__PURE__*/function(){function e(e){this.firstSetMap=new Map,this.followSetMap=new Map,this.actionTable=new Map,this.gotoTable=new Map,this._firstSetNTStack=[],this.grammar=e}var t=e.prototype;return t.generate=function(){this.computeFirstSet(),this.buildStateTable()},t.buildStateTable=function(){var e=[new ej(this.grammar.productions[0],0,[ep.EOF])],t=eH.create(e);this._extendState(t)},t._extendState=function(e){if(e.needReInfer){this._closure(e);for(var t,n=this._inferNextState(e),i=r(n);!(t=i()).done;){var a=t.value;this._extendState(a)}}},t._closure=function(e){for(var t,n=r(e.cores);!(t=n()).done;){var i=t.value;i.canReduce()||this._extendStateItem(e,i)}return e.closured=!0,e},t._extendStateItem=function(e,t){if(!eU.isTerminal(t.curSymbol)){var n=this.grammar.getProductionList(t.curSymbol);if(t.nextSymbol){for(var i=new Set,a=!1,o=1,s=t.symbolByOffset(1);s;s=t.symbolByOffset(++o)){if(eU.isTerminal(s)){i.add(s),a=!0;break}c=this.firstSetMap.get(s);for(var c,l,u=r(c);!(l=u()).done;){var p=l.value;i.add(p)}if(!c.has(ep.EPSILON))break}if(!a&&(null==c?void 0:c.has(ep.EPSILON)))for(var h,d=r(t.lookaheadSet);!(h=d()).done;){var f=h.value;i.add(f)}for(var _,S=r(n);!(_=S()).done;){var g=_.value,y=e.createStateItem(g,0);e.items.has(y)&&eU.isSubSet(i,y.lookaheadSet)||(e.items.add(y),y.addLookahead(i),this._extendStateItem(e,y))}}else for(var v,m=r(n);!(v=m()).done;){var x=v.value,E=e.createStateItem(x,0);e.items.has(E)&&eU.isSubSet(t.lookaheadSet,E.lookaheadSet)||(e.items.add(E),E.addLookahead(t.lookaheadSet),this._extendStateItem(e,E))}}},t._inferNextState=function(e){var t=new Map,n=null!=(a=this.actionTable.get(e.id))?a:new Map,i=null!=(o=this.gotoTable.get(e.id))?o:new Map;this.actionTable.set(e.id,n),this.gotoTable.set(e.id,i);for(var a,o,s,c=r(e.items);!(s=c()).done;){var l=s.value;if(l.canReduce()){var u=void 0;u=l.production.goal!==eG.START?{action:eE.Reduce,target:l.production.id}:{action:eE.Accept};for(var p,h=r(l.lookaheadSet);!(p=h()).done;){var d=p.value;this._addAction(n,d,u)}}else{var f=l.advance();eU.addMapSetItem(t,l.curSymbol,f)}l.needReInfer=!1}for(var _,S=new Set,g=r(t.entries());!(_=g()).done;){var y=_.value,v=y[0],m=y[1],x=eH.create(Array.from(m));eU.isTerminal(v)?this._addAction(n,v,{action:eE.Shift,target:x.id}):i.set(v,x.id),S.add(x)}return S},t._addAction=function(e,t,n){var r=e.get(t);(!r||eU.isActionEqual(r,n)||t!==el.ELSE||r.action!==eE.Shift||n.action!==eE.Reduce)&&e.set(t,n)},t.computeFirstSet=function(){for(var e,t=r(this.grammar.productions.slice(1));!(e=t()).done;){var n=e.value;this._computeFirstSetForNT(n.goal)}},t._computeFirstSetForNT=function(e){var t=this._firstSetNTStack.findIndex(function(t){return t===e});if(-1!==t){for(var n=this.firstSetMap.get(e),i=this._firstSetNTStack.length,a=i-1;a>t;a--){var o=this._firstSetNTStack[a];this.firstSetMap.set(o,n)}return n}this._firstSetNTStack.push(e);var s=this.grammar.getProductionList(e),c=new Set;this.firstSetMap.set(e,c),this.grammar.isNullableNT(e)&&c.add(ep.EPSILON);for(var l,u=r(s);!(l=u()).done;){for(var p=l.value,h=0;h<p.derivation.length;h++){var d=p.derivation[h];if(eU.isTerminal(d)){c.add(d);break}for(var f,_=this._computeFirstSetForNT(d),S=r(_);!(f=S()).done;){var g=f.value;g!==ep.EPSILON&&c.add(g)}if(!this.grammar.isNullableNT(d))break}h===p.derivation.length&&c.add(ep.EPSILON)}return this._firstSetNTStack.pop(),c},e}(),ez=/*#__PURE__*/function(){function e(e,t,n){this._traceBackStack=[],this.actionTable=e,this.gotoTable=t,this.grammar=n,this.sematicAnalyzer=new eN}return e.prototype.parse=function(e){this.sematicAnalyzer.reset();var n=performance.now(),r=this._traceBackStack,i=this.sematicAnalyzer;r.push(0);for(var a=e.next(),o=0;;){o+=1;var s=a.value,c=this.stateActionTable.get(s.type);if((null==c?void 0:c.action)===eE.Shift)r.push(s,c.target),a=e.next();else{if((null==c?void 0:c.action)===eE.Accept)return t.Logger.info("[pass compilation - parser] Accept! State automata run "+o+" times! cost time "+(performance.now()-n)+"ms"),null==i.acceptRule||i.acceptRule.call(i,i),i.semanticStack.pop();if((null==c?void 0:c.action)!==eE.Reduce)return ed.createGSError("Unexpected token "+s.lexeme,ev.CompilationError,tl._processingPassText,s.location),null;for(var l=c.target,u=this.grammar.getProductionByID(l),p=i.getTranslationRule(u.id),h=[],d=u.derivation.length-1;d>=0;d--)if(u.derivation[d]!==ep.EPSILON){r.pop();var f=r.pop();if(eh(f,ef))h.unshift(f);else{var _=i.semanticStack.pop();h.unshift(_)}}null==p||p.apply(void 0,[].concat([i],h));var S=this.stateGotoTable;r.push(u.goal);var g=null==S?void 0:S.get(u.goal);r.push(g);continue}}},e.create=function(){if(!this._singleton){var t=eD.create(eG.gs_shader_program,eV.map(function(e){return e[0]})),n=new eq(t);n.generate(),this._singleton=new e(n.actionTable,n.gotoTable,t),eW(this._singleton.sematicAnalyzer)}return this._singleton},ey(e,[{key:"curState",get:function(){return this._traceBackStack[this._traceBackStack.length-1]}},{key:"stateActionTable",get:function(){return this.actionTable.get(this.curState)}},{key:"stateGotoTable",get:function(){return this.gotoTable.get(this.curState)}}]),e}();function eQ(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}var eX=/*#__PURE__*/function(){function e(e,t,n,r){this.macro=e,this.body=t,this.location=n,this.args=r,r&&(this._argsLexemes=this.args.map(function(e){return e.lexeme}),this._replaceRegex=RegExp("\\b("+this._argsLexemes.join("|")+")\\b","g"))}return e.prototype.expandFunctionBody=function(e){var t,n=this;if(e.length!==(null==(t=this.args)?void 0:t.length))throw ed.createGSError("mismatched function macro",GSErrorName.PreprocessorError,"",this.location);return this.body.lexeme.replace(this._replaceRegex,function(t){return e[n._argsLexemes.indexOf(t)]})},ey(e,[{key:"isFunction",get:function(){var e;return!!(null==(e=this.args)?void 0:e.length)}}]),e}(),eK=((er={})[er.id=0]="id",er[er.line_remain=1]="line_remain",er[er.chunk=2]="chunk",er[er.int_constant=3]="int_constant",er[er.string_const=4]="string_const",er[er.right_op=5]="right_op",er[er.left_op=6]="left_op",er[er.left_paren=7]="left_paren",er[er.right_paren=8]="right_paren",er[er.ge=9]="ge",er[er.le=10]="le",er[er.eq=11]="eq",er[er.neq=12]="neq",er[er.and=13]="and",er[er.or=14]="or",er[er.left_angle=15]="left_angle",er[er.right_angle=16]="right_angle",er[er.star=17]="star",er[er.plus=18]="plus",er[er.dash=19]="dash",er[er.bang=20]="bang",er[er.slash=21]="slash",er[er.percent=22]="percent",er[er.EOF=100]="EOF",er),eY=((ei={})[ei.define=101]="define",ei[ei.undef=102]="undef",ei[ei.if=103]="if",ei[ei.ifdef=104]="ifdef",ei[ei.ifndef=105]="ifndef",ei[ei.else=106]="else",ei[ei.elif=107]="elif",ei[ei.endif=108]="endif",ei[ei.include=109]="include",ei[ei.defined=110]="defined",ei),eJ=new Map([["#define",101],["#undef",102],["#if",103],["#ifdef",104],["#ifndef",105],["#else",106],["#elif",107],["#endif",108],["#include",109],["defined",110]]),eZ=/*#__PURE__*/function(){function e(){}return e.expand=function(e,t){for(var n,i=[],a=0,o=0,s=r(e);!(n=s()).done;){var c=n.value,l=t.slice(a,c.rangeInBlock.start.index);i.push(l,c.replace);var u=o+l.length+c.replace.length;a=c.rangeInBlock.end.index,o=u}return i.push(t.slice(a)),i.join("")},e.assembleSegments=function(e,t){for(var n,i=[],a=0,o=r(e);!(n=o()).done;){var s=n.value,c=t.slice(a,s.range.start.index);i.push(c,s.replace),a=s.range.end.index}return i.push(t.slice(a)),i.join("")},e}(),e$=/*#__PURE__*/function(e){function t(t){var n;return(n=e.call(this,t)||this).macroLvl=0,n}a(t,e);var n=t.prototype;return n.scanDirective=function(e){var t=this._advanceToDirective(e);return[eY.if,eY.ifdef,eY.ifndef].includes(null==t?void 0:t.type)?this.macroLvl+=1:(null==t?void 0:t.type)===eY.endif&&(this.macroLvl-=1),t},n.scanWordsUntilChar=function(e){for(var t=[];;)if(this.skipSpace(!0),eS.isLetter(this.getCurChar()))t.push(this.scanWord());else{if(this.getCurChar()===e)return this.advance(),t;this.advance()}},n.scanWord=function(e){if(void 0===e&&(e=!1),e)for(;!eS.isLetter(this.getCurChar())&&!this.isEnd();)this.advance();else this.skipSpace(!0);if(this.isEnd())return e_;for(var t=this._currentIndex;eS.isLetter(this.getCurChar())&&!this.isEnd();)this.advance();var n=this._currentIndex,r=this._source.slice(t,n);n===t&&this.throwError(this.getShaderPosition(),"no word found.");var i=eJ.get(r);if(i){var a=ef.pool.get();return a.set(i,r,this.getShaderPosition()),a}var o=ef.pool.get();return o.set(eK.id,r,this.getShaderPosition(r.length)),o},n.getShaderPosition=function(e){return void 0===e&&(e=0),tl.createPosition(this._currentIndex-e)},n.scanToken=function(e){if(this.skipSpace(!0),this._skipComments(),!this.isEnd()){for(var n=this._currentIndex;t._splitCharacters.test(this.getCurChar())&&!this.isEnd();)this._advance();if(n===this._currentIndex)return this._advance(),this.scanToken(e);var r=this._source.slice(n,this._currentIndex),i=ef.pool.get();return i.set(eJ.has(r)?eJ.get(r):eK.id,r,this.getShaderPosition(this._currentIndex-n)),null==e||e(i,this),i}},n.scanQuotedString=function(){this.skipSpace(!0),'"'!==this.getCurChar()&&this.throwError(this.getShaderPosition(),"unexpected char, expected '\"'");var e=this.getShaderPosition();this._advance();for(var t=this._currentIndex;'"'!==this.getCurChar()&&!this.isEnd();)this._advance();this.isEnd()&&this.throwError(this.getShaderPosition(),"unexpected char, expected '\"'");var n=this._source.slice(t,this._currentIndex),r=ef.pool.get();return r.set(eK.string_const,n,e),r},n.scanToChar=function(e){for(var t=this._source;t[this._currentIndex]!==e&&!this.isEnd();)this.advance()},n.scanMacroBranchChunk=function(){for(var e=this._currentIndex,t=this.getShaderPosition(),n=this.macroLvl,r=this.scanDirective();(r.type!==eY.endif||n-1!==this.macroLvl)&&(![eY.elif,eY.else].includes(r.type)||n!==this.macroLvl);)r=this.scanDirective();var i=this._source.slice(e,this._currentIndex-r.lexeme.length-1),a=ef.pool.get();return a.set(eK.chunk,i,t),{token:a,nextDirective:r}},n.scanPairedBlock=function(e,t){this.scanToChar(e);var n=0,r=this._source;do{var i=r[this._currentIndex];i===e?n++:i===t&&n--,this._advance()}while(n>0)},n.scanRemainMacro=function(){for(var e=this.macroLvl,t=this.scanDirective();!this.isEnd()&&(t.type!==eY.endif||e-1!==this.macroLvl);)t=this.scanDirective();return this.getShaderPosition()},n.peekNonSpace=function(){for(var e=this._currentIndex;/\s/.test(this._source[e]);)e+=1;return this._source[e]},n.scanInteger=function(){for(var e=this._currentIndex;eS.isNum(this.getCurChar());)this.advance();this._currentIndex===e&&this.throwError(this.getShaderPosition(),"no integer found");var t=this._source.slice(e,this._currentIndex),n=ef.pool.get();return n.set(eK.int_constant,t,this.getShaderPosition()),n},n.scanLineRemain=function(){this.skipSpace(!1);for(var e=this._currentIndex,t=[];"\n"!==this.getCurChar();){if(this.isEnd()){var n=this._source.slice(e,this._currentIndex),r=ef.pool.get();return r.set(eK.line_remain,n,this.getShaderPosition(n.length)),r}this.advance();var i=this._skipComments();i&&(i.start.index-=e,i.end.index-=e,t.push(i))}var a=this._source.slice(e,this._currentIndex);t.length&&(a=eZ.assembleSegments(t.map(function(e){return{range:e,replace:""}}),a));var o=ef.pool.get();return o.set(eK.line_remain,a,this.getShaderPosition(a.length)),o},n._advanceToDirective=function(e){for(;;){var t=this.scanToken(e);if(null==t?void 0:t.lexeme.startsWith("#"))return t;if(this.isEnd())return}},n._skipComments=function(){if("//"===this.peek(2)){for(var e=this.getShaderPosition();"\n"!==this.getCurChar()&&!this.isEnd();)this._advance();return tl.createRange(e,this.getCurPosition())}if("/*"===this.peek(2)){var t=this.getShaderPosition();for(this.advance(2);"*/"!==this.peek(2)&&!this.isEnd();)this._advance();return this.advance(2),tl.createRange(t,this.getShaderPosition())}},t}(em);e$._splitCharacters=/[\w#.]/;var e0=/*#__PURE__*/function(){function e(){}return e.reset=function(e,t){this._definedMacros.clear(),this._expandSegmentsStack.length=0,this._expandSegmentsStack.push([]),this._branchMacros.clear(),this.addPredefinedMacro("GL_ES"),this._includeMap=e,this._basePathForIncludeKey=t},e.addPredefinedMacro=function(e,t){var n,r=ef.pool.get();r.set(eK.id,e),t&&(n=ef.pool.get()).set(eK.id,t),this._definedMacros.set(e,new eX(r,n))},e.parse=function(e){for(;!e.isEnd();){var t=e.scanDirective(this._onToken.bind(this));if(e.isEnd())break;switch(t.type){case eY.define:this._parseDefine(e);break;case eY.undef:this._parseUndef(e);break;case eY.if:this._parseIf(e);break;case eY.ifndef:this._parseIfNdef(e);break;case eY.ifdef:this._parseIfDef(e);break;case eY.include:this._parseInclude(e)}}return eZ.expand(this.expandSegments,e.source,e.sourceMap)},e.reportError=function(e,t,n,r){ed.createGSError(t,ev.PreprocessorError,n,e,r)},e._parseInclude=function(e){var n,r=e.getShaderPosition(8);e.skipSpace(!0);var i=e.scanQuotedString();n="."!==i.lexeme[0]?i.lexeme:new URL(i.lexeme,this._basePathForIncludeKey).href.substring(t.ShaderPass._shaderRootPath.length),e.scanToChar("\n");var a=e.getShaderPosition(),o=this._includeMap[n];if(!o){this.reportError(i.location,'Shader slice "'+n+'" not founded.',e.source,e.file);return}var s=tl.createRange(r,a),c=this._expandMacroChunk(o,s,i.lexeme);this.expandSegments.push({rangeInBlock:s,replace:c.content})},e._parseIfDef=function(e){var t=e.current-6,n=e.scanWord();this._addEmptyReplace(e,t),this._branchMacros.add(n.lexeme);var r=this._definedMacros.get(n.lexeme);e.skipSpace(!0);var i=e.scanMacroBranchChunk(),a=i.token,o=i.nextDirective;if(r){var s=o.type===eY.endif?e.getShaderPosition():e.scanRemainMacro(),c=this._expandMacroChunk(a.lexeme,a.location,e),l=tl.createRange(a.location.start,s);this.expandSegments.push({rangeInBlock:l,replace:c.content});return}this.expandSegments.pop(),this._addEmptyReplace(e,t),this._parseMacroBranch(o.type,e)},e._parseMacroBranch=function(e,t){if(e!==eY.endif){var n=t.current;if(e===eY.else){var r=t.scanMacroBranchChunk().token,i=this._expandMacroChunk(r.lexeme,r.location,t),a=tl.createPosition(n),o=tl.createRange(a,t.getShaderPosition());this.expandSegments.push({rangeInBlock:o,replace:i.content})}else if(e===eY.elif){var s=this._parseConstantExpression(t),c=t.scanMacroBranchChunk(),l=c.token,u=c.nextDirective;if(s){var p=u.type===eY.endif?t.current:t.scanRemainMacro().index,h=this._expandMacroChunk(l.lexeme,l.location,t),d=tl.createPosition(n),f=tl.createPosition(p),_=tl.createRange(d,f);this.expandSegments.push({rangeInBlock:_,replace:h.content})}else{var S=tl.createPosition(n),g=tl.createPosition(t.current),y=tl.createRange(S,g);this.expandSegments.push({rangeInBlock:y,replace:""}),this._parseMacroBranch(u.type,t)}}}},e._parseConstantExpression=function(e){return e.skipSpace(!0),this._parseLogicalOrExpression(e)},e._parseLogicalOrExpression=function(e){var t=this._parseLogicalAndExpression(e),n=e.peek(2);if(n&&"||"===n){e.advance(2),e.skipSpace(!1);var r=this._parseLogicalOrExpression(e);return t||r}return t},e._parseLogicalAndExpression=function(e){var t=this._parseEqualityExpression(e),n=e.peek(2);if(n&&"&&"===n){e.advance(2),e.skipSpace(!1);var r=this._parseLogicalAndExpression(e);return t&&r}return t},e._parseEqualityExpression=function(e){var t=this._parseRelationalExpression(e),n=e.peek(2);if(n&&["==","!="].includes(n)){e.advance(2),e.skipSpace(!1);var r=this._parseEqualityExpression(e);switch(n){case"==":return t===r;case"!=":return t!==r}}return t},e._parseRelationalExpression=function(e){var t=this._parseShiftExpression(e),n=e.peek(2);if("="!==n[1]&&(n=n[0]),n&&[">","<",">=","<="].includes(n)){var r=e.getShaderPosition();e.advance(n.length),e.skipSpace(!1);var i=this._parseRelationalExpression(e);if((void 0===t?"undefined":eQ(t))!==(void 0===i?"undefined":eQ(i))&&"number"!=typeof t){this.reportError(r,"invalid operator in relation expression.",e.source,e.file);return}switch(n){case">":return t>i;case"<":return t<i;case">=":return t>=i;case"<=":return t<=i}}return t},e._parseShiftExpression=function(e){var t=this._parseAdditiveExpression(e),n=e.peek(2);if(n&&[">>","<<"].includes(n)){var r=e.getShaderPosition();e.advance(2),e.skipSpace(!1);var i=this._parseShiftExpression(e);if((void 0===t?"undefined":eQ(t))!==(void 0===i?"undefined":eQ(i))&&"number"!=typeof t){this.reportError(r,"invalid operator in shift expression.",e.source,e.file);return}switch(n){case">>":return t>>i;case"<<":return t<<i}}return t},e._parseAdditiveExpression=function(e){var t=this._parseMulticativeExpression(e);if([">","<"].includes(e.getCurChar())){var n=e.getShaderPosition();e.advance();var r=e.getCurChar();e.skipSpace(!1);var i=this._parseAdditiveExpression(e);if((void 0===t?"undefined":eQ(t))!==(void 0===i?"undefined":eQ(i))&&"number"!=typeof t)return this.reportError(n,"invalid operator.",e.source,e.file),!1;switch(r){case"+":return t+i;case"-":return t-i}}return t},e._parseMulticativeExpression=function(e){var t=this._parseUnaryExpression(e);if(e.skipSpace(!1),["*","/","%"].includes(e.getCurChar())){var n=e.getShaderPosition(),r=e.getCurChar();e.skipSpace(!1);var i=this._parseMulticativeExpression(e);if((void 0===t?"undefined":eQ(t))!==(void 0===i?"undefined":eQ(i))&&"number"!=typeof t){this.reportError(n,"invalid operator.",e.source,e.file);return}switch(r){case"*":return t*i;case"/":return t/i;case"%":return t%i}}return t},e._parseUnaryExpression=function(e){var t=e.getCurChar();if(["+","-","!"].includes(t)){e.advance();var n=e.getShaderPosition(),r=this._parseParenthesisExpression(e);switch(("!"===t&&"boolean"!=typeof r||"!"!==t&&"number"!=typeof r)&&this.reportError(n,"invalid operator.",e.source,e.file),t){case"+":return r;case"-":return-r;case"!":return!r}}return this._parseParenthesisExpression(e)},e._parseParenthesisExpression=function(e){if("("===e.getCurChar()){e.advance(),e.skipSpace(!1);var t=this._parseConstantExpression(e);return e.scanToChar(")"),e.advance(),t}return this._parseConstant(e)},e._parseConstant=function(e){if(eS.isAlpha(e.getCurChar())){var t=e.scanWord();if(t.type===eY.defined){var n="("===e.peekNonSpace(),r=e.scanWord(!0);return n&&(e.scanToChar(")"),e.advance()),this._branchMacros.add(r.lexeme),!!this._definedMacros.get(r.lexeme)}var i=this._definedMacros.get(t.lexeme);if(!i)return!1;i.isFunction&&this.reportError(t.location,"invalid function macro usage",e.source,e.file);var a=Number(i.body.lexeme);return Number.isInteger(a)||this.reportError(t.location,"invalid const macro: "+t.lexeme,e.source,e.file),this._branchMacros.add(t.lexeme),a}if(eS.isNum(e.getCurChar()))return Number(e.scanInteger().lexeme);this.reportError(e.getShaderPosition(),"invalid token: "+e.getCurChar(),e.source,e.file)},e._expandMacroChunk=function(e,t,n){this._expandSegmentsStack.push([]),r="string"==typeof n?new e$(e,n):new e$(e,n.file,t);var r,i=this.parse(r);return this._expandSegmentsStack.pop(),{content:i}},e._parseIfNdef=function(e){var t=e.current-7,n=e.scanWord();this._addEmptyReplace(e,t),this._branchMacros.add(n.lexeme);var r=this._definedMacros.get(n.lexeme),i=e.scanMacroBranchChunk(),a=i.token,o=i.nextDirective;if(!r){var s=o.type===eY.endif?e.getShaderPosition():e.scanRemainMacro(),c=this._expandMacroChunk(a.lexeme,a.location,e),l=tl.createRange(a.location.start,s);this.expandSegments.push({rangeInBlock:l,replace:c.content});return}this.expandSegments.pop(),this._addEmptyReplace(e,t),this._parseMacroBranch(o.type,e)},e._addEmptyReplace=function(e,t){var n=tl.createPosition(t),r=e.getCurPosition(),i=tl.createRange(n,r);this.expandSegments.push({rangeInBlock:i,replace:""})},e._parseIf=function(e){var t=e.current-3,n=this._parseConstantExpression(e);this._addEmptyReplace(e,t);var r=e.scanMacroBranchChunk(),i=r.token,a=r.nextDirective;if(n){var o=a.type===eY.endif?e.getShaderPosition():e.scanRemainMacro(),s=this._expandMacroChunk(i.lexeme,i.location,e),c=tl.createRange(i.location.start,o);this.expandSegments.push({rangeInBlock:c,replace:s.content});return}this.expandSegments.pop(),this._addEmptyReplace(e,t),this._parseMacroBranch(a.type,e)},e._parseDefine=function(e){var t,n=e.getShaderPosition(7),r=e.scanWord(),i=r.location.end;this._definedMacros.get(r.lexeme)&&r.lexeme.startsWith("GL_")&&this.reportError(r.location,"redefined macro: "+r.lexeme,e.source,e.file),"("===e.getCurChar()&&(t=e.scanWordsUntilChar(")"),i=e.getShaderPosition());var a=new eX(r,e.scanLineRemain(),tl.createRange(n,i),t);this._definedMacros.set(r.lexeme,a),this.expandSegments.push({rangeInBlock:tl.createRange(n,e.getCurPosition()),replace:""})},e._parseUndef=function(e){var t=e.current-6,n=e.scanWord(),r=tl.createPosition(t),i=tl.createRange(r,e.getCurPosition());this.expandSegments.push({rangeInBlock:i,replace:""}),this._definedMacros.delete(n.lexeme)},e._onToken=function(e,t){var n=this._definedMacros.get(e.lexeme);if(n){var r=n.body.lexeme;if(n.isFunction){t.scanToChar("("),t.advance();for(var i=[],a=1,o=t.current;;){if("("===t.getCurChar())a+=1;else if(")"===t.getCurChar()){if(0==(a-=1))break}else","===t.getCurChar()&&1===a&&(i.push(t.source.slice(o,t.current)),o=t.current+1);t.advance()}i.push(t.source.slice(o,t.current)),t.advance();var s=tl.createRange(e.location.start,t.getCurPosition());r=n.expandFunctionBody(i);var c=this._expandMacroChunk(r,s,t),l=tl.createRange(e.location.start,t.getCurPosition());this.expandSegments.push({rangeInBlock:l,replace:c.content})}else{var u=this._expandMacroChunk(r,e.location,t),p=tl.createRange(e.location.start,e.location.end);this.expandSegments.push({rangeInBlock:p,replace:u.content})}}},ey(e,null,[{key:"expandSegments",get:function(){return this._expandSegmentsStack[this._expandSegmentsStack.length-1]}}]),e}();e0._definedMacros=new Map,e0._expandSegmentsStack=[[]],e0._branchMacros=new Set;var e1=/*#__PURE__*/function(){function e(){}return e.reset=function(e,t){e0.reset(e,t)},e.process=function(e){return this.baseScanner=new e$(e),e0.parse(this.baseScanner)},e.addPredefinedMacro=function(e,t){e0.addPredefinedMacro(e,t)},e}(),e2=/*#__PURE__*/function(){function e(){}return e.unwrapNodeByType=function(t,n){var r=t.children[0];if(!eh(r,ef))return r.nt===n?r:e.unwrapNodeByType(r,n)},e.isTerminal=function(e){return e<eG.START},e}(),e3=/*#__PURE__*/function(){function e(){this.attributeList=[],this.attributeStructs=[],this._referencedAttributeList=Object.create(null),this._referencedGlobals=Object.create(null),this._referencedVaryingList=Object.create(null)}var t=e.prototype;return t.reset=function(){this.attributeList.length=0,this.attributeStructs.length=0,this._referencedAttributeList=Object.create(null),this._referencedGlobals=Object.create(null),this._referencedVaryingList=Object.create(null)},t.isAttributeStruct=function(e){return -1!==this.attributeStructs.findIndex(function(t){return t.ident.lexeme===e})},t.isVaryingStruct=function(e){var t,n;return(null==(n=this.varyingStruct)?void 0:null==(t=n.ident)?void 0:t.lexeme)===e},t.referenceAttribute=function(e){if(!this._referencedAttributeList[e.lexeme]){var t=this.attributeList.find(function(t){return t.ident.lexeme===e.lexeme});if(!t)return ed.createGSError("referenced attribute not found: "+e.lexeme,ev.CompilationError,tl._processingPassText,e.location);this._referencedAttributeList[e.lexeme]=t}},t.referenceVarying=function(e){if(!this._referencedVaryingList[e.lexeme]){var t,n=null==(t=this.varyingStruct)?void 0:t.propList.find(function(t){return t.ident.lexeme===e.lexeme});if(!n)return ed.createGSError("referenced varying not found: "+e.lexeme,ev.CompilationError,tl._processingPassText,e.location);this._referencedVaryingList[e.lexeme]=n}},t.referenceGlobal=function(e,t){if(!this._referencedGlobals[e]){if(t===eT.FN){for(var n=this._passSymbolTable.getAllFnSymbols(e),r=0;r<n.length;r++){var i=0===r?e:e+r;this._referencedGlobals[i]=n[r]}return}var a=this.passSymbolTable.lookup({ident:e,symbolType:t});a&&(this._referencedGlobals[e]=a)}},e.reset=function(){this._singleton||(this._singleton=new e),this._singleton.reset()},ey(e,[{key:"passSymbolTable",get:function(){return this._passSymbolTable}}],[{key:"context",get:function(){return this._singleton}}]),e}(),e4=/*#__PURE__*/function(){function e(){}var t=e.prototype;return t.defaultCodeGen=function(e){for(var t,n=[],i=r(e);!(t=i()).done;){var a=t.value;eh(a,ef)?n.push(a.lexeme):n.push(a.codeGen(this))}return n.join(" ")},t.visitPostfixExpression=function(e){if(3===e.children.length){var t=e3.context,n=e.children[0],r=e.children[2];return eh(r,ef)?t.isAttributeStruct(n.type)?(t.referenceAttribute(r),r.lexeme):t.isVaryingStruct(n.type)?(t.referenceVarying(r),r.lexeme):n.codeGen(this)+"."+r.lexeme:n.codeGen(this)+"."+r.codeGen(this)}return this.defaultCodeGen(e.children)},t.visitVariableIdentifier=function(e){return eh(e.symbolInfo,ek)&&e.symbolInfo.isGlobalVariable&&e3.context.referenceGlobal(e.lexeme,eT.VAR),e.lexeme},t.visitFunctionCall=function(e){var t=e.children[0];if(eh(t.fnSymbol,eA)){e3.context.referenceGlobal(t.fnSymbol.ident,eT.FN);var n=t.children[2],r=t.fnSymbol.astNode.protoType.parameterList;if(eh(n,eo.FunctionCallParameterList)){for(var i=[],a=n.paramNodes,o=0;o<a.length;o++)e3.context.isAttributeStruct(r[o].typeInfo.typeLexeme)||e3.context.isVaryingStruct(r[o].typeInfo.typeLexeme)||i.push(a[o].codeGen(this));return t.fnSymbol.ident+"("+i.join(", ")+")"}}return this.defaultCodeGen(e.children)},t.visitStatementList=function(e){var t=e.children;return 1===e.children.length?t[0].codeGen(this):t[0].codeGen(this)+"\n"+t[1].codeGen(this)},t.visitSingleDeclaration=function(e){var t=e.typeSpecifier.type;return"string"==typeof t&&e3.context.referenceGlobal(t,eT.STRUCT),this.defaultCodeGen(e.children)},t.visitGlobalVariableDeclaration=function(e){var t=e.children[0];return eh(t,eo.FullySpecifiedType)&&t.typeSpecifier.isCustom&&e3.context.referenceGlobal(t.type,eT.STRUCT),this.defaultCodeGen(e.children)},t.visitDeclaration=function(e){var t,n,r=e.children[0];return eh(r,eo.InitDeclaratorList)&&r.typeInfo.typeLexeme===(null==(n=e3.context.varyingStruct)?void 0:null==(t=n.ident)?void 0:t.lexeme)?"":this.defaultCodeGen(e.children)},t.visitFunctionProtoType=function(e){return e3.context._curFn=e,this.defaultCodeGen(e.children)},t.visitFunctionDefinition=function(e){return e3.context._curFn=void 0,this.defaultCodeGen(e.children)},t.visitFunctionParameterList=function(e){var t=this;return e.parameterInfoList.filter(function(e){return!e3.context.isAttributeStruct(e.typeInfo.typeLexeme)&&!e3.context.isVaryingStruct(e.typeInfo.typeLexeme)}).map(function(e){return e.astNode.codeGen(t)}).join(", ")},t.visitFunctionHeader=function(e){var t=e.returnType.typeSpecifier.lexeme;return e3.context.isAttributeStruct(t)||e3.context.isVaryingStruct(t)?"void "+e.ident.lexeme+"(":this.defaultCodeGen(e.children)},t.visitJumpStatement=function(e){if(e.children[0].type===el.RETURN){var t=e.children[1];if(eh(t,eo.Expression)){var n,r,i,a,o=e2.unwrapNodeByType(t,eG.variable_identifier);if((null==o?void 0:o.typeInfo)===(null==(r=e3.context.varyingStruct)?void 0:null==(n=r.ident)?void 0:n.lexeme))return"";var s=e2.unwrapNodeByType(t,eG.function_call);if((null==s?void 0:s.type)===(null==(a=e3.context.varyingStruct)?void 0:null==(i=a.ident)?void 0:i.lexeme))return""+t.codeGen(this)+";"}}return this.defaultCodeGen(e.children)},t.visitFunctionIdentifier=function(e){return this.defaultCodeGen(e.children)},t._reportError=function(e,t){throw Error(t)},e}(),e6=((ea={})[ea.VERTEX=0]="VERTEX",ea[ea.FRAGMENT=1]="FRAGMENT",ea[ea.ALL=2]="ALL",ea),e5=/*#__PURE__*/function(e){function t(){var t;return t=e.apply(this,arguments)||this,t._versionText="",t._extensions="",t}a(t,e);var n=t.prototype;return n.visitShaderProgram=function(e,t,n){return e3.reset(),e3.context._passSymbolTable=e.shaderData.symbolTable,{vertex:this.vertexMain(t,e.shaderData),fragment:this._fragmentMain(n,e.shaderData)}},n.vertexMain=function(e,t){var n=t.symbolTable,i=n.lookup({ident:e,symbolType:eT.FN});if(!(null==i?void 0:i.astNode))throw"no entry function found: "+e;var a=i.astNode;e3.context.stage=e6.VERTEX;var o=a.protoType.returnType;if("string"==typeof o.type){var s=n.lookup({ident:o.type,symbolType:eT.STRUCT});s?e3.context.varyingStruct=s.astNode:this._reportError(o.location,"invalid varying struct: "+o.type)}else o.type!==el.VOID&&this._reportError(o.location,"main entry can only return struct.");var c=a.protoType.parameterList;if(null==c?void 0:c.length)for(var l,u=r(c);!(l=u()).done;){var p=l.value;if("string"==typeof p.typeInfo.type){var h=n.lookup({ident:p.typeInfo.type,symbolType:eT.STRUCT});if(!h){this._reportError(p.astNode.location,'Not found attribute struct "'+p.typeInfo.type+'".');continue}e3.context.attributeStructs.push(h.astNode);for(var d,f=r(h.astNode.propList);!(d=f()).done;){var _=d.value;e3.context.attributeList.push(_)}}else e3.context.attributeList.push(p)}var S=a.statements.codeGen(this),g=[].concat(this._getGlobalText(t),this.getAttributeDeclare(),this.getVaryingDeclare()).sort(function(e,t){return e.index-t.index}).map(function(e){return e.text}).join("\n");return e3.context.reset(),this._versionText+"\n"+g+"\n\nvoid main() "+S},n._fragmentMain=function(e,t){var n=t.symbolTable.lookup({ident:e,symbolType:eT.FN});if(!(null==n?void 0:n.astNode))throw"no entry function found: "+e;var r=n.astNode;e3.context.stage=e6.FRAGMENT;var i=r.statements.codeGen(this),a=[].concat(this._getGlobalText(t),this.getVaryingDeclare()).sort(function(e,t){return e.index-t.index}).map(function(e){return e.text}).join("\n");return e3.context.reset(),this._versionText+"\n"+this._extensions+"\n\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n#else\n  precision mediump float;\n  precision mediump int;\n#endif\n\n"+a+"\n\nvoid main() "+i},n._getGlobalText=function(e,t,n,i){void 0===t&&(t=[]),void 0===n&&(n=0),void 0===i&&(i=new Set);var a=e3.context._referencedGlobals;if(n===Object.keys(a).length){for(var o,s=r(e.globalPrecisions);!(o=s()).done;){var c=o.value;t.push({text:c.codeGen(this),index:c.location.start.index})}return t}for(var l in n=Object.keys(a).length,a){var u=a[l];i.has(l)||(i.add(l),eh(u,eP)?u.symbolType===eT.VAR?t.push({text:"uniform "+u.astNode.codeGen(this),index:u.astNode.location.start.index}):t.push({text:u.astNode.codeGen(this),index:u.astNode.location.start.index}):t.push({text:u.codeGen(this),index:u.location.start.index}))}return this._getGlobalText(e,t,n,i)},t}(e4),e7=/*#__PURE__*/function(e){function t(){var t;return t=e.apply(this,arguments)||this,t._versionText="#version 100",t._extensions=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives","GL_EXT_draw_buffers","GL_EXT_frag_depth"].map(function(e){return"#extension "+e+" : enable\n"}).join(""),t}a(t,e);var n=t.prototype;return n.getAttributeDeclare=function(){for(var e,t=[],n=r(Object.values(e3.context._referencedAttributeList));!(e=n()).done;){var i=e.value;t.push({text:"attribute "+i.typeInfo.typeLexeme+" "+i.ident.lexeme+";",index:i.ident.location.start.index})}return t},n.getVaryingDeclare=function(){for(var e,t=[],n=r(Object.values(e3.context._referencedVaryingList));!(e=n()).done;){var i=e.value;t.push({text:"varying "+i.typeInfo.typeLexeme+" "+i.ident.lexeme+";",index:i.ident.location.start.index})}return t},t.getVisitor=function(){return this._singleton||(this._singleton=new t),this._singleton},t}(e5),e8="GS_glFragColor",e9=/*#__PURE__*/function(e){function t(){var t;return t=e.apply(this,arguments)||this,t._versionText="#version 300 es",t}a(t,e);var n=t.prototype;return n.getAttributeDeclare=function(){for(var e,t=[],n=r(Object.values(e3.context._referencedAttributeList));!(e=n()).done;){var i=e.value;t.push({text:"in "+i.typeInfo.typeLexeme+" "+i.ident.lexeme+";",index:i.ident.location.start.index})}return t},n.getVaryingDeclare=function(){for(var e=[],t=e3.context.stage===e6.FRAGMENT?"in":"out",n=Object.values(e3.context._referencedVaryingList),r=0;r<n.length;r++){var i,a=n[r];e.push({text:(null!=(i=a.qualifier)?i:t)+" "+a.typeInfo.typeLexeme+" "+a.ident.lexeme+";",index:a.ident.location.start.index})}return e},n.visitFunctionIdentifier=function(e){if(1!==e.children[0].children.length)return this.defaultCodeGen(e.children);var t=e.lexeme;if("texture2D"===e.ident||"textureCube"===e.ident)t="texture";else if("texture2DProj"===e.ident)t="textureProj";else if(e3.context.stage===e6.FRAGMENT)switch(e.ident){case"texture2DLodEXT":case"textureCubeLodEXT":t="textureLod";break;case"texture2DGradEXT":case"textureCubeGradEXT":t="textureGrad";break;case"texture2DProjLodEXT":t="textureProjLod";break;case"texture2DProjGradEXT":t="textureProjGrad";break;case"gl_FragDepthEXT":t="gl_FragDepth"}return t},n.visitVariableIdentifier=function(t){if(e3.context.stage===e6.FRAGMENT&&"gl_FragColor"===t.lexeme){if(!e3.context._referencedVaryingList[e8]){var n=ef.pool.get();n.set(ep.ID,e8,tl.createPosition(0,0,0)),e3.context._referencedVaryingList[e8]={ident:n,typeInfo:new eF(el.VEC4,"vec4"),qualifier:"out",astNode:t}}return e8}return e.prototype.visitVariableIdentifier.call(this,t)},t.getVisitor=function(){return this._singleton||(this._singleton=new t),this._singleton},t}(e5);function te(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(te=function(){return!!e})()}function tt(e,t,n){return(tt=te()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&i(a,n.prototype),a}).apply(null,arguments)}function tn(){return(tn=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var tr=new Map([["RenderQueueType",el.GS_RenderQueueType],["BlendState",el.GS_BlendState],["DepthState",el.GS_DepthState],["StencilState",el.GS_StencilState],["RasterState",el.GS_RasterState],["EditorProperties",el.GS_EditorProperties],["EditorMacros",el.GS_EditorMacros],["Editor",el.GS_Editor],["Tags",el.GS_Tags],["VertexShader",el.GS_VertexShader],["FragmentShader",el.GS_FragmentShader],["SubShader",el.GS_SubShader],["Pass",el.GS_Pass],["BlendFactor",el.GS_BlendFactor],["BlendOperation",el.GS_BlendOperation],["Bool",el.GS_Bool],["Number",el.GS_Number],["CompareFunction",el.GS_CompareFunction],["StencilOperation",el.GS_StencilOperation],["CullMode",el.GS_CullMode],["true",el.TRUE],["false",el.FALSE],["UsePass",el.GS_UsePass],["Color",el.GS_Color]]),ti=/*#__PURE__*/function(e){function t(t,n){return void 0===n&&(n=new Map),e.call(this,t,n)||this}a(t,e);var n=t.prototype;return n.scanWord=function(){this.skipCommentsAndSpace();for(var e=this._currentIndex;/\S/.test(this.getCurChar())&&!this.isEnd();)this._advance();return this._source.substring(e,this._currentIndex)},n.scanNumber=function(){this.skipCommentsAndSpace();for(var e=this._currentIndex;/[0-9]/.test(this.getCurChar());)this._advance();if("."===this.getCurChar())for(this._advance();/[0-9]/.test(this.getCurChar());)this._advance();return Number(this._source.substring(e,this._currentIndex))},t}(em),ta=/*#__PURE__*/function(e){function t(){return e.apply(this,arguments)||this}return a(t,e),t.prototype.symbolEqualCheck=function(e,t){return e.type===t.type},t}(eI),to=[el.GS_RenderQueueType,el.GS_BlendFactor,el.GS_BlendOperation,el.GS_Bool,el.GS_Number,el.GS_Color,el.GS_CompareFunction,el.GS_StencilOperation,el.GS_CullMode],ts=[el.GS_BlendState,el.GS_DepthState,el.GS_RasterState,el.GS_StencilState],tc=/*#__PURE__*/function(){function e(){}return e._isRenderStateDeclarator=function(e){return ts.includes(e.type)},e._isEngineType=function(e){return to.includes(e.type)},e.reset=function(){this._errors.length=0,this._symbolTable.clear(),this._newScope()},e.parse=function(e){var n=performance.now(),r=new ti(e,tr),i={subShaders:[],globalContents:[],renderStates:{constantMap:{},variableMap:{}}};r.scanText("Shader"),i.name=r.scanPairedText('"','"'),r.scanText("{"),r.skipCommentsAndSpace(),this._parseShaderStatements(i,r);for(var a=i.globalContents,o=i.renderStates,s=0;s<i.subShaders.length;s++)for(var c=i.subShaders[s],l=a.concat(c.globalContents),u=tn({},o.constantMap,c.renderStates.constantMap),p=tn({},o.variableMap,c.renderStates.variableMap),h=0;h<c.passes.length;h++){var d=c.passes[h];if(Object.assign(d.renderStates.constantMap,u),Object.assign(d.renderStates.variableMap,p),!d.isUsePass){var f=l.concat(d.globalContents);d.contents=f.map(function(e){return e.content}).join("\n")}}return t.Logger.info("[content compilation] cost time "+(performance.now()-n)+"ms"),i},e._parseShaderStatements=function(t,n){for(var r=1,i=n.getCurPosition();;){var a=n.scanToken();switch(a.type){case el.GS_SubShader:this._addGlobalStatement(t,n,i,a.lexeme.length);var o=this._parseSubShader(n);t.subShaders.push(o),i=n.getCurPosition();break;case el.GS_EditorProperties:case el.GS_EditorMacros:case el.GS_Editor:this._addGlobalStatement(t,n,i,a.lexeme.length),n.scanPairedText("{","}",!0),i=n.getCurPosition();break;case el.GS_RenderQueueType:this._addGlobalStatement(t,n,i,a.lexeme.length),this._parseRenderQueueAssignment(t,n),i=n.getCurPosition();break;case ep.NOT_WORD:if("{"===a.lexeme)r+=1;else if("}"===a.lexeme&&0==(r-=1)){this._addGlobalStatement(t,n,i,a.lexeme.length),this._symbolTable.dropScope();return}default:if(e._isRenderStateDeclarator(a)){this._addGlobalStatement(t,n,i,a.lexeme.length),this._parseRenderStateDeclarationOrAssignment(t,a,n),i=n.getCurPosition();break}e._isEngineType(a)&&(this._addGlobalStatement(t,n,i,a.lexeme.length),this._parseVariableDeclaration(a.type,n),i=n.getCurPosition())}}},e._parseRenderStateDeclarationOrAssignment=function(e,t,n){var r,i=n.scanToken();if(i.type===ep.ID)r=!0,n.scanText("{");else if("{"===i.lexeme)r=!1;else if("="===i.lexeme){var a=n.scanToken();n.scanText(";");var o=this._symbolTable.lookup({type:t.type,ident:a.lexeme});(null==o?void 0:o.value)||ed.createGSError('Invalid "'+t.lexeme+'" variable: '+a.lexeme,ev.CompilationError,n.source,a.location);var s=o.value;Object.assign(e.renderStates.constantMap,s.constantMap),Object.assign(e.renderStates.variableMap,s.variableMap);return}var c=this._parseRenderStatePropList(t.lexeme,n);r?this._symbolTable.insert({ident:i.lexeme,type:t.type,value:c}):(Object.assign(e.renderStates.constantMap,c.constantMap),Object.assign(e.renderStates.variableMap,c.variableMap))},e._parseVariableDeclaration=function(e,t){var n=t.scanToken();t.scanText(";"),this._symbolTable.insert({type:n.type,ident:n.lexeme})},e._newScope=function(){var e=new ta;this._symbolTable.newScope(e)},e._parseRenderStatePropList=function(e,t){for(var n={constantMap:{},variableMap:{}};"}"!==t.getCurChar();)this._parseRenderStatePropItem(n,e,t),t.skipCommentsAndSpace();return t._advance(),n},e._parseRenderStatePropItem=function(n,r,i){var a=i.scanToken().lexeme,o=i.scanToken();if("BlendState"===r&&"BlendColor"!==a&&"AlphaToCoverage"!==a){var s=0;"["===o.lexeme?(s=i.scanNumber(),i.scanText("]"),i.scanText("=")):"="!==o.lexeme&&ed.createGSError("Invalid syntax, expect character '=', but got "+o.lexeme,ev.CompilationError,i.source,i.getCurPosition()),a+=s}a=r+a;var c=t.RenderStateDataKey[a];if(void 0==c&&ed.createGSError("Invalid render state element "+a,ev.CompilationError,i.source,i.getCurPosition()),i.skipCommentsAndSpace(),/[0-9.]/.test(i.getCurChar()))p=i.scanNumber();else{var l=i.scanToken();if(l.type===el.TRUE)p=!0;else if(l.type===el.FALSE)p=!1;else if(l.type===el.GS_Color){i.scanText("(");for(var u=[];;){if(u.push(i.scanNumber()),i.skipCommentsAndSpace(),")"===i.peek(1)){i._advance();break}i.scanText(",")}p=tt(t.Color,[].concat(u))}else if("."===i.getCurChar()){i._advance();var p,h,d=i.scanToken();void 0==(p=null==(h=e._engineType[l.lexeme])?void 0:h[d.lexeme])&&ed.createGSError("Invalid engine constant: "+l.lexeme+"."+d.lexeme,ev.CompilationError,i.source,d.location)}else p=l.lexeme}i.scanText(";"),"string"==typeof p?n.variableMap[c]=p:n.constantMap[c]=p},e._parseRenderQueueAssignment=function(n,r){r.scanText("=");var i=r.scanToken();r.scanText(";");var a=e._engineType.RenderQueueType[i.lexeme],o=t.RenderStateDataKey.RenderQueueType;void 0==a?n.renderStates.variableMap[o]=i.lexeme:n.renderStates.constantMap[o]=a},e._addGlobalStatement=function(e,t,n,r){t.current>n.index+r&&e.globalContents.push({range:{start:n,end:tn({},t.getCurPosition(),{index:t.current-r-1})},content:t.source.substring(n.index,t.current-r-1)})},e._parseSubShader=function(t){this._newScope();var n={passes:[],globalContents:[],renderStates:{constantMap:{},variableMap:{}},tags:{}},r=1;n.name=t.scanPairedText('"','"'),t.scanText("{"),t.skipCommentsAndSpace();for(var i=t.getCurPosition();;){var a=t.scanToken();switch(a.type){case el.GS_Pass:this._addGlobalStatement(n,t,i,a.lexeme.length);var o=this._parsePass(t);n.passes.push(o),i=t.getCurPosition();break;case el.GS_RenderQueueType:this._addGlobalStatement(n,t,i,a.lexeme.length),this._parseRenderQueueAssignment(n,t),i=t.getCurPosition();break;case el.GS_UsePass:this._addGlobalStatement(n,t,i,a.lexeme.length);var s=t.scanPairedText('"','"');n.passes.push({name:s,isUsePass:!0,renderStates:{constantMap:{},variableMap:{}},tags:{}}),i=t.getCurPosition();break;case el.GS_Tags:this._addGlobalStatement(n,t,i,a.lexeme.length),this._parseTags(n,t),i=t.getCurPosition();break;case ep.NOT_WORD:if("{"===a.lexeme)r+=1;else if("}"===a.lexeme&&0==(r-=1))return this._addGlobalStatement(n,t,i,a.lexeme.length),this._symbolTable.dropScope(),n;default:if(e._isRenderStateDeclarator(a)){this._addGlobalStatement(n,t,i,a.lexeme.length),this._parseRenderStateDeclarationOrAssignment(n,a,t),i=t.getCurPosition();break}e._isEngineType(a)&&(this._addGlobalStatement(n,t,i,a.lexeme.length),this._parseVariableDeclaration(a.type,t),i=t.getCurPosition())}}},e._parseTags=function(e,t){for(t.scanText("{");;){var n=t.scanToken();t.scanText("=");var r=t.scanPairedText('"','"');if(t.skipCommentsAndSpace(),e.tags[n.lexeme]=r,"}"===t.peek(1)){t._advance();return}t.scanText(",")}},e._parsePass=function(t){this._newScope();var n={globalContents:[],renderStates:{constantMap:{},variableMap:{}},tags:{}};n.name=t.scanPairedText('"','"'),t.scanText("{");var r=1;t.skipCommentsAndSpace();for(var i=t.getCurPosition();;){var a=t.scanToken();switch(a.type){case el.GS_RenderQueueType:this._addGlobalStatement(n,t,i,a.lexeme.length),this._parseRenderQueueAssignment(n,t),i=t.getCurPosition();break;case el.GS_Tags:this._addGlobalStatement(n,t,i,a.lexeme.length),this._parseTags(n,t),i=t.getCurPosition();break;case el.GS_VertexShader:case el.GS_FragmentShader:this._addGlobalStatement(n,t,i,a.lexeme.length),t.scanText("=");var o=t.scanToken();n[a.lexeme]&&ed.createGSError("reassign main entry",ev.CompilationError,t.source,t.getCurPosition()),n[a.type===el.GS_VertexShader?"vertexEntry":"fragmentEntry"]=o.lexeme,t.scanText(";"),i=t.getCurPosition();break;case ep.NOT_WORD:if("{"===a.lexeme)r+=1;else if("}"===a.lexeme&&0==(r-=1))return this._addGlobalStatement(n,t,i,a.lexeme.length),this._symbolTable.dropScope(),n;default:if(e._isRenderStateDeclarator(a)){this._addGlobalStatement(n,t,i,a.lexeme.length),this._parseRenderStateDeclarationOrAssignment(n,a,t),i=t.getCurPosition();break}e._isEngineType(a)&&(this._addGlobalStatement(n,t,i,a.lexeme.length),this._parseVariableDeclaration(a.type,t),i=t.getCurPosition())}}},e}();tc._engineType={RenderQueueType:t.RenderQueueType,CompareFunction:t.CompareFunction,StencilOperation:t.StencilOperation,BlendOperation:t.BlendOperation,BlendFactor:t.BlendFactor,CullMode:t.CullMode},tc._errors=[],tc._symbolTable=new eR;var tl=/*#__PURE__*/function(){function e(){}var n=e.prototype;return n._parseShaderPass=function(n,i,a,o,s,c,l){e1.reset(t.ShaderLib,l);for(var u,p=r(o);!(u=p()).done;){var h=u.value;e1.addPredefinedMacro(h.name,h.value)}for(var d=0;d<c.length;d++)e1.addPredefinedMacro(c[d]);var f=performance.now(),_=e1.process(n);t.Logger.info("[pass compilation - preprocessor]  cost time "+(performance.now()-f)+"ms");var S=new ex(_).tokenize(),g=e._parser;e._processingPassText=_;var y=g.parse(S);if(y){var v=s===t.ShaderPlatformTarget.GLES100?e7.getVisitor():e9.getVisitor(),m=performance.now(),x=v.visitShaderProgram(y,i,a);return t.Logger.info("[CodeGen] cost time: "+(performance.now()-m)+"ms"),e._processingPassText=void 0,x}},n._parseShaderContent=function(e){return ed.clearAllShaderLabObjectPool(),tc.reset(),tc.parse(e)},e.createPosition=function(e,t,n){var r=this._shaderPositionPool.get();return r.set(e),r},e.createRange=function(e,t){var n=this._shaderRangePool.get();return n.set(e,t),n},e}();tl._parser=ez.create(),tl._shaderPositionPool=ed.createObjectPool(ec),tl._shaderRangePool=ed.createObjectPool(es);var tu="1.4.0-alpha.0";console.log("Galacean ShaderLab version: "+tu+". mode: Release"),e.ShaderLab=tl,e.version=tu,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=browser.min.js.map
