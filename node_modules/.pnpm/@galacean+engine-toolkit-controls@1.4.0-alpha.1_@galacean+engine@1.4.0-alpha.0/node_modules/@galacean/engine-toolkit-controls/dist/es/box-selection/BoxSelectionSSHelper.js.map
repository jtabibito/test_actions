{"version":3,"file":"BoxSelectionSSHelper.js","sources":["../../../src/box-selection/BoxSelectionSSHelper.ts"],"sourcesContent":["import { Entity, InputManager, MeshRenderer, PointerButton, PrimitiveMesh, Script, Vector2, WebGLEngine } from \"@galacean/engine\";\nimport { PlaneMesh } from \"./PlaneMesh\";\nimport { BoxSelectionSSMaterial } from \"./BoxSelectionSSMaterial\";\nimport { IBoxSelectionHelper } from \"./types\";\n\n// draw according to screen space\nexport class BoxSelectionSSHelper implements IBoxSelectionHelper {\n  element: Entity;\n  sceneRoot: Entity;\n  startPoint: Vector2;\n  pointBottomLeft: Vector2;\n  pointTopRight: Vector2;\n  isDown: boolean;\n  onPointerDown: any;\n  onPointerMove: any;\n  onPointerUp: any;\n  input: InputManager;\n  engine: WebGLEngine;\n  material: BoxSelectionSSMaterial;\n\n  constructor(engine: WebGLEngine, sceneRoot: Entity) {\n    this.engine = engine;\n    this.element = new Entity(engine);\n    this.sceneRoot = sceneRoot;\n    this.startPoint = new Vector2();\n    this.pointBottomLeft = new Vector2();\n    this.pointTopRight = new Vector2();\n    this.input = engine.inputManager;\n    this.init();\n  }\n\n  private init() {\n    const renderer = this.element.addComponent(MeshRenderer);\n    renderer.receiveShadows = false;\n    renderer.castShadows = false;\n    renderer.mesh = PlaneMesh.createPlane(this.engine); // PrimitiveMesh.createPlane is xoz plane, but we need xoy plane\n    this.material = new BoxSelectionSSMaterial(this.engine);\n    renderer.setMaterial(this.material);\n    this.element.transform.rotation.x = Math.PI * 0.5;\n  }\n\n  onSelectStart(vec2: Vector2) {\n    this.startPoint.x = vec2.x;\n    this.startPoint.y = this.engine.canvas.height - vec2.y;\n    this.sceneRoot.addChild(this.element);\n  }\n\n  onSelecting(vec2: Vector2) {\n    this.pointTopRight.x = Math.max(this.startPoint.x, vec2.x);\n    this.pointTopRight.y = Math.max(this.startPoint.y, this.engine.canvas.height - vec2.y);\n    this.pointBottomLeft.x = Math.min(this.startPoint.x, vec2.x);\n    this.pointBottomLeft.y = Math.min(this.startPoint.y, this.engine.canvas.height - vec2.y);\n\n    this.material.maxPoint = this.pointTopRight;\n    this.material.minPoint = this.pointBottomLeft;\n  }\n\n  onSelectEnd() {\n    this.sceneRoot.removeChild(this.element);\n  }\n}\n"],"names":["BoxSelectionSSHelper","engine","sceneRoot","element","Entity","startPoint","Vector2","pointBottomLeft","pointTopRight","input","inputManager","init","renderer","addComponent","MeshRenderer","receiveShadows","castShadows","mesh","PlaneMesh","createPlane","material","BoxSelectionSSMaterial","setMaterial","transform","rotation","x","Math","PI","onSelectStart","vec2","y","canvas","height","addChild","onSelecting","max","min","maxPoint","minPoint","onSelectEnd","removeChild"],"mappings":";;;;;;AAKA;AACO,IAAA,oBAAMA,iBAAD,WAAL;aAAMA,oBAcCC,CAAAA,MAAmB,EAAEC,SAAiB,EAAA;QAChD,IAAI,CAACD,MAAM,GAAGA,MAAAA,CAAAA;AACd,QAAA,IAAI,CAACE,OAAO,GAAG,IAAIC,MAAOH,CAAAA,MAAAA,CAAAA,CAAAA;QAC1B,IAAI,CAACC,SAAS,GAAGA,SAAAA,CAAAA;QACjB,IAAI,CAACG,UAAU,GAAG,IAAIC,OAAAA,EAAAA,CAAAA;QACtB,IAAI,CAACC,eAAe,GAAG,IAAID,OAAAA,EAAAA,CAAAA;QAC3B,IAAI,CAACE,aAAa,GAAG,IAAIF,OAAAA,EAAAA,CAAAA;AACzB,QAAA,IAAI,CAACG,KAAK,GAAGR,MAAAA,CAAOS,YAAY,CAAA;AAChC,QAAA,IAAI,CAACC,IAAI,EAAA,CAAA;;AAtBAX,IAAAA,IAAAA,MAAAA,GAAAA,oBAAAA,CAAAA,SAAAA,CAAAA;IAyBX,MAAQW,CAAAA,IAQP,GARD,SAAQA,IAAAA,GAAAA;AACN,QAAA,IAAMC,WAAW,IAAI,CAACT,OAAO,CAACU,YAAY,CAACC,YAAAA,CAAAA,CAAAA;AAC3CF,QAAAA,QAAAA,CAASG,cAAc,GAAG,KAAA,CAAA;AAC1BH,QAAAA,QAAAA,CAASI,WAAW,GAAG,KAAA,CAAA;QACvBJ,QAASK,CAAAA,IAAI,GAAGC,SAAUC,CAAAA,WAAW,CAAC,IAAI,CAAClB,MAAM,CAAA,CAAA;AACjD,QAAA,IAAI,CAACmB,QAAQ,GAAG,IAAIC,sBAAuB,CAAA,IAAI,CAACpB,MAAM,CAAA,CAAA;AACtDW,QAAAA,QAAAA,CAASU,WAAW,CAAC,IAAI,CAACF,QAAQ,CAAA,CAAA;QAClC,IAAI,CAACjB,OAAO,CAACoB,SAAS,CAACC,QAAQ,CAACC,CAAC,GAAGC,IAAKC,CAAAA,EAAE,GAAG,GAAA,CAAA;AAChD,KAAA,CAAA;AAEAC,IAAAA,MAAAA,CAAAA,aAIC,GAJDA,SAAAA,aAAAA,CAAcC,IAAa,EAAA;AACzB,QAAA,IAAI,CAACxB,UAAU,CAACoB,CAAC,GAAGI,KAAKJ,CAAC,CAAA;AAC1B,QAAA,IAAI,CAACpB,UAAU,CAACyB,CAAC,GAAG,IAAI,CAAC7B,MAAM,CAAC8B,MAAM,CAACC,MAAM,GAAGH,KAAKC,CAAC,CAAA;AACtD,QAAA,IAAI,CAAC5B,SAAS,CAAC+B,QAAQ,CAAC,IAAI,CAAC9B,OAAO,CAAA,CAAA;AACtC,KAAA,CAAA;AAEA+B,IAAAA,MAAAA,CAAAA,WAQC,GARDA,SAAAA,WAAAA,CAAYL,IAAa,EAAA;AACvB,QAAA,IAAI,CAACrB,aAAa,CAACiB,CAAC,GAAGC,IAAKS,CAAAA,GAAG,CAAC,IAAI,CAAC9B,UAAU,CAACoB,CAAC,EAAEI,KAAKJ,CAAC,CAAA,CAAA;QACzD,IAAI,CAACjB,aAAa,CAACsB,CAAC,GAAGJ,IAAKS,CAAAA,GAAG,CAAC,IAAI,CAAC9B,UAAU,CAACyB,CAAC,EAAE,IAAI,CAAC7B,MAAM,CAAC8B,MAAM,CAACC,MAAM,GAAGH,IAAAA,CAAKC,CAAC,CAAA,CAAA;AACrF,QAAA,IAAI,CAACvB,eAAe,CAACkB,CAAC,GAAGC,IAAKU,CAAAA,GAAG,CAAC,IAAI,CAAC/B,UAAU,CAACoB,CAAC,EAAEI,KAAKJ,CAAC,CAAA,CAAA;QAC3D,IAAI,CAAClB,eAAe,CAACuB,CAAC,GAAGJ,IAAKU,CAAAA,GAAG,CAAC,IAAI,CAAC/B,UAAU,CAACyB,CAAC,EAAE,IAAI,CAAC7B,MAAM,CAAC8B,MAAM,CAACC,MAAM,GAAGH,IAAAA,CAAKC,CAAC,CAAA,CAAA;AAEvF,QAAA,IAAI,CAACV,QAAQ,CAACiB,QAAQ,GAAG,IAAI,CAAC7B,aAAa,CAAA;AAC3C,QAAA,IAAI,CAACY,QAAQ,CAACkB,QAAQ,GAAG,IAAI,CAAC/B,eAAe,CAAA;AAC/C,KAAA,CAAA;IAEAgC,MAAAA,CAAAA,WAEC,GAFDA,SAAAA,WAAAA,GAAAA;AACE,QAAA,IAAI,CAACrC,SAAS,CAACsC,WAAW,CAAC,IAAI,CAACrC,OAAO,CAAA,CAAA;AACzC,KAAA,CAAA;AArDWH,IAAAA,OAAAA,oBAAAA,CAAAA;AAsDZ,CAAA;;;;"}