import{AssetType as t,request as e,TextureFilterMode as s,TextureWrapMode as a,BlendFactor as n,BlendOperation as r,SubPrimitive as i,BoundingBox as o,Vector3 as l,Material as h,Shader as c,CullMode as d,RenderQueueType as u,Renderer as m,VertexElement as f,VertexElementFormat as g,Primitive as p,Buffer as x,BufferBindFlag as w,BufferUsage as b,VertexBufferBinding as y,IndexBufferBinding as k,IndexFormat as v,deepClone as S,ignoreClone as A,ReferResource as I,Loader as M,AssetPromise as C,resourceLoader as F}from"@galacean/engine";function T(t,e,s,a){var n,r=arguments.length,i=r<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,s):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,s,a);else for(var o=t.length-1;o>=0;o--)(n=t[o])&&(i=(r<3?n(i):r>3?n(e,s,i):n(e,s))||i);return r>3&&i&&Object.defineProperty(e,s,i),i}"function"==typeof SuppressedError&&SuppressedError;class E{array=new Array;add(t){let e=this.contains(t);return this.array[0|t]=0|t,!e}contains(t){return null!=this.array[0|t]}remove(t){this.array[0|t]=void 0}clear(){this.array.length=0}}class Y{entries={};size=0;add(t){let e=this.entries[t];return this.entries[t]=!0,!e&&(this.size++,!0)}addAll(t){let e=this.size;for(var s=0,a=t.length;s<a;s++)this.add(t[s]);return e!=this.size}contains(t){return this.entries[t]}clear(){this.entries={},this.size=0}}class R{r;g;b;a;static WHITE=new R(1,1,1,1);static RED=new R(1,0,0,1);static GREEN=new R(0,1,0,1);static BLUE=new R(0,0,1,1);static MAGENTA=new R(1,0,1,1);constructor(t=0,e=0,s=0,a=0){this.r=t,this.g=e,this.b=s,this.a=a}set(t,e,s,a){return this.r=t,this.g=e,this.b=s,this.a=a,this.clamp()}setFromColor(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}setFromString(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=8!=t.length?1:parseInt(t.substr(6,2),16)/255,this}add(t,e,s,a){return this.r+=t,this.g+=e,this.b+=s,this.a+=a,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}static rgb888ToColor(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}toRgb888(){const t=t=>("0"+(255*t).toString(16)).slice(-2);return Number("0x"+t(this.r)+t(this.g)+t(this.b))}static fromString(t){return(new R).setFromString(t)}}class X{static PI=3.1415927;static PI2=2*X.PI;static invPI2=1/X.PI2;static radiansToDegrees=180/X.PI;static radDeg=X.radiansToDegrees;static degreesToRadians=X.PI/180;static degRad=X.degreesToRadians;static clamp(t,e,s){return t<e?e:t>s?s:t}static cosDeg(t){return Math.cos(t*X.degRad)}static sinDeg(t){return Math.sin(t*X.degRad)}static atan2Deg(t,e){return Math.atan2(t,e)*X.degRad}static signum(t){return t>0?1:t<0?-1:0}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}static cbrt(t){let e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}static randomTriangular(t,e){return X.randomTriangularWith(t,e,.5*(t+e))}static randomTriangularWith(t,e,s){let a=Math.random(),n=e-t;return a<=(s-t)/n?t+Math.sqrt(a*n*(s-t)):e-Math.sqrt((1-a)*n*(e-s))}static isPowerOfTwo(t){return t&&!(t&t-1)}}class _{apply(t,e,s){return t+(e-t)*this.applyInternal(s)}}class B extends _{power=2;constructor(t){super(),this.power=t}applyInternal(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1}}class P extends B{constructor(t){super(t)}applyInternal(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1}}class V{static SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;static arrayCopy(t,e,s,a,n){for(let r=e,i=a;r<e+n;r++,i++)s[i]=t[r]}static arrayFill(t,e,s,a){for(let n=e;n<s;n++)t[n]=a}static setArraySize(t,e,s=0){let a=t.length;if(a==e)return t;if(t.length=e,a<e)for(let n=a;n<e;n++)t[n]=s;return t}static ensureArrayCapacity(t,e,s=0){return t.length>=e?t:V.setArraySize(t,e,s)}static newArray(t,e){let s=new Array(t);for(let a=0;a<t;a++)s[a]=e;return s}static newFloatArray(t){if(V.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);{let e=new Array(t);for(let t=0;t<e.length;t++)e[t]=0;return e}}static newShortArray(t){if(V.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);{let e=new Array(t);for(let t=0;t<e.length;t++)e[t]=0;return e}}static toFloatArray(t){return V.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t}static toSinglePrecision(t){return V.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t}static webkit602BugfixHelper(t,e){}static contains(t,e,s=!0){for(var a=0;a<t.length;a++)if(t[a]==e)return!0;return!1}static enumValue(t,e){return t[e[0].toUpperCase()+e.slice(1)]}}class D{static logBones(t){for(let e=0;e<t.bones.length;e++){let s=t.bones[e];console.log(s.data.name+", "+s.a+", "+s.b+", "+s.c+", "+s.d+", "+s.worldX+", "+s.worldY)}}}class O{items=new Array;instantiator;constructor(t){this.instantiator=t}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(t){t.reset&&t.reset(),this.items.push(t)}freeAll(t){for(let e=0;e<t.length;e++)this.free(t[e])}clear(){this.items.length=0}}class N{x;y;constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}length(){let t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}normalize(){let t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}}class L{maxDelta=.064;framesPerSecond=0;delta=0;totalTime=0;lastTime=Date.now()/1e3;frameCount=0;frameTime=0;update(){let t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)}}class q{values;addedValues=0;lastValue=0;mean=0;dirty=!0;constructor(t=32){this.values=new Array(t)}hasEnoughData(){return this.addedValues>=this.values.length}addValue(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0}getMean(){if(this.hasEnoughData()){if(this.dirty){let t=0;for(let e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0}}class U{name;constructor(t){if(!t)throw new Error("name cannot be null.");this.name=t}}class W extends U{static nextID=0;id=W.nextID++;bones=null;vertices=[];worldVerticesLength=0;timelineAttachment=this;constructor(t){super(t)}computeWorldVertices(t,e,s,a,n,r){s=n+(s>>1)*r;let i=t.bone.skeleton,o=t.deform,l=this.vertices,h=this.bones;if(!h){o.length>0&&(l=o);let i=t.bone,h=i.worldX,c=i.worldY,d=i.a,u=i.b,m=i.c,f=i.d;for(let t=e,i=n;i<s;t+=2,i+=r){let e=l[t],s=l[t+1];a[i]=e*d+s*u+h,a[i+1]=e*m+s*f+c}return}let c=0,d=0;for(let t=0;t<e;t+=2){let t=h[c];c+=t+1,d+=t}let u=i.bones;if(0==o.length)for(let t=n,e=3*d;t<s;t+=r){let s=0,n=0,r=h[c++];for(r+=c;c<r;c++,e+=3){let t=u[h[c]],a=l[e],r=l[e+1],i=l[e+2];s+=(a*t.a+r*t.b+t.worldX)*i,n+=(a*t.c+r*t.d+t.worldY)*i}a[t]=s,a[t+1]=n}else{let t=o;for(let e=n,i=3*d,o=d<<1;e<s;e+=r){let s=0,n=0,r=h[c++];for(r+=c;c<r;c++,i+=3,o+=2){let e=u[h[c]],a=l[i]+t[o],r=l[i+1]+t[o+1],d=l[i+2];s+=(a*e.a+r*e.b+e.worldX)*d,n+=(a*e.c+r*e.d+e.worldY)*d}a[e]=s,a[e+1]=n}}}copyTo(t){this.bones?(t.bones=new Array(this.bones.length),V.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,this.vertices&&(t.vertices=V.newFloatArray(this.vertices.length),V.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)),t.worldVerticesLength=this.worldVerticesLength,t.timelineAttachment=this.timelineAttachment}}class z{static _nextID=0;id=z.nextID();regions;start=0;digits=0;setupIndex=0;constructor(t){this.regions=new Array(t)}copy(){let t=new z(this.regions.length);return V.arrayCopy(this.regions,0,t.regions,0,this.regions.length),t.start=this.start,t.digits=this.digits,t.setupIndex=this.setupIndex,t}apply(t,e){let s=t.sequenceIndex;-1==s&&(s=this.setupIndex),s>=this.regions.length&&(s=this.regions.length-1);let a=this.regions[s];e.region!=a&&(e.region=a,e.updateRegion())}getPath(t,e){let s=t,a=(this.start+e).toString();for(let t=this.digits-a.length;t>0;t--)s+="0";return s+=a,s}static nextID(){return z._nextID++}}var $;!function(t){t[t.hold=0]="hold",t[t.once=1]="once",t[t.loop=2]="loop",t[t.pingpong=3]="pingpong",t[t.onceReverse=4]="onceReverse",t[t.loopReverse=5]="loopReverse",t[t.pingpongReverse=6]="pingpongReverse"}($||($={}));const G=[$.hold,$.once,$.loop,$.pingpong,$.onceReverse,$.loopReverse,$.pingpongReverse];class j{name;timelines=[];timelineIds=new Y;duration;constructor(t,e,s){if(!t)throw new Error("name cannot be null.");this.name=t,this.setTimelines(e),this.duration=s}setTimelines(t){if(!t)throw new Error("timelines cannot be null.");this.timelines=t,this.timelineIds.clear();for(var e=0;e<t.length;e++)this.timelineIds.addAll(t[e].getPropertyIds())}hasTimeline(t){for(let e=0;e<t.length;e++)if(this.timelineIds.contains(t[e]))return!0;return!1}apply(t,e,s,a,n,r,i,o){if(!t)throw new Error("skeleton cannot be null.");a&&0!=this.duration&&(s%=this.duration,e>0&&(e%=this.duration));let l=this.timelines;for(let a=0,h=l.length;a<h;a++)l[a].apply(t,e,s,n,r,i,o)}}var H,J;!function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(H||(H={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(J||(J={}));const K={rotate:0,x:1,y:2,scaleX:3,scaleY:4,shearX:5,shearY:6,inherit:7,rgb:8,alpha:9,rgb2:10,attachment:11,deform:12,event:13,drawOrder:14,ikConstraint:15,transformConstraint:16,pathConstraintPosition:17,pathConstraintSpacing:18,pathConstraintMix:19,physicsConstraintInertia:20,physicsConstraintStrength:21,physicsConstraintDamping:22,physicsConstraintMass:23,physicsConstraintWind:24,physicsConstraintGravity:25,physicsConstraintMix:26,physicsConstraintReset:27,sequence:28};class Z{propertyIds;frames;constructor(t,e){this.propertyIds=e,this.frames=V.newFloatArray(t*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(t,e){let s=t.length;for(let a=1;a<s;a++)if(t[a]>e)return a-1;return s-1}static search(t,e,s){let a=t.length;for(let n=s;n<a;n+=s)if(t[n]>e)return n-s;return a-s}}class Q extends Z{curves;constructor(t,e,s){super(t,s),this.curves=V.newFloatArray(t+18*e),this.curves[t-1]=1}setLinear(t){this.curves[t]=0}setStepped(t){this.curves[t]=1}shrink(t){let e=this.getFrameCount()+18*t;if(this.curves.length>e){let t=V.newFloatArray(e);V.arrayCopy(this.curves,0,t,0,e),this.curves=t}}setBezier(t,e,s,a,n,r,i,o,l,h,c){let d=this.curves,u=this.getFrameCount()+18*t;0==s&&(d[e]=2+u);let m=.03*(a-2*r+o),f=.03*(n-2*i+l),g=.006*(3*(r-o)-a+h),p=.006*(3*(i-l)-n+c),x=2*m+g,w=2*f+p,b=.3*(r-a)+m+.16666667*g,y=.3*(i-n)+f+.16666667*p,k=a+b,v=n+y;for(let t=u+18;u<t;u+=2)d[u]=k,d[u+1]=v,b+=x,y+=w,x+=g,w+=p,k+=b,v+=y}getBezierValue(t,e,s,a){let n=this.curves;if(n[a]>t){let r=this.frames[e],i=this.frames[e+s];return i+(t-r)/(n[a]-r)*(n[a+1]-i)}let r=a+18;for(a+=2;a<r;a+=2)if(n[a]>=t){let e=n[a-2],s=n[a-1];return s+(t-e)/(n[a]-e)*(n[a+1]-s)}e+=this.getFrameEntries();let i=n[r-2],o=n[r-1];return o+(t-i)/(this.frames[e]-i)*(this.frames[e+s]-o)}}class tt extends Q{constructor(t,e,s){super(t,e,[s])}getFrameEntries(){return 2}setFrame(t,e,s){t<<=1,this.frames[t]=e,this.frames[t+1]=s}getCurveValue(t){let e=this.frames,s=e.length-2;for(let a=2;a<=s;a+=2)if(e[a]>t){s=a-2;break}let a=this.curves[s>>1];switch(a){case 0:let a=e[s],n=e[s+1];return n+(t-a)/(e[s+2]-a)*(e[s+2+1]-n);case 1:return e[s+1]}return this.getBezierValue(t,s,1,a-2)}getRelativeValue(t,e,s,a,n){if(t<this.frames[0]){switch(s){case H.setup:return n;case H.first:return a+(n-a)*e}return a}let r=this.getCurveValue(t);switch(s){case H.setup:return n+r*e;case H.first:case H.replace:r+=n-a}return a+r*e}getAbsoluteValue(t,e,s,a,n){if(t<this.frames[0]){switch(s){case H.setup:return n;case H.first:return a+(n-a)*e}return a}let r=this.getCurveValue(t);return s==H.setup?n+(r-n)*e:a+(r-a)*e}getAbsoluteValue2(t,e,s,a,n,r){if(t<this.frames[0]){switch(s){case H.setup:return n;case H.first:return a+(n-a)*e}return a}return s==H.setup?n+(r-n)*e:a+(r-a)*e}getScaleValue(t,e,s,a,n,r){if(t<this.frames[0]){switch(s){case H.setup:return r;case H.first:return n+(r-n)*e}return n}let i=this.getCurveValue(t)*r;if(1==e)return s==H.add?n+i-r:i;if(a==J.mixOut)switch(s){case H.setup:return r+(Math.abs(i)*X.signum(r)-r)*e;case H.first:case H.replace:return n+(Math.abs(i)*X.signum(n)-n)*e}else{let t=0;switch(s){case H.setup:return t=Math.abs(r)*X.signum(i),t+(i-t)*e;case H.first:case H.replace:return t=Math.abs(n)*X.signum(i),t+(i-t)*e}}return n+(i-r)*e}}class et extends Q{constructor(t,e,s,a){super(t,e,[s,a])}getFrameEntries(){return 3}setFrame(t,e,s,a){t*=3,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=a}}class st extends tt{boneIndex=0;constructor(t,e,s){super(t,e,K.rotate+"|"+s),this.boneIndex=s}apply(t,e,s,a,n,r,i){let o=t.bones[this.boneIndex];o.active&&(o.rotation=this.getRelativeValue(s,n,r,o.rotation,o.data.rotation))}}class at extends et{boneIndex=0;constructor(t,e,s){super(t,e,K.x+"|"+s,K.y+"|"+s),this.boneIndex=s}apply(t,e,s,a,n,r,i){let o=t.bones[this.boneIndex];if(!o.active)return;let l=this.frames;if(s<l[0]){switch(r){case H.setup:return o.x=o.data.x,void(o.y=o.data.y);case H.first:o.x+=(o.data.x-o.x)*n,o.y+=(o.data.y-o.y)*n}return}let h=0,c=0,d=Z.search(l,s,3),u=this.curves[d/3];switch(u){case 0:let t=l[d];h=l[d+1],c=l[d+2];let e=(s-t)/(l[d+3]-t);h+=(l[d+3+1]-h)*e,c+=(l[d+3+2]-c)*e;break;case 1:h=l[d+1],c=l[d+2];break;default:h=this.getBezierValue(s,d,1,u-2),c=this.getBezierValue(s,d,2,u+18-2)}switch(r){case H.setup:o.x=o.data.x+h*n,o.y=o.data.y+c*n;break;case H.first:case H.replace:o.x+=(o.data.x+h-o.x)*n,o.y+=(o.data.y+c-o.y)*n;break;case H.add:o.x+=h*n,o.y+=c*n}}}class nt extends tt{boneIndex=0;constructor(t,e,s){super(t,e,K.x+"|"+s),this.boneIndex=s}apply(t,e,s,a,n,r,i){let o=t.bones[this.boneIndex];o.active&&(o.x=this.getRelativeValue(s,n,r,o.x,o.data.x))}}class rt extends tt{boneIndex=0;constructor(t,e,s){super(t,e,K.y+"|"+s),this.boneIndex=s}apply(t,e,s,a,n,r,i){let o=t.bones[this.boneIndex];o.active&&(o.y=this.getRelativeValue(s,n,r,o.y,o.data.y))}}class it extends et{boneIndex=0;constructor(t,e,s){super(t,e,K.scaleX+"|"+s,K.scaleY+"|"+s),this.boneIndex=s}apply(t,e,s,a,n,r,i){let o=t.bones[this.boneIndex];if(!o.active)return;let l,h,c=this.frames;if(s<c[0]){switch(r){case H.setup:return o.scaleX=o.data.scaleX,void(o.scaleY=o.data.scaleY);case H.first:o.scaleX+=(o.data.scaleX-o.scaleX)*n,o.scaleY+=(o.data.scaleY-o.scaleY)*n}return}let d=Z.search(c,s,3),u=this.curves[d/3];switch(u){case 0:let t=c[d];l=c[d+1],h=c[d+2];let e=(s-t)/(c[d+3]-t);l+=(c[d+3+1]-l)*e,h+=(c[d+3+2]-h)*e;break;case 1:l=c[d+1],h=c[d+2];break;default:l=this.getBezierValue(s,d,1,u-2),h=this.getBezierValue(s,d,2,u+18-2)}if(l*=o.data.scaleX,h*=o.data.scaleY,1==n)r==H.add?(o.scaleX+=l-o.data.scaleX,o.scaleY+=h-o.data.scaleY):(o.scaleX=l,o.scaleY=h);else{let t=0,e=0;if(i==J.mixOut)switch(r){case H.setup:t=o.data.scaleX,e=o.data.scaleY,o.scaleX=t+(Math.abs(l)*X.signum(t)-t)*n,o.scaleY=e+(Math.abs(h)*X.signum(e)-e)*n;break;case H.first:case H.replace:t=o.scaleX,e=o.scaleY,o.scaleX=t+(Math.abs(l)*X.signum(t)-t)*n,o.scaleY=e+(Math.abs(h)*X.signum(e)-e)*n;break;case H.add:o.scaleX+=(l-o.data.scaleX)*n,o.scaleY+=(h-o.data.scaleY)*n}else switch(r){case H.setup:t=Math.abs(o.data.scaleX)*X.signum(l),e=Math.abs(o.data.scaleY)*X.signum(h),o.scaleX=t+(l-t)*n,o.scaleY=e+(h-e)*n;break;case H.first:case H.replace:t=Math.abs(o.scaleX)*X.signum(l),e=Math.abs(o.scaleY)*X.signum(h),o.scaleX=t+(l-t)*n,o.scaleY=e+(h-e)*n;break;case H.add:o.scaleX+=(l-o.data.scaleX)*n,o.scaleY+=(h-o.data.scaleY)*n}}}}class ot extends tt{boneIndex=0;constructor(t,e,s){super(t,e,K.scaleX+"|"+s),this.boneIndex=s}apply(t,e,s,a,n,r,i){let o=t.bones[this.boneIndex];o.active&&(o.scaleX=this.getScaleValue(s,n,r,i,o.scaleX,o.data.scaleX))}}class lt extends tt{boneIndex=0;constructor(t,e,s){super(t,e,K.scaleY+"|"+s),this.boneIndex=s}apply(t,e,s,a,n,r,i){let o=t.bones[this.boneIndex];o.active&&(o.scaleY=this.getScaleValue(s,n,r,i,o.scaleY,o.data.scaleY))}}class ht extends et{boneIndex=0;constructor(t,e,s){super(t,e,K.shearX+"|"+s,K.shearY+"|"+s),this.boneIndex=s}apply(t,e,s,a,n,r,i){let o=t.bones[this.boneIndex];if(!o.active)return;let l=this.frames;if(s<l[0]){switch(r){case H.setup:return o.shearX=o.data.shearX,void(o.shearY=o.data.shearY);case H.first:o.shearX+=(o.data.shearX-o.shearX)*n,o.shearY+=(o.data.shearY-o.shearY)*n}return}let h=0,c=0,d=Z.search(l,s,3),u=this.curves[d/3];switch(u){case 0:let t=l[d];h=l[d+1],c=l[d+2];let e=(s-t)/(l[d+3]-t);h+=(l[d+3+1]-h)*e,c+=(l[d+3+2]-c)*e;break;case 1:h=l[d+1],c=l[d+2];break;default:h=this.getBezierValue(s,d,1,u-2),c=this.getBezierValue(s,d,2,u+18-2)}switch(r){case H.setup:o.shearX=o.data.shearX+h*n,o.shearY=o.data.shearY+c*n;break;case H.first:case H.replace:o.shearX+=(o.data.shearX+h-o.shearX)*n,o.shearY+=(o.data.shearY+c-o.shearY)*n;break;case H.add:o.shearX+=h*n,o.shearY+=c*n}}}class ct extends tt{boneIndex=0;constructor(t,e,s){super(t,e,K.shearX+"|"+s),this.boneIndex=s}apply(t,e,s,a,n,r,i){let o=t.bones[this.boneIndex];o.active&&(o.shearX=this.getRelativeValue(s,n,r,o.shearX,o.data.shearX))}}class dt extends tt{boneIndex=0;constructor(t,e,s){super(t,e,K.shearY+"|"+s),this.boneIndex=s}apply(t,e,s,a,n,r,i){let o=t.bones[this.boneIndex];o.active&&(o.shearY=this.getRelativeValue(s,n,r,o.shearY,o.data.shearY))}}class ut extends Z{boneIndex=0;constructor(t,e){super(t,[K.inherit+"|"+e]),this.boneIndex=e}getFrameEntries(){return 2}setFrame(t,e,s){t*=2,this.frames[t]=e,this.frames[t+1]=s}apply(t,e,s,a,n,r,i){let o=t.bones[this.boneIndex];if(!o.active)return;let l=this.frames;s<l[0]?r!=H.setup&&r!=H.first||(o.inherit=o.data.inherit):o.inherit=this.frames[Z.search(l,s,2)+1]}}class mt extends Q{slotIndex=0;constructor(t,e,s){super(t,e,[K.rgb+"|"+s,K.alpha+"|"+s]),this.slotIndex=s}getFrameEntries(){return 5}setFrame(t,e,s,a,n,r){t*=5,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=a,this.frames[t+3]=n,this.frames[t+4]=r}apply(t,e,s,a,n,r,i){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color;if(s<l[0]){let t=o.data.color;switch(r){case H.setup:return void h.setFromColor(t);case H.first:h.add((t.r-h.r)*n,(t.g-h.g)*n,(t.b-h.b)*n,(t.a-h.a)*n)}return}let c=0,d=0,u=0,m=0,f=Z.search(l,s,5),g=this.curves[f/5];switch(g){case 0:let t=l[f];c=l[f+1],d=l[f+2],u=l[f+3],m=l[f+4];let e=(s-t)/(l[f+5]-t);c+=(l[f+5+1]-c)*e,d+=(l[f+5+2]-d)*e,u+=(l[f+5+3]-u)*e,m+=(l[f+5+4]-m)*e;break;case 1:c=l[f+1],d=l[f+2],u=l[f+3],m=l[f+4];break;default:c=this.getBezierValue(s,f,1,g-2),d=this.getBezierValue(s,f,2,g+18-2),u=this.getBezierValue(s,f,3,g+36-2),m=this.getBezierValue(s,f,4,g+54-2)}1==n?h.set(c,d,u,m):(r==H.setup&&h.setFromColor(o.data.color),h.add((c-h.r)*n,(d-h.g)*n,(u-h.b)*n,(m-h.a)*n))}}class ft extends Q{slotIndex=0;constructor(t,e,s){super(t,e,[K.rgb+"|"+s]),this.slotIndex=s}getFrameEntries(){return 4}setFrame(t,e,s,a,n){t<<=2,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=a,this.frames[t+3]=n}apply(t,e,s,a,n,r,i){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color;if(s<l[0]){let t=o.data.color;switch(r){case H.setup:return h.r=t.r,h.g=t.g,void(h.b=t.b);case H.first:h.r+=(t.r-h.r)*n,h.g+=(t.g-h.g)*n,h.b+=(t.b-h.b)*n}return}let c=0,d=0,u=0,m=Z.search(l,s,4),f=this.curves[m>>2];switch(f){case 0:let t=l[m];c=l[m+1],d=l[m+2],u=l[m+3];let e=(s-t)/(l[m+4]-t);c+=(l[m+4+1]-c)*e,d+=(l[m+4+2]-d)*e,u+=(l[m+4+3]-u)*e;break;case 1:c=l[m+1],d=l[m+2],u=l[m+3];break;default:c=this.getBezierValue(s,m,1,f-2),d=this.getBezierValue(s,m,2,f+18-2),u=this.getBezierValue(s,m,3,f+36-2)}if(1==n)h.r=c,h.g=d,h.b=u;else{if(r==H.setup){let t=o.data.color;h.r=t.r,h.g=t.g,h.b=t.b}h.r+=(c-h.r)*n,h.g+=(d-h.g)*n,h.b+=(u-h.b)*n}}}class gt extends tt{slotIndex=0;constructor(t,e,s){super(t,e,K.alpha+"|"+s),this.slotIndex=s}apply(t,e,s,a,n,r,i){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=o.color;if(s<this.frames[0]){let t=o.data.color;switch(r){case H.setup:return void(l.a=t.a);case H.first:l.a+=(t.a-l.a)*n}return}let h=this.getCurveValue(s);1==n?l.a=h:(r==H.setup&&(l.a=o.data.color.a),l.a+=(h-l.a)*n)}}class pt extends Q{slotIndex=0;constructor(t,e,s){super(t,e,[K.rgb+"|"+s,K.alpha+"|"+s,K.rgb2+"|"+s]),this.slotIndex=s}getFrameEntries(){return 8}setFrame(t,e,s,a,n,r,i,o,l){t<<=3,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=a,this.frames[t+3]=n,this.frames[t+4]=r,this.frames[t+5]=i,this.frames[t+6]=o,this.frames[t+7]=l}apply(t,e,s,a,n,r,i){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color,c=o.darkColor;if(s<l[0]){let t=o.data.color,e=o.data.darkColor;switch(r){case H.setup:return h.setFromColor(t),c.r=e.r,c.g=e.g,void(c.b=e.b);case H.first:h.add((t.r-h.r)*n,(t.g-h.g)*n,(t.b-h.b)*n,(t.a-h.a)*n),c.r+=(e.r-c.r)*n,c.g+=(e.g-c.g)*n,c.b+=(e.b-c.b)*n}return}let d=0,u=0,m=0,f=0,g=0,p=0,x=0,w=Z.search(l,s,8),b=this.curves[w>>3];switch(b){case 0:let t=l[w];d=l[w+1],u=l[w+2],m=l[w+3],f=l[w+4],g=l[w+5],p=l[w+6],x=l[w+7];let e=(s-t)/(l[w+8]-t);d+=(l[w+8+1]-d)*e,u+=(l[w+8+2]-u)*e,m+=(l[w+8+3]-m)*e,f+=(l[w+8+4]-f)*e,g+=(l[w+8+5]-g)*e,p+=(l[w+8+6]-p)*e,x+=(l[w+8+7]-x)*e;break;case 1:d=l[w+1],u=l[w+2],m=l[w+3],f=l[w+4],g=l[w+5],p=l[w+6],x=l[w+7];break;default:d=this.getBezierValue(s,w,1,b-2),u=this.getBezierValue(s,w,2,b+18-2),m=this.getBezierValue(s,w,3,b+36-2),f=this.getBezierValue(s,w,4,b+54-2),g=this.getBezierValue(s,w,5,b+72-2),p=this.getBezierValue(s,w,6,b+90-2),x=this.getBezierValue(s,w,7,b+108-2)}if(1==n)h.set(d,u,m,f),c.r=g,c.g=p,c.b=x;else{if(r==H.setup){h.setFromColor(o.data.color);let t=o.data.darkColor;c.r=t.r,c.g=t.g,c.b=t.b}h.add((d-h.r)*n,(u-h.g)*n,(m-h.b)*n,(f-h.a)*n),c.r+=(g-c.r)*n,c.g+=(p-c.g)*n,c.b+=(x-c.b)*n}}}class xt extends Q{slotIndex=0;constructor(t,e,s){super(t,e,[K.rgb+"|"+s,K.rgb2+"|"+s]),this.slotIndex=s}getFrameEntries(){return 7}setFrame(t,e,s,a,n,r,i,o){t*=7,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=a,this.frames[t+3]=n,this.frames[t+4]=r,this.frames[t+5]=i,this.frames[t+6]=o}apply(t,e,s,a,n,r,i){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=this.frames,h=o.color,c=o.darkColor;if(s<l[0]){let t=o.data.color,e=o.data.darkColor;switch(r){case H.setup:return h.r=t.r,h.g=t.g,h.b=t.b,c.r=e.r,c.g=e.g,void(c.b=e.b);case H.first:h.r+=(t.r-h.r)*n,h.g+=(t.g-h.g)*n,h.b+=(t.b-h.b)*n,c.r+=(e.r-c.r)*n,c.g+=(e.g-c.g)*n,c.b+=(e.b-c.b)*n}return}let d=0,u=0,m=0,f=0,g=0,p=0,x=Z.search(l,s,7),w=this.curves[x/7];switch(w){case 0:let t=l[x];d=l[x+1],u=l[x+2],m=l[x+3],f=l[x+4],g=l[x+5],p=l[x+6];let e=(s-t)/(l[x+7]-t);d+=(l[x+7+1]-d)*e,u+=(l[x+7+2]-u)*e,m+=(l[x+7+3]-m)*e,f+=(l[x+7+4]-f)*e,g+=(l[x+7+5]-g)*e,p+=(l[x+7+6]-p)*e;break;case 1:d=l[x+1],u=l[x+2],m=l[x+3],f=l[x+4],g=l[x+5],p=l[x+6];break;default:d=this.getBezierValue(s,x,1,w-2),u=this.getBezierValue(s,x,2,w+18-2),m=this.getBezierValue(s,x,3,w+36-2),f=this.getBezierValue(s,x,4,w+54-2),g=this.getBezierValue(s,x,5,w+72-2),p=this.getBezierValue(s,x,6,w+90-2)}if(1==n)h.r=d,h.g=u,h.b=m,c.r=f,c.g=g,c.b=p;else{if(r==H.setup){let t=o.data.color,e=o.data.darkColor;h.r=t.r,h.g=t.g,h.b=t.b,c.r=e.r,c.g=e.g,c.b=e.b}h.r+=(d-h.r)*n,h.g+=(u-h.g)*n,h.b+=(m-h.b)*n,c.r+=(f-c.r)*n,c.g+=(g-c.g)*n,c.b+=(p-c.b)*n}}}class wt extends Z{slotIndex=0;attachmentNames;constructor(t,e){super(t,[K.attachment+"|"+e]),this.slotIndex=e,this.attachmentNames=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.attachmentNames[t]=s}apply(t,e,s,a,n,r,i){let o=t.slots[this.slotIndex];o.bone.active&&(i!=J.mixOut?s<this.frames[0]?r!=H.setup&&r!=H.first||this.setAttachment(t,o,o.data.attachmentName):this.setAttachment(t,o,this.attachmentNames[Z.search1(this.frames,s)]):r==H.setup&&this.setAttachment(t,o,o.data.attachmentName))}setAttachment(t,e,s){e.setAttachment(s?t.getAttachment(this.slotIndex,s):null)}}class bt extends Q{slotIndex=0;attachment;vertices;constructor(t,e,s,a){super(t,e,[K.deform+"|"+s+"|"+a.id]),this.slotIndex=s,this.attachment=a,this.vertices=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.vertices[t]=s}setBezier(t,e,s,a,n,r,i,o,l,h,c){let d=this.curves,u=this.getFrameCount()+18*t;0==s&&(d[e]=2+u);let m=.03*(a-2*r+o),f=.03*l-.06*i,g=.006*(3*(r-o)-a+h),p=.018*(i-l+.33333333),x=2*m+g,w=2*f+p,b=.3*(r-a)+m+.16666667*g,y=.3*i+f+.16666667*p,k=a+b,v=y;for(let t=u+18;u<t;u+=2)d[u]=k,d[u+1]=v,b+=x,y+=w,x+=g,w+=p,k+=b,v+=y}getCurvePercent(t,e){let s=this.curves,a=s[e];switch(a){case 0:let s=this.frames[e];return(t-s)/(this.frames[e+this.getFrameEntries()]-s);case 1:return 0}if(a-=2,s[a]>t){let n=this.frames[e];return s[a+1]*(t-n)/(s[a]-n)}let n=a+18;for(a+=2;a<n;a+=2)if(s[a]>=t){let e=s[a-2],n=s[a-1];return n+(t-e)/(s[a]-e)*(s[a+1]-n)}let r=s[n-2],i=s[n-1];return i+(1-i)*(t-r)/(this.frames[e+this.getFrameEntries()]-r)}apply(t,e,s,a,n,r,i){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=o.getAttachment();if(!l)return;if(!(l instanceof W)||l.timelineAttachment!=this.attachment)return;let h=o.deform;0==h.length&&(r=H.setup);let c=this.vertices,d=c[0].length,u=this.frames;if(s<u[0]){switch(r){case H.setup:return void(h.length=0);case H.first:if(1==n)return void(h.length=0);h.length=d;let t=l;if(t.bones){n=1-n;for(m=0;m<d;m++)h[m]*=n}else{let e=t.vertices;for(var m=0;m<d;m++)h[m]+=(e[m]-h[m])*n}}return}if(h.length=d,s>=u[u.length-1]){let t=c[u.length-1];if(1==n)if(r==H.add){let e=l;if(e.bones)for(let e=0;e<d;e++)h[e]+=t[e];else{let s=e.vertices;for(let e=0;e<d;e++)h[e]+=t[e]-s[e]}}else V.arrayCopy(t,0,h,0,d);else switch(r){case H.setup:{let e=l;if(e.bones)for(let e=0;e<d;e++)h[e]=t[e]*n;else{let s=e.vertices;for(let e=0;e<d;e++){let a=s[e];h[e]=a+(t[e]-a)*n}}break}case H.first:case H.replace:for(let e=0;e<d;e++)h[e]+=(t[e]-h[e])*n;break;case H.add:let e=l;if(e.bones)for(let e=0;e<d;e++)h[e]+=t[e]*n;else{let s=e.vertices;for(let e=0;e<d;e++)h[e]+=(t[e]-s[e])*n}}return}let f=Z.search1(u,s),g=this.getCurvePercent(s,f),p=c[f],x=c[f+1];if(1==n)if(r==H.add){let t=l;if(t.bones)for(let t=0;t<d;t++){let e=p[t];h[t]+=e+(x[t]-e)*g}else{let e=t.vertices;for(let t=0;t<d;t++){let s=p[t];h[t]+=s+(x[t]-s)*g-e[t]}}}else for(let t=0;t<d;t++){let e=p[t];h[t]=e+(x[t]-e)*g}else switch(r){case H.setup:{let t=l;if(t.bones)for(let t=0;t<d;t++){let e=p[t];h[t]=(e+(x[t]-e)*g)*n}else{let e=t.vertices;for(let t=0;t<d;t++){let s=p[t],a=e[t];h[t]=a+(s+(x[t]-s)*g-a)*n}}break}case H.first:case H.replace:for(let t=0;t<d;t++){let e=p[t];h[t]+=(e+(x[t]-e)*g-h[t])*n}break;case H.add:let t=l;if(t.bones)for(let t=0;t<d;t++){let e=p[t];h[t]+=(e+(x[t]-e)*g)*n}else{let e=t.vertices;for(let t=0;t<d;t++){let s=p[t];h[t]+=(s+(x[t]-s)*g-e[t])*n}}}}}class yt extends Z{static propertyIds=[""+K.event];events;constructor(t){super(t,yt.propertyIds),this.events=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,s,a,n,r,i){if(!a)return;let o=this.frames,l=this.frames.length;if(e>s)this.apply(t,e,Number.MAX_VALUE,a,n,r,i),e=-1;else if(e>=o[l-1])return;if(s<o[0])return;let h=0;if(e<o[0])h=0;else{h=Z.search1(o,e)+1;let t=o[h];for(;h>0&&o[h-1]==t;)h--}for(;h<l&&s>=o[h];h++)a.push(this.events[h])}}class kt extends Z{static propertyIds=[""+K.drawOrder];drawOrders;constructor(t){super(t,kt.propertyIds),this.drawOrders=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,s){this.frames[t]=e,this.drawOrders[t]=s}apply(t,e,s,a,n,r,i){if(i==J.mixOut)return void(r==H.setup&&V.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));if(s<this.frames[0])return void(r!=H.setup&&r!=H.first||V.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let o=Z.search1(this.frames,s),l=this.drawOrders[o];if(l){let e=t.drawOrder,s=t.slots;for(let t=0,a=l.length;t<a;t++)e[t]=s[l[t]]}else V.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}}class vt extends Q{constraintIndex=0;constructor(t,e,s){super(t,e,[K.ikConstraint+"|"+s]),this.constraintIndex=s}getFrameEntries(){return 6}setFrame(t,e,s,a,n,r,i){t*=6,this.frames[t]=e,this.frames[t+1]=s,this.frames[t+2]=a,this.frames[t+3]=n,this.frames[t+4]=r?1:0,this.frames[t+5]=i?1:0}apply(t,e,s,a,n,r,i){let o=t.ikConstraints[this.constraintIndex];if(!o.active)return;let l=this.frames;if(s<l[0]){switch(r){case H.setup:return o.mix=o.data.mix,o.softness=o.data.softness,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,void(o.stretch=o.data.stretch);case H.first:o.mix+=(o.data.mix-o.mix)*n,o.softness+=(o.data.softness-o.softness)*n,o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch}return}let h=0,c=0,d=Z.search(l,s,6),u=this.curves[d/6];switch(u){case 0:let t=l[d];h=l[d+1],c=l[d+2];let e=(s-t)/(l[d+6]-t);h+=(l[d+6+1]-h)*e,c+=(l[d+6+2]-c)*e;break;case 1:h=l[d+1],c=l[d+2];break;default:h=this.getBezierValue(s,d,1,u-2),c=this.getBezierValue(s,d,2,u+18-2)}r==H.setup?(o.mix=o.data.mix+(h-o.data.mix)*n,o.softness=o.data.softness+(c-o.data.softness)*n,i==J.mixOut?(o.bendDirection=o.data.bendDirection,o.compress=o.data.compress,o.stretch=o.data.stretch):(o.bendDirection=l[d+3],o.compress=0!=l[d+4],o.stretch=0!=l[d+5])):(o.mix+=(h-o.mix)*n,o.softness+=(c-o.softness)*n,i==J.mixIn&&(o.bendDirection=l[d+3],o.compress=0!=l[d+4],o.stretch=0!=l[d+5]))}}class St extends Q{constraintIndex=0;constructor(t,e,s){super(t,e,[K.transformConstraint+"|"+s]),this.constraintIndex=s}getFrameEntries(){return 7}setFrame(t,e,s,a,n,r,i,o){let l=this.frames;l[t*=7]=e,l[t+1]=s,l[t+2]=a,l[t+3]=n,l[t+4]=r,l[t+5]=i,l[t+6]=o}apply(t,e,s,a,n,r,i){let o=t.transformConstraints[this.constraintIndex];if(!o.active)return;let l,h,c,d,u,m,f=this.frames;if(s<f[0]){let t=o.data;switch(r){case H.setup:return o.mixRotate=t.mixRotate,o.mixX=t.mixX,o.mixY=t.mixY,o.mixScaleX=t.mixScaleX,o.mixScaleY=t.mixScaleY,void(o.mixShearY=t.mixShearY);case H.first:o.mixRotate+=(t.mixRotate-o.mixRotate)*n,o.mixX+=(t.mixX-o.mixX)*n,o.mixY+=(t.mixY-o.mixY)*n,o.mixScaleX+=(t.mixScaleX-o.mixScaleX)*n,o.mixScaleY+=(t.mixScaleY-o.mixScaleY)*n,o.mixShearY+=(t.mixShearY-o.mixShearY)*n}return}let g=Z.search(f,s,7),p=this.curves[g/7];switch(p){case 0:let t=f[g];l=f[g+1],h=f[g+2],c=f[g+3],d=f[g+4],u=f[g+5],m=f[g+6];let e=(s-t)/(f[g+7]-t);l+=(f[g+7+1]-l)*e,h+=(f[g+7+2]-h)*e,c+=(f[g+7+3]-c)*e,d+=(f[g+7+4]-d)*e,u+=(f[g+7+5]-u)*e,m+=(f[g+7+6]-m)*e;break;case 1:l=f[g+1],h=f[g+2],c=f[g+3],d=f[g+4],u=f[g+5],m=f[g+6];break;default:l=this.getBezierValue(s,g,1,p-2),h=this.getBezierValue(s,g,2,p+18-2),c=this.getBezierValue(s,g,3,p+36-2),d=this.getBezierValue(s,g,4,p+54-2),u=this.getBezierValue(s,g,5,p+72-2),m=this.getBezierValue(s,g,6,p+90-2)}if(r==H.setup){let t=o.data;o.mixRotate=t.mixRotate+(l-t.mixRotate)*n,o.mixX=t.mixX+(h-t.mixX)*n,o.mixY=t.mixY+(c-t.mixY)*n,o.mixScaleX=t.mixScaleX+(d-t.mixScaleX)*n,o.mixScaleY=t.mixScaleY+(u-t.mixScaleY)*n,o.mixShearY=t.mixShearY+(m-t.mixShearY)*n}else o.mixRotate+=(l-o.mixRotate)*n,o.mixX+=(h-o.mixX)*n,o.mixY+=(c-o.mixY)*n,o.mixScaleX+=(d-o.mixScaleX)*n,o.mixScaleY+=(u-o.mixScaleY)*n,o.mixShearY+=(m-o.mixShearY)*n}}class At extends tt{constraintIndex=0;constructor(t,e,s){super(t,e,K.pathConstraintPosition+"|"+s),this.constraintIndex=s}apply(t,e,s,a,n,r,i){let o=t.pathConstraints[this.constraintIndex];o.active&&(o.position=this.getAbsoluteValue(s,n,r,o.position,o.data.position))}}class It extends tt{constraintIndex=0;constructor(t,e,s){super(t,e,K.pathConstraintSpacing+"|"+s),this.constraintIndex=s}apply(t,e,s,a,n,r,i){let o=t.pathConstraints[this.constraintIndex];o.active&&(o.spacing=this.getAbsoluteValue(s,n,r,o.spacing,o.data.spacing))}}class Mt extends Q{constraintIndex=0;constructor(t,e,s){super(t,e,[K.pathConstraintMix+"|"+s]),this.constraintIndex=s}getFrameEntries(){return 4}setFrame(t,e,s,a,n){let r=this.frames;r[t<<=2]=e,r[t+1]=s,r[t+2]=a,r[t+3]=n}apply(t,e,s,a,n,r,i){let o=t.pathConstraints[this.constraintIndex];if(!o.active)return;let l,h,c,d=this.frames;if(s<d[0]){switch(r){case H.setup:return o.mixRotate=o.data.mixRotate,o.mixX=o.data.mixX,void(o.mixY=o.data.mixY);case H.first:o.mixRotate+=(o.data.mixRotate-o.mixRotate)*n,o.mixX+=(o.data.mixX-o.mixX)*n,o.mixY+=(o.data.mixY-o.mixY)*n}return}let u=Z.search(d,s,4),m=this.curves[u>>2];switch(m){case 0:let t=d[u];l=d[u+1],h=d[u+2],c=d[u+3];let e=(s-t)/(d[u+4]-t);l+=(d[u+4+1]-l)*e,h+=(d[u+4+2]-h)*e,c+=(d[u+4+3]-c)*e;break;case 1:l=d[u+1],h=d[u+2],c=d[u+3];break;default:l=this.getBezierValue(s,u,1,m-2),h=this.getBezierValue(s,u,2,m+18-2),c=this.getBezierValue(s,u,3,m+36-2)}if(r==H.setup){let t=o.data;o.mixRotate=t.mixRotate+(l-t.mixRotate)*n,o.mixX=t.mixX+(h-t.mixX)*n,o.mixY=t.mixY+(c-t.mixY)*n}else o.mixRotate+=(l-o.mixRotate)*n,o.mixX+=(h-o.mixX)*n,o.mixY+=(c-o.mixY)*n}}class Ct extends tt{constraintIndex=0;constructor(t,e,s,a){super(t,e,a+"|"+s),this.constraintIndex=s}apply(t,e,s,a,n,r,i){let o;if(-1==this.constraintIndex){const e=s>=this.frames[0]?this.getCurveValue(s):0;for(const a of t.physicsConstraints)a.active&&this.global(a.data)&&this.set(a,this.getAbsoluteValue2(s,n,r,this.get(a),this.setup(a),e))}else o=t.physicsConstraints[this.constraintIndex],o.active&&this.set(o,this.getAbsoluteValue(s,n,r,this.get(o),this.setup(o)))}}class Ft extends Ct{constructor(t,e,s){super(t,e,s,K.physicsConstraintInertia)}setup(t){return t.data.inertia}get(t){return t.inertia}set(t,e){t.inertia=e}global(t){return t.inertiaGlobal}}class Tt extends Ct{constructor(t,e,s){super(t,e,s,K.physicsConstraintStrength)}setup(t){return t.data.strength}get(t){return t.strength}set(t,e){t.strength=e}global(t){return t.strengthGlobal}}class Et extends Ct{constructor(t,e,s){super(t,e,s,K.physicsConstraintDamping)}setup(t){return t.data.damping}get(t){return t.damping}set(t,e){t.damping=e}global(t){return t.dampingGlobal}}class Yt extends Ct{constructor(t,e,s){super(t,e,s,K.physicsConstraintMass)}setup(t){return 1/t.data.massInverse}get(t){return 1/t.massInverse}set(t,e){t.massInverse=1/e}global(t){return t.massGlobal}}class Rt extends Ct{constructor(t,e,s){super(t,e,s,K.physicsConstraintWind)}setup(t){return t.data.wind}get(t){return t.wind}set(t,e){t.wind=e}global(t){return t.windGlobal}}class Xt extends Ct{constructor(t,e,s){super(t,e,s,K.physicsConstraintGravity)}setup(t){return t.data.gravity}get(t){return t.gravity}set(t,e){t.gravity=e}global(t){return t.gravityGlobal}}class _t extends Ct{constructor(t,e,s){super(t,e,s,K.physicsConstraintMix)}setup(t){return t.data.mix}get(t){return t.mix}set(t,e){t.mix=e}global(t){return t.mixGlobal}}class Bt extends Z{static propertyIds=[K.physicsConstraintReset.toString()];constraintIndex;constructor(t,e){super(t,Bt.propertyIds),this.constraintIndex=e}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e}apply(t,e,s,a,n,r,i){let o;if(-1!=this.constraintIndex&&(o=t.physicsConstraints[this.constraintIndex],!o.active))return;const l=this.frames;if(e>s)this.apply(t,e,Number.MAX_VALUE,[],n,r,i),e=-1;else if(e>=l[l.length-1])return;if(!(s<l[0])&&(e<l[0]||s>=l[Z.search1(l,e)+1]))if(null!=o)o.reset();else for(const e of t.physicsConstraints)e.active&&e.reset()}}class Pt extends Z{static ENTRIES=3;static MODE=1;static DELAY=2;slotIndex;attachment;constructor(t,e,s){super(t,[K.sequence+"|"+e+"|"+s.sequence.id]),this.slotIndex=e,this.attachment=s}getFrameEntries(){return Pt.ENTRIES}getSlotIndex(){return this.slotIndex}getAttachment(){return this.attachment}setFrame(t,e,s,a,n){let r=this.frames;r[t*=Pt.ENTRIES]=e,r[t+Pt.MODE]=s|a<<4,r[t+Pt.DELAY]=n}apply(t,e,s,a,n,r,i){let o=t.slots[this.slotIndex];if(!o.bone.active)return;let l=o.attachment,h=this.attachment;if(!(l==h||l instanceof W&&l.timelineAttachment==h))return;let c=this.frames;if(s<c[0])return void(r!=H.setup&&r!=H.first||(o.sequenceIndex=-1));let d=Z.search(c,s,Pt.ENTRIES),u=c[d],m=c[d+Pt.MODE],f=c[d+Pt.DELAY];if(!this.attachment.sequence)return;let g=m>>4,p=this.attachment.sequence.regions.length,x=G[15&m];if(x!=$.hold)switch(g+=(s-u)/f+1e-5|0,x){case $.once:g=Math.min(p-1,g);break;case $.loop:g%=p;break;case $.pingpong:{let t=(p<<1)-2;g=0==t?0:g%t,g>=p&&(g=t-g);break}case $.onceReverse:g=Math.max(p-1-g,0);break;case $.loopReverse:g=p-1-g%p;break;case $.pingpongReverse:{let t=(p<<1)-2;g=0==t?0:(g+p-1)%t,g>=p&&(g=t-g)}}o.sequenceIndex=g}}class Vt{static _emptyAnimation=new j("<empty>",[],0);static emptyAnimation(){return Vt._emptyAnimation}data;tracks=new Array;timeScale=1;unkeyedState=0;events=new Array;listeners=new Array;queue=new Ot(this);propertyIDs=new Y;animationsChanged=!1;trackEntryPool=new O((()=>new Dt));constructor(t){this.data=t}update(t){t*=this.timeScale;let e=this.tracks;for(let s=0,a=e.length;s<a;s++){let a=e[s];if(!a)continue;a.animationLast=a.nextAnimationLast,a.trackLast=a.nextTrackLast;let n=t*a.timeScale;if(a.delay>0){if(a.delay-=n,a.delay>0)continue;n=-a.delay,a.delay=0}let r=a.next;if(r){let e=a.trackLast-r.delay;if(e>=0){for(r.delay=0,r.trackTime+=0==a.timeScale?0:(e/a.timeScale+t)*r.timeScale,a.trackTime+=n,this.setCurrent(s,r,!0);r.mixingFrom;)r.mixTime+=t,r=r.mixingFrom;continue}}else if(a.trackLast>=a.trackEnd&&!a.mixingFrom){e[s]=null,this.queue.end(a),this.clearNext(a);continue}if(a.mixingFrom&&this.updateMixingFrom(a,t)){let t=a.mixingFrom;for(a.mixingFrom=null,t&&(t.mixingTo=null);t;)this.queue.end(t),t=t.mixingFrom}a.trackTime+=n}this.queue.drain()}updateMixingFrom(t,e){let s=t.mixingFrom;if(!s)return!0;let a=this.updateMixingFrom(s,e);return s.animationLast=s.nextAnimationLast,s.trackLast=s.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=s.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=s.mixingFrom,s.mixingFrom&&(s.mixingFrom.mixingTo=t),t.interruptAlpha=s.interruptAlpha,this.queue.end(s)),a):(s.trackTime+=e*s.timeScale,t.mixTime+=e,!1)}apply(t){if(!t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();let e=this.events,s=this.tracks,a=!1;for(let r=0,i=s.length;r<i;r++){let i=s[r];if(!i||i.delay>0)continue;a=!0;let o=0==r?H.first:i.mixBlend,l=i.alpha;i.mixingFrom?l*=this.applyMixingFrom(i,t,o):i.trackTime>=i.trackEnd&&!i.next&&(l=0);let h=l>=i.alphaAttachmentThreshold,c=i.animationLast,d=i.getAnimationTime(),u=d,m=e;i.reverse&&(u=i.animation.duration-u,m=null);let f=i.animation.timelines,g=f.length;if(0==r&&1==l||o==H.add){0==r&&(h=!0);for(let e=0;e<g;e++){V.webkit602BugfixHelper(l,o);var n=f[e];n instanceof wt?this.applyAttachmentTimeline(n,t,u,o,h):n.apply(t,c,u,m,l,o,J.mixIn)}}else{let e=i.timelineMode,s=i.shortestRotation,a=!s&&i.timelinesRotation.length!=g<<1;a&&(i.timelinesRotation.length=g<<1);for(let n=0;n<g;n++){let r=f[n],d=e[n]==qt?o:H.setup;!s&&r instanceof st?this.applyRotateTimeline(r,t,u,l,d,i.timelinesRotation,n<<1,a):r instanceof wt?this.applyAttachmentTimeline(r,t,u,o,h):(V.webkit602BugfixHelper(l,o),r.apply(t,c,u,m,l,d,J.mixIn))}}this.queueEvents(i,d),e.length=0,i.nextAnimationLast=d,i.nextTrackLast=i.trackTime}for(var r=this.unkeyedState+Gt,i=t.slots,o=0,l=t.slots.length;o<l;o++){var h=i[o];if(h.attachmentState==r){var c=h.data.attachmentName;h.setAttachment(c?t.getAttachment(h.data.index,c):null)}}return this.unkeyedState+=2,this.queue.drain(),a}applyMixingFrom(t,e,s){let a=t.mixingFrom;a.mixingFrom&&this.applyMixingFrom(a,e,s);let n=0;0==t.mixDuration?(n=1,s==H.first&&(s=H.setup)):(n=t.mixTime/t.mixDuration,n>1&&(n=1),s!=H.first&&(s=a.mixBlend));let r=n<a.mixAttachmentThreshold,i=n<a.mixDrawOrderThreshold,o=a.animation.timelines,l=o.length,h=a.alpha*t.interruptAlpha,c=h*(1-n),d=a.animationLast,u=a.getAnimationTime(),m=u,f=null;if(a.reverse?m=a.animation.duration-m:n<a.eventThreshold&&(f=this.events),s==H.add)for(let t=0;t<l;t++)o[t].apply(e,d,m,f,c,s,J.mixOut);else{let t=a.timelineMode,n=a.timelineHoldMix,u=a.shortestRotation,g=!u&&a.timelinesRotation.length!=l<<1;g&&(a.timelinesRotation.length=l<<1),a.totalAlpha=0;for(let p=0;p<l;p++){let l,x=o[p],w=J.mixOut,b=0;switch(t[p]){case qt:if(!i&&x instanceof kt)continue;l=s,b=c;break;case Ut:l=H.setup,b=c;break;case Wt:l=s,b=h;break;case zt:l=H.setup,b=h;break;default:l=H.setup;let t=n[p];b=h*Math.max(0,1-t.mixTime/t.mixDuration)}a.totalAlpha+=b,!u&&x instanceof st?this.applyRotateTimeline(x,e,m,b,l,a.timelinesRotation,p<<1,g):x instanceof wt?this.applyAttachmentTimeline(x,e,m,l,r&&b>=a.alphaAttachmentThreshold):(V.webkit602BugfixHelper(b,s),i&&x instanceof kt&&l==H.setup&&(w=J.mixIn),x.apply(e,d,m,f,b,l,w))}}return t.mixDuration>0&&this.queueEvents(a,u),this.events.length=0,a.nextAnimationLast=u,a.nextTrackLast=a.trackTime,n}applyAttachmentTimeline(t,e,s,a,n){var r=e.slots[t.slotIndex];r.bone.active&&(s<t.frames[0]?a!=H.setup&&a!=H.first||this.setAttachment(e,r,r.data.attachmentName,n):this.setAttachment(e,r,t.attachmentNames[Z.search1(t.frames,s)],n),r.attachmentState<=this.unkeyedState&&(r.attachmentState=this.unkeyedState+Gt))}setAttachment(t,e,s,a){e.setAttachment(s?t.getAttachment(e.data.index,s):null),a&&(e.attachmentState=this.unkeyedState+jt)}applyRotateTimeline(t,e,s,a,n,r,i,o){if(o&&(r[i]=0),1==a)return void t.apply(e,0,s,null,1,n,J.mixIn);let l=e.bones[t.boneIndex];if(!l.active)return;let h=0,c=0;if(s<t.frames[0])switch(n){case H.setup:l.rotation=l.data.rotation;default:return;case H.first:h=l.rotation,c=l.data.rotation}else h=n==H.setup?l.data.rotation:l.rotation,c=l.data.rotation+t.getCurveValue(s);let d=0,u=c-h;if(u-=360*Math.ceil(u/360-.5),0==u)d=r[i];else{let t=0,e=0;o?(t=0,e=u):(t=r[i],e=r[i+1]);let s=t-t%360;d=u+s;let a=u>=0,n=t>=0;Math.abs(e)<=90&&X.signum(e)!=X.signum(u)&&(Math.abs(t-s)>180?(d+=360*X.signum(t),n=a):0!=s?d-=360*X.signum(t):n=a),n!=a&&(d+=360*X.signum(t)),r[i]=d}r[i+1]=u,l.rotation=h+d*a}queueEvents(t,e){let s=t.animationStart,a=t.animationEnd,n=a-s,r=t.trackLast%n,i=this.events,o=0,l=i.length;for(;o<l;o++){let e=i[o];if(e.time<r)break;e.time>a||this.queue.event(t,e)}let h=!1;if(t.loop)if(0==n)h=!0;else{const e=Math.floor(t.trackTime/n);h=e>0&&e>Math.floor(t.trackLast/n)}else h=e>=a&&t.animationLast<a;for(h&&this.queue.complete(t);o<l;o++){let e=i[o];e.time<s||this.queue.event(t,e)}}clearTracks(){let t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let t=0,e=this.tracks.length;t<e;t++)this.clearTrack(t);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;let e=this.tracks[t];if(!e)return;this.queue.end(e),this.clearNext(e);let s=e;for(;;){let t=s.mixingFrom;if(!t)break;this.queue.end(t),s.mixingFrom=null,s.mixingTo=null,s=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,s){let a=this.expandToIndex(t);this.tracks[t]=e,e.previous=null,a&&(s&&this.queue.interrupt(a),e.mixingFrom=a,a.mixingTo=e,e.mixTime=0,a.mixingFrom&&a.mixDuration>0&&(e.interruptAlpha*=Math.min(1,a.mixTime/a.mixDuration)),a.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,s=!1){let a=this.data.skeletonData.findAnimation(e);if(!a)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,a,s)}setAnimationWith(t,e,s=!1){if(!e)throw new Error("animation cannot be null.");let a=!0,n=this.expandToIndex(t);n&&(-1==n.nextTrackLast?(this.tracks[t]=n.mixingFrom,this.queue.interrupt(n),this.queue.end(n),this.clearNext(n),n=n.mixingFrom,a=!1):this.clearNext(n));let r=this.trackEntry(t,e,s,n);return this.setCurrent(t,r,a),this.queue.drain(),r}addAnimation(t,e,s=!1,a=0){let n=this.data.skeletonData.findAnimation(e);if(!n)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,n,s,a)}addAnimationWith(t,e,s=!1,a=0){if(!e)throw new Error("animation cannot be null.");let n=this.expandToIndex(t);if(n)for(;n.next;)n=n.next;let r=this.trackEntry(t,e,s,n);return n?(n.next=r,r.previous=n,a<=0&&(a+=n.getTrackComplete()-r.mixDuration)):(this.setCurrent(t,r,!0),this.queue.drain()),r.delay=a,r}setEmptyAnimation(t,e=0){let s=this.setAnimationWith(t,Vt.emptyAnimation(),!1);return s.mixDuration=e,s.trackEnd=e,s}addEmptyAnimation(t,e=0,s=0){let a=this.addAnimationWith(t,Vt.emptyAnimation(),!1,s);return s<=0&&(a.delay+=a.mixDuration-e),a.mixDuration=e,a.trackEnd=e,a}setEmptyAnimations(t=0){let e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,s=this.tracks.length;e<s;e++){let s=this.tracks[e];s&&this.setEmptyAnimation(s.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(V.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,s,a){let n=this.trackEntryPool.obtain();return n.reset(),n.trackIndex=t,n.animation=e,n.loop=s,n.holdPrevious=!1,n.reverse=!1,n.shortestRotation=!1,n.eventThreshold=0,n.alphaAttachmentThreshold=0,n.mixAttachmentThreshold=0,n.mixDrawOrderThreshold=0,n.animationStart=0,n.animationEnd=e.duration,n.animationLast=-1,n.nextAnimationLast=-1,n.delay=0,n.trackTime=0,n.trackLast=-1,n.nextTrackLast=-1,n.trackEnd=Number.MAX_VALUE,n.timeScale=1,n.alpha=1,n.mixTime=0,n.mixDuration=a?this.data.getMix(a.animation,e):0,n.interruptAlpha=1,n.totalAlpha=0,n.mixBlend=H.replace,n}clearNext(t){let e=t.next;for(;e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();let t=this.tracks;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(s){for(;s.mixingFrom;)s=s.mixingFrom;do{s.mixingTo&&s.mixBlend==H.add||this.computeHold(s),s=s.mixingTo}while(s)}}}computeHold(t){let e=t.mixingTo,s=t.animation.timelines,a=t.animation.timelines.length,n=t.timelineMode;n.length=a;let r=t.timelineHoldMix;r.length=0;let i=this.propertyIDs;if(e&&e.holdPrevious)for(let t=0;t<a;t++)n[t]=i.addAll(s[t].getPropertyIds())?zt:Wt;else t:for(let o=0;o<a;o++){let a=s[o],l=a.getPropertyIds();if(i.addAll(l))if(!e||a instanceof wt||a instanceof kt||a instanceof yt||!e.animation.hasTimeline(l))n[o]=Ut;else{for(let s=e.mixingTo;s;s=s.mixingTo)if(!s.animation.hasTimeline(l)){if(t.mixDuration>0){n[o]=$t,r[o]=s;continue t}break}n[o]=zt}else n[o]=qt}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(!t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){let e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}}class Dt{animation=null;previous=null;next=null;mixingFrom=null;mixingTo=null;listener=null;trackIndex=0;loop=!1;holdPrevious=!1;reverse=!1;shortestRotation=!1;eventThreshold=0;mixAttachmentThreshold=0;alphaAttachmentThreshold=0;mixDrawOrderThreshold=0;animationStart=0;animationEnd=0;animationLast=0;nextAnimationLast=0;delay=0;trackTime=0;trackLast=0;nextTrackLast=0;trackEnd=0;timeScale=0;alpha=0;mixTime=0;_mixDuration=0;interruptAlpha=0;totalAlpha=0;get mixDuration(){return this._mixDuration}set mixDuration(t){this._mixDuration=t}setMixDurationWithDelay(t,e){this._mixDuration=t,null!=this.previous&&e<=0&&(e+=this.previous.getTrackComplete()-t),this.delay=e}mixBlend=H.replace;timelineMode=new Array;timelineHoldMix=new Array;timelinesRotation=new Array;reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){let t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){let t=this.animationEnd-this.animationStart;if(0!=t){if(this.loop)return t*(1+(this.trackTime/t|0));if(this.trackTime<t)return t}return this.trackTime}wasApplied(){return-1!=this.nextTrackLast}isNextReady(){return null!=this.next&&this.nextTrackLast-this.next.delay>=0}}class Ot{objects=[];drainDisabled=!1;animState;constructor(t){this.animState=t}start(t){this.objects.push(Nt.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(Nt.interrupt),this.objects.push(t)}end(t){this.objects.push(Nt.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(Nt.dispose),this.objects.push(t)}complete(t){this.objects.push(Nt.complete),this.objects.push(t)}event(t,e){this.objects.push(Nt.event),this.objects.push(t),this.objects.push(e)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;let t=this.objects,e=this.animState.listeners;for(let s=0;s<t.length;s+=2){let a=t[s],n=t[s+1];switch(a){case Nt.start:n.listener&&n.listener.start&&n.listener.start(n);for(let t=0;t<e.length;t++){let s=e[t];s.start&&s.start(n)}break;case Nt.interrupt:n.listener&&n.listener.interrupt&&n.listener.interrupt(n);for(let t=0;t<e.length;t++){let s=e[t];s.interrupt&&s.interrupt(n)}break;case Nt.end:n.listener&&n.listener.end&&n.listener.end(n);for(let t=0;t<e.length;t++){let s=e[t];s.end&&s.end(n)}case Nt.dispose:n.listener&&n.listener.dispose&&n.listener.dispose(n);for(let t=0;t<e.length;t++){let s=e[t];s.dispose&&s.dispose(n)}this.animState.trackEntryPool.free(n);break;case Nt.complete:n.listener&&n.listener.complete&&n.listener.complete(n);for(let t=0;t<e.length;t++){let s=e[t];s.complete&&s.complete(n)}break;case Nt.event:let a=t[2+s++];n.listener&&n.listener.event&&n.listener.event(n,a);for(let t=0;t<e.length;t++){let s=e[t];s.event&&s.event(n,a)}}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var Nt;!function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(Nt||(Nt={}));class Lt{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}}const qt=0,Ut=1,Wt=2,zt=3,$t=4,Gt=1,jt=2;class Ht{skeletonData;animationToMixTime={};defaultMix=0;constructor(t){if(!t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,s){let a=this.skeletonData.findAnimation(t);if(!a)throw new Error("Animation not found: "+t);let n=this.skeletonData.findAnimation(e);if(!n)throw new Error("Animation not found: "+e);this.setMixWith(a,n,s)}setMixWith(t,e,s){if(!t)throw new Error("from cannot be null.");if(!e)throw new Error("to cannot be null.");let a=t.name+"."+e.name;this.animationToMixTime[a]=s}getMix(t,e){let s=t.name+"."+e.name,a=this.animationToMixTime[s];return void 0===a?this.defaultMix:a}}class Jt extends W{color=new R(1,1,1,1);constructor(t){super(t)}copy(){let t=new Jt(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class Kt extends W{endSlot=null;color=new R(.2275,.2275,.8078,1);constructor(t){super(t)}copy(){let t=new Kt(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}class Zt{_image;constructor(t){this._image=t}getImage(){return this._image}}var Qt,te,ee,se,ae,ne,re,ie,oe;!function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(Qt||(Qt={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(te||(te={}));class le{texture;u=0;v=0;u2=0;v2=0;width=0;height=0;degrees=0;offsetX=0;offsetY=0;originalWidth=0;originalHeight=0}class he extends Zt{setFilters(t,e){}setWraps(t,e){}dispose(){}}class ce{pages=new Array;regions=new Array;constructor(t){let e=new de(t),s=new Array(4),a={size:t=>{t.width=parseInt(s[1]),t.height=parseInt(s[2])},format:()=>{},filter:t=>{t.minFilter=V.enumValue(Qt,s[1]),t.magFilter=V.enumValue(Qt,s[2])},repeat:t=>{-1!=s[1].indexOf("x")&&(t.uWrap=te.Repeat),-1!=s[1].indexOf("y")&&(t.vWrap=te.Repeat)},pma:t=>{t.pma="true"==s[1]}};var n={xy:t=>{t.x=parseInt(s[1]),t.y=parseInt(s[2])},size:t=>{t.width=parseInt(s[1]),t.height=parseInt(s[2])},bounds:t=>{t.x=parseInt(s[1]),t.y=parseInt(s[2]),t.width=parseInt(s[3]),t.height=parseInt(s[4])},offset:t=>{t.offsetX=parseInt(s[1]),t.offsetY=parseInt(s[2])},orig:t=>{t.originalWidth=parseInt(s[1]),t.originalHeight=parseInt(s[2])},offsets:t=>{t.offsetX=parseInt(s[1]),t.offsetY=parseInt(s[2]),t.originalWidth=parseInt(s[3]),t.originalHeight=parseInt(s[4])},rotate:t=>{let e=s[1];"true"==e?t.degrees=90:"false"!=e&&(t.degrees=parseInt(e))},index:t=>{t.index=parseInt(s[1])}};let r=e.readLine();for(;r&&0==r.trim().length;)r=e.readLine();for(;r&&0!=r.trim().length&&0!=e.readEntry(s,r);)r=e.readLine();let i=null,o=null,l=null;for(;null!==r;)if(0==r.trim().length)i=null,r=e.readLine();else if(i){let t=new me(i,r);for(;;){let a=e.readEntry(s,r=e.readLine());if(0==a)break;let i=n[s[0]];if(i)i(t);else{o||(o=[]),l||(l=[]),o.push(s[0]);let t=[];for(let e=0;e<a;e++)t.push(parseInt(s[e+1]));l.push(t)}}0==t.originalWidth&&0==t.originalHeight&&(t.originalWidth=t.width,t.originalHeight=t.height),o&&o.length>0&&l&&l.length>0&&(t.names=o,t.values=l,o=null,l=null),t.u=t.x/i.width,t.v=t.y/i.height,90==t.degrees?(t.u2=(t.x+t.height)/i.width,t.v2=(t.y+t.width)/i.height):(t.u2=(t.x+t.width)/i.width,t.v2=(t.y+t.height)/i.height),this.regions.push(t)}else{for(i=new ue(r.trim());0!=e.readEntry(s,r=e.readLine());){let t=a[s[0]];t&&t(i)}this.pages.push(i)}}findRegion(t){for(let e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}setTextures(t,e=""){for(let s of this.pages)s.setTexture(t.get(e+s.name))}dispose(){for(let t=0;t<this.pages.length;t++)this.pages[t].texture?.dispose()}}class de{lines;index=0;constructor(t){this.lines=t.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(t,e){if(!e)return 0;if(0==(e=e.trim()).length)return 0;let s=e.indexOf(":");if(-1==s)return 0;t[0]=e.substr(0,s).trim();for(let a=1,n=s+1;;a++){let s=e.indexOf(",",n);if(-1==s)return t[a]=e.substr(n).trim(),a;if(t[a]=e.substr(n,s-n).trim(),n=s+1,4==a)return 4}}}class ue{name;minFilter=Qt.Nearest;magFilter=Qt.Nearest;uWrap=te.ClampToEdge;vWrap=te.ClampToEdge;texture=null;width=0;height=0;pma=!1;regions=new Array;constructor(t){this.name=t}setTexture(t){this.texture=t,t.setFilters(this.minFilter,this.magFilter),t.setWraps(this.uWrap,this.vWrap);for(let e of this.regions)e.texture=t}}class me extends le{page;name;x=0;y=0;offsetX=0;offsetY=0;originalWidth=0;originalHeight=0;index=0;degrees=0;names=null;values=null;constructor(t,e){super(),this.page=t,this.name=e,t.regions.push(this)}}class fe extends W{region=null;path;regionUVs=[];uvs=[];triangles=[];color=new R(1,1,1,1);width=0;height=0;hullLength=0;edges=[];parentMesh=null;sequence=null;tempColor=new R(0,0,0,0);constructor(t,e){super(t),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");let t=this.regionUVs;this.uvs&&this.uvs.length==t.length||(this.uvs=V.newFloatArray(t.length));let e=this.uvs,s=this.uvs.length,a=this.region.u,n=this.region.v,r=0,i=0;if(this.region instanceof me){let o=this.region,l=o.page,h=l.width,c=l.height;switch(o.degrees){case 90:a-=(o.originalHeight-o.offsetY-o.height)/h,n-=(o.originalWidth-o.offsetX-o.width)/c,r=o.originalHeight/h,i=o.originalWidth/c;for(let o=0;o<s;o+=2)e[o]=a+t[o+1]*r,e[o+1]=n+(1-t[o])*i;return;case 180:a-=(o.originalWidth-o.offsetX-o.width)/h,n-=o.offsetY/c,r=o.originalWidth/h,i=o.originalHeight/c;for(let o=0;o<s;o+=2)e[o]=a+(1-t[o])*r,e[o+1]=n+(1-t[o+1])*i;return;case 270:a-=o.offsetY/h,n-=o.offsetX/c,r=o.originalHeight/h,i=o.originalWidth/c;for(let o=0;o<s;o+=2)e[o]=a+(1-t[o+1])*r,e[o+1]=n+t[o]*i;return}a-=o.offsetX/h,n-=(o.originalHeight-o.offsetY-o.height)/c,r=o.originalWidth/h,i=o.originalHeight/c}else this.region?(r=this.region.u2-a,i=this.region.v2-n):(a=n=0,r=i=1);for(let o=0;o<s;o+=2)e[o]=a+t[o]*r,e[o+1]=n+t[o+1]*i}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();let t=new fe(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Array(this.regionUVs.length),V.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.uvs=new Array(this.uvs.length),V.arrayCopy(this.uvs,0,t.uvs,0,this.uvs.length),t.triangles=new Array(this.triangles.length),V.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,t.sequence=null!=this.sequence?this.sequence.copy():null,this.edges&&(t.edges=new Array(this.edges.length),V.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}computeWorldVertices(t,e,s,a,n,r){null!=this.sequence&&this.sequence.apply(t,this),super.computeWorldVertices(t,e,s,a,n,r)}newLinkedMesh(){let t=new fe(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),t.timelineAttachment=this.timelineAttachment,t.setParentMesh(this.parentMesh?this.parentMesh:this),null!=t.region&&t.updateRegion(),t}}class ge extends W{lengths=[];closed=!1;constantSpeed=!1;color=new R(1,1,1,1);constructor(t){super(t)}copy(){let t=new ge(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),V.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class pe extends W{x=0;y=0;rotation=0;color=new R(.38,.94,0,1);constructor(t){super(t)}computeWorldPosition(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e}computeWorldRotation(t){const e=this.rotation*X.degRad,s=Math.cos(e),a=Math.sin(e),n=s*t.a+a*t.b,r=s*t.c+a*t.d;return X.atan2Deg(r,n)}copy(){let t=new pe(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}class xe extends U{x=0;y=0;scaleX=1;scaleY=1;rotation=0;width=0;height=0;color=new R(1,1,1,1);path;region=null;sequence=null;offset=V.newFloatArray(8);uvs=V.newFloatArray(8);tempColor=new R(1,1,1,1);constructor(t,e){super(t),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");let t=this.region,e=this.uvs;if(null==t)return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=1,e[5]=1,e[6]=1,void(e[7]=0);let s=this.width/this.region.originalWidth*this.scaleX,a=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*s,r=-this.height/2*this.scaleY+this.region.offsetY*a,i=n+this.region.width*s,o=r+this.region.height*a,l=this.rotation*X.degRad,h=Math.cos(l),c=Math.sin(l),d=this.x,u=this.y,m=n*h+d,f=n*c,g=r*h+u,p=r*c,x=i*h+d,w=i*c,b=o*h+u,y=o*c,k=this.offset;k[0]=m-p,k[1]=g+f,k[2]=m-y,k[3]=b+f,k[4]=x-y,k[5]=b+w,k[6]=x-p,k[7]=g+w,90==t.degrees?(e[0]=t.u2,e[1]=t.v2,e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,s,a){null!=this.sequence&&this.sequence.apply(t,this);let n=t.bone,r=this.offset,i=n.worldX,o=n.worldY,l=n.a,h=n.b,c=n.c,d=n.d,u=0,m=0;u=r[0],m=r[1],e[s]=u*l+m*h+i,e[s+1]=u*c+m*d+o,s+=a,u=r[2],m=r[3],e[s]=u*l+m*h+i,e[s+1]=u*c+m*d+o,s+=a,u=r[4],m=r[5],e[s]=u*l+m*h+i,e[s+1]=u*c+m*d+o,s+=a,u=r[6],m=r[7],e[s]=u*l+m*h+i,e[s+1]=u*c+m*d+o}copy(){let t=new xe(this.name,this.path);return t.region=this.region,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,V.arrayCopy(this.uvs,0,t.uvs,0,8),V.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t.sequence=null!=this.sequence?this.sequence.copy():null,t}static X1=0;static Y1=1;static C1R=2;static C1G=3;static C1B=4;static C1A=5;static U1=6;static V1=7;static X2=8;static Y2=9;static C2R=10;static C2G=11;static C2B=12;static C2A=13;static U2=14;static V2=15;static X3=16;static Y3=17;static C3R=18;static C3G=19;static C3B=20;static C3A=21;static U3=22;static V3=23;static X4=24;static Y4=25;static C4R=26;static C4G=27;static C4B=28;static C4A=29;static U4=30;static V4=31}class we{atlas;constructor(t){this.atlas=t}loadSequence(t,e,s){let a=s.regions;for(let n=0,r=a.length;n<r;n++){let r=s.getPath(e,n),i=this.atlas.findRegion(r);if(null==i)throw new Error("Region not found in atlas: "+r+" (sequence: "+t+")");a[n]=i}}newRegionAttachment(t,e,s,a){let n=new xe(e,s);if(null!=a)this.loadSequence(e,s,a);else{let t=this.atlas.findRegion(s);if(!t)throw new Error("Region not found in atlas: "+s+" (region attachment: "+e+")");n.region=t}return n}newMeshAttachment(t,e,s,a){let n=new fe(e,s);if(null!=a)this.loadSequence(e,s,a);else{let t=this.atlas.findRegion(s);if(!t)throw new Error("Region not found in atlas: "+s+" (mesh attachment: "+e+")");n.region=t}return n}newBoundingBoxAttachment(t,e){return new Jt(e)}newPathAttachment(t,e){return new ge(e)}newPointAttachment(t,e){return new pe(e)}newClippingAttachment(t,e){return new Kt(e)}}class be{index=0;name;parent=null;length=0;x=0;y=0;rotation=0;scaleX=1;scaleY=1;shearX=0;shearY=0;inherit=ee.Normal;skinRequired=!1;color=new R;icon;visible=!1;constructor(t,e,s){if(t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=s}}!function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(ee||(ee={}));class ye{data;skeleton;parent=null;children=new Array;x=0;y=0;rotation=0;scaleX=0;scaleY=0;shearX=0;shearY=0;ax=0;ay=0;arotation=0;ascaleX=0;ascaleY=0;ashearX=0;ashearY=0;a=0;b=0;c=0;d=0;worldY=0;worldX=0;inherit=ee.Normal;sorted=!1;active=!1;constructor(t,e,s){if(!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=s,this.setToSetupPose()}isActive(){return this.active}update(t){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,s,a,n,r,i){this.ax=t,this.ay=e,this.arotation=s,this.ascaleX=a,this.ascaleY=n,this.ashearX=r,this.ashearY=i;let o=this.parent;if(!o){let o=this.skeleton;const l=o.scaleX,h=o.scaleY,c=(s+r)*X.degRad,d=(s+90+i)*X.degRad;return this.a=Math.cos(c)*a*l,this.b=Math.cos(d)*n*l,this.c=Math.sin(c)*a*h,this.d=Math.sin(d)*n*h,this.worldX=t*l+o.x,void(this.worldY=e*h+o.y)}let l=o.a,h=o.b,c=o.c,d=o.d;switch(this.worldX=l*t+h*e+o.worldX,this.worldY=c*t+d*e+o.worldY,this.inherit){case ee.Normal:{const t=(s+r)*X.degRad,e=(s+90+i)*X.degRad,o=Math.cos(t)*a,u=Math.cos(e)*n,m=Math.sin(t)*a,f=Math.sin(e)*n;return this.a=l*o+h*m,this.b=l*u+h*f,this.c=c*o+d*m,void(this.d=c*u+d*f)}case ee.OnlyTranslation:{const t=(s+r)*X.degRad,e=(s+90+i)*X.degRad;this.a=Math.cos(t)*a,this.b=Math.cos(e)*n,this.c=Math.sin(t)*a,this.d=Math.sin(e)*n;break}case ee.NoRotationOrReflection:{let t=l*l+c*c,e=0;t>1e-4?(t=Math.abs(l*d-h*c)/t,l/=this.skeleton.scaleX,c/=this.skeleton.scaleY,h=c*t,d=l*t,e=Math.atan2(c,l)*X.radDeg):(l=0,c=0,e=90-Math.atan2(d,h)*X.radDeg);const o=(s+r-e)*X.degRad,u=(s+i-e+90)*X.degRad,m=Math.cos(o)*a,f=Math.cos(u)*n,g=Math.sin(o)*a,p=Math.sin(u)*n;this.a=l*m-h*g,this.b=l*f-h*p,this.c=c*m+d*g,this.d=c*f+d*p;break}case ee.NoScale:case ee.NoScaleOrReflection:{s*=X.degRad;const t=Math.cos(s),e=Math.sin(s);let o=(l*t+h*e)/this.skeleton.scaleX,u=(c*t+d*e)/this.skeleton.scaleY,m=Math.sqrt(o*o+u*u);m>1e-5&&(m=1/m),o*=m,u*=m,m=Math.sqrt(o*o+u*u),this.inherit==ee.NoScale&&l*d-h*c<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(m=-m),s=Math.PI/2+Math.atan2(u,o);const f=Math.cos(s)*m,g=Math.sin(s)*m;r*=X.degRad,i=(90+i)*X.degRad;const p=Math.cos(r)*a,x=Math.cos(i)*n,w=Math.sin(r)*a,b=Math.sin(i)*n;this.a=o*p+f*w,this.b=o*x+f*b,this.c=u*p+g*w,this.d=u*x+g*b;break}}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY}setToSetupPose(){let t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY,this.inherit=t.inherit}updateAppliedTransform(){let t=this.parent;if(!t)return this.ax=this.worldX-this.skeleton.x,this.ay=this.worldY-this.skeleton.y,this.arotation=Math.atan2(this.c,this.a)*X.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*X.radDeg);let e,s,a,n,r=t.a,i=t.b,o=t.c,l=t.d,h=1/(r*l-i*o),c=l*h,d=i*h,u=o*h,m=r*h,f=this.worldX-t.worldX,g=this.worldY-t.worldY;if(this.ax=f*c-g*d,this.ay=g*m-f*u,this.inherit==ee.OnlyTranslation)e=this.a,s=this.b,a=this.c,n=this.d;else{switch(this.inherit){case ee.NoRotationOrReflection:{let t=Math.abs(r*l-i*o)/(r*r+o*o),e=r/this.skeleton.scaleX;i=-(o/this.skeleton.scaleY)*t*this.skeleton.scaleX,l=e*t*this.skeleton.scaleY,h=1/(r*l-i*o),c=l*h,d=i*h;break}case ee.NoScale:case ee.NoScaleOrReflection:let t=X.cosDeg(this.rotation),e=X.sinDeg(this.rotation);r=(r*t+i*e)/this.skeleton.scaleX,o=(o*t+l*e)/this.skeleton.scaleY;let s=Math.sqrt(r*r+o*o);s>1e-5&&(s=1/s),r*=s,o*=s,s=Math.sqrt(r*r+o*o),this.inherit==ee.NoScale&&h<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(s=-s);let a=X.PI/2+Math.atan2(o,r);i=Math.cos(a)*s,l=Math.sin(a)*s,h=1/(r*l-i*o),c=l*h,d=i*h,u=o*h,m=r*h}e=c*this.a-d*this.c,s=c*this.b-d*this.d,a=m*this.c-u*this.a,n=m*this.d-u*this.b}if(this.ashearX=0,this.ascaleX=Math.sqrt(e*e+a*a),this.ascaleX>1e-4){let t=e*n-s*a;this.ascaleY=t/this.ascaleX,this.ashearY=-Math.atan2(e*s+a*n,t)*X.radDeg,this.arotation=Math.atan2(a,e)*X.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(s*s+n*n),this.ashearY=0,this.arotation=90-Math.atan2(n,s)*X.radDeg}getWorldRotationX(){return Math.atan2(this.c,this.a)*X.radDeg}getWorldRotationY(){return Math.atan2(this.d,this.b)*X.radDeg}getWorldScaleX(){return Math.sqrt(this.a*this.a+this.c*this.c)}getWorldScaleY(){return Math.sqrt(this.b*this.b+this.d*this.d)}worldToLocal(t){let e=1/(this.a*this.d-this.b*this.c),s=t.x-this.worldX,a=t.y-this.worldY;return t.x=s*this.d*e-a*this.b*e,t.y=a*this.a*e-s*this.c*e,t}localToWorld(t){let e=t.x,s=t.y;return t.x=e*this.a+s*this.b+this.worldX,t.y=e*this.c+s*this.d+this.worldY,t}worldToParent(t){if(null==t)throw new Error("world cannot be null.");return null==this.parent?t:this.parent.worldToLocal(t)}parentToWorld(t){if(null==t)throw new Error("world cannot be null.");return null==this.parent?t:this.parent.localToWorld(t)}worldToLocalRotation(t){let e=X.sinDeg(t),s=X.cosDeg(t);return Math.atan2(this.a*e-this.c*s,this.d*s-this.b*e)*X.radDeg+this.rotation-this.shearX}localToWorldRotation(t){t-=this.rotation-this.shearX;let e=X.sinDeg(t),s=X.cosDeg(t);return Math.atan2(s*this.c+e*this.d,s*this.a+e*this.b)*X.radDeg}rotateWorld(t){t*=X.degRad;const e=Math.sin(t),s=Math.cos(t),a=this.a,n=this.b;this.a=s*a-e*this.c,this.b=s*n-e*this.d,this.c=e*a+s*this.c,this.d=e*n+s*this.d}}class ke{name;order;skinRequired;constructor(t,e,s){this.name=t,this.order=e,this.skinRequired=s}}class ve{pathPrefix="";textureLoader;downloader;assets={};errors={};toLoad=0;loaded=0;constructor(t,e="",s=new Se){this.textureLoader=t,this.pathPrefix=e,this.downloader=s}start(t){return this.toLoad++,this.pathPrefix+t}success(t,e,s){this.toLoad--,this.loaded++,this.assets[e]=s,t&&t(e,s)}error(t,e,s){this.toLoad--,this.loaded++,this.errors[e]=s,t&&t(e,s)}loadAll(){return new Promise(((t,e)=>{let s=()=>{this.isLoadingComplete()?this.hasErrors()?e(this.errors):t(this):requestAnimationFrame(s)};requestAnimationFrame(s)}))}setRawDataURI(t,e){this.downloader.rawDataUris[this.pathPrefix+t]=e}loadBinary(t,e=()=>{},s=()=>{}){t=this.start(t),this.downloader.downloadBinary(t,(s=>{this.success(e,t,s)}),((e,a)=>{this.error(s,t,`Couldn't load binary ${t}: status ${e}, ${a}`)}))}loadText(t,e=()=>{},s=()=>{}){t=this.start(t),this.downloader.downloadText(t,(s=>{this.success(e,t,s)}),((e,a)=>{this.error(s,t,`Couldn't load text ${t}: status ${e}, ${a}`)}))}loadJson(t,e=()=>{},s=()=>{}){t=this.start(t),this.downloader.downloadJson(t,(s=>{this.success(e,t,s)}),((e,a)=>{this.error(s,t,`Couldn't load JSON ${t}: status ${e}, ${a}`)}))}loadTexture(t,e=()=>{},s=()=>{}){if(t=this.start(t),!!("undefined"==typeof window||"undefined"==typeof navigator||!window.document))fetch(t,{mode:"cors"}).then((e=>e.ok?e.blob():(this.error(s,t,`Couldn't load image: ${t}`),null))).then((t=>t?createImageBitmap(t,{premultiplyAlpha:"none",colorSpaceConversion:"none"}):null)).then((s=>{s&&this.success(e,t,this.textureLoader(s))}));else{let a=new Image;a.crossOrigin="anonymous",a.onload=()=>{this.success(e,t,this.textureLoader(a))},a.onerror=()=>{this.error(s,t,`Couldn't load image: ${t}`)},this.downloader.rawDataUris[t]&&(t=this.downloader.rawDataUris[t]),a.src=t}}loadTextureAtlas(t,e=()=>{},s=()=>{},a){let n=t.lastIndexOf("/"),r=n>=0?t.substring(0,n+1):"";t=this.start(t),this.downloader.downloadText(t,(n=>{try{let i=new ce(n),o=i.pages.length,l=!1;for(let n of i.pages)this.loadTexture(a?a[n.name]:r+n.name,((s,a)=>{l||(n.setTexture(a),0==--o&&this.success(e,t,i))}),((e,a)=>{l||this.error(s,t,`Couldn't load texture atlas ${t} page image: ${e}`),l=!0}))}catch(e){this.error(s,t,`Couldn't parse texture atlas ${t}: ${e.message}`)}}),((e,a)=>{this.error(s,t,`Couldn't load texture atlas ${t}: status ${e}, ${a}`)}))}get(t){return this.assets[this.pathPrefix+t]}require(t){t=this.pathPrefix+t;let e=this.assets[t];if(e)return e;let s=this.errors[t];throw Error("Asset not found: "+t+(s?"\n"+s:""))}remove(t){t=this.pathPrefix+t;let e=this.assets[t];return e.dispose&&e.dispose(),delete this.assets[t],e}removeAll(){for(let t in this.assets){let e=this.assets[t];e.dispose&&e.dispose()}this.assets={}}isLoadingComplete(){return 0==this.toLoad}getToLoad(){return this.toLoad}getLoaded(){return this.loaded}dispose(){this.removeAll()}hasErrors(){return Object.keys(this.errors).length>0}getErrors(){return this.errors}}class Se{callbacks={};rawDataUris={};dataUriToString(t){if(!t.startsWith("data:"))throw new Error("Not a data URI.");let e=t.indexOf("base64,");return-1!=e?(e+=7,atob(t.substr(e))):t.substr(t.indexOf(",")+1)}base64ToUint8Array(t){for(var e=window.atob(t),s=e.length,a=new Uint8Array(s),n=0;n<s;n++)a[n]=e.charCodeAt(n);return a}dataUriToUint8Array(t){if(!t.startsWith("data:"))throw new Error("Not a data URI.");let e=t.indexOf("base64,");if(-1==e)throw new Error("Not a binary data URI.");return e+=7,this.base64ToUint8Array(t.substr(e))}downloadText(t,e,s){if(this.start(t,e,s))return;if(this.rawDataUris[t]){try{let e=this.rawDataUris[t];this.finish(t,200,this.dataUriToString(e))}catch(e){this.finish(t,400,JSON.stringify(e))}return}let a=new XMLHttpRequest;a.overrideMimeType("text/html"),a.open("GET",t,!0);let n=()=>{this.finish(t,a.status,a.responseText)};a.onload=n,a.onerror=n,a.send()}downloadJson(t,e,s){this.downloadText(t,(t=>{e(JSON.parse(t))}),s)}downloadBinary(t,e,s){if(this.start(t,e,s))return;if(this.rawDataUris[t]){try{let e=this.rawDataUris[t];this.finish(t,200,this.dataUriToUint8Array(e))}catch(e){this.finish(t,400,JSON.stringify(e))}return}let a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="arraybuffer";let n=()=>{this.finish(t,a.status,a.response)};a.onload=()=>{200==a.status||0==a.status?this.finish(t,200,new Uint8Array(a.response)):n()},a.onerror=n,a.send()}start(t,e,s){let a=this.callbacks[t];try{if(a)return!0;this.callbacks[t]=a=[]}finally{a.push(e,s)}}finish(t,e,s){let a=this.callbacks[t];delete this.callbacks[t];let n=200==e||0==e?[s]:[e,s];for(let t=n.length-1,e=a.length;t<e;t+=2)a[t].apply(null,n)}}class Ae{data;intValue=0;floatValue=0;stringValue=null;time=0;volume=0;balance=0;constructor(t,e){if(!e)throw new Error("data cannot be null.");this.time=t,this.data=e}}class Ie{name;intValue=0;floatValue=0;stringValue=null;audioPath=null;volume=0;balance=0;constructor(t){this.name=t}}class Me{data;bones;target;bendDirection=0;compress=!1;stretch=!1;mix=1;softness=0;active=!1;constructor(t,e){if(!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let s=0;s<t.bones.length;s++){let a=e.findBone(t.bones[s].name);if(!a)throw new Error(`Couldn't find bone ${t.bones[s].name}`);this.bones.push(a)}let s=e.findBone(t.target.name);if(!s)throw new Error(`Couldn't find bone ${t.target.name}`);this.target=s,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch}isActive(){return this.active}setToSetupPose(){const t=this.data;this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch}update(t){if(0==this.mix)return;let e=this.target,s=this.bones;switch(s.length){case 1:this.apply1(s[0],e.worldX,e.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(s[0],s[1],e.worldX,e.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix)}}apply1(t,e,s,a,n,r,i){let o=t.parent;if(!o)throw new Error("IK bone must have parent.");let l=o.a,h=o.b,c=o.c,d=o.d,u=-t.ashearX-t.arotation,m=0,f=0;switch(t.inherit){case ee.OnlyTranslation:m=(e-t.worldX)*X.signum(t.skeleton.scaleX),f=(s-t.worldY)*X.signum(t.skeleton.scaleY);break;case ee.NoRotationOrReflection:let a=Math.abs(l*d-h*c)/Math.max(1e-4,l*l+c*c),n=l/t.skeleton.scaleX,r=c/t.skeleton.scaleY;h=-r*a*t.skeleton.scaleX,d=n*a*t.skeleton.scaleY,u+=Math.atan2(r,n)*X.radDeg;default:let i=e-o.worldX,g=s-o.worldY,p=l*d-h*c;Math.abs(p)<=1e-4?(m=0,f=0):(m=(i*d-g*h)/p-t.ax,f=(g*l-i*c)/p-t.ay)}u+=Math.atan2(f,m)*X.radDeg,t.ascaleX<0&&(u+=180),u>180?u-=360:u<-180&&(u+=360);let g=t.ascaleX,p=t.ascaleY;if(a||n){switch(t.inherit){case ee.NoScale:case ee.NoScaleOrReflection:m=e-t.worldX,f=s-t.worldY}const o=t.data.length*g;if(o>1e-4){const t=m*m+f*f;if(a&&t<o*o||n&&t>o*o){const e=(Math.sqrt(t)/o-1)*i+1;g*=e,r&&(p*=e)}}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+u*i,g,p,t.ashearX,t.ashearY)}apply2(t,e,s,a,n,r,i,o,l){if(t.inherit!=ee.Normal||e.inherit!=ee.Normal)return;let h=t.ax,c=t.ay,d=t.ascaleX,u=t.ascaleY,m=d,f=u,g=e.ascaleX,p=0,x=0,w=0;d<0?(d=-d,p=180,w=-1):(p=0,w=1),u<0&&(u=-u,w=-w),g<0?(g=-g,x=180):x=0;let b=e.ax,y=0,k=0,v=0,S=t.a,A=t.b,I=t.c,M=t.d,C=Math.abs(d-u)<=1e-4;!C||r?(y=0,k=S*b+t.worldX,v=I*b+t.worldY):(y=e.ay,k=S*b+A*y+t.worldX,v=I*b+M*y+t.worldY);let F=t.parent;if(!F)throw new Error("IK parent must itself have a parent.");S=F.a,A=F.b,I=F.c,M=F.d;let T=S*M-A*I,E=k-F.worldX,Y=v-F.worldY;T=Math.abs(T)<=1e-4?0:1/T;let R,_,B=(E*M-Y*A)*T-h,P=(Y*S-E*I)*T-c,V=Math.sqrt(B*B+P*P),D=e.data.length*g;if(V<1e-4)return this.apply1(t,s,a,!1,r,!1,l),void e.updateWorldTransformWith(b,y,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);E=s-F.worldX,Y=a-F.worldY;let O=(E*M-Y*A)*T-h,N=(Y*S-E*I)*T-c,L=O*O+N*N;if(0!=o){o*=d*(g+1)*.5;let t=Math.sqrt(L),e=t-V-D*d+o;if(e>0){let s=Math.min(1,e/(2*o))-1;s=(e-o*(1-s*s))/t,O-=s*O,N-=s*N,L=O*O+N*N}}t:if(C){D*=d;let t=(L-V*V-D*D)/(2*V*D);t<-1?(t=-1,_=Math.PI*n):t>1?(t=1,_=0,r&&(S=(Math.sqrt(L)/(V+D)-1)*l+1,m*=S,i&&(f*=S))):_=Math.acos(t)*n,S=V+D*t,A=D*Math.sin(_),R=Math.atan2(N*S-O*A,O*S+N*A)}else{S=d*D,A=u*D;let t=S*S,e=A*A,s=Math.atan2(N,O);I=e*V*V+t*L-t*e;let a=-2*e*V,r=e-t;if(M=a*a-4*r*I,M>=0){let t=Math.sqrt(M);a<0&&(t=-t),t=.5*-(a+t);let e=t/r,i=I/t,o=Math.abs(e)<Math.abs(i)?e:i;if(o*o<=L){Y=Math.sqrt(L-o*o)*n,R=s-Math.atan2(Y,o),_=Math.atan2(Y/u,(o-V)/d);break t}}let i=X.PI,o=V-S,l=o*o,h=0,c=0,m=V+S,f=m*m,g=0;I=-S*V/(t-e),I>=-1&&I<=1&&(I=Math.acos(I),E=S*Math.cos(I)+V,Y=A*Math.sin(I),M=E*E+Y*Y,M<l&&(i=I,l=M,o=E,h=Y),M>f&&(c=I,f=M,m=E,g=Y)),L<=.5*(l+f)?(R=s-Math.atan2(h*n,o),_=i*n):(R=s-Math.atan2(g*n,m),_=c*n)}let q=Math.atan2(y,b)*w,U=t.arotation;R=(R-q)*X.radDeg+p-U,R>180?R-=360:R<-180&&(R+=360),t.updateWorldTransformWith(h,c,U+R*l,m,f,0,0),U=e.arotation,_=((_+q)*X.radDeg-e.ashearX)*w+x-U,_>180?_-=360:_<-180&&(_+=360),e.updateWorldTransformWith(b,y,U+_*l,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class Ce extends ke{bones=new Array;_target=null;set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}bendDirection=0;compress=!1;stretch=!1;uniform=!1;mix=0;softness=0;constructor(t){super(t,0,!1)}}class Fe extends ke{bones=new Array;_target=null;set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("SlotData not set.")}positionMode=se.Fixed;spacingMode=ae.Fixed;rotateMode=ne.Chain;offsetRotation=0;position=0;spacing=0;mixRotate=0;mixX=0;mixY=0;constructor(t){super(t,0,!1)}}!function(t){t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent"}(se||(se={})),function(t){t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t[t.Proportional=3]="Proportional"}(ae||(ae={})),function(t){t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale"}(ne||(ne={}));class Te{static NONE=-1;static BEFORE=-2;static AFTER=-3;static epsilon=1e-5;data;bones;target;position=0;spacing=0;mixRotate=0;mixX=0;mixY=0;spaces=new Array;positions=new Array;world=new Array;curves=new Array;lengths=new Array;segments=new Array;active=!1;constructor(t,e){if(!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let s=0,a=t.bones.length;s<a;s++){let a=e.findBone(t.bones[s].name);if(!a)throw new Error(`Couldn't find bone ${t.bones[s].name}.`);this.bones.push(a)}let s=e.findSlot(t.target.name);if(!s)throw new Error(`Couldn't find target bone ${t.target.name}`);this.target=s,this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}isActive(){return this.active}setToSetupPose(){const t=this.data;this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}update(t){let e=this.target.getAttachment();if(!(e instanceof ge))return;let s=this.mixRotate,a=this.mixX,n=this.mixY;if(0==s&&0==a&&0==n)return;let r=this.data,i=r.rotateMode==ne.Tangent,o=r.rotateMode==ne.ChainScale,l=this.bones,h=l.length,c=i?h:h+1,d=V.setArraySize(this.spaces,c),u=o?this.lengths=V.setArraySize(this.lengths,h):[],m=this.spacing;switch(r.spacingMode){case ae.Percent:if(o)for(let t=0,e=c-1;t<e;t++){let e=l[t],s=e.data.length,a=s*e.a,n=s*e.c;u[t]=Math.sqrt(a*a+n*n)}V.arrayFill(d,1,c,m);break;case ae.Proportional:let t=0;for(let e=0,s=c-1;e<s;){let s=l[e],a=s.data.length;if(a<Te.epsilon)o&&(u[e]=0),d[++e]=m;else{let n=a*s.a,r=a*s.c,i=Math.sqrt(n*n+r*r);o&&(u[e]=i),d[++e]=i,t+=i}}if(t>0){t=c/t*m;for(let e=1;e<c;e++)d[e]*=t}break;default:let e=r.spacingMode==ae.Length;for(let t=0,s=c-1;t<s;){let s=l[t],a=s.data.length;if(a<Te.epsilon)o&&(u[t]=0),d[++t]=m;else{let n=a*s.a,r=a*s.c,i=Math.sqrt(n*n+r*r);o&&(u[t]=i),d[++t]=(e?a+m:m)*i/a}}}let f=this.computeWorldPositions(e,c,i),g=f[0],p=f[1],x=r.offsetRotation,w=!1;if(0==x)w=r.rotateMode==ne.Chain;else{w=!1;let t=this.target.bone;x*=t.a*t.d-t.b*t.c>0?X.degRad:-X.degRad}for(let t=0,e=3;t<h;t++,e+=3){let r=l[t];r.worldX+=(g-r.worldX)*a,r.worldY+=(p-r.worldY)*n;let h=f[e],c=f[e+1],m=h-g,b=c-p;if(o){let e=u[t];if(0!=e){let t=(Math.sqrt(m*m+b*b)/e-1)*s+1;r.a*=t,r.c*=t}}if(g=h,p=c,s>0){let a=r.a,n=r.b,o=r.c,l=r.d,h=0,c=0,u=0;if(h=i?f[e-1]:0==d[t+1]?f[e+2]:Math.atan2(b,m),h-=Math.atan2(o,a),w){c=Math.cos(h),u=Math.sin(h);let t=r.data.length;g+=(t*(c*a-u*o)-m)*s,p+=(t*(u*a+c*o)-b)*s}else h+=x;h>X.PI?h-=X.PI2:h<-X.PI&&(h+=X.PI2),h*=s,c=Math.cos(h),u=Math.sin(h),r.a=c*a-u*o,r.b=c*n-u*l,r.c=u*a+c*o,r.d=u*n+c*l}r.updateAppliedTransform()}}computeWorldPositions(t,e,s){let a=this.target,n=this.position,r=this.spaces,i=V.setArraySize(this.positions,3*e+2),o=this.world,l=t.closed,h=t.worldVerticesLength,c=h/6,d=Te.NONE;if(!t.constantSpeed){let u=t.lengths;c-=l?1:2;let m,f=u[c];switch(this.data.positionMode==se.Percent&&(n*=f),this.data.spacingMode){case ae.Percent:m=f;break;case ae.Proportional:m=f/e;break;default:m=1}o=V.setArraySize(this.world,8);for(let g=0,p=0,x=0;g<e;g++,p+=3){let e=r[g]*m;n+=e;let w=n;if(l)w%=f,w<0&&(w+=f),x=0;else{if(w<0){d!=Te.BEFORE&&(d=Te.BEFORE,t.computeWorldVertices(a,2,4,o,0,2)),this.addBeforePosition(w,o,0,i,p);continue}if(w>f){d!=Te.AFTER&&(d=Te.AFTER,t.computeWorldVertices(a,h-6,4,o,0,2)),this.addAfterPosition(w-f,o,0,i,p);continue}}for(;;x++){let t=u[x];if(!(w>t)){if(0==x)w/=t;else{let e=u[x-1];w=(w-e)/(t-e)}break}}x!=d&&(d=x,l&&x==c?(t.computeWorldVertices(a,h-4,4,o,0,2),t.computeWorldVertices(a,0,4,o,4,2)):t.computeWorldVertices(a,6*x+2,8,o,0,2)),this.addCurvePosition(w,o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],i,p,s||g>0&&0==e)}return i}l?(h+=2,o=V.setArraySize(this.world,h),t.computeWorldVertices(a,2,h-4,o,0,2),t.computeWorldVertices(a,0,2,o,h-4,2),o[h-2]=o[0],o[h-1]=o[1]):(c--,h-=4,o=V.setArraySize(this.world,h),t.computeWorldVertices(a,2,h,o,0,2));let u,m=V.setArraySize(this.curves,c),f=0,g=o[0],p=o[1],x=0,w=0,b=0,y=0,k=0,v=0,S=0,A=0,I=0,M=0,C=0,F=0,T=0,E=0;for(let t=0,e=2;t<c;t++,e+=6)x=o[e],w=o[e+1],b=o[e+2],y=o[e+3],k=o[e+4],v=o[e+5],S=.1875*(g-2*x+b),A=.1875*(p-2*w+y),I=.09375*(3*(x-b)-g+k),M=.09375*(3*(w-y)-p+v),C=2*S+I,F=2*A+M,T=.75*(x-g)+S+.16666667*I,E=.75*(w-p)+A+.16666667*M,f+=Math.sqrt(T*T+E*E),T+=C,E+=F,C+=I,F+=M,f+=Math.sqrt(T*T+E*E),T+=C,E+=F,f+=Math.sqrt(T*T+E*E),T+=C+I,E+=F+M,f+=Math.sqrt(T*T+E*E),m[t]=f,g=k,p=v;switch(this.data.positionMode==se.Percent&&(n*=f),this.data.spacingMode){case ae.Percent:u=f;break;case ae.Proportional:u=f/e;break;default:u=1}let Y=this.segments,R=0;for(let t=0,a=0,c=0,X=0;t<e;t++,a+=3){let e=r[t]*u;n+=e;let _=n;if(l)_%=f,_<0&&(_+=f),c=0;else{if(_<0){this.addBeforePosition(_,o,0,i,a);continue}if(_>f){this.addAfterPosition(_-f,o,h-4,i,a);continue}}for(;;c++){let t=m[c];if(!(_>t)){if(0==c)_/=t;else{let e=m[c-1];_=(_-e)/(t-e)}break}}if(c!=d){d=c;let t=6*c;for(g=o[t],p=o[t+1],x=o[t+2],w=o[t+3],b=o[t+4],y=o[t+5],k=o[t+6],v=o[t+7],S=.03*(g-2*x+b),A=.03*(p-2*w+y),I=.006*(3*(x-b)-g+k),M=.006*(3*(w-y)-p+v),C=2*S+I,F=2*A+M,T=.3*(x-g)+S+.16666667*I,E=.3*(w-p)+A+.16666667*M,R=Math.sqrt(T*T+E*E),Y[0]=R,t=1;t<8;t++)T+=C,E+=F,C+=I,F+=M,R+=Math.sqrt(T*T+E*E),Y[t]=R;T+=C,E+=F,R+=Math.sqrt(T*T+E*E),Y[8]=R,T+=C+I,E+=F+M,R+=Math.sqrt(T*T+E*E),Y[9]=R,X=0}for(_*=R;;X++){let t=Y[X];if(!(_>t)){if(0==X)_/=t;else{let e=Y[X-1];_=X+(_-e)/(t-e)}break}}this.addCurvePosition(.1*_,g,p,x,w,b,y,k,v,i,a,s||t>0&&0==e)}return i}addBeforePosition(t,e,s,a,n){let r=e[s],i=e[s+1],o=e[s+2]-r,l=e[s+3]-i,h=Math.atan2(l,o);a[n]=r+t*Math.cos(h),a[n+1]=i+t*Math.sin(h),a[n+2]=h}addAfterPosition(t,e,s,a,n){let r=e[s+2],i=e[s+3],o=r-e[s],l=i-e[s+1],h=Math.atan2(l,o);a[n]=r+t*Math.cos(h),a[n+1]=i+t*Math.sin(h),a[n+2]=h}addCurvePosition(t,e,s,a,n,r,i,o,l,h,c,d){if(0==t||isNaN(t))return h[c]=e,h[c+1]=s,void(h[c+2]=Math.atan2(n-s,a-e));let u=t*t,m=u*t,f=1-t,g=f*f,p=g*f,x=f*t,w=3*x,b=f*w,y=w*t,k=e*p+a*b+r*y+o*m,v=s*p+n*b+i*y+l*m;h[c]=k,h[c+1]=v,d&&(h[c+2]=t<.001?Math.atan2(n-s,a-e):Math.atan2(v-(s*g+n*x*2+i*u),k-(e*g+a*x*2+r*u)))}}class Ee{data;_bone=null;set bone(t){this._bone=t}get bone(){if(this._bone)return this._bone;throw new Error("Bone not set.")}inertia=0;strength=0;damping=0;massInverse=0;wind=0;gravity=0;mix=0;_reset=!0;ux=0;uy=0;cx=0;cy=0;tx=0;ty=0;xOffset=0;xVelocity=0;yOffset=0;yVelocity=0;rotateOffset=0;rotateVelocity=0;scaleOffset=0;scaleVelocity=0;active=!1;skeleton;remaining=0;lastTime=0;constructor(t,e){this.data=t,this.skeleton=e,this.bone=e.bones[t.bone.index],this.inertia=t.inertia,this.strength=t.strength,this.damping=t.damping,this.massInverse=t.massInverse,this.wind=t.wind,this.gravity=t.gravity,this.mix=t.mix}reset(){this.remaining=0,this.lastTime=this.skeleton.time,this._reset=!0,this.xOffset=0,this.xVelocity=0,this.yOffset=0,this.yVelocity=0,this.rotateOffset=0,this.rotateVelocity=0,this.scaleOffset=0,this.scaleVelocity=0}setToSetupPose(){const t=this.data;this.inertia=t.inertia,this.strength=t.strength,this.damping=t.damping,this.massInverse=t.massInverse,this.wind=t.wind,this.gravity=t.gravity,this.mix=t.mix}isActive(){return this.active}update(t){const e=this.mix;if(0==e)return;const s=this.data.x>0,a=this.data.y>0,n=this.data.rotate>0||this.data.shearX>0,r=this.data.scaleX>0,i=this.bone,o=i.data.length;switch(t){case re.none:return;case re.reset:this.reset();case re.update:const t=Math.max(this.skeleton.time-this.lastTime,0);this.remaining+=t,this.lastTime=this.skeleton.time;const l=i.worldX,h=i.worldY;if(this._reset)this._reset=!1,this.ux=l,this.uy=h;else{let c=this.remaining,d=this.inertia,u=this.data.limit*t,m=this.data.step,f=this.skeleton.data.referenceScale,g=-1;if(s||a){if(s){const t=(this.ux-l)*d;this.xOffset+=t>u?u:t<-u?-u:t,this.ux=l}if(a){const t=(this.uy-h)*d;this.yOffset+=t>u?u:t<-u?-u:t,this.uy=h}if(c>=m){g=Math.pow(this.damping,60*m);const t=this.massInverse*m,e=this.strength,n=this.wind*f,r=(Xe.yDown?-this.gravity:this.gravity)*f;do{s&&(this.xVelocity+=(n-this.xOffset*e)*t,this.xOffset+=this.xVelocity*m,this.xVelocity*=g),a&&(this.yVelocity-=(r+this.yOffset*e)*t,this.yOffset+=this.yVelocity*m,this.yVelocity*=g),c-=m}while(c>=m)}s&&(i.worldX+=this.xOffset*e*this.data.x),a&&(i.worldY+=this.yOffset*e*this.data.y)}if(n||r){let t=Math.atan2(i.c,i.a),s=0,a=0,l=0,h=this.cx-i.worldX,p=this.cy-i.worldY;if(h>u?h=u:h<-u&&(h=-u),p>u?p=u:p<-u&&(p=-u),n){l=(this.data.rotate+this.data.shearX)*e;let n=Math.atan2(p+this.ty,h+this.tx)-t-this.rotateOffset*l;this.rotateOffset+=(n-Math.ceil(n*X.invPI2-.5)*X.PI2)*d,n=this.rotateOffset*l+t,s=Math.cos(n),a=Math.sin(n),r&&(n=o*i.getWorldScaleX(),n>0&&(this.scaleOffset+=(h*s+p*a)*d/n))}else{s=Math.cos(t),a=Math.sin(t);const e=o*i.getWorldScaleX();e>0&&(this.scaleOffset+=(h*s+p*a)*d/e)}if(c=this.remaining,c>=m){-1==g&&(g=Math.pow(this.damping,60*m));const e=this.massInverse*m,i=this.strength,h=this.wind,d=Xe.yDown?-this.gravity:this.gravity,u=o/f;for(;;)if(c-=m,r&&(this.scaleVelocity+=(h*s-d*a-this.scaleOffset*i)*e,this.scaleOffset+=this.scaleVelocity*m,this.scaleVelocity*=g),n){if(this.rotateVelocity-=((h*a+d*s)*u+this.rotateOffset*i)*e,this.rotateOffset+=this.rotateVelocity*m,this.rotateVelocity*=g,c<m)break;const n=this.rotateOffset*l+t;s=Math.cos(n),a=Math.sin(n)}else if(c<m)break}}this.remaining=c}this.cx=i.worldX,this.cy=i.worldY;break;case re.pose:s&&(i.worldX+=this.xOffset*e*this.data.x),a&&(i.worldY+=this.yOffset*e*this.data.y)}if(n){let t=this.rotateOffset*e,s=0,a=0,n=0;if(this.data.shearX>0){let e=0;this.data.rotate>0&&(e=t*this.data.rotate,s=Math.sin(e),a=Math.cos(e),n=i.b,i.b=a*n-s*i.d,i.d=s*n+a*i.d),e+=t*this.data.shearX,s=Math.sin(e),a=Math.cos(e),n=i.a,i.a=a*n-s*i.c,i.c=s*n+a*i.c}else t*=this.data.rotate,s=Math.sin(t),a=Math.cos(t),n=i.a,i.a=a*n-s*i.c,i.c=s*n+a*i.c,n=i.b,i.b=a*n-s*i.d,i.d=s*n+a*i.d}if(r){const t=1+this.scaleOffset*e*this.data.scaleX;i.a*=t,i.c*=t}t!=re.pose&&(this.tx=o*i.a,this.ty=o*i.c),i.updateAppliedTransform()}translate(t,e){this.ux-=t,this.uy-=e,this.cx-=t,this.cy-=e}rotate(t,e,s){const a=s*X.degRad,n=Math.cos(a),r=Math.sin(a),i=this.cx-t,o=this.cy-e;this.translate(i*n-o*r-i,i*r+o*n-o)}}class Ye{data;bone;color;darkColor=null;attachment=null;attachmentState=0;sequenceIndex=-1;deform=new Array;constructor(t,e){if(!t)throw new Error("data cannot be null.");if(!e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new R,this.darkColor=t.darkColor?new R:null,this.setToSetupPose()}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(t instanceof W&&this.attachment instanceof W&&t.timelineAttachment==this.attachment.timelineAttachment||(this.deform.length=0),this.attachment=t,this.sequenceIndex=-1)}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class Re{data;bones;target;mixRotate=0;mixX=0;mixY=0;mixScaleX=0;mixScaleY=0;mixShearY=0;temp=new N;active=!1;constructor(t,e){if(!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let s=0;s<t.bones.length;s++){let a=e.findBone(t.bones[s].name);if(!a)throw new Error(`Couldn't find bone ${t.bones[s].name}.`);this.bones.push(a)}let s=e.findBone(t.target.name);if(!s)throw new Error(`Couldn't find target bone ${t.target.name}.`);this.target=s,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY}isActive(){return this.active}setToSetupPose(){const t=this.data;this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY}update(t){0==this.mixRotate&&0==this.mixX&&0==this.mixY&&0==this.mixScaleX&&0==this.mixScaleY&&0==this.mixShearY||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){let t=this.mixRotate,e=this.mixX,s=this.mixY,a=this.mixScaleX,n=this.mixScaleY,r=this.mixShearY,i=0!=e||0!=s,o=this.target,l=o.a,h=o.b,c=o.c,d=o.d,u=l*d-h*c>0?X.degRad:-X.degRad,m=this.data.offsetRotation*u,f=this.data.offsetShearY*u,g=this.bones;for(let u=0,p=g.length;u<p;u++){let p=g[u];if(0!=t){let e=p.a,s=p.b,a=p.c,n=p.d,r=Math.atan2(c,l)-Math.atan2(a,e)+m;r>X.PI?r-=X.PI2:r<-X.PI&&(r+=X.PI2),r*=t;let i=Math.cos(r),o=Math.sin(r);p.a=i*e-o*a,p.b=i*s-o*n,p.c=o*e+i*a,p.d=o*s+i*n}if(i){let t=this.temp;o.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),p.worldX+=(t.x-p.worldX)*e,p.worldY+=(t.y-p.worldY)*s}if(0!=a){let t=Math.sqrt(p.a*p.a+p.c*p.c);0!=t&&(t=(t+(Math.sqrt(l*l+c*c)-t+this.data.offsetScaleX)*a)/t),p.a*=t,p.c*=t}if(0!=n){let t=Math.sqrt(p.b*p.b+p.d*p.d);0!=t&&(t=(t+(Math.sqrt(h*h+d*d)-t+this.data.offsetScaleY)*n)/t),p.b*=t,p.d*=t}if(r>0){let t=p.b,e=p.d,s=Math.atan2(e,t),a=Math.atan2(d,h)-Math.atan2(c,l)-(s-Math.atan2(p.c,p.a));a>X.PI?a-=X.PI2:a<-X.PI&&(a+=X.PI2),a=s+(a+f)*r;let n=Math.sqrt(t*t+e*e);p.b=Math.cos(a)*n,p.d=Math.sin(a)*n}p.updateAppliedTransform()}}applyRelativeWorld(){let t=this.mixRotate,e=this.mixX,s=this.mixY,a=this.mixScaleX,n=this.mixScaleY,r=this.mixShearY,i=0!=e||0!=s,o=this.target,l=o.a,h=o.b,c=o.c,d=o.d,u=l*d-h*c>0?X.degRad:-X.degRad,m=this.data.offsetRotation*u,f=this.data.offsetShearY*u,g=this.bones;for(let u=0,p=g.length;u<p;u++){let p=g[u];if(0!=t){let e=p.a,s=p.b,a=p.c,n=p.d,r=Math.atan2(c,l)+m;r>X.PI?r-=X.PI2:r<-X.PI&&(r+=X.PI2),r*=t;let i=Math.cos(r),o=Math.sin(r);p.a=i*e-o*a,p.b=i*s-o*n,p.c=o*e+i*a,p.d=o*s+i*n}if(i){let t=this.temp;o.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),p.worldX+=t.x*e,p.worldY+=t.y*s}if(0!=a){let t=(Math.sqrt(l*l+c*c)-1+this.data.offsetScaleX)*a+1;p.a*=t,p.c*=t}if(0!=n){let t=(Math.sqrt(h*h+d*d)-1+this.data.offsetScaleY)*n+1;p.b*=t,p.d*=t}if(r>0){let t=Math.atan2(d,h)-Math.atan2(c,l);t>X.PI?t-=X.PI2:t<-X.PI&&(t+=X.PI2);let e=p.b,s=p.d;t=Math.atan2(s,e)+(t-X.PI/2+f)*r;let a=Math.sqrt(e*e+s*s);p.b=Math.cos(t)*a,p.d=Math.sin(t)*a}p.updateAppliedTransform()}}applyAbsoluteLocal(){let t=this.mixRotate,e=this.mixX,s=this.mixY,a=this.mixScaleX,n=this.mixScaleY,r=this.mixShearY,i=this.target,o=this.bones;for(let l=0,h=o.length;l<h;l++){let h=o[l],c=h.arotation;0!=t&&(c+=(i.arotation-c+this.data.offsetRotation)*t);let d=h.ax,u=h.ay;d+=(i.ax-d+this.data.offsetX)*e,u+=(i.ay-u+this.data.offsetY)*s;let m=h.ascaleX,f=h.ascaleY;0!=a&&0!=m&&(m=(m+(i.ascaleX-m+this.data.offsetScaleX)*a)/m),0!=n&&0!=f&&(f=(f+(i.ascaleY-f+this.data.offsetScaleY)*n)/f);let g=h.ashearY;0!=r&&(g+=(i.ashearY-g+this.data.offsetShearY)*r),h.updateWorldTransformWith(d,u,c,m,f,h.ashearX,g)}}applyRelativeLocal(){let t=this.mixRotate,e=this.mixX,s=this.mixY,a=this.mixScaleX,n=this.mixScaleY,r=this.mixShearY,i=this.target,o=this.bones;for(let l=0,h=o.length;l<h;l++){let h=o[l],c=h.arotation+(i.arotation+this.data.offsetRotation)*t,d=h.ax+(i.ax+this.data.offsetX)*e,u=h.ay+(i.ay+this.data.offsetY)*s,m=h.ascaleX*((i.ascaleX-1+this.data.offsetScaleX)*a+1),f=h.ascaleY*((i.ascaleY-1+this.data.offsetScaleY)*n+1),g=h.ashearY+(i.ashearY+this.data.offsetShearY)*r;h.updateWorldTransformWith(d,u,c,m,f,h.ashearX,g)}}}class Xe{static quadTriangles=[0,1,2,2,3,0];static yDown=!1;data;bones;slots;drawOrder;ikConstraints;transformConstraints;pathConstraints;physicsConstraints;_updateCache=new Array;skin=null;color;scaleX=1;_scaleY=1;get scaleY(){return Xe.yDown?-this._scaleY:this._scaleY}set scaleY(t){this._scaleY=t}x=0;y=0;time=0;constructor(t){if(!t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){let s,a=t.bones[e];if(a.parent){let t=this.bones[a.parent.index];s=new ye(a,this,t),t.children.push(s)}else s=new ye(a,this,null);this.bones.push(s)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){let s=t.slots[e],a=this.bones[s.boneData.index],n=new Ye(s,a);this.slots.push(n),this.drawOrder.push(n)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){let s=t.ikConstraints[e];this.ikConstraints.push(new Me(s,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){let s=t.transformConstraints[e];this.transformConstraints.push(new Re(s,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){let s=t.pathConstraints[e];this.pathConstraints.push(new Te(s,this))}this.physicsConstraints=new Array;for(let e=0;e<t.physicsConstraints.length;e++){let s=t.physicsConstraints[e];this.physicsConstraints.push(new Ee(s,this))}this.color=new R(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0;let t=this.bones;for(let e=0,s=t.length;e<s;e++){let s=t[e];s.sorted=s.data.skinRequired,s.active=!s.sorted}if(this.skin){let t=this.skin.bones;for(let e=0,s=this.skin.bones.length;e<s;e++){let s=this.bones[t[e].index];do{s.sorted=!1,s.active=!0,s=s.parent}while(s)}}let e=this.ikConstraints,s=this.transformConstraints,a=this.pathConstraints,n=this.physicsConstraints,r=e.length,i=s.length,o=a.length,l=this.physicsConstraints.length,h=r+i+o+l;t:for(let t=0;t<h;t++){for(let s=0;s<r;s++){let a=e[s];if(a.data.order==t){this.sortIkConstraint(a);continue t}}for(let e=0;e<i;e++){let a=s[e];if(a.data.order==t){this.sortTransformConstraint(a);continue t}}for(let e=0;e<o;e++){let s=a[e];if(s.data.order==t){this.sortPathConstraint(s);continue t}}for(let e=0;e<l;e++){const s=n[e];if(s.data.order==t){this.sortPhysicsConstraint(s);continue t}}}for(let e=0,s=t.length;e<s;e++)this.sortBone(t[e])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&V.contains(this.skin.constraints,t.data,!0)),!t.active)return;let e=t.target;this.sortBone(e);let s=t.bones,a=s[0];if(this.sortBone(a),1==s.length)this._updateCache.push(t),this.sortReset(a.children);else{let e=s[s.length-1];this.sortBone(e),this._updateCache.push(t),this.sortReset(a.children),e.sorted=!0}}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin&&V.contains(this.skin.constraints,t.data,!0)),!t.active)return;let e=t.target,s=e.data.index,a=e.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,s,a),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,s,a);for(let t=0,e=this.data.skins.length;t<e;t++)this.sortPathConstraintAttachment(this.data.skins[t],s,a);let n=e.getAttachment();n instanceof ge&&this.sortPathConstraintAttachmentWith(n,a);let r=t.bones,i=r.length;for(let t=0;t<i;t++)this.sortBone(r[t]);this._updateCache.push(t);for(let t=0;t<i;t++)this.sortReset(r[t].children);for(let t=0;t<i;t++)r[t].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&V.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);let e=t.bones,s=e.length;if(t.data.local)for(let t=0;t<s;t++){let s=e[t];this.sortBone(s.parent),this.sortBone(s)}else for(let t=0;t<s;t++)this.sortBone(e[t]);this._updateCache.push(t);for(let t=0;t<s;t++)this.sortReset(e[t].children);for(let t=0;t<s;t++)e[t].sorted=!0}sortPathConstraintAttachment(t,e,s){let a=t.attachments[e];if(a)for(let t in a)this.sortPathConstraintAttachmentWith(a[t],s)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof ge))return;let s=t.bones;if(s){let t=this.bones;for(let e=0,a=s.length;e<a;){let a=s[e++];for(a+=e;e<a;)this.sortBone(t[s[e++]])}}else this.sortBone(e)}sortPhysicsConstraint(t){const e=t.bone;t.active=e.active&&(!t.data.skinRequired||null!=this.skin&&V.contains(this.skin.constraints,t.data,!0)),t.active&&(this.sortBone(e),this._updateCache.push(t),this.sortReset(e.children),e.sorted=!0)}sortBone(t){if(!t)return;if(t.sorted)return;let e=t.parent;e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,s=t.length;e<s;e++){let s=t[e];s.active&&(s.sorted&&this.sortReset(s.children),s.sorted=!1)}}updateWorldTransform(t){if(null==t)throw new Error("physics is undefined");let e=this.bones;for(let t=0,s=e.length;t<s;t++){let s=e[t];s.ax=s.x,s.ay=s.y,s.arotation=s.rotation,s.ascaleX=s.scaleX,s.ascaleY=s.scaleY,s.ashearX=s.shearX,s.ashearY=s.shearY}let s=this._updateCache;for(let e=0,a=s.length;e<a;e++)s[e].update(t)}updateWorldTransformWith(t,e){let s=this.getRootBone();if(!s)throw new Error("Root bone must not be null.");let a=e.a,n=e.b,r=e.c,i=e.d;s.worldX=a*this.x+n*this.y+e.worldX,s.worldY=r*this.x+i*this.y+e.worldY;const o=(s.rotation+s.shearX)*X.degRad,l=(s.rotation+90+s.shearY)*X.degRad,h=Math.cos(o)*s.scaleX,c=Math.cos(l)*s.scaleY,d=Math.sin(o)*s.scaleX,u=Math.sin(l)*s.scaleY;s.a=(a*h+n*d)*this.scaleX,s.b=(a*c+n*u)*this.scaleX,s.c=(r*h+i*d)*this.scaleY,s.d=(r*c+i*u)*this.scaleY;let m=this._updateCache;for(let e=0,a=m.length;e<a;e++){let a=m[e];a!=s&&a.update(t)}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){for(const t of this.bones)t.setToSetupPose();for(const t of this.ikConstraints)t.setToSetupPose();for(const t of this.transformConstraints)t.setToSetupPose();for(const t of this.pathConstraints)t.setToSetupPose();for(const t of this.physicsConstraints)t.setToSetupPose()}setSlotsToSetupPose(){let t=this.slots;V.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,s=t.length;e<s;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(!t)throw new Error("boneName cannot be null.");let e=this.bones;for(let s=0,a=e.length;s<a;s++){let a=e[s];if(a.data.name==t)return a}return null}findSlot(t){if(!t)throw new Error("slotName cannot be null.");let e=this.slots;for(let s=0,a=e.length;s<a;s++){let a=e[s];if(a.data.name==t)return a}return null}setSkinByName(t){let e=this.data.findSkin(t);if(!e)throw new Error("Skin not found: "+t);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(t)if(this.skin)t.attachAll(this,this.skin);else{let e=this.slots;for(let s=0,a=e.length;s<a;s++){let a=e[s],n=a.data.attachmentName;if(n){let e=t.getAttachment(s,n);e&&a.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){let s=this.data.findSlot(t);if(!s)throw new Error(`Can't find slot with name ${t}`);return this.getAttachment(s.index,e)}getAttachment(t,e){if(!e)throw new Error("attachmentName cannot be null.");if(this.skin){let s=this.skin.getAttachment(t,e);if(s)return s}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(!t)throw new Error("slotName cannot be null.");let s=this.slots;for(let a=0,n=s.length;a<n;a++){let n=s[a];if(n.data.name==t){let s=null;if(e&&(s=this.getAttachment(a,e),!s))throw new Error("Attachment not found: "+e+", for slot: "+t);return void n.setAttachment(s)}}throw new Error("Slot not found: "+t)}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");return this.ikConstraints.find((e=>e.data.name==t))??null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");return this.transformConstraints.find((e=>e.data.name==t))??null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");return this.pathConstraints.find((e=>e.data.name==t))??null}findPhysicsConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");return this.physicsConstraints.find((e=>e.data.name==t))??null}getBoundsRect(){let t=new N,e=new N;return this.getBounds(t,e),{x:t.x,y:t.y,width:e.x,height:e.y}}getBounds(t,e,s=new Array(2),a=null){if(!t)throw new Error("offset cannot be null.");if(!e)throw new Error("size cannot be null.");let n=this.drawOrder,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;for(let t=0,e=n.length;t<e;t++){let e=n[t];if(!e.bone.active)continue;let h=0,c=null,d=null,u=e.getAttachment();if(u instanceof xe)h=8,c=V.setArraySize(s,h,0),u.computeWorldVertices(e,c,0,2),d=Xe.quadTriangles;else if(u instanceof fe){let t=u;h=t.worldVerticesLength,c=V.setArraySize(s,h,0),t.computeWorldVertices(e,0,h,c,0,2),d=t.triangles}else if(u instanceof Kt&&null!=a){a.clipStart(e,u);continue}if(c&&d){null!=a&&a.isClipping()&&(a.clipTriangles(c,d,d.length),c=a.clippedVertices,h=a.clippedVertices.length);for(let t=0,e=c.length;t<e;t+=2){let e=c[t],s=c[t+1];r=Math.min(r,e),i=Math.min(i,s),o=Math.max(o,e),l=Math.max(l,s)}}null!=a&&a.clipEndWithSlot(e)}null!=a&&a.clipEnd(),t.set(r,i),e.set(o-r,l-i)}update(t){this.time+=t}physicsTranslate(t,e){const s=this.physicsConstraints;for(let a=0,n=s.length;a<n;a++)s[a].translate(t,e)}physicsRotate(t,e,s){const a=this.physicsConstraints;for(let n=0,r=a.length;n<r;n++)a[n].rotate(t,e,s)}}!function(t){t[t.none=0]="none",t[t.reset=1]="reset",t[t.update=2]="update",t[t.pose=3]="pose"}(re||(re={}));class _e extends ke{_bone=null;set bone(t){this._bone=t}get bone(){if(this._bone)return this._bone;throw new Error("BoneData not set.")}x=0;y=0;rotate=0;scaleX=0;shearX=0;limit=0;step=0;inertia=0;strength=0;damping=0;massInverse=0;wind=0;gravity=0;mix=0;inertiaGlobal=!1;strengthGlobal=!1;dampingGlobal=!1;massGlobal=!1;windGlobal=!1;gravityGlobal=!1;mixGlobal=!1;constructor(t){super(t,0,!1)}}class Be{name=null;bones=new Array;slots=new Array;skins=new Array;defaultSkin=null;events=new Array;animations=new Array;ikConstraints=new Array;transformConstraints=new Array;pathConstraints=new Array;physicsConstraints=new Array;x=0;y=0;width=0;height=0;referenceScale=100;version=null;hash=null;fps=0;imagesPath=null;audioPath=null;findBone(t){if(!t)throw new Error("boneName cannot be null.");let e=this.bones;for(let s=0,a=e.length;s<a;s++){let a=e[s];if(a.name==t)return a}return null}findSlot(t){if(!t)throw new Error("slotName cannot be null.");let e=this.slots;for(let s=0,a=e.length;s<a;s++){let a=e[s];if(a.name==t)return a}return null}findSkin(t){if(!t)throw new Error("skinName cannot be null.");let e=this.skins;for(let s=0,a=e.length;s<a;s++){let a=e[s];if(a.name==t)return a}return null}findEvent(t){if(!t)throw new Error("eventDataName cannot be null.");let e=this.events;for(let s=0,a=e.length;s<a;s++){let a=e[s];if(a.name==t)return a}return null}findAnimation(t){if(!t)throw new Error("animationName cannot be null.");let e=this.animations;for(let s=0,a=e.length;s<a;s++){let a=e[s];if(a.name==t)return a}return null}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let s=0,a=e.length;s<a;s++){const a=e[s];if(a.name==t)return a}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let s=0,a=e.length;s<a;s++){const a=e[s];if(a.name==t)return a}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let s=0,a=e.length;s<a;s++){const a=e[s];if(a.name==t)return a}return null}findPhysicsConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.physicsConstraints;for(let s=0,a=e.length;s<a;s++){const a=e[s];if(a.name==t)return a}return null}}class Pe{slotIndex;name;attachment;constructor(t=0,e,s){this.slotIndex=t,this.name=e,this.attachment=s}}class Ve{name;attachments=new Array;bones=Array();constraints=new Array;color=new R(.99607843,.61960787,.30980393,1);constructor(t){if(!t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,s){if(!s)throw new Error("attachment cannot be null.");let a=this.attachments;t>=a.length&&(a.length=t+1),a[t]||(a[t]={}),a[t][e]=s}addSkin(t){for(let e=0;e<t.bones.length;e++){let s=t.bones[e],a=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==s){a=!0;break}a||this.bones.push(s)}for(let e=0;e<t.constraints.length;e++){let s=t.constraints[e],a=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==s){a=!0;break}a||this.constraints.push(s)}let e=t.getAttachments();for(let t=0;t<e.length;t++){var s=e[t];this.setAttachment(s.slotIndex,s.name,s.attachment)}}copySkin(t){for(let e=0;e<t.bones.length;e++){let s=t.bones[e],a=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==s){a=!0;break}a||this.bones.push(s)}for(let e=0;e<t.constraints.length;e++){let s=t.constraints[e],a=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==s){a=!0;break}a||this.constraints.push(s)}let e=t.getAttachments();for(let t=0;t<e.length;t++){var s=e[t];s.attachment&&(s.attachment instanceof fe?(s.attachment=s.attachment.newLinkedMesh(),this.setAttachment(s.slotIndex,s.name,s.attachment)):(s.attachment=s.attachment.copy(),this.setAttachment(s.slotIndex,s.name,s.attachment)))}}getAttachment(t,e){let s=this.attachments[t];return s?s[e]:null}removeAttachment(t,e){let s=this.attachments[t];s&&delete s[e]}getAttachments(){let t=new Array;for(var e=0;e<this.attachments.length;e++){let s=this.attachments[e];if(s)for(let a in s){let n=s[a];n&&t.push(new Pe(e,a,n))}}return t}getAttachmentsForSlot(t,e){let s=this.attachments[t];if(s)for(let a in s){let n=s[a];n&&e.push(new Pe(t,a,n))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let s=0;for(let a=0;a<t.slots.length;a++){let n=t.slots[a],r=n.getAttachment();if(r&&s<e.attachments.length){let t=e.attachments[s];for(let e in t){if(r==t[e]){let t=this.getAttachment(s,e);t&&n.setAttachment(t);break}}}s++}}}class De{index=0;name;boneData;color=new R(1,1,1,1);darkColor=null;attachmentName=null;blendMode=ie.Normal;visible=!0;constructor(t,e,s){if(t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");if(!s)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=s}}!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(ie||(ie={}));class Oe extends ke{bones=new Array;_target=null;set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}mixRotate=0;mixX=0;mixY=0;mixScaleX=0;mixScaleY=0;mixShearY=0;offsetRotation=0;offsetX=0;offsetY=0;offsetScaleX=0;offsetScaleY=0;offsetShearY=0;relative=!1;local=!1;constructor(t){super(t,0,!1)}}class Ne{scale=1;attachmentLoader;linkedMeshes=new Array;constructor(t){this.attachmentLoader=t}readSkeletonData(t){let e=this.scale,s=new Be;s.name="";let a=new Le(t),n=a.readInt32(),r=a.readInt32();s.hash=0==r&&0==n?null:r.toString(16)+n.toString(16),s.version=a.readString(),s.x=a.readFloat(),s.y=a.readFloat(),s.width=a.readFloat(),s.height=a.readFloat(),s.referenceScale=a.readFloat()*e;let i=a.readBoolean();i&&(s.fps=a.readFloat(),s.imagesPath=a.readString(),s.audioPath=a.readString());let o=0;o=a.readInt(!0);for(let t=0;t<o;t++){let t=a.readString();if(!t)throw new Error("String in string table must not be null.");a.strings.push(t)}o=a.readInt(!0);for(let t=0;t<o;t++){let n=a.readString();if(!n)throw new Error("Bone name must not be null.");let r=0==t?null:s.bones[a.readInt(!0)],o=new be(t,n,r);o.rotation=a.readFloat(),o.x=a.readFloat()*e,o.y=a.readFloat()*e,o.scaleX=a.readFloat(),o.scaleY=a.readFloat(),o.shearX=a.readFloat(),o.shearY=a.readFloat(),o.length=a.readFloat()*e,o.inherit=a.readByte(),o.skinRequired=a.readBoolean(),i&&(R.rgba8888ToColor(o.color,a.readInt32()),o.icon=a.readString()??void 0,o.visible=a.readBoolean()),s.bones.push(o)}o=a.readInt(!0);for(let t=0;t<o;t++){let e=a.readString();if(!e)throw new Error("Slot name must not be null.");let n=s.bones[a.readInt(!0)],r=new De(t,e,n);R.rgba8888ToColor(r.color,a.readInt32());let o=a.readInt32();-1!=o&&R.rgb888ToColor(r.darkColor=new R,o),r.attachmentName=a.readStringRef(),r.blendMode=a.readInt(!0),i&&(r.visible=a.readBoolean()),s.slots.push(r)}o=a.readInt(!0);for(let t,n=0;n<o;n++){let n=a.readString();if(!n)throw new Error("IK constraint data name must not be null.");let r=new Ce(n);r.order=a.readInt(!0),t=a.readInt(!0);for(let e=0;e<t;e++)r.bones.push(s.bones[a.readInt(!0)]);r.target=s.bones[a.readInt(!0)];let i=a.readByte();r.skinRequired=!!(1&i),r.bendDirection=2&i?1:-1,r.compress=!!(4&i),r.stretch=!!(8&i),r.uniform=!!(16&i),32&i&&(r.mix=64&i?a.readFloat():1),128&i&&(r.softness=a.readFloat()*e),s.ikConstraints.push(r)}o=a.readInt(!0);for(let t,n=0;n<o;n++){let n=a.readString();if(!n)throw new Error("Transform constraint data name must not be null.");let r=new Oe(n);r.order=a.readInt(!0),t=a.readInt(!0);for(let e=0;e<t;e++)r.bones.push(s.bones[a.readInt(!0)]);r.target=s.bones[a.readInt(!0)];let i=a.readByte();r.skinRequired=!!(1&i),r.local=!!(2&i),r.relative=!!(4&i),8&i&&(r.offsetRotation=a.readFloat()),16&i&&(r.offsetX=a.readFloat()*e),32&i&&(r.offsetY=a.readFloat()*e),64&i&&(r.offsetScaleX=a.readFloat()),128&i&&(r.offsetScaleY=a.readFloat()),i=a.readByte(),1&i&&(r.offsetShearY=a.readFloat()),2&i&&(r.mixRotate=a.readFloat()),4&i&&(r.mixX=a.readFloat()),8&i&&(r.mixY=a.readFloat()),16&i&&(r.mixScaleX=a.readFloat()),32&i&&(r.mixScaleY=a.readFloat()),64&i&&(r.mixShearY=a.readFloat()),s.transformConstraints.push(r)}o=a.readInt(!0);for(let t,n=0;n<o;n++){let n=a.readString();if(!n)throw new Error("Path constraint data name must not be null.");let r=new Fe(n);r.order=a.readInt(!0),r.skinRequired=a.readBoolean(),t=a.readInt(!0);for(let e=0;e<t;e++)r.bones.push(s.bones[a.readInt(!0)]);r.target=s.slots[a.readInt(!0)];const i=a.readByte();r.positionMode=1&i,r.spacingMode=i>>1&3,r.rotateMode=i>>3&3,128&i&&(r.offsetRotation=a.readFloat()),r.position=a.readFloat(),r.positionMode==se.Fixed&&(r.position*=e),r.spacing=a.readFloat(),r.spacingMode!=ae.Length&&r.spacingMode!=ae.Fixed||(r.spacing*=e),r.mixRotate=a.readFloat(),r.mixX=a.readFloat(),r.mixY=a.readFloat(),s.pathConstraints.push(r)}o=a.readInt(!0);for(let t=0;t<o;t++){const t=a.readString();if(!t)throw new Error("Physics constraint data name must not be null.");const n=new _e(t);n.order=a.readInt(!0),n.bone=s.bones[a.readInt(!0)];let r=a.readByte();n.skinRequired=!!(1&r),2&r&&(n.x=a.readFloat()),4&r&&(n.y=a.readFloat()),8&r&&(n.rotate=a.readFloat()),16&r&&(n.scaleX=a.readFloat()),32&r&&(n.shearX=a.readFloat()),n.limit=(64&r?a.readFloat():5e3)*e,n.step=1/a.readUnsignedByte(),n.inertia=a.readFloat(),n.strength=a.readFloat(),n.damping=a.readFloat(),n.massInverse=128&r?a.readFloat():1,n.wind=a.readFloat(),n.gravity=a.readFloat(),r=a.readByte(),1&r&&(n.inertiaGlobal=!0),2&r&&(n.strengthGlobal=!0),4&r&&(n.dampingGlobal=!0),8&r&&(n.massGlobal=!0),16&r&&(n.windGlobal=!0),32&r&&(n.gravityGlobal=!0),64&r&&(n.mixGlobal=!0),n.mix=128&r?a.readFloat():1,s.physicsConstraints.push(n)}let l=this.readSkin(a,s,!0,i);l&&(s.defaultSkin=l,s.skins.push(l));{let t=s.skins.length;for(V.setArraySize(s.skins,o=t+a.readInt(!0));t<o;t++){let e=this.readSkin(a,s,!1,i);if(!e)throw new Error("readSkin() should not have returned null.");s.skins[t]=e}}o=this.linkedMeshes.length;for(let t=0;t<o;t++){let e=this.linkedMeshes[t];const a=s.skins[e.skinIndex];if(!e.parent)throw new Error("Linked mesh parent must not be null");let n=a.getAttachment(e.slotIndex,e.parent);if(!n)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.timelineAttachment=e.inheritTimeline?n:e.mesh,e.mesh.setParentMesh(n),null!=e.mesh.region&&e.mesh.updateRegion()}this.linkedMeshes.length=0,o=a.readInt(!0);for(let t=0;t<o;t++){let t=a.readString();if(!t)throw new Error("Event data name must not be null");let e=new Ie(t);e.intValue=a.readInt(!1),e.floatValue=a.readFloat(),e.stringValue=a.readString(),e.audioPath=a.readString(),e.audioPath&&(e.volume=a.readFloat(),e.balance=a.readFloat()),s.events.push(e)}o=a.readInt(!0);for(let t=0;t<o;t++){let t=a.readString();if(!t)throw new Error("Animatio name must not be null.");s.animations.push(this.readAnimation(a,t,s))}return s}readSkin(t,e,s,a){let n=null,r=0;if(s){if(r=t.readInt(!0),0==r)return null;n=new Ve("default")}else{let s=t.readString();if(!s)throw new Error("Skin name must not be null.");n=new Ve(s),a&&R.rgba8888ToColor(n.color,t.readInt32()),n.bones.length=t.readInt(!0);for(let s=0,a=n.bones.length;s<a;s++)n.bones[s]=e.bones[t.readInt(!0)];for(let s=0,a=t.readInt(!0);s<a;s++)n.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let s=0,a=t.readInt(!0);s<a;s++)n.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let s=0,a=t.readInt(!0);s<a;s++)n.constraints.push(e.pathConstraints[t.readInt(!0)]);for(let s=0,a=t.readInt(!0);s<a;s++)n.constraints.push(e.physicsConstraints[t.readInt(!0)]);r=t.readInt(!0)}for(let s=0;s<r;s++){let s=t.readInt(!0);for(let r=0,i=t.readInt(!0);r<i;r++){let r=t.readStringRef();if(!r)throw new Error("Attachment name must not be null");let i=this.readAttachment(t,e,n,s,r,a);i&&n.setAttachment(s,r,i)}}return n}readAttachment(t,e,s,a,n,r){let i=this.scale,o=t.readByte();const l=8&o?t.readStringRef():n;if(!l)throw new Error("Attachment name must not be null");switch(7&o){case oe.Region:{let e=16&o?t.readStringRef():null;const a=32&o?t.readInt32():4294967295,n=64&o?this.readSequence(t):null;let r=128&o?t.readFloat():0,h=t.readFloat(),c=t.readFloat(),d=t.readFloat(),u=t.readFloat(),m=t.readFloat(),f=t.readFloat();e||(e=l);let g=this.attachmentLoader.newRegionAttachment(s,l,e,n);return g?(g.path=e,g.x=h*i,g.y=c*i,g.scaleX=d,g.scaleY=u,g.rotation=r,g.width=m*i,g.height=f*i,R.rgba8888ToColor(g.color,a),g.sequence=n,null==n&&g.updateRegion(),g):null}case oe.BoundingBox:{let e=this.readVertices(t,!!(16&o)),a=r?t.readInt32():0,n=this.attachmentLoader.newBoundingBoxAttachment(s,l);return n?(n.worldVerticesLength=e.length,n.vertices=e.vertices,n.bones=e.bones,r&&R.rgba8888ToColor(n.color,a),n):null}case oe.Mesh:{let e=16&o?t.readStringRef():l;const a=32&o?t.readInt32():4294967295,n=64&o?this.readSequence(t):null,h=t.readInt(!0),c=this.readVertices(t,!!(128&o)),d=this.readFloatArray(t,c.length,1),u=this.readShortArray(t,3*(c.length-h-2));let m=[],f=0,g=0;r&&(m=this.readShortArray(t,t.readInt(!0)),f=t.readFloat(),g=t.readFloat()),e||(e=l);let p=this.attachmentLoader.newMeshAttachment(s,l,e,n);return p?(p.path=e,R.rgba8888ToColor(p.color,a),p.bones=c.bones,p.vertices=c.vertices,p.worldVerticesLength=c.length,p.triangles=u,p.regionUVs=d,null==n&&p.updateRegion(),p.hullLength=h<<1,p.sequence=n,r&&(p.edges=m,p.width=f*i,p.height=g*i),p):null}case oe.LinkedMesh:{const e=16&o?t.readStringRef():l;if(null==e)throw new Error("Path of linked mesh must not be null");const n=32&o?t.readInt32():4294967295,h=64&o?this.readSequence(t):null,c=!!(128&o),d=t.readInt(!0),u=t.readStringRef();let m=0,f=0;r&&(m=t.readFloat(),f=t.readFloat());let g=this.attachmentLoader.newMeshAttachment(s,l,e,h);return g?(g.path=e,R.rgba8888ToColor(g.color,n),g.sequence=h,r&&(g.width=m*i,g.height=f*i),this.linkedMeshes.push(new qe(g,d,a,u,c)),g):null}case oe.Path:{const e=!!(16&o),a=!!(32&o),n=this.readVertices(t,!!(64&o)),h=V.newArray(n.length/6,0);for(let e=0,s=h.length;e<s;e++)h[e]=t.readFloat()*i;const c=r?t.readInt32():0,d=this.attachmentLoader.newPathAttachment(s,l);return d?(d.closed=e,d.constantSpeed=a,d.worldVerticesLength=n.length,d.vertices=n.vertices,d.bones=n.bones,d.lengths=h,r&&R.rgba8888ToColor(d.color,c),d):null}case oe.Point:{const e=t.readFloat(),a=t.readFloat(),n=t.readFloat(),o=r?t.readInt32():0,h=this.attachmentLoader.newPointAttachment(s,l);return h?(h.x=a*i,h.y=n*i,h.rotation=e,r&&R.rgba8888ToColor(h.color,o),h):null}case oe.Clipping:{const a=t.readInt(!0),n=this.readVertices(t,!!(16&o));let i=r?t.readInt32():0,h=this.attachmentLoader.newClippingAttachment(s,l);return h?(h.endSlot=e.slots[a],h.worldVerticesLength=n.length,h.vertices=n.vertices,h.bones=n.bones,r&&R.rgba8888ToColor(h.color,i),h):null}}return null}readSequence(t){let e=new z(t.readInt(!0));return e.start=t.readInt(!0),e.digits=t.readInt(!0),e.setupIndex=t.readInt(!0),e}readVertices(t,e){const s=this.scale,a=t.readInt(!0),n=new Ue;if(n.length=a<<1,!e)return n.vertices=this.readFloatArray(t,n.length,s),n;let r=new Array,i=new Array;for(let e=0;e<a;e++){let e=t.readInt(!0);i.push(e);for(let a=0;a<e;a++)i.push(t.readInt(!0)),r.push(t.readFloat()*s),r.push(t.readFloat()*s),r.push(t.readFloat())}return n.vertices=V.toFloatArray(r),n.bones=i,n}readFloatArray(t,e,s){let a=new Array(e);if(1==s)for(let s=0;s<e;s++)a[s]=t.readFloat();else for(let n=0;n<e;n++)a[n]=t.readFloat()*s;return a}readShortArray(t,e){let s=new Array(e);for(let a=0;a<e;a++)s[a]=t.readInt(!0);return s}readAnimation(t,e,s){t.readInt(!0);let a=new Array,n=this.scale;for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0);for(let s=0,n=t.readInt(!0);s<n;s++){let s=t.readByte(),n=t.readInt(!0),r=n-1;switch(s){case ns:{let s=new wt(n,e);for(let e=0;e<n;e++)s.setFrame(e,t.readFloat(),t.readStringRef());a.push(s);break}case rs:{let s=t.readInt(!0),i=new mt(n,s,e),o=t.readFloat(),l=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255;for(let e=0,s=0;i.setFrame(e,o,l,h,c,d),e!=r;e++){let a=t.readFloat(),n=t.readUnsignedByte()/255,r=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255;switch(t.readByte()){case Ss:i.setStepped(e);break;case As:$e(t,i,s++,e,0,o,a,l,n,1),$e(t,i,s++,e,1,o,a,h,r,1),$e(t,i,s++,e,2,o,a,c,u,1),$e(t,i,s++,e,3,o,a,d,m,1)}o=a,l=n,h=r,c=u,d=m}a.push(i);break}case is:{let s=t.readInt(!0),i=new ft(n,s,e),o=t.readFloat(),l=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255;for(let e=0,s=0;i.setFrame(e,o,l,h,c),e!=r;e++){let a=t.readFloat(),n=t.readUnsignedByte()/255,r=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255;switch(t.readByte()){case Ss:i.setStepped(e);break;case As:$e(t,i,s++,e,0,o,a,l,n,1),$e(t,i,s++,e,1,o,a,h,r,1),$e(t,i,s++,e,2,o,a,c,d,1)}o=a,l=n,h=r,c=d}a.push(i);break}case os:{let s=t.readInt(!0),i=new pt(n,s,e),o=t.readFloat(),l=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255;for(let e=0,s=0;i.setFrame(e,o,l,h,c,d,u,m,f),e!=r;e++){let a=t.readFloat(),n=t.readUnsignedByte()/255,r=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255,x=t.readUnsignedByte()/255,w=t.readUnsignedByte()/255,b=t.readUnsignedByte()/255;switch(t.readByte()){case Ss:i.setStepped(e);break;case As:$e(t,i,s++,e,0,o,a,l,n,1),$e(t,i,s++,e,1,o,a,h,r,1),$e(t,i,s++,e,2,o,a,c,g,1),$e(t,i,s++,e,3,o,a,d,p,1),$e(t,i,s++,e,4,o,a,u,x,1),$e(t,i,s++,e,5,o,a,m,w,1),$e(t,i,s++,e,6,o,a,f,b,1)}o=a,l=n,h=r,c=g,d=p,u=x,m=w,f=b}a.push(i);break}case ls:{let s=t.readInt(!0),i=new xt(n,s,e),o=t.readFloat(),l=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255;for(let e=0,s=0;i.setFrame(e,o,l,h,c,d,u,m),e!=r;e++){let a=t.readFloat(),n=t.readUnsignedByte()/255,r=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255,x=t.readUnsignedByte()/255;switch(t.readByte()){case Ss:i.setStepped(e);break;case As:$e(t,i,s++,e,0,o,a,l,n,1),$e(t,i,s++,e,1,o,a,h,r,1),$e(t,i,s++,e,2,o,a,c,f,1),$e(t,i,s++,e,3,o,a,d,g,1),$e(t,i,s++,e,4,o,a,u,p,1),$e(t,i,s++,e,5,o,a,m,x,1)}o=a,l=n,h=r,c=f,d=g,u=p,m=x}a.push(i);break}case hs:{let s=new gt(n,t.readInt(!0),e),i=t.readFloat(),o=t.readUnsignedByte()/255;for(let e=0,a=0;s.setFrame(e,i,o),e!=r;e++){let n=t.readFloat(),r=t.readUnsignedByte()/255;switch(t.readByte()){case Ss:s.setStepped(e);break;case As:$e(t,s,a++,e,0,i,n,o,r,1)}i=n,o=r}a.push(s)}}}}for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0);for(let s=0,r=t.readInt(!0);s<r;s++){let s=t.readByte(),r=t.readInt(!0);if(s==as){let s=new ut(r,e);for(let e=0;e<r;e++)s.setFrame(e,t.readFloat(),t.readByte());a.push(s);continue}let i=t.readInt(!0);switch(s){case Ge:a.push(We(t,new st(r,i,e),1));break;case je:a.push(ze(t,new at(r,i,e),n));break;case He:a.push(We(t,new nt(r,i,e),n));break;case Je:a.push(We(t,new rt(r,i,e),n));break;case Ke:a.push(ze(t,new it(r,i,e),1));break;case Ze:a.push(We(t,new ot(r,i,e),1));break;case Qe:a.push(We(t,new lt(r,i,e),1));break;case ts:a.push(ze(t,new ht(r,i,e),1));break;case es:a.push(We(t,new ct(r,i,e),1));break;case ss:a.push(We(t,new dt(r,i,e),1))}}}for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0),s=t.readInt(!0),r=s-1,i=new vt(s,t.readInt(!0),e),o=t.readByte(),l=t.readFloat(),h=1&o?2&o?t.readFloat():1:0,c=4&o?t.readFloat()*n:0;for(let e=0,s=0;i.setFrame(e,l,h,c,8&o?1:-1,!!(16&o),!!(32&o)),e!=r;e++){o=t.readByte();const a=t.readFloat(),r=1&o?2&o?t.readFloat():1:0,d=4&o?t.readFloat()*n:0;64&o?i.setStepped(e):128&o&&($e(t,i,s++,e,0,l,a,h,r,1),$e(t,i,s++,e,1,l,a,c,d,n)),l=a,h=r,c=d}a.push(i)}for(let e=0,s=t.readInt(!0);e<s;e++){let e=t.readInt(!0),s=t.readInt(!0),n=s-1,r=new St(s,t.readInt(!0),e),i=t.readFloat(),o=t.readFloat(),l=t.readFloat(),h=t.readFloat(),c=t.readFloat(),d=t.readFloat(),u=t.readFloat();for(let e=0,s=0;r.setFrame(e,i,o,l,h,c,d,u),e!=n;e++){let a=t.readFloat(),n=t.readFloat(),m=t.readFloat(),f=t.readFloat(),g=t.readFloat(),p=t.readFloat(),x=t.readFloat();switch(t.readByte()){case Ss:r.setStepped(e);break;case As:$e(t,r,s++,e,0,i,a,o,n,1),$e(t,r,s++,e,1,i,a,l,m,1),$e(t,r,s++,e,2,i,a,h,f,1),$e(t,r,s++,e,3,i,a,c,g,1),$e(t,r,s++,e,4,i,a,d,p,1),$e(t,r,s++,e,5,i,a,u,x,1)}i=a,o=n,l=m,h=f,c=g,d=p,u=x}a.push(r)}for(let e=0,r=t.readInt(!0);e<r;e++){let e=t.readInt(!0),r=s.pathConstraints[e];for(let s=0,i=t.readInt(!0);s<i;s++){const s=t.readByte(),i=t.readInt(!0),o=t.readInt(!0);switch(s){case us:a.push(We(t,new At(i,o,e),r.positionMode==se.Fixed?n:1));break;case ms:a.push(We(t,new It(i,o,e),r.spacingMode==ae.Length||r.spacingMode==ae.Fixed?n:1));break;case fs:let s=new Mt(i,o,e),l=t.readFloat(),h=t.readFloat(),c=t.readFloat(),d=t.readFloat();for(let e=0,a=0,n=s.getFrameCount()-1;s.setFrame(e,l,h,c,d),e!=n;e++){let n=t.readFloat(),r=t.readFloat(),i=t.readFloat(),o=t.readFloat();switch(t.readByte()){case Ss:s.setStepped(e);break;case As:$e(t,s,a++,e,0,l,n,h,r,1),$e(t,s,a++,e,1,l,n,c,i,1),$e(t,s,a++,e,2,l,n,d,o,1)}l=n,h=r,c=i,d=o}a.push(s)}}}for(let e=0,s=t.readInt(!0);e<s;e++){const e=t.readInt(!0)-1;for(let s=0,n=t.readInt(!0);s<n;s++){const s=t.readByte(),n=t.readInt(!0);if(s==vs){const s=new Bt(n,e);for(let e=0;e<n;e++)s.setFrame(e,t.readFloat());a.push(s);continue}const r=t.readInt(!0);switch(s){case gs:a.push(We(t,new Ft(n,r,e),1));break;case ps:a.push(We(t,new Tt(n,r,e),1));break;case xs:a.push(We(t,new Et(n,r,e),1));break;case ws:a.push(We(t,new Yt(n,r,e),1));break;case bs:a.push(We(t,new Rt(n,r,e),1));break;case ys:a.push(We(t,new Xt(n,r,e),1));break;case ks:a.push(We(t,new _t(n,r,e),1))}}}for(let e=0,r=t.readInt(!0);e<r;e++){let e=s.skins[t.readInt(!0)];for(let s=0,r=t.readInt(!0);s<r;s++){let s=t.readInt(!0);for(let r=0,i=t.readInt(!0);r<i;r++){let r=t.readStringRef();if(!r)throw new Error("attachmentName must not be null.");let i=e.getAttachment(s,r),o=t.readByte(),l=t.readInt(!0),h=l-1;switch(o){case cs:{let e=i,r=e.bones,o=e.vertices,c=r?o.length/3*2:o.length,d=t.readInt(!0),u=new bt(l,d,s,e),m=t.readFloat();for(let e=0,s=0;;e++){let a,i=t.readInt(!0);if(0==i)a=r?V.newFloatArray(c):o;else{a=V.newFloatArray(c);let e=t.readInt(!0);if(i+=e,1==n)for(let s=e;s<i;s++)a[s]=t.readFloat();else for(let s=e;s<i;s++)a[s]=t.readFloat()*n;if(!r)for(let t=0,e=a.length;t<e;t++)a[t]+=o[t]}if(u.setFrame(e,m,a),e==h)break;let l=t.readFloat();switch(t.readByte()){case Ss:u.setStepped(e);break;case As:$e(t,u,s++,e,0,m,l,0,1,1)}m=l}a.push(u);break}case ds:{let e=new Pt(l,s,i);for(let s=0;s<l;s++){let a=t.readFloat(),n=t.readInt32();e.setFrame(s,a,G[15&n],n>>4,t.readFloat())}a.push(e);break}}}}}let r=t.readInt(!0);if(r>0){let e=new kt(r),n=s.slots.length;for(let s=0;s<r;s++){let a=t.readFloat(),r=t.readInt(!0),i=V.newArray(n,0);for(let t=n-1;t>=0;t--)i[t]=-1;let o=V.newArray(n-r,0),l=0,h=0;for(let e=0;e<r;e++){let e=t.readInt(!0);for(;l!=e;)o[h++]=l++;i[l+t.readInt(!0)]=l++}for(;l<n;)o[h++]=l++;for(let t=n-1;t>=0;t--)-1==i[t]&&(i[t]=o[--h]);e.setFrame(s,a,i)}a.push(e)}let i=t.readInt(!0);if(i>0){let e=new yt(i);for(let a=0;a<i;a++){let n=t.readFloat(),r=s.events[t.readInt(!0)],i=new Ae(n,r);i.intValue=t.readInt(!1),i.floatValue=t.readFloat(),i.stringValue=t.readString(),null==i.stringValue&&(i.stringValue=r.stringValue),i.data.audioPath&&(i.volume=t.readFloat(),i.balance=t.readFloat()),e.setFrame(a,i)}a.push(e)}let o=0;for(let t=0,e=a.length;t<e;t++)o=Math.max(o,a[t].getDuration());return new j(e,a,o)}}class Le{strings;index;buffer;constructor(t,e=new Array,s=0,a=new DataView(t instanceof ArrayBuffer?t:t.buffer)){this.strings=e,this.index=s,this.buffer=a}readByte(){return this.buffer.getInt8(this.index++)}readUnsignedByte(){return this.buffer.getUint8(this.index++)}readShort(){let t=this.buffer.getInt16(this.index);return this.index+=2,t}readInt32(){let t=this.buffer.getInt32(this.index);return this.index+=4,t}readInt(t){let e=this.readByte(),s=127&e;return 128&e&&(e=this.readByte(),s|=(127&e)<<7,128&e&&(e=this.readByte(),s|=(127&e)<<14,128&e&&(e=this.readByte(),s|=(127&e)<<21,128&e&&(e=this.readByte(),s|=(127&e)<<28)))),t?s:s>>>1^-(1&s)}readStringRef(){let t=this.readInt(!0);return 0==t?null:this.strings[t-1]}readString(){let t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;let e="";for(let s=0;s<t;){let t=this.readUnsignedByte();switch(t>>4){case 12:case 13:e+=String.fromCharCode((31&t)<<6|63&this.readByte()),s+=2;break;case 14:e+=String.fromCharCode((15&t)<<12|(63&this.readByte())<<6|63&this.readByte()),s+=3;break;default:e+=String.fromCharCode(t),s++}}return e}readFloat(){let t=this.buffer.getFloat32(this.index);return this.index+=4,t}readBoolean(){return 0!=this.readByte()}}class qe{parent;skinIndex;slotIndex;mesh;inheritTimeline;constructor(t,e,s,a,n){this.mesh=t,this.skinIndex=e,this.slotIndex=s,this.parent=a,this.inheritTimeline=n}}class Ue{bones;vertices;length;constructor(t=null,e=null,s=0){this.bones=t,this.vertices=e,this.length=s}}function We(t,e,s){let a=t.readFloat(),n=t.readFloat()*s;for(let r=0,i=0,o=e.getFrameCount()-1;e.setFrame(r,a,n),r!=o;r++){let o=t.readFloat(),l=t.readFloat()*s;switch(t.readByte()){case Ss:e.setStepped(r);break;case As:$e(t,e,i++,r,0,a,o,n,l,s)}a=o,n=l}return e}function ze(t,e,s){let a=t.readFloat(),n=t.readFloat()*s,r=t.readFloat()*s;for(let i=0,o=0,l=e.getFrameCount()-1;e.setFrame(i,a,n,r),i!=l;i++){let l=t.readFloat(),h=t.readFloat()*s,c=t.readFloat()*s;switch(t.readByte()){case Ss:e.setStepped(i);break;case As:$e(t,e,o++,i,0,a,l,n,h,s),$e(t,e,o++,i,1,a,l,r,c,s)}a=l,n=h,r=c}return e}function $e(t,e,s,a,n,r,i,o,l,h){e.setBezier(s,a,n,r,o,t.readFloat(),t.readFloat()*h,t.readFloat(),t.readFloat()*h,i,l)}!function(t){t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping"}(oe||(oe={}));const Ge=0,je=1,He=2,Je=3,Ke=4,Ze=5,Qe=6,ts=7,es=8,ss=9,as=10,ns=0,rs=1,is=2,os=3,ls=4,hs=5,cs=0,ds=1,us=0,ms=1,fs=2,gs=0,ps=1,xs=2,ws=4,bs=5,ys=6,ks=7,vs=8,Ss=1,As=2;class Is{minX=0;minY=0;maxX=0;maxY=0;boundingBoxes=new Array;polygons=new Array;polygonPool=new O((()=>V.newFloatArray(16)));update(t,e){if(!t)throw new Error("skeleton cannot be null.");let s=this.boundingBoxes,a=this.polygons,n=this.polygonPool,r=t.slots,i=r.length;s.length=0,n.freeAll(a),a.length=0;for(let t=0;t<i;t++){let e=r[t];if(!e.bone.active)continue;let i=e.getAttachment();if(i instanceof Jt){let t=i;s.push(t);let r=n.obtain();r.length!=t.worldVerticesLength&&(r=V.newFloatArray(t.worldVerticesLength)),a.push(r),t.computeWorldVertices(e,0,t.worldVerticesLength,r,0,2)}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}aabbCompute(){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY,n=this.polygons;for(let r=0,i=n.length;r<i;r++){let i=n[r],o=i;for(let n=0,r=i.length;n<r;n+=2){let r=o[n],i=o[n+1];t=Math.min(t,r),e=Math.min(e,i),s=Math.max(s,r),a=Math.max(a,i)}}this.minX=t,this.minY=e,this.maxX=s,this.maxY=a}aabbContainsPoint(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY}aabbIntersectsSegment(t,e,s,a){let n=this.minX,r=this.minY,i=this.maxX,o=this.maxY;if(t<=n&&s<=n||e<=r&&a<=r||t>=i&&s>=i||e>=o&&a>=o)return!1;let l=(a-e)/(s-t),h=l*(n-t)+e;if(h>r&&h<o)return!0;if(h=l*(i-t)+e,h>r&&h<o)return!0;let c=(r-e)/l+t;return c>n&&c<i||(c=(o-e)/l+t,c>n&&c<i)}aabbIntersectsSkeleton(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY}containsPoint(t,e){let s=this.polygons;for(let a=0,n=s.length;a<n;a++)if(this.containsPointPolygon(s[a],t,e))return this.boundingBoxes[a];return null}containsPointPolygon(t,e,s){let a=t,n=t.length,r=n-2,i=!1;for(let t=0;t<n;t+=2){let n=a[t+1],o=a[r+1];if(n<s&&o>=s||o<s&&n>=s){let l=a[t];l+(s-n)/(o-n)*(a[r]-l)<e&&(i=!i)}r=t}return i}intersectsSegment(t,e,s,a){let n=this.polygons;for(let r=0,i=n.length;r<i;r++)if(this.intersectsSegmentPolygon(n[r],t,e,s,a))return this.boundingBoxes[r];return null}intersectsSegmentPolygon(t,e,s,a,n){let r=t,i=t.length,o=e-a,l=s-n,h=e*n-s*a,c=r[i-2],d=r[i-1];for(let t=0;t<i;t+=2){let i=r[t],u=r[t+1],m=c*u-d*i,f=c-i,g=d-u,p=o*g-l*f,x=(h*f-o*m)/p;if((x>=c&&x<=i||x>=i&&x<=c)&&(x>=e&&x<=a||x>=a&&x<=e)){let t=(h*g-l*m)/p;if((t>=d&&t<=u||t>=u&&t<=d)&&(t>=s&&t<=n||t>=n&&t<=s))return!0}c=i,d=u}return!1}getPolygon(t){if(!t)throw new Error("boundingBox cannot be null.");let e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]}getWidth(){return this.maxX-this.minX}getHeight(){return this.maxY-this.minY}}class Ms{convexPolygons=new Array;convexPolygonsIndices=new Array;indicesArray=new Array;isConcaveArray=new Array;triangles=new Array;polygonPool=new O((()=>new Array));polygonIndicesPool=new O((()=>new Array));triangulate(t){let e=t,s=t.length>>1,a=this.indicesArray;a.length=0;for(let t=0;t<s;t++)a[t]=t;let n=this.isConcaveArray;n.length=0;for(let t=0,r=s;t<r;++t)n[t]=Ms.isConcave(t,s,e,a);let r=this.triangles;for(r.length=0;s>3;){let t=s-1,i=0,o=1;for(;;){t:if(!n[i]){let r=a[t]<<1,l=a[i]<<1,h=a[o]<<1,c=e[r],d=e[r+1],u=e[l],m=e[l+1],f=e[h],g=e[h+1];for(let r=(o+1)%s;r!=t;r=(r+1)%s){if(!n[r])continue;let t=a[r]<<1,s=e[t],i=e[t+1];if(Ms.positiveArea(f,g,c,d,s,i)&&Ms.positiveArea(c,d,u,m,s,i)&&Ms.positiveArea(u,m,f,g,s,i))break t}break}if(0==o){do{if(!n[i])break;i--}while(i>0);break}t=i,i=o,o=(o+1)%s}r.push(a[(s+i-1)%s]),r.push(a[i]),r.push(a[(i+1)%s]),a.splice(i,1),n.splice(i,1),s--;let l=(s+i-1)%s,h=i==s?0:i;n[l]=Ms.isConcave(l,s,e,a),n[h]=Ms.isConcave(h,s,e,a)}return 3==s&&(r.push(a[2]),r.push(a[0]),r.push(a[1])),r}decompose(t,e){let s=t,a=this.convexPolygons;this.polygonPool.freeAll(a),a.length=0;let n=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(n),n.length=0;let r=this.polygonIndicesPool.obtain();r.length=0;let i=this.polygonPool.obtain();i.length=0;let o=-1,l=0;for(let t=0,h=e.length;t<h;t+=3){let h=e[t]<<1,c=e[t+1]<<1,d=e[t+2]<<1,u=s[h],m=s[h+1],f=s[c],g=s[c+1],p=s[d],x=s[d+1],w=!1;if(o==h){let t=i.length-4,e=Ms.winding(i[t],i[t+1],i[t+2],i[t+3],p,x),s=Ms.winding(p,x,i[0],i[1],i[2],i[3]);e==l&&s==l&&(i.push(p),i.push(x),r.push(d),w=!0)}w||(i.length>0?(a.push(i),n.push(r)):(this.polygonPool.free(i),this.polygonIndicesPool.free(r)),i=this.polygonPool.obtain(),i.length=0,i.push(u),i.push(m),i.push(f),i.push(g),i.push(p),i.push(x),r=this.polygonIndicesPool.obtain(),r.length=0,r.push(h),r.push(c),r.push(d),l=Ms.winding(u,m,f,g,p,x),o=h)}i.length>0&&(a.push(i),n.push(r));for(let t=0,e=a.length;t<e;t++){if(r=n[t],0==r.length)continue;let s=r[0],o=r[r.length-1];i=a[t];let l=i.length-4,h=i[l],c=i[l+1],d=i[l+2],u=i[l+3],m=i[0],f=i[1],g=i[2],p=i[3],x=Ms.winding(h,c,d,u,m,f);for(let l=0;l<e;l++){if(l==t)continue;let e=n[l];if(3!=e.length)continue;let w=e[0],b=e[1],y=e[2],k=a[l],v=k[k.length-2],S=k[k.length-1];if(w!=s||b!=o)continue;let A=Ms.winding(h,c,d,u,v,S),I=Ms.winding(v,S,m,f,g,p);A==x&&I==x&&(k.length=0,e.length=0,i.push(v),i.push(S),r.push(y),h=d,c=u,d=v,u=S,l=0)}}for(let t=a.length-1;t>=0;t--)i=a[t],0==i.length&&(a.splice(t,1),this.polygonPool.free(i),r=n[t],n.splice(t,1),this.polygonIndicesPool.free(r));return a}static isConcave(t,e,s,a){let n=a[(e+t-1)%e]<<1,r=a[t]<<1,i=a[(t+1)%e]<<1;return!this.positiveArea(s[n],s[n+1],s[r],s[r+1],s[i],s[i+1])}static positiveArea(t,e,s,a,n,r){return t*(r-a)+s*(e-r)+n*(a-e)>=0}static winding(t,e,s,a,n,r){let i=s-t,o=a-e;return n*o-r*i+i*e-t*o>=0?1:-1}}class Cs{triangulator=new Ms;clippingPolygon=new Array;clipOutput=new Array;clippedVertices=new Array;clippedUVs=new Array;clippedTriangles=new Array;scratch=new Array;clipAttachment=null;clippingPolygons=null;clipStart(t,e){if(this.clipAttachment)return 0;this.clipAttachment=e;let s=e.worldVerticesLength,a=V.setArraySize(this.clippingPolygon,s);e.computeWorldVertices(t,0,s,a,0,2);let n=this.clippingPolygon;Cs.makeClockwise(n);let r=this.clippingPolygons=this.triangulator.decompose(n,this.triangulator.triangulate(n));for(let t=0,e=r.length;t<e;t++){let e=r[t];Cs.makeClockwise(e),e.push(e[0]),e.push(e[1])}return r.length}clipEndWithSlot(t){this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()}clipEnd(){this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)}isClipping(){return null!=this.clipAttachment}clipTriangles(t,e,s,a,n,r,i){a&&n&&r&&"boolean"==typeof i?this.clipTrianglesRender(t,e,s,a,n,r,i):this.clipTrianglesNoRender(t,e,s)}clipTrianglesNoRender(t,e,s){let a=this.clipOutput,n=this.clippedVertices,r=this.clippedTriangles,i=this.clippingPolygons,o=i.length,l=0;n.length=0,r.length=0;for(let h=0;h<s;h+=3){let s=e[h]<<1,c=t[s],d=t[s+1];s=e[h+1]<<1;let u=t[s],m=t[s+1];s=e[h+2]<<1;let f=t[s],g=t[s+1];for(let t=0;t<o;t++){let e=n.length;if(!this.clip(c,d,u,m,f,g,i[t],a)){let t=V.setArraySize(n,e+6);t[e]=c,t[e+1]=d,t[e+2]=u,t[e+3]=m,t[e+4]=f,t[e+5]=g,e=r.length;let s=V.setArraySize(r,e+3);s[e]=l,s[e+1]=l+1,s[e+2]=l+2,l+=3;break}{let t=a.length;if(0==t)continue;let s=t>>1,i=this.clipOutput,o=V.setArraySize(n,e+2*s);for(let s=0;s<t;s+=2,e+=2){let t=i[s],a=i[s+1];o[e]=t,o[e+1]=a}e=r.length;let h=V.setArraySize(r,e+3*(s-2));s--;for(let t=1;t<s;t++,e+=3)h[e]=l,h[e+1]=l+t,h[e+2]=l+t+1;l+=s+1}}}}clipTrianglesRender(t,e,s,a,n,r,i){let o=this.clipOutput,l=this.clippedVertices,h=this.clippedTriangles,c=this.clippingPolygons,d=c.length,u=i?12:8,m=0;l.length=0,h.length=0;for(let f=0;f<s;f+=3){let s=e[f]<<1,g=t[s],p=t[s+1],x=a[s],w=a[s+1];s=e[f+1]<<1;let b=t[s],y=t[s+1],k=a[s],v=a[s+1];s=e[f+2]<<1;let S=t[s],A=t[s+1],I=a[s],M=a[s+1];for(let t=0;t<d;t++){let e=l.length;if(!this.clip(g,p,b,y,S,A,c[t],o)){let t=V.setArraySize(l,e+3*u);t[e]=g,t[e+1]=p,t[e+2]=n.r,t[e+3]=n.g,t[e+4]=n.b,t[e+5]=n.a,i?(t[e+6]=x,t[e+7]=w,t[e+8]=r.r,t[e+9]=r.g,t[e+10]=r.b,t[e+11]=r.a,t[e+12]=b,t[e+13]=y,t[e+14]=n.r,t[e+15]=n.g,t[e+16]=n.b,t[e+17]=n.a,t[e+18]=k,t[e+19]=v,t[e+20]=r.r,t[e+21]=r.g,t[e+22]=r.b,t[e+23]=r.a,t[e+24]=S,t[e+25]=A,t[e+26]=n.r,t[e+27]=n.g,t[e+28]=n.b,t[e+29]=n.a,t[e+30]=I,t[e+31]=M,t[e+32]=r.r,t[e+33]=r.g,t[e+34]=r.b,t[e+35]=r.a):(t[e+6]=x,t[e+7]=w,t[e+8]=b,t[e+9]=y,t[e+10]=n.r,t[e+11]=n.g,t[e+12]=n.b,t[e+13]=n.a,t[e+14]=k,t[e+15]=v,t[e+16]=S,t[e+17]=A,t[e+18]=n.r,t[e+19]=n.g,t[e+20]=n.b,t[e+21]=n.a,t[e+22]=I,t[e+23]=M),e=h.length;let s=V.setArraySize(h,e+3);s[e]=m,s[e+1]=m+1,s[e+2]=m+2,m+=3;break}{let t=o.length;if(0==t)continue;let s=y-A,a=S-b,c=g-S,d=A-p,f=1/(s*c+a*(p-A)),C=t>>1,F=this.clipOutput,T=V.setArraySize(l,e+C*u);for(let o=0;o<t;o+=2,e+=u){let t=F[o],l=F[o+1];T[e]=t,T[e+1]=l,T[e+2]=n.r,T[e+3]=n.g,T[e+4]=n.b,T[e+5]=n.a;let h=t-S,u=l-A,m=(s*h+a*u)*f,g=(d*h+c*u)*f,p=1-m-g;T[e+6]=x*m+k*g+I*p,T[e+7]=w*m+v*g+M*p,i&&(T[e+8]=r.r,T[e+9]=r.g,T[e+10]=r.b,T[e+11]=r.a)}e=h.length;let E=V.setArraySize(h,e+3*(C-2));C--;for(let t=1;t<C;t++,e+=3)E[e]=m,E[e+1]=m+t,E[e+2]=m+t+1;m+=C+1}}}}clipTrianglesUnpacked(t,e,s,a){let n=this.clipOutput,r=this.clippedVertices,i=this.clippedUVs,o=this.clippedTriangles,l=this.clippingPolygons,h=l.length,c=0;r.length=0,i.length=0,o.length=0;for(let d=0;d<s;d+=3){let s=e[d]<<1,u=t[s],m=t[s+1],f=a[s],g=a[s+1];s=e[d+1]<<1;let p=t[s],x=t[s+1],w=a[s],b=a[s+1];s=e[d+2]<<1;let y=t[s],k=t[s+1],v=a[s],S=a[s+1];for(let t=0;t<h;t++){let e=r.length;if(!this.clip(u,m,p,x,y,k,l[t],n)){let t=V.setArraySize(r,e+6);t[e]=u,t[e+1]=m,t[e+2]=p,t[e+3]=x,t[e+4]=y,t[e+5]=k;let s=V.setArraySize(i,e+6);s[e]=f,s[e+1]=g,s[e+2]=w,s[e+3]=b,s[e+4]=v,s[e+5]=S,e=o.length;let a=V.setArraySize(o,e+3);a[e]=c,a[e+1]=c+1,a[e+2]=c+2,c+=3;break}{let t=n.length;if(0==t)continue;let s=x-k,a=y-p,l=u-y,h=k-m,d=1/(s*l+a*(m-k)),A=t>>1,I=this.clipOutput,M=V.setArraySize(r,e+2*A),C=V.setArraySize(i,e+2*A);for(let n=0;n<t;n+=2,e+=2){let t=I[n],r=I[n+1];M[e]=t,M[e+1]=r;let i=t-y,o=r-k,c=(s*i+a*o)*d,u=(h*i+l*o)*d,m=1-c-u;C[e]=f*c+w*u+v*m,C[e+1]=g*c+b*u+S*m}e=o.length;let F=V.setArraySize(o,e+3*(A-2));A--;for(let t=1;t<A;t++,e+=3)F[e]=c,F[e+1]=c+t,F[e+2]=c+t+1;c+=A+1}}}}clip(t,e,s,a,n,r,i,o){let l,h=o,c=!1;i.length%4>=2?(l=o,o=this.scratch):l=this.scratch,l.length=0,l.push(t),l.push(e),l.push(s),l.push(a),l.push(n),l.push(r),l.push(t),l.push(e),o.length=0;let d=i.length-4,u=i;for(let t=0;;t+=2){let e=u[t],s=u[t+1],a=e-u[t+2],n=s-u[t+3],r=o.length,i=l;for(let t=0,r=l.length-2;t<r;){let r=i[t],l=i[t+1];t+=2;let h=i[t],d=i[t+1],u=n*(e-h)>a*(s-d),m=n*(e-r)-a*(s-l);if(m>0){if(u){o.push(h),o.push(d);continue}let t=h-r,e=d-l,s=m/(t*n-e*a);if(!(s>=0&&s<=1)){o.push(h),o.push(d);continue}o.push(r+t*s),o.push(l+e*s)}else if(u){let t=h-r,e=d-l,s=m/(t*n-e*a);if(!(s>=0&&s<=1)){o.push(h),o.push(d);continue}o.push(r+t*s),o.push(l+e*s),o.push(h),o.push(d)}c=!0}if(r==o.length)return h.length=0,!0;if(o.push(o[0]),o.push(o[1]),t==d)break;let m=o;(o=l).length=0,l=m}if(h!=o){h.length=0;for(let t=0,e=o.length-2;t<e;t++)h[t]=o[t]}else h.length=h.length-2;return c}static makeClockwise(t){let e=t,s=t.length,a=e[s-2]*e[1]-e[0]*e[s-1],n=0,r=0,i=0,o=0;for(let t=0,l=s-3;t<l;t+=2)n=e[t],r=e[t+1],i=e[t+2],o=e[t+3],a+=n*o-i*r;if(!(a<0))for(let t=0,a=s-2,n=s>>1;t<n;t+=2){let s=e[t],n=e[t+1],r=a-t;e[t]=e[r],e[t+1]=e[r+1],e[r]=s,e[r+1]=n}}}class Fs{attachmentLoader;scale=1;linkedMeshes=new Array;constructor(t){this.attachmentLoader=t}readSkeletonData(t){let e=this.scale,s=new Be,a="string"==typeof t?JSON.parse(t):t,n=a.skeleton;if(n&&(s.hash=n.hash,s.version=n.spine,s.x=n.x,s.y=n.y,s.width=n.width,s.height=n.height,s.referenceScale=Xs(n,"referenceScale",100)*e,s.fps=n.fps,s.imagesPath=n.images??null,s.audioPath=n.audio??null),a.bones)for(let t=0;t<a.bones.length;t++){let n=a.bones[t],r=null,i=Xs(n,"parent",null);i&&(r=s.findBone(i));let o=new be(s.bones.length,n.name,r);o.length=Xs(n,"length",0)*e,o.x=Xs(n,"x",0)*e,o.y=Xs(n,"y",0)*e,o.rotation=Xs(n,"rotation",0),o.scaleX=Xs(n,"scaleX",1),o.scaleY=Xs(n,"scaleY",1),o.shearX=Xs(n,"shearX",0),o.shearY=Xs(n,"shearY",0),o.inherit=V.enumValue(ee,Xs(n,"inherit","Normal")),o.skinRequired=Xs(n,"skin",!1);let l=Xs(n,"color",null);l&&o.color.setFromString(l),s.bones.push(o)}if(a.slots)for(let t=0;t<a.slots.length;t++){let e=a.slots[t],n=e.name,r=s.findBone(e.bone);if(!r)throw new Error(`Couldn't find bone ${e.bone} for slot ${n}`);let i=new De(s.slots.length,n,r),o=Xs(e,"color",null);o&&i.color.setFromString(o);let l=Xs(e,"dark",null);l&&(i.darkColor=R.fromString(l)),i.attachmentName=Xs(e,"attachment",null),i.blendMode=V.enumValue(ie,Xs(e,"blend","normal")),i.visible=Xs(e,"visible",!0),s.slots.push(i)}if(a.ik)for(let t=0;t<a.ik.length;t++){let n=a.ik[t],r=new Ce(n.name);r.order=Xs(n,"order",0),r.skinRequired=Xs(n,"skin",!1);for(let t=0;t<n.bones.length;t++){let e=s.findBone(n.bones[t]);if(!e)throw new Error(`Couldn't find bone ${n.bones[t]} for IK constraint ${n.name}.`);r.bones.push(e)}let i=s.findBone(n.target);if(!i)throw new Error(`Couldn't find target bone ${n.target} for IK constraint ${n.name}.`);r.target=i,r.mix=Xs(n,"mix",1),r.softness=Xs(n,"softness",0)*e,r.bendDirection=Xs(n,"bendPositive",!0)?1:-1,r.compress=Xs(n,"compress",!1),r.stretch=Xs(n,"stretch",!1),r.uniform=Xs(n,"uniform",!1),s.ikConstraints.push(r)}if(a.transform)for(let t=0;t<a.transform.length;t++){let n=a.transform[t],r=new Oe(n.name);r.order=Xs(n,"order",0),r.skinRequired=Xs(n,"skin",!1);for(let t=0;t<n.bones.length;t++){let e=n.bones[t],a=s.findBone(e);if(!a)throw new Error(`Couldn't find bone ${e} for transform constraint ${n.name}.`);r.bones.push(a)}let i=n.target,o=s.findBone(i);if(!o)throw new Error(`Couldn't find target bone ${i} for transform constraint ${n.name}.`);r.target=o,r.local=Xs(n,"local",!1),r.relative=Xs(n,"relative",!1),r.offsetRotation=Xs(n,"rotation",0),r.offsetX=Xs(n,"x",0)*e,r.offsetY=Xs(n,"y",0)*e,r.offsetScaleX=Xs(n,"scaleX",0),r.offsetScaleY=Xs(n,"scaleY",0),r.offsetShearY=Xs(n,"shearY",0),r.mixRotate=Xs(n,"mixRotate",1),r.mixX=Xs(n,"mixX",1),r.mixY=Xs(n,"mixY",r.mixX),r.mixScaleX=Xs(n,"mixScaleX",1),r.mixScaleY=Xs(n,"mixScaleY",r.mixScaleX),r.mixShearY=Xs(n,"mixShearY",1),s.transformConstraints.push(r)}if(a.path)for(let t=0;t<a.path.length;t++){let n=a.path[t],r=new Fe(n.name);r.order=Xs(n,"order",0),r.skinRequired=Xs(n,"skin",!1);for(let t=0;t<n.bones.length;t++){let e=n.bones[t],a=s.findBone(e);if(!a)throw new Error(`Couldn't find bone ${e} for path constraint ${n.name}.`);r.bones.push(a)}let i=n.target,o=s.findSlot(i);if(!o)throw new Error(`Couldn't find target slot ${i} for path constraint ${n.name}.`);r.target=o,r.positionMode=V.enumValue(se,Xs(n,"positionMode","Percent")),r.spacingMode=V.enumValue(ae,Xs(n,"spacingMode","Length")),r.rotateMode=V.enumValue(ne,Xs(n,"rotateMode","Tangent")),r.offsetRotation=Xs(n,"rotation",0),r.position=Xs(n,"position",0),r.positionMode==se.Fixed&&(r.position*=e),r.spacing=Xs(n,"spacing",0),r.spacingMode!=ae.Length&&r.spacingMode!=ae.Fixed||(r.spacing*=e),r.mixRotate=Xs(n,"mixRotate",1),r.mixX=Xs(n,"mixX",1),r.mixY=Xs(n,"mixY",r.mixX),s.pathConstraints.push(r)}if(a.physics)for(let t=0;t<a.physics.length;t++){const n=a.physics[t],r=new _e(n.name);r.order=Xs(n,"order",0),r.skinRequired=Xs(n,"skin",!1);const i=n.bone,o=s.findBone(i);if(null==o)throw new Error("Physics bone not found: "+i);r.bone=o,r.x=Xs(n,"x",0),r.y=Xs(n,"y",0),r.rotate=Xs(n,"rotate",0),r.scaleX=Xs(n,"scaleX",0),r.shearX=Xs(n,"shearX",0),r.limit=Xs(n,"limit",5e3)*e,r.step=1/Xs(n,"fps",60),r.inertia=Xs(n,"inertia",1),r.strength=Xs(n,"strength",100),r.damping=Xs(n,"damping",1),r.massInverse=1/Xs(n,"mass",1),r.wind=Xs(n,"wind",0),r.gravity=Xs(n,"gravity",0),r.mix=Xs(n,"mix",1),r.inertiaGlobal=Xs(n,"inertiaGlobal",!1),r.strengthGlobal=Xs(n,"strengthGlobal",!1),r.dampingGlobal=Xs(n,"dampingGlobal",!1),r.massGlobal=Xs(n,"massGlobal",!1),r.windGlobal=Xs(n,"windGlobal",!1),r.gravityGlobal=Xs(n,"gravityGlobal",!1),r.mixGlobal=Xs(n,"mixGlobal",!1),s.physicsConstraints.push(r)}if(a.skins)for(let t=0;t<a.skins.length;t++){let e=a.skins[t],n=new Ve(e.name);if(e.bones)for(let t=0;t<e.bones.length;t++){let a=e.bones[t],r=s.findBone(a);if(!r)throw new Error(`Couldn't find bone ${a} for skin ${e.name}.`);n.bones.push(r)}if(e.ik)for(let t=0;t<e.ik.length;t++){let a=e.ik[t],r=s.findIkConstraint(a);if(!r)throw new Error(`Couldn't find IK constraint ${a} for skin ${e.name}.`);n.constraints.push(r)}if(e.transform)for(let t=0;t<e.transform.length;t++){let a=e.transform[t],r=s.findTransformConstraint(a);if(!r)throw new Error(`Couldn't find transform constraint ${a} for skin ${e.name}.`);n.constraints.push(r)}if(e.path)for(let t=0;t<e.path.length;t++){let a=e.path[t],r=s.findPathConstraint(a);if(!r)throw new Error(`Couldn't find path constraint ${a} for skin ${e.name}.`);n.constraints.push(r)}if(e.physics)for(let t=0;t<e.physics.length;t++){let a=e.physics[t],r=s.findPhysicsConstraint(a);if(!r)throw new Error(`Couldn't find physics constraint ${a} for skin ${e.name}.`);n.constraints.push(r)}for(let t in e.attachments){let a=s.findSlot(t);if(!a)throw new Error(`Couldn't find slot ${t} for skin ${e.name}.`);let r=e.attachments[t];for(let t in r){let e=this.readAttachment(r[t],n,a.index,t,s);e&&n.setAttachment(a.index,t,e)}}s.skins.push(n),"default"==n.name&&(s.defaultSkin=n)}for(let t=0,e=this.linkedMeshes.length;t<e;t++){let e=this.linkedMeshes[t],a=e.skin?s.findSkin(e.skin):s.defaultSkin;if(!a)throw new Error(`Skin not found: ${e.skin}`);let n=a.getAttachment(e.slotIndex,e.parent);if(!n)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.timelineAttachment=e.inheritTimeline?n:e.mesh,e.mesh.setParentMesh(n),null!=e.mesh.region&&e.mesh.updateRegion()}if(this.linkedMeshes.length=0,a.events)for(let t in a.events){let e=a.events[t],n=new Ie(t);n.intValue=Xs(e,"int",0),n.floatValue=Xs(e,"float",0),n.stringValue=Xs(e,"string",""),n.audioPath=Xs(e,"audio",null),n.audioPath&&(n.volume=Xs(e,"volume",1),n.balance=Xs(e,"balance",0)),s.events.push(n)}if(a.animations)for(let t in a.animations){let e=a.animations[t];this.readAnimation(e,t,s)}return s}readAttachment(t,e,s,a,n){let r=this.scale;switch(a=Xs(t,"name",a),Xs(t,"type","region")){case"region":{let s=Xs(t,"path",a),n=this.readSequence(Xs(t,"sequence",null)),i=this.attachmentLoader.newRegionAttachment(e,a,s,n);if(!i)return null;i.path=s,i.x=Xs(t,"x",0)*r,i.y=Xs(t,"y",0)*r,i.scaleX=Xs(t,"scaleX",1),i.scaleY=Xs(t,"scaleY",1),i.rotation=Xs(t,"rotation",0),i.width=t.width*r,i.height=t.height*r,i.sequence=n;let o=Xs(t,"color",null);return o&&i.color.setFromString(o),null!=i.region&&i.updateRegion(),i}case"boundingbox":{let s=this.attachmentLoader.newBoundingBoxAttachment(e,a);if(!s)return null;this.readVertices(t,s,t.vertexCount<<1);let n=Xs(t,"color",null);return n&&s.color.setFromString(n),s}case"mesh":case"linkedmesh":{let n=Xs(t,"path",a),i=this.readSequence(Xs(t,"sequence",null)),o=this.attachmentLoader.newMeshAttachment(e,a,n,i);if(!o)return null;o.path=n;let l=Xs(t,"color",null);l&&o.color.setFromString(l),o.width=Xs(t,"width",0)*r,o.height=Xs(t,"height",0)*r,o.sequence=i;let h=Xs(t,"parent",null);if(h)return this.linkedMeshes.push(new Ts(o,Xs(t,"skin",null),s,h,Xs(t,"timelines",!0))),o;let c=t.uvs;return this.readVertices(t,o,c.length),o.triangles=t.triangles,o.regionUVs=c,null!=o.region&&o.updateRegion(),o.edges=Xs(t,"edges",null),o.hullLength=2*Xs(t,"hull",0),o}case"path":{let s=this.attachmentLoader.newPathAttachment(e,a);if(!s)return null;s.closed=Xs(t,"closed",!1),s.constantSpeed=Xs(t,"constantSpeed",!0);let n=t.vertexCount;this.readVertices(t,s,n<<1);let i=V.newArray(n/3,0);for(let e=0;e<t.lengths.length;e++)i[e]=t.lengths[e]*r;s.lengths=i;let o=Xs(t,"color",null);return o&&s.color.setFromString(o),s}case"point":{let s=this.attachmentLoader.newPointAttachment(e,a);if(!s)return null;s.x=Xs(t,"x",0)*r,s.y=Xs(t,"y",0)*r,s.rotation=Xs(t,"rotation",0);let n=Xs(t,"color",null);return n&&s.color.setFromString(n),s}case"clipping":{let s=this.attachmentLoader.newClippingAttachment(e,a);if(!s)return null;let r=Xs(t,"end",null);r&&(s.endSlot=n.findSlot(r));let i=t.vertexCount;this.readVertices(t,s,i<<1);let o=Xs(t,"color",null);return o&&s.color.setFromString(o),s}}return null}readSequence(t){if(null==t)return null;let e=new z(Xs(t,"count",0));return e.start=Xs(t,"start",1),e.digits=Xs(t,"digits",0),e.setupIndex=Xs(t,"setup",0),e}readVertices(t,e,s){let a=this.scale;e.worldVerticesLength=s;let n=t.vertices;if(s==n.length){let t=V.toFloatArray(n);if(1!=a)for(let e=0,s=n.length;e<s;e++)t[e]*=a;return void(e.vertices=t)}let r=new Array,i=new Array;for(let t=0,e=n.length;t<e;){let e=n[t++];i.push(e);for(let s=t+4*e;t<s;t+=4)i.push(n[t]),r.push(n[t+1]*a),r.push(n[t+2]*a),r.push(n[t+3])}e.bones=i,e.vertices=V.toFloatArray(r)}readAnimation(t,e,s){let a=this.scale,n=new Array;if(t.slots)for(let e in t.slots){let a=t.slots[e],r=s.findSlot(e);if(!r)throw new Error("Slot not found: "+e);let i=r.index;for(let t in a){let e=a[t];if(!e)continue;let s=e.length;if("attachment"==t){let t=new wt(s,i);for(let a=0;a<s;a++){let s=e[a];t.setFrame(a,Xs(s,"time",0),Xs(s,"name",null))}n.push(t)}else if("rgba"==t){let t=new mt(s,s<<2,i),a=e[0],r=Xs(a,"time",0),o=R.fromString(a.color);for(let s=0,n=0;;s++){t.setFrame(s,r,o.r,o.g,o.b,o.a);let i=e[s+1];if(!i){t.shrink(n);break}let l=Xs(i,"time",0),h=R.fromString(i.color),c=a.curve;c&&(n=Rs(c,t,n,s,0,r,l,o.r,h.r,1),n=Rs(c,t,n,s,1,r,l,o.g,h.g,1),n=Rs(c,t,n,s,2,r,l,o.b,h.b,1),n=Rs(c,t,n,s,3,r,l,o.a,h.a,1)),r=l,o=h,a=i}n.push(t)}else if("rgb"==t){let t=new ft(s,3*s,i),a=e[0],r=Xs(a,"time",0),o=R.fromString(a.color);for(let s=0,n=0;;s++){t.setFrame(s,r,o.r,o.g,o.b);let i=e[s+1];if(!i){t.shrink(n);break}let l=Xs(i,"time",0),h=R.fromString(i.color),c=a.curve;c&&(n=Rs(c,t,n,s,0,r,l,o.r,h.r,1),n=Rs(c,t,n,s,1,r,l,o.g,h.g,1),n=Rs(c,t,n,s,2,r,l,o.b,h.b,1)),r=l,o=h,a=i}n.push(t)}else if("alpha"==t)n.push(Es(e,new gt(s,s,i),0,1));else if("rgba2"==t){let t=new pt(s,7*s,i),a=e[0],r=Xs(a,"time",0),o=R.fromString(a.light),l=R.fromString(a.dark);for(let s=0,n=0;;s++){t.setFrame(s,r,o.r,o.g,o.b,o.a,l.r,l.g,l.b);let i=e[s+1];if(!i){t.shrink(n);break}let h=Xs(i,"time",0),c=R.fromString(i.light),d=R.fromString(i.dark),u=a.curve;u&&(n=Rs(u,t,n,s,0,r,h,o.r,c.r,1),n=Rs(u,t,n,s,1,r,h,o.g,c.g,1),n=Rs(u,t,n,s,2,r,h,o.b,c.b,1),n=Rs(u,t,n,s,3,r,h,o.a,c.a,1),n=Rs(u,t,n,s,4,r,h,l.r,d.r,1),n=Rs(u,t,n,s,5,r,h,l.g,d.g,1),n=Rs(u,t,n,s,6,r,h,l.b,d.b,1)),r=h,o=c,l=d,a=i}n.push(t)}else if("rgb2"==t){let t=new xt(s,6*s,i),a=e[0],r=Xs(a,"time",0),o=R.fromString(a.light),l=R.fromString(a.dark);for(let s=0,n=0;;s++){t.setFrame(s,r,o.r,o.g,o.b,l.r,l.g,l.b);let i=e[s+1];if(!i){t.shrink(n);break}let h=Xs(i,"time",0),c=R.fromString(i.light),d=R.fromString(i.dark),u=a.curve;u&&(n=Rs(u,t,n,s,0,r,h,o.r,c.r,1),n=Rs(u,t,n,s,1,r,h,o.g,c.g,1),n=Rs(u,t,n,s,2,r,h,o.b,c.b,1),n=Rs(u,t,n,s,3,r,h,l.r,d.r,1),n=Rs(u,t,n,s,4,r,h,l.g,d.g,1),n=Rs(u,t,n,s,5,r,h,l.b,d.b,1)),r=h,o=c,l=d,a=i}n.push(t)}}}if(t.bones)for(let e in t.bones){let r=t.bones[e],i=s.findBone(e);if(!i)throw new Error("Bone not found: "+e);let o=i.index;for(let t in r){let e=r[t],s=e.length;if(0!=s)if("rotate"===t)n.push(Es(e,new st(s,s,o),0,1));else if("translate"===t){let t=new at(s,s<<1,o);n.push(Ys(e,t,"x","y",0,a))}else if("translatex"===t){let t=new nt(s,s,o);n.push(Es(e,t,0,a))}else if("translatey"===t){let t=new rt(s,s,o);n.push(Es(e,t,0,a))}else if("scale"===t){let t=new it(s,s<<1,o);n.push(Ys(e,t,"x","y",1,1))}else if("scalex"===t){let t=new ot(s,s,o);n.push(Es(e,t,1,1))}else if("scaley"===t){let t=new lt(s,s,o);n.push(Es(e,t,1,1))}else if("shear"===t){let t=new ht(s,s<<1,o);n.push(Ys(e,t,"x","y",0,1))}else if("shearx"===t){let t=new ct(s,s,o);n.push(Es(e,t,0,1))}else if("sheary"===t){let t=new dt(s,s,o);n.push(Es(e,t,0,1))}else if("inherit"===t){let t=new ut(s,i.index);for(let s=0;s<e.length;s++){let a=e[s];t.setFrame(s,Xs(a,"time",0),V.enumValue(ee,Xs(a,"inherit","Normal")))}n.push(t)}}}if(t.ik)for(let e in t.ik){let r=t.ik[e],i=r[0];if(!i)continue;let o=s.findIkConstraint(e);if(!o)throw new Error("IK Constraint not found: "+e);let l=s.ikConstraints.indexOf(o),h=new vt(r.length,r.length<<1,l),c=Xs(i,"time",0),d=Xs(i,"mix",1),u=Xs(i,"softness",0)*a;for(let t=0,e=0;;t++){h.setFrame(t,c,d,u,Xs(i,"bendPositive",!0)?1:-1,Xs(i,"compress",!1),Xs(i,"stretch",!1));let s=r[t+1];if(!s){h.shrink(e);break}let n=Xs(s,"time",0),o=Xs(s,"mix",1),l=Xs(s,"softness",0)*a,m=i.curve;m&&(e=Rs(m,h,e,t,0,c,n,d,o,1),e=Rs(m,h,e,t,1,c,n,u,l,a)),c=n,d=o,u=l,i=s}n.push(h)}if(t.transform)for(let e in t.transform){let a=t.transform[e],r=a[0];if(!r)continue;let i=s.findTransformConstraint(e);if(!i)throw new Error("Transform constraint not found: "+e);let o=s.transformConstraints.indexOf(i),l=new St(a.length,6*a.length,o),h=Xs(r,"time",0),c=Xs(r,"mixRotate",1),d=Xs(r,"mixX",1),u=Xs(r,"mixY",d),m=Xs(r,"mixScaleX",1),f=Xs(r,"mixScaleY",m),g=Xs(r,"mixShearY",1);for(let t=0,e=0;;t++){l.setFrame(t,h,c,d,u,m,f,g);let s=a[t+1];if(!s){l.shrink(e);break}let n=Xs(s,"time",0),i=Xs(s,"mixRotate",1),o=Xs(s,"mixX",1),p=Xs(s,"mixY",o),x=Xs(s,"mixScaleX",1),w=Xs(s,"mixScaleY",x),b=Xs(s,"mixShearY",1),y=r.curve;y&&(e=Rs(y,l,e,t,0,h,n,c,i,1),e=Rs(y,l,e,t,1,h,n,d,o,1),e=Rs(y,l,e,t,2,h,n,u,p,1),e=Rs(y,l,e,t,3,h,n,m,x,1),e=Rs(y,l,e,t,4,h,n,f,w,1),e=Rs(y,l,e,t,5,h,n,g,b,1)),h=n,c=i,d=o,u=p,m=x,f=w,m=x,r=s}n.push(l)}if(t.path)for(let e in t.path){let r=t.path[e],i=s.findPathConstraint(e);if(!i)throw new Error("Path constraint not found: "+e);let o=s.pathConstraints.indexOf(i);for(let t in r){let e=r[t],s=e[0];if(!s)continue;let l=e.length;if("position"===t){let t=new At(l,l,o);n.push(Es(e,t,0,i.positionMode==se.Fixed?a:1))}else if("spacing"===t){let t=new It(l,l,o);n.push(Es(e,t,0,i.spacingMode==ae.Length||i.spacingMode==ae.Fixed?a:1))}else if("mix"===t){let t=new Mt(l,3*l,o),a=Xs(s,"time",0),r=Xs(s,"mixRotate",1),i=Xs(s,"mixX",1),h=Xs(s,"mixY",i);for(let n=0,o=0;;n++){t.setFrame(n,a,r,i,h);let l=e[n+1];if(!l){t.shrink(o);break}let c=Xs(l,"time",0),d=Xs(l,"mixRotate",1),u=Xs(l,"mixX",1),m=Xs(l,"mixY",u),f=s.curve;f&&(o=Rs(f,t,o,n,0,a,c,r,d,1),o=Rs(f,t,o,n,1,a,c,i,u,1),o=Rs(f,t,o,n,2,a,c,h,m,1)),a=c,r=d,i=u,h=m,s=l}n.push(t)}}}if(t.physics)for(let e in t.physics){let a=t.physics[e],r=-1;if(e.length>0){let t=s.findPhysicsConstraint(e);if(!t)throw new Error("Physics constraint not found: "+e);r=s.physicsConstraints.indexOf(t)}for(let t in a){let e=a[t],s=e[0];if(!s)continue;let i,o=e.length;if("reset"!=t){if("inertia"==t)i=new Ft(o,o,r);else if("strength"==t)i=new Tt(o,o,r);else if("damping"==t)i=new Et(o,o,r);else if("mass"==t)i=new Yt(o,o,r);else if("wind"==t)i=new Rt(o,o,r);else if("gravity"==t)i=new Xt(o,o,r);else{if("mix"!=t)continue;i=new _t(o,o,r)}n.push(Es(e,i,0,1))}else{const t=new Bt(o,r);for(let a=0;null!=s;s=e[a+1],a++)t.setFrame(a,Xs(s,"time",0));n.push(t)}}}if(t.attachments)for(let e in t.attachments){let r=t.attachments[e],i=s.findSkin(e);if(!i)throw new Error("Skin not found: "+e);for(let t in r){let e=r[t],o=s.findSlot(t);if(!o)throw new Error("Slot not found: "+t);let l=o.index;for(let t in e){let s=e[t],r=i.getAttachment(l,t);for(let t in s){let e=s[t],i=e[0];if(i)if("deform"==t){let t=r.bones,s=r.vertices,o=t?s.length/3*2:s.length,h=new bt(e.length,e.length,l,r),c=Xs(i,"time",0);for(let n=0,r=0;;n++){let l,d=Xs(i,"vertices",null);if(d){l=V.newFloatArray(o);let e=Xs(i,"offset",0);if(V.arrayCopy(d,0,l,e,d.length),1!=a)for(let t=e,s=t+d.length;t<s;t++)l[t]*=a;if(!t)for(let t=0;t<o;t++)l[t]+=s[t]}else l=t?V.newFloatArray(o):s;h.setFrame(n,c,l);let u=e[n+1];if(!u){h.shrink(r);break}let m=Xs(u,"time",0),f=i.curve;f&&(r=Rs(f,h,r,n,0,c,m,0,1,1)),c=m,i=u}n.push(h)}else if("sequence"==t){let t=new Pt(e.length,l,r),s=0;for(let a=0;a<e.length;a++){let n=Xs(i,"delay",s),r=Xs(i,"time",0),o=$[Xs(i,"mode","hold")],l=Xs(i,"index",0);t.setFrame(a,r,o,l,n),s=n,i=e[a+1]}n.push(t)}}}}}if(t.drawOrder){let e=new kt(t.drawOrder.length),a=s.slots.length,r=0;for(let n=0;n<t.drawOrder.length;n++,r++){let i=t.drawOrder[n],o=null,l=Xs(i,"offsets",null);if(l){o=V.newArray(a,-1);let t=V.newArray(a-l.length,0),e=0,n=0;for(let a=0;a<l.length;a++){let r=l[a],i=s.findSlot(r.slot);if(!i)throw new Error("Slot not found: "+i);let h=i.index;for(;e!=h;)t[n++]=e++;o[e+r.offset]=e++}for(;e<a;)t[n++]=e++;for(let e=a-1;e>=0;e--)-1==o[e]&&(o[e]=t[--n])}e.setFrame(r,Xs(i,"time",0),o)}n.push(e)}if(t.events){let e=new yt(t.events.length),a=0;for(let n=0;n<t.events.length;n++,a++){let r=t.events[n],i=s.findEvent(r.name);if(!i)throw new Error("Event not found: "+r.name);let o=new Ae(V.toSinglePrecision(Xs(r,"time",0)),i);o.intValue=Xs(r,"int",i.intValue),o.floatValue=Xs(r,"float",i.floatValue),o.stringValue=Xs(r,"string",i.stringValue),o.data.audioPath&&(o.volume=Xs(r,"volume",1),o.balance=Xs(r,"balance",0)),e.setFrame(a,o)}n.push(e)}let r=0;for(let t=0,e=n.length;t<e;t++)r=Math.max(r,n[t].getDuration());s.animations.push(new j(e,n,r))}}class Ts{parent;skin;slotIndex;mesh;inheritTimeline;constructor(t,e,s,a,n){this.mesh=t,this.skin=e,this.slotIndex=s,this.parent=a,this.inheritTimeline=n}}function Es(t,e,s,a){let n=t[0],r=Xs(n,"time",0),i=Xs(n,"value",s)*a,o=0;for(let l=0;;l++){e.setFrame(l,r,i);let h=t[l+1];if(!h)return e.shrink(o),e;let c=Xs(h,"time",0),d=Xs(h,"value",s)*a;n.curve&&(o=Rs(n.curve,e,o,l,0,r,c,i,d,a)),r=c,i=d,n=h}}function Ys(t,e,s,a,n,r){let i=t[0],o=Xs(i,"time",0),l=Xs(i,s,n)*r,h=Xs(i,a,n)*r,c=0;for(let d=0;;d++){e.setFrame(d,o,l,h);let u=t[d+1];if(!u)return e.shrink(c),e;let m=Xs(u,"time",0),f=Xs(u,s,n)*r,g=Xs(u,a,n)*r,p=i.curve;p&&(c=Rs(p,e,c,d,0,o,m,l,f,r),c=Rs(p,e,c,d,1,o,m,h,g,r)),o=m,l=f,h=g,i=u}}function Rs(t,e,s,a,n,r,i,o,l,h){if("stepped"==t)return e.setStepped(a),s;let c=n<<2,d=t[c],u=t[c+1]*h,m=t[c+2],f=t[c+3]*h;return e.setBezier(s,a,n,r,o,d,u,m,f,i,l),s+1}function Xs(t,e,s){return void 0!==t[e]?t[e]:s}var _s;function Bs(t,e,s){const a=new we(t);return"json"===s?new Fs(a).readSkeletonData(e):new Ne(a).readSkeletonData(new Uint8Array(e))}async function Ps(e,s,a){let n;const r=e.map(((e,n)=>{const r=s[n];let i=t.Texture2D;return"ktx"===r?i=t.KTX:"ktx2"===r&&(i=t.KTX2),Os(e,a,i)}));try{n=await Promise.all(r)}catch(t){throw t}return n}async function Vs(t,s){const a=function(t){const e=new URL(t),s=e.origin+e.pathname;return s.endsWith("/")?s:s.substring(0,s.lastIndexOf("/")+1)}(t);let n,r;try{n=await e(t,{type:"text"})}catch(e){throw new Error(`Spine Atlas: ${t} load error: ${e}`)}let i=new ce(n);const o=[];for(let t of i.pages){const e=a+t.name;o.push(Os(e,s))}try{r=await Promise.all(o)}catch(t){throw new Error(`Spine Texture: load error: ${t}`)}return i=Ds(n,r),i}function Ds(t,e){const s=new ce(t);return s.pages.forEach(((t,s)=>{const a=function(t){return new Ns(new Image,t)}(e.find((e=>e.name===t.name))||e[s]);t.setTexture(a)})),s}function Os(e,s,a=t.Texture2D){return s.resourceManager.load({url:e,type:a})}void 0===Math.fround&&(Math.fround=(_s=new Float32Array(1),function(t){return _s[0]=t,_s[0]}));class Ns extends Zt{constructor(t,e){super(t),this.texture=e,this.texture.generateMipmaps()}getImage(){return this.texture}setFilters(t,e){t===Qt.Nearest?this.texture.filterMode=s.Point:e===Qt.MipMapLinearLinear?this.texture.filterMode=s.Trilinear:this.texture.filterMode=s.Bilinear}setWraps(t,e){this.texture.wrapModeU=this._convertWrapMode(t),this.texture.wrapModeV=this._convertWrapMode(e)}dispose(){}_convertWrapMode(t){switch(t){case te.ClampToEdge:return a.Clamp;case te.Repeat:return a.Repeat;case te.MirroredRepeat:return a.Mirror;default:throw new Error("Unsupported texture wrap mode.")}}}class Ls{constructor(t,e=1){this._type=t,this._lastElementIndex=e-1;const s=this._elements=new Array(e);for(let a=0;a<e;++a)s[a]=new t}get(){return this._lastElementIndex<0?new this._type:this._elements[this._lastElementIndex--]}return(t){this._elements[++this._lastElementIndex]=t}}class qs{constructor(t){this._usedElementCount=0,this._type=t,this._elements=[]}get(){const{_usedElementCount:t,_elements:e}=this;if(this._usedElementCount++,e.length===t){const t=new this._type;return e.push(t),t}return e[t]}clear(){this._usedElementCount=0}}const{SourceAlpha:Us,One:Ws,DestinationColor:zs,Zero:$s,OneMinusSourceColor:Gs,OneMinusSourceAlpha:js}=n,{Add:Hs}=r;function Js(t,e){const s=t.renderState.blendState.targetBlendState;switch(e){case ie.Additive:s.sourceColorBlendFactor=Us,s.destinationColorBlendFactor=Ws,s.sourceAlphaBlendFactor=Ws,s.destinationAlphaBlendFactor=Ws,s.colorBlendOperation=s.alphaBlendOperation=Hs;break;case ie.Multiply:s.sourceColorBlendFactor=zs,s.destinationColorBlendFactor=$s,s.sourceAlphaBlendFactor=Ws,s.destinationAlphaBlendFactor=$s,s.colorBlendOperation=s.alphaBlendOperation=Hs;break;case ie.Screen:s.sourceColorBlendFactor=Ws,s.destinationColorBlendFactor=Gs,s.sourceAlphaBlendFactor=Ws,s.destinationAlphaBlendFactor=Gs,s.colorBlendOperation=s.alphaBlendOperation=Hs;break;default:s.sourceColorBlendFactor=Us,s.destinationColorBlendFactor=js,s.sourceAlphaBlendFactor=Ws,s.destinationAlphaBlendFactor=js,s.colorBlendOperation=s.alphaBlendOperation=Hs}}class Ks{}const Zs=1/0,Qs=-1/0;class ta{static{this.QUAD_TRIANGLES=[0,1,2,2,3,0]}static{this.VERTEX_SIZE=8}static{this.VERTEX_STRIDE=9}static{this.tempDark=new R}static{this.tempColor=new R}static{this.tempVerts=new Array(8)}static{this.tempBlendMode=null}static{this.tempTexture=null}static{this.subPrimitivePool=new Ls(i)}static{this.subRenderItemPool=new qs(Ks)}static{this.bounds=new o(new l(Zs,Zs,Zs),new l(Qs,Qs,Qs))}getMaxVertexCount(t){let e=0;const{skins:s}=t,a=s.length;for(let t=0;t<a;t+=1){const a=s[t],n=this._getSkinVertexCount(a);e=Math.max(e,n)}return e}buildPrimitive(t,e){const{useClipping:s=!0,zSpacing:a=.01}=e.setting,{_clipper:n,_separateSlots:r,_subRenderItems:i,_separateSlotTextureMap:o}=this,{bounds:l}=ta;l.min.set(Zs,Zs,Zs),l.max.set(Qs,Qs,Qs);let h=0,c=0;const d=t.drawOrder,u=d.length,{engine:m,_indices:f,_vertices:g,_subPrimitives:p}=e;let{tempVerts:x,tempTexture:w,tempBlendMode:b,subRenderItemPool:y,subPrimitivePool:k}=ta;i.length=0,y.clear();let v,S,A=e._vertices,I=0,M=0,C=ie.Normal,F=null,T=0;ta.tempBlendMode=null,ta.tempTexture=null;for(let t=0;t<u;++t){const e=d[t];if(!e.bone.active){n.clipEndWithSlot(e);continue}const l=e.getAttachment();let u=null;const m=a*t;let E=0;const Y=n.isClipping();let R=Y?2:ta.VERTEX_SIZE;if(l){switch(l.constructor){case xe:const t=l;u=t.color,E=4*R,t.computeWorldVertices(e,x,0,R),v=ta.QUAD_TRIANGLES,S=t.uvs,F=t.region.texture;break;case fe:const a=l;u=a.color,E=(a.worldVerticesLength>>1)*R,E>A.length&&(ta.tempVerts=new Array(E)),a.computeWorldVertices(e,0,a.worldVerticesLength,x,0,R),v=a.triangles,S=a.uvs,F=a.region.texture;break;case Kt:if(s){let t=l;n.clipStart(e,t)}continue;default:s&&n.clipEndWithSlot(e);continue}if(null!=F){let t,s,a,l,d=e.bone.skeleton.color,A=e.color,X=d.a*A.a*u.a,_=ta.tempColor,B=ta.tempDark;if(_.set(d.r*A.r*u.r,d.g*A.g*u.g,d.b*A.b*u.b,X),Y)n.clipTriangles(x,v,v.length,S,_,B,!1),t=n.clippedVertices,s=t.length,a=n.clippedTriangles,l=a.length;else{let e=x;const{r:n,g:r,b:i,a:o}=_;for(let t=2,s=0,a=E;t<a;t+=R,s+=2)e[t]=n,e[t+1]=r,e[t+2]=i,e[t+3]=o,e[t+4]=S[s],e[t+5]=S[s+1];t=x,s=E,a=v,l=v.length}if(0==s||0==l){n.clipEndWithSlot(e);continue}let P=h/ta.VERTEX_STRIDE,V=g,D=h,O=0;for(;O<s;){let e=t[O++],s=t[O++];V[D++]=e,V[D++]=s,V[D++]=m,V[D++]=t[O++],V[D++]=t[O++],V[D++]=t[O++],V[D++]=t[O++],V[D++]=t[O++],V[D++]=t[O++],this._expandByPoint(e,s,m)}h=D;let N=f;for(D=c,O=0;O<l;D++,O++)N[D]=a[O]+P;c+=l;const L=e.data,q=L.name;C=L.blendMode;const U=null!==b&&b!==L.blendMode,W=null!==w&&w!==F,z=r.get(q);if(z||U||W){if(M>0){const t=p[T];t&&T++;const e=t||k.get();e.start=I,e.count=M;const s=y.get();s.subPrimitive=e,s.texture=w,s.blendMode=b,i.push(s),I+=M,M=0}if(z){const t=o.get(q);if(t){const e=F.texture;t.filterMode=e.filterMode,t.wrapModeU=e.wrapModeU,t.wrapModeV=e.wrapModeV}const e=p[T];e&&T++;const s=e||k.get();s.start=I,s.count=l;const a=y.get();a.blendMode=C,a.subPrimitive=s,a.texture=F,a.slotName=q,i.push(a),I+=l,M=0}else M+=l}else M+=l;w=F,b=C}n.clipEndWithSlot(e)}else s&&n.clipEndWithSlot(e)}if(M>0){const t=p[T];t&&T++;const e=t||k.get();e.start=I,e.count=M;const s=y.get();s.blendMode=C,s.subPrimitive=e,s.texture=F,i.push(s),M=0}n.clipEnd();const E=p.length,Y=i.length;if(Y<E)for(let t=Y;t<E;t++){const e=p[t];k.return(e)}e._clearSubPrimitives();for(let t=0,s=Y;t<s;++t){const s=i[t],{slotName:a,blendMode:n,texture:r}=s;e._addSubPrimitive(s.subPrimitive);let l=r.texture;o.has(a)&&(l=o.get(a));const h=`${l.instanceId}_${n}`;let c=sa._materialCache.get(h);c||(c=this._createMaterialForTexture(l,m,n),sa._materialCache.set(h,c)),e.setMaterial(t,c)}e._vertexBuffer.setData(g),e._indexBuffer.setData(f)}addSeparateSlot(t){this._separateSlots.set(t,t)}addSeparateSlotTexture(t,e){this._separateSlotTextureMap.set(t,e)}_createMaterialForTexture(t,e,s){const a=sa._getDefaultMaterial(e);return a.shaderData.setTexture("material_SpineTexture",t),Js(a,s),a}_expandByPoint(t,e,s){const{bounds:{min:a,max:n}}=ta,r=Math.min(a.x,t),i=Math.min(a.y,e),o=Math.min(a.z,s),l=Math.max(n.x,t),h=Math.max(n.y,e),c=Math.max(n.z,s);a.set(r,i,o),n.set(l,h,c)}_getSkinVertexCount(t){const{attachments:e}=t;let s=0;const a=ta.QUAD_TRIANGLES.length;for(let t=0,n=e.length;t<n;t++){const n=e[t];for(let t in n){const e=n[t];if(e)if(e instanceof xe)s+=a;else{if(!(e instanceof fe))continue;s+=e.triangles.length}}}return s}constructor(){this._clipper=new Cs,this._subRenderItems=[],this._separateSlots=new Map,this._separateSlotTextureMap=new Map}}class ea extends h{static{this._spineVS="\n    uniform mat4 renderer_MVPMat;\n\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    attribute vec4 COLOR_0;\n    \n    varying vec2 v_uv;\n    varying vec4 v_color;\n    \n    void main()\n    {\n      gl_Position = renderer_MVPMat * vec4(POSITION, 1.0);\n    \n      v_uv = TEXCOORD_0;\n      v_color = COLOR_0;\n    }\n  "}static{this._spineFS="\n    uniform sampler2D material_SpineTexture;\n\n    varying vec2 v_uv;\n    varying vec4 v_color;\n    \n    void main()\n    {\n        vec4 baseColor = texture2D(material_SpineTexture, v_uv);\n        gl_FragColor = baseColor * v_color;\n    }\n   "}constructor(t){super(t,c.find("galacean-spine-shader")||c.create("galacean-spine-shader",ea._spineVS,ea._spineFS));const e=this.renderState;e.blendState.targetBlendState.enabled=!0,Js(this,ie.Normal),e.depthState.writeEnabled=!1,e.rasterState.cullMode=d.Off,e.renderQueueType=u.Transparent}}class sa extends m{static{this._spineGenerator=new ta}static{this._positionVertexElement=new f("POSITION",0,g.Vector3,0)}static{this._colorVertexElement=new f("COLOR_0",12,g.Vector4,0)}static{this._uvVertexElement=new f("TEXCOORD_0",28,g.Vector2,0)}static{this._materialCache=new Map}static{this._animationDataCache=new Map}static _getDefaultMaterial(t){let e=this._defaultMaterial;if(e){if(e.engine===t)return e.clone();e.destroy(!0),e=null}return e=new ea(t),e.isGCIgnored=!0,this._defaultMaterial=e,e.clone()}get resource(){return this._resource}set resource(t){if(!t)return this._state=null,this._skeleton=null,void(this._resource=null);this._resource=t,this._addResourceReferCount(t,1);const{skeletonData:e}=t;this._skeleton=new Xe(e);let s=sa._animationDataCache.get(e);s||(s=new Ht(e),sa._animationDataCache.set(e,s)),this._state=new Vt(s);const a=sa._spineGenerator.getMaxVertexCount(e);this._createBuffer(a),this._initializeDefaultState(),this._dirtyUpdateFlag|=4,this._state.addListener({start:()=>{this._onAnimationStart()},complete:t=>{this._onAnimationComplete(t)}})}get state(){return this._state}get skeleton(){return this._skeleton}constructor(t){super(t),this.setting=new ra,this.defaultState=new ia,this._subPrimitives=[],this._needResizeBuffer=!1,this._vertexCount=0;const e=new p(this._engine);this._primitive=e,e.addVertexElement(sa._positionVertexElement),e.addVertexElement(sa._colorVertexElement),e.addVertexElement(sa._uvVertexElement)}addSeparateSlot(t){this._skeleton||console.error("Skeleton not found!");this._skeleton.findSlot(t)?sa._spineGenerator.addSeparateSlot(t):console.warn(`Slot: ${t} not find.`)}_onEnable(){this._initializeDefaultState()}update(t){const{_state:e,_skeleton:s}=this;e&&s&&(e.update(t),e.apply(s),s.update(t),s.updateWorldTransform(re.update),sa._spineGenerator.buildPrimitive(this._skeleton,this),this._isContainDirtyFlag(4)&&(this._onWorldVolumeChanged(),this._setDirtyFlagFalse(4)),this._isContainDirtyFlag(2)&&this._calculateGeneratorBounds(this.bounds))}_render(t){const{_primitive:e,_subPrimitives:s}=this,{_materials:a,_engine:n}=this,r=n._renderElementPool.get();r.set(this.priority,this._distanceForSort);const i=n._subRenderElementPool;if(s){for(let t=0,n=s.length;t<n;t++){let n=a[t];if(!n)continue;(n.destroyed||n.shader.destroyed)&&(n=this.engine._meshMagentaMaterial);const o=i.get();o.set(this,n,e,s[t]),r.addSubRenderElement(o)}t.camera._renderPipeline.pushRenderElement(t,r)}}_updateBounds(t){this._calculateGeneratorBounds(t)}_calculateGeneratorBounds(t){const{bounds:e}=ta;o.transform(e,this.entity.transform.worldMatrix,t)}_cloneTo(t){t.resource=this._resource}_onDestroy(){const{_primitive:t,_subPrimitives:e,_resource:s}=this;e.length=0,t&&t.destroy(),s&&this._addResourceReferCount(s,-1),this._clearMaterialCache(),this._primitive=null,this._resource=null,this._skeleton=null,this._state=null,this.setting=null,super._onDestroy()}_createBuffer(t){const{_engine:e,_primitive:s}=this;this._vertices=new Float32Array(t*ta.VERTEX_STRIDE),this._indices=new Uint16Array(t);const a=4*ta.VERTEX_STRIDE,n=new x(e,w.VertexBuffer,this._vertices,b.Dynamic),r=new x(e,w.IndexBuffer,this._indices,b.Dynamic);this._indexBuffer=r,this._vertexBuffer=n;const i=new y(n,a);this._primitive.setVertexBufferBinding(0,i);const o=new k(r,v.UInt16);s.setIndexBufferBinding(o)}_addSubPrimitive(t){this._subPrimitives.push(t)}_clearSubPrimitives(){this._subPrimitives.length=0}_isContainDirtyFlag(t){return!!(this._dirtyUpdateFlag&t)}_setDirtyFlagFalse(t){this._dirtyUpdateFlag&=~t}_onWorldVolumeChanged(){this._dirtyUpdateFlag|=1}_onAnimationStart(){this._dirtyUpdateFlag|=2}_onAnimationComplete(t){t.loop||this._setDirtyFlagFalse(2)}_clearMaterialCache(){this._materials.forEach((t=>{const e=t.shaderData.getTexture("material_SpineTexture"),s=function(t){const e=t.renderState.blendState.targetBlendState;return e.sourceColorBlendFactor===Us&&e.destinationColorBlendFactor===Ws&&e.sourceAlphaBlendFactor===Ws&&e.destinationAlphaBlendFactor===Ws&&e.colorBlendOperation===Hs&&e.alphaBlendOperation===Hs?ie.Additive:e.sourceColorBlendFactor===zs&&e.destinationColorBlendFactor===$s&&e.sourceAlphaBlendFactor===Ws&&e.destinationAlphaBlendFactor===$s&&e.colorBlendOperation===Hs&&e.alphaBlendOperation===Hs?ie.Multiply:e.sourceColorBlendFactor===Ws&&e.destinationColorBlendFactor===Gs&&e.sourceAlphaBlendFactor===Ws&&e.destinationAlphaBlendFactor===Gs&&e.colorBlendOperation===Hs&&e.alphaBlendOperation===Hs?ie.Screen:ie.Normal}(t),a=`${e.instanceId}_${s}`;sa._materialCache.delete(a)}))}_initializeDefaultState(){const{skeleton:t,state:e}=this;if(t&&e){const{animationName:s,skinName:a,loop:n,scale:r}=this.defaultState;t.scaleX=r,t.scaleY=r,"default"!==a&&(t.setSkinByName(a),t.setToSetupPose()),s&&e.setAnimation(0,s,n)}}}var aa,na;T([S],sa.prototype,"setting",void 0),T([S],sa.prototype,"defaultState",void 0),T([A],sa.prototype,"_primitive",void 0),T([A],sa.prototype,"_subPrimitives",void 0),T([A],sa.prototype,"_indexBuffer",void 0),T([A],sa.prototype,"_vertexBuffer",void 0),T([A],sa.prototype,"_vertices",void 0),T([A],sa.prototype,"_indices",void 0),T([A],sa.prototype,"_needResizeBuffer",void 0),T([A],sa.prototype,"_vertexCount",void 0),T([A],sa.prototype,"_resource",void 0),T([A],sa.prototype,"_skeleton",void 0),T([A],sa.prototype,"_state",void 0),function(t){t[t.TransformVolume=1]="TransformVolume",t[t.AnimationVolume=2]="AnimationVolume",t[t.InitialVolume=4]="InitialVolume"}(aa||(aa={})),function(t){t[t.WorldVolume=1]="WorldVolume"}(na||(na={}));class ra{constructor(t=.01,e=!0){this.zSpacing=t,this.useClipping=e}}class ia{constructor(t=1,e=!0,s=null,a="default"){this.scale=t,this.loop=e,this.animationName=s,this.skinName=a}}class oa extends I{get skeletonData(){return this._skeletonData}constructor(t,e){super(t),this.textures=[],this._skeletonData=e,this._associationTextureInSkeletonData(e)}_onDestroy(){super._onDestroy();const{textures:t,_skeletonData:e}=this;t&&this._disassociationSuperResource(t),this._clearAttachmentTextures(e),sa._animationDataCache.delete(e),this._skeletonData=null}_disassociationSuperResource(t){for(let e=0,s=t.length;e<s;e++)t[e]._disassociationSuperResource(this)}_associationTextureInSkeletonData(t){const{skins:e}=t;e.forEach((t=>{const{attachments:e}=t;e.forEach((t=>{const e=Object.values(t)[0],s=e?.region?.texture.texture;s&&!this.textures.find((t=>t.instanceId===s.instanceId))&&(this.textures.push(s),s._associationSuperResource(this))}))}))}_clearAttachmentTextures(t){const{skins:e}=t;e.forEach((t=>{const{attachments:e}=t;e.forEach((t=>{const e=Object.values(t)[0];e?.region?.texture&&(e.region.texture.texture=null)}))}))}}class la{constructor(t,e=0,s){this.data=t,this._dataView=new DataView(t.buffer,t.byteOffset+e,s??t.byteLength-e),this._position=0}nextUint16(){const t=this._dataView.getUint16(this._position,!0);return this._position+=2,t}nextStr(){const t=this.nextUint16(),e=new Uint8Array(this.data.buffer,this._position+this._dataView.byteOffset,t);return this._position+=t,this.decodeText(e)}nextImageData(){return new Uint8Array(this.data.buffer,this.data.byteOffset+this._position)}decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let s=0,a=t.length;s<a;s++)e+=String.fromCharCode(t[s]);return decodeURIComponent(encodeURIComponent(e))}}class ha extends M{static{this.imageExtensions=["png","jpg","webp","jpeg","ktx","ktx2"]}static{this.skeletonExtensions=["skel","json","bin"]}static parseAndAssignSpineAsset(t,e,s){const{imageExtensions:a,skeletonExtensions:n}=ha,r=ha.getUrlExtension(t,e);r&&(n.includes(r)&&(s.skeletonPath=t,s.skeletonExtension=r),"atlas"===r&&(s.atlasPath=t),a.includes(r)&&(s.imagePaths.push(t),s.imageExtensions.push(r)))}static deriveAndAssignSpineAsset(t,e,s){const a=ha.getUrlExtension(t,e);if(!a)return;s.skeletonPath=t,s.skeletonExtension=a;const n=/(\.(json|bin|skel))$/;let r;if(n.test(t)&&(r=t.replace(n,"")),r){const t=r+".atlas";s.atlasPath=t}}static verifyFileExtensions(t,e){return t?e&&!Array.isArray(t)?(console.error("Expect fileExtensions to be an array."),[]):e||"string"==typeof t?t:(console.error("Expect fileExtensions to be a string."),null):null}static getUrlExtension(t,e){if(e)return e;const s=t.match(/\/([^\/?#]+)\.([a-zA-Z0-9]+)(\?|#|$)|\?[^#]*\.([a-zA-Z0-9]+)(\?|#|$)/);return s?s[2]||s[4]:null}load(t,e){return new C((async s=>{let a;if(t.urls)a=await this._handleOriginAsset(t,e);else{const s=await this.request(t.url,{type:"arraybuffer"}),n=new la(new Uint8Array(s)),r=n.nextStr();a=r.startsWith("spine")?await this._handleEditorAsset(s,n,r,e):await this._handleOriginAsset(t,e,s)}s(a)}))}async _handleEditorAsset(t,e,s,a){let n,r;const i=s.startsWith("spine:skel")?"skel":"json",{engine:o}=a;if("skel"===i)r=e.nextStr(),n=e.nextImageData();else{const e=new TextDecoder("utf-8").decode(new Uint8Array(t)),{data:s,atlas:a}=JSON.parse(e);r=a.refId,n=s}const l=Bs(await a.getResourceByRef({refId:r}),n,i);return new oa(o,l)}async _handleOriginAsset(t,e,s){let{fileExtensions:a}=t.params||{},n={skeletonPath:"",skeletonExtension:"",atlasPath:"",imagePaths:[],imageExtensions:[]};const{engine:r}=e;if(s){const e=ha.verifyFileExtensions(a,!1);ha.deriveAndAssignSpineAsset(t.url,e,n);const{skeletonPath:i,atlasPath:o}=n;if(!i||!o)throw new Error("Failed to load spine assets. Please check the file path and ensure the file extension is included.");const l=await Vs(o,r),{data:h,type:c}=this._determineSkeletonDataType(s),d=Bs(l,h,c);return new oa(r,d)}{a=ha.verifyFileExtensions(a,!0);for(let e=0;e<t.urls.length;e+=1){const s=t.urls[e],r=a&&a[e]||null;ha.parseAndAssignSpineAsset(s,r,n)}const{skeletonPath:e,atlasPath:s,imagePaths:i,skeletonExtension:o,imageExtensions:l}=n;if(!e||!s)throw new Error("Failed to load spine assets. Please check the file path and ensure the file extension is included.");const h="json"===o?"json":"skel";let c,d,u=["json"===o?this.request(e,{type:"text"}):this.request(e,{type:"arraybuffer"})];if(i.length>0){let t,e;u=u.concat([this.request(s,{type:"text"}),Ps(i,l,r)]),[d,t,e]=await Promise.all(u),c=Ds(t,e)}else u.push(Vs(s,r)),[d,c]=await Promise.all(u);const m=Bs(c,d,h);return new oa(r,m)}}_determineSkeletonDataType(t){let e,s;try{const a=new TextDecoder("utf-8").decode(t);JSON.parse(a),e=a,s="json"}catch(a){e=t,s="skel"}return{data:e,type:s}}}ha=T([F("spine",["json","bin","skel"])],ha);class ca extends M{load(t,e){return new C((async s=>{const a=await this.request(t.url,{type:"text"}),{data:n,textures:r}=JSON.parse(a),i=r.map((t=>e.getResourceByRef({refId:t.refId})));s(Ds(n,await Promise.all(i)))}))}}ca=T([F("EditorSpineAtlas",["atlas"])],ca);const da="4.2.0-beta.0";M.registerClass("SpineAnimationRenderer",sa),console.log(`Galacean spine version: ${da}`);export{gt as AlphaTimeline,j as Animation,Vt as AnimationState,Lt as AnimationStateAdapter,Ht as AnimationStateData,ve as AssetManagerBase,we as AtlasAttachmentLoader,U as Attachment,wt as AttachmentTimeline,Le as BinaryInput,ie as BlendMode,ye as Bone,be as BoneData,Jt as BoundingBoxAttachment,jt as CURRENT,Kt as ClippingAttachment,R as Color,ke as ConstraintData,Q as CurveTimeline,tt as CurveTimeline1,et as CurveTimeline2,D as DebugUtils,bt as DeformTimeline,Se as Downloader,kt as DrawOrderTimeline,Ae as Event,Ie as EventData,Ot as EventQueue,yt as EventTimeline,Nt as EventType,Ut as FIRST,he as FakeTexture,zt as HOLD_FIRST,$t as HOLD_MIX,Wt as HOLD_SUBSEQUENT,Me as IkConstraint,Ce as IkConstraintData,vt as IkConstraintTimeline,ee as Inherit,ut as InheritTimeline,E as IntSet,_ as Interpolation,X as MathUtils,fe as MeshAttachment,H as MixBlend,J as MixDirection,ge as PathAttachment,Te as PathConstraint,Fe as PathConstraintData,Mt as PathConstraintMixTimeline,At as PathConstraintPositionTimeline,It as PathConstraintSpacingTimeline,re as Physics,Et as PhysicsConstraintDampingTimeline,Xt as PhysicsConstraintGravityTimeline,Ft as PhysicsConstraintInertiaTimeline,Yt as PhysicsConstraintMassTimeline,_t as PhysicsConstraintMixTimeline,Bt as PhysicsConstraintResetTimeline,Tt as PhysicsConstraintStrengthTimeline,Ct as PhysicsConstraintTimeline,Rt as PhysicsConstraintWindTimeline,pe as PointAttachment,O as Pool,se as PositionMode,B as Pow,P as PowOut,xt as RGB2Timeline,pt as RGBA2Timeline,mt as RGBATimeline,ft as RGBTimeline,xe as RegionAttachment,ne as RotateMode,st as RotateTimeline,Gt as SETUP,qt as SUBSEQUENT,it as ScaleTimeline,ot as ScaleXTimeline,lt as ScaleYTimeline,Pt as SequenceTimeline,ht as ShearTimeline,ct as ShearXTimeline,dt as ShearYTimeline,Xe as Skeleton,Ne as SkeletonBinary,Is as SkeletonBounds,Cs as SkeletonClipping,Be as SkeletonData,oa as SkeletonDataResource,Fs as SkeletonJson,Ve as Skin,Pe as SkinEntry,Ye as Slot,De as SlotData,ae as SpacingMode,sa as SpineAnimationRenderer,Y as StringSet,Zt as Texture,ce as TextureAtlas,ue as TextureAtlasPage,me as TextureAtlasRegion,Qt as TextureFilter,le as TextureRegion,te as TextureWrap,L as TimeKeeper,Z as Timeline,Dt as TrackEntry,Re as TransformConstraint,Oe as TransformConstraintData,St as TransformConstraintTimeline,at as TranslateTimeline,nt as TranslateXTimeline,rt as TranslateYTimeline,Ms as Triangulator,V as Utils,N as Vector2,W as VertexAttachment,q as WindowedMean,Ds as createTextureAtlas,da as version};
//# sourceMappingURL=module.js.map
